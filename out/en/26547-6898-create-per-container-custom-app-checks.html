<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Create Per-Container Custom App Checks</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="26547-6897-create-a-custom-app-check.html" title="Create a Custom App Check"></link><link rel="next" href="26547-6961-dashboards.html" title="Dashboards"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-6897-create-a-custom-app-check.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-6961-dashboards.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="26547-6498-sysdig-monitor.html">Sysdig Monitor</a></li><li class="breadcrumb-link"><a href="26547-6857-sysdig-integrations.html">Sysdig Integrations</a></li><li class="breadcrumb-node">Create Per-Container Custom App Checks</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-735efcbf-21e2-04d0-715c-a7611f50a926" data-permalink="26547-6898-create-per-container-custom-app-checks.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-b5c715fe-d5a4-f744-872b-78207fd405c7"><div class="titlepage"><div><div class="title"><h4 class="title">Create Per-Container Custom App Checks</h4></div></div></div><p>Sysdig supports adding custom application check-script configurations for each individual container in the infrastructure. This avoids multiple edits and entries to achieve container specific customization. In particular, this enables PaaS to work smarter, by delegating application teams to configure their own checks.</p><p>See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/198934553/Understanding+the+Agent+Config+Files" target="_blank">Understanding the Agent Config Files</a> for details on accessing and editing the agent configuration files in general.</p><h6 id="UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-Contents" class="bridgehead">Contents</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="26547-6898-create-per-container-custom-app-checks.html#UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-HowItWorks" title="How It Works">How It Works</a> </p></li><li class="listitem"><p> <a class="link" href="26547-6898-create-per-container-custom-app-checks.html#UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-ExamplewithDockerfile" title="Example with Dockerfile">Example with Dockerfile</a> </p></li><li class="listitem"><p> <a class="link" href="26547-6898-create-per-container-custom-app-checks.html#UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-ExamplewithDockerCLI" title="Example with Docker CLI">Example with Docker CLI</a> </p></li></ul></div><h6 id="UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-HowItWorks" class="bridgehead">How It Works</h6><p>The SYSDIG_AGENT_CONF variable stores a YAML-formatted configuration for your app check and will be used to match app check configurations.</p><p>All original<a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204767363/Integrate+Custom+Metrics+with+App+Check+Scripts" target="_blank">app_checks</a>are available, and the syntax is the same as for dragent.yaml. You can add the environment variable directly to theDocker file.</p><h6 id="UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-ExamplewithDockerfile" class="bridgehead">Example with Dockerfile</h6><p>This example defines a per container app-check for redis. Normally you would have a yaml formatted entry installed into the agent's <code class="code">/opt/draios/etc/dragent.yaml</code> file that would look like this:</p><pre class="programlisting">app_checks: 
 - name: redis
    check_module: redisdb
    pattern:
      comm: redis-server
    conf:
      host: 127.0.0.1
      port: "{port}"
      password: protected</pre><p>For the per-container method, convert and add the above entry to the Docker file via the SYSDIG_AGENT_CONF environment variable:</p><pre class="programlisting">FROM redis
# This config file adds a password for accessing redis instance
ADD redis.conf /

ENV SYSDIG_AGENT_CONF { "app_checks": [{ "name": "redis", "check_module": "redisdb", "pattern": {"comm": "redis-server"}, "conf": { "host": "127.0.0.1", "port": "6379", "password": "protected"} }] }
ENTRYPOINT ["redis-server"]
CMD [ "/redis.conf" ]</pre><h6 id="UUID-b5c715fe-d5a4-f744-872b-78207fd405c7_id_CreatePer-ContainerCustomAppChecks-ExamplewithDockerCLI" class="bridgehead">Example with Docker CLI</h6><p>You can add parameters starting a container with dockerrunusing-e/--envflag or injecting it using orchestration systems like Kubernetes:</p><pre class="programlisting">
PER_CONTAINER_CONF='{ "app_checks": [{ "name": "redis", "check_module": "redisdb", "pattern": {"comm": "redis-server"}, "conf": { "host": "127.0.0.1", "port": "6379", "password": "protected"} }] }'

docker run --name redis -v /tmp/redis.conf:/etc/redis.conf -e SYSDIG_AGENT_CONF="${PER_CONTAINER_CONF}" -d redis /etc/redis.conf</pre><pre class="programlisting"></pre></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-6897-create-a-custom-app-check.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-6961-dashboards.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
