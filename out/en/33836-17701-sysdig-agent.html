<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="no"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Sysdig Agent</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments"></link><link rel="next" href="33836-17746-administration-settings.html" title="Administration Settings"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><ul class="toc nav nav-site-sidebar"><li><a href="33836-7424-mon--sysdig-monitor-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-069aba38-24df-cfe3-6295-806f95c1d6d3" data-permalink="33836-7424-mon--sysdig-monitor-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> MON (Sysdig Monitor)</a><ul><li><a href="33836-9744-sysdig-monitor.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-80c03485-8397-80ea-8f5f-fc2cae33cb49" data-permalink="33836-9744-sysdig-monitor.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Monitor</a><ul><li><a href="33836-9745-getting-started.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-f338dfdd-e52a-3369-fc78-7c91004d8538" data-permalink="33836-9745-getting-started.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started</a></li><li><a href="33836-9747-overview.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5cc77116-7dd1-a2a9-0b81-8302f36ce5a6" data-permalink="33836-9747-overview.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Overview</a></li><li><a href="33836-9753-explore.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9f1e2c9c-0fde-5a17-7d03-c6508d9a121c" data-permalink="33836-9753-explore.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Explore</a></li><li><a href="33836-9760-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9ecc347f-4d82-142f-f23f-eef54921905c" data-permalink="33836-9760-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics</a></li><li><a href="33836-9769-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3db0303c-3326-331c-b50e-43aee72438f5" data-permalink="33836-9769-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Dashboards</a></li><li><a href="33836-9784-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-0dd6f084-a8c7-47bd-60fd-99e6a6d32231" data-permalink="33836-9784-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Events</a></li><li><a href="33836-9795--doc-785--alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-2c45e57c-0a2c-7a96-4c9c-61ae662e4c78" data-permalink="33836-9795--doc-785--alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">[DOC-785] Alerts</a></li><li><a href="33836-9803-alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-207f896d-385a-ef7f-6a49-006fa7cf0ac9" data-permalink="33836-9803-alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Alerts</a></li><li><a href="33836-9804-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d8263ae-e350-e76b-b33c-a4a6ed9910c5" data-permalink="33836-9804-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li></ul></li></ul></li><li><a href="33836-31726-ss--sysdig-secure-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-9d238259-cba8-538a-45d2-7146377b7970" data-permalink="33836-31726-ss--sysdig-secure-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SS (Sysdig Secure)</a><ul><li><a href="33836-31918-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a4e13476-09e2-0efc-ae18-7955d3e4e07f" data-permalink="33836-31918-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Secure</a><ul><li><a href="33836-31919-getting-started-with-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-34b1cd4b-0b04-382d-958d-c37e8514fd79" data-permalink="33836-31919-getting-started-with-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started with Sysdig Secure</a></li><li><a href="33836-31920-policies.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a6f83873-7719-6a0c-4355-512ead6227e9" data-permalink="33836-31920-policies.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policies</a></li><li><a href="33836-31925-policy-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a0c9d18f-6753-34fe-5537-e841a0c7ebc7" data-permalink="33836-31925-policy-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policy Events</a></li><li><a href="33836-31930-commands-audit.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-e607ad4e-4aff-6808-d2da-124d665c2935" data-permalink="33836-31930-commands-audit.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Commands Audit</a></li><li><a href="33836-31931-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c330d73e-7372-4819-7660-e9c3ebe57377" data-permalink="33836-31931-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li><li><a href="33836-31932-image-scanning.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-138616ae-4150-ab6a-92c5-cda4c1b29469" data-permalink="33836-31932-image-scanning.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Image Scanning</a></li><li><a href="33836-31943-compliance.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b790f1cd-3616-783f-4854-d3561cef37f0" data-permalink="33836-31943-compliance.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Compliance</a></li></ul></li></ul></li><li><a href="33836-14843-sp--sysdig-platform-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-5f790757-94c6-c118-c525-e894abac1da1" data-permalink="33836-14843-sp--sysdig-platform-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SP (Sysdig Platform)</a><ul><li><a href="33836-17625-sysdig-platform.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-d7f578b2-c960-970c-a969-10cebb31d199" data-permalink="33836-17625-sysdig-platform.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Platform</a><ul><li><a href="33836-17626-on-premises-deployments.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b0fbda15-008f-f5ef-e82b-44edcdbddf2f" data-permalink="33836-17626-on-premises-deployments.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">On-Premises Deployments</a></li><li><a href="33836-17701-sysdig-agent.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-ee770b85-3c82-28cf-48e0-a38a6f973bc1" data-permalink="33836-17701-sysdig-agent.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent</a></li><li><a href="33836-17746-administration-settings.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-79535d85-dcdb-4dfd-1b55-de1edacb346d" data-permalink="33836-17746-administration-settings.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Administration Settings</a></li><li><a href="33836-17794-get-help---using-sysdig-support.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-712b3b75-2584-30e3-5bd9-e1e57d3d8756" data-permalink="33836-17794-get-help---using-sysdig-support.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Get Help | Using Sysdig Support</a></li></ul></li></ul></li><li><a href="33836-1790-si--sysdig-integrations-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-a547c8f5-9ae9-1c4c-5e8c-8fe12da3bcb0" data-permalink="33836-1790-si--sysdig-integrations-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SI (Sysdig Integrations)</a><ul><li><a href="33836-3104-sysdig-integrations.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c9afbbe1-ebba-13d8-6b7e-280e11acba65" data-permalink="33836-3104-sysdig-integrations.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Integrations</a><ul><li><a href="33836-3105-integrate-prometheus-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a9b82586-6669-653a-af4c-e3d71e6093b7" data-permalink="33836-3105-integrate-prometheus-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Prometheus Metrics</a></li><li><a href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-eb4a14da-a0d4-5d37-b74c-9c1d4fd24a76" data-permalink="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate JMX Metrics from Java Virtual Machines</a></li><li><a href="33836-3118-integrate-statsd-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6efe354e-5d0d-8dc2-d58c-103524dcb0cb" data-permalink="33836-3118-integrate-statsd-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate StatsD Metrics</a></li><li><a href="33836-3119-integrate-node-js-application-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fd238571-3246-4a22-59ae-18a993d11d70" data-permalink="33836-3119-integrate-node-js-application-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Node.js Application Metrics</a></li><li><a href="33836-3120-integrate-applications--default-app-checks-.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-771652e1-1419-993b-6a15-6ffb08f23cbe" data-permalink="33836-3120-integrate-applications--default-app-checks-.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Applications (Default App Checks)</a></li><li><a href="33836-3163-monitor-log-files.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fab0e8c0-9a8b-6da1-72ed-1a6f78bcc819" data-permalink="33836-3163-monitor-log-files.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Monitor Log Files</a></li><li><a href="33836-3164-create-a-custom-app-check.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-87fda1aa-3729-5b0b-0e6d-3826c07008b2" data-permalink="33836-3164-create-a-custom-app-check.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create a Custom App Check</a></li><li><a href="33836-3165-create-per-container-custom-app-checks.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-be3c8a46-1153-ae68-9ffa-a743b9f4c5c7" data-permalink="33836-3165-create-per-container-custom-app-checks.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create Per-Container Custom App Checks</a></li><li><a href="33836-3167---copy-of-integrate-statsd-metrics--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-62916008-0afc-b3b9-9a57-0619ffd7162c" data-permalink="33836-3167---copy-of-integrate-statsd-metrics--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Copy of Integrate StatsD Metrics**</a></li></ul></li></ul></li><li><a href="33836-321-sd--sysdig-developer-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-02c2a850-5ddd-8c69-e72e-a6c25dd77bd6" data-permalink="33836-321-sd--sysdig-developer-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SD (Sysdig Developer)</a><ul><li><a href="33836-407-sysdig-developer.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c6f9da21-9261-0143-c7bf-cc1911bfd830" data-permalink="33836-407-sysdig-developer.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Developer</a><ul><li><a href="33836-408-sysdig-python-client.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3221c4bb-2722-3923-2318-fface3c5a7dc" data-permalink="33836-408-sysdig-python-client.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Python Client</a></li><li><a href="33836-411-sysdig-rest-api-conventions.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-cd967606-7ed2-3987-4ae5-ebe61c5c63b3" data-permalink="33836-411-sysdig-rest-api-conventions.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig REST API Conventions</a></li><li><a href="33836-412-working-with-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-dab3ac7a-75a7-ca54-b757-48eb6c152382" data-permalink="33836-412-working-with-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Working with Dashboards</a></li><li><a href="33836-415-metrics-dictionary.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb8f1cb0-689d-02b1-685e-ce078d15458d" data-permalink="33836-415-metrics-dictionary.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics Dictionary</a></li><li><a href="33836-486---sample-use-cases--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9560c9cf-68e1-76fb-d9d1-8bc20520c9e9" data-permalink="33836-486---sample-use-cases--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Sample Use Cases**</a></li></ul></li></ul></li><li><a href="33836-29920-srn--sysdig-release-notes-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-3347f819-20ba-fc5a-b851-ef9c9b052358" data-permalink="33836-29920-srn--sysdig-release-notes-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SRN (Sysdig Release Notes)</a><ul><li><a href="33836-30013-sysdig-release-notes-home.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5a6ffc5f-ac34-9a7b-dadd-93a6660c0797" data-permalink="33836-30013-sysdig-release-notes-home.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Release Notes Home</a><ul><li><a href="33836-30014-sysdig-agent-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d6e3387-7f79-746c-f6dc-307df42de9b6" data-permalink="33836-30014-sysdig-agent-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent Release Notes</a></li><li><a href="33836-30015-saas--sysdig-monitor-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6f9142b1-da9d-e39a-a544-b636187d1f1c" data-permalink="33836-30015-saas--sysdig-monitor-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Monitor Release Notes</a></li><li><a href="33836-30016-saas--sysdig-secure-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb47596c-e097-c65e-7b1f-aea99cbe7e6d" data-permalink="33836-30016-saas--sysdig-secure-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Secure Release Notes</a></li><li><a href="33836-30017-sysdig-on-premises-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b883612b-b2eb-205b-e04d-5108476566f9" data-permalink="33836-30017-sysdig-on-premises-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig On-Premises Release Notes</a></li><li><a href="33836-30018-terms-of-use.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-005c4ff8-26e9-cd84-5f78-729f0870b46f" data-permalink="33836-30018-terms-of-use.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Terms of Use</a></li></ul></li></ul></li></ul></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-17626-on-premises-deployments.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-17746-administration-settings.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="33836-14843-sp--sysdig-platform-.html">SP (Sysdig Platform)</a></li><li class="breadcrumb-link"><a href="33836-17625-sysdig-platform.html">Sysdig Platform</a></li><li class="breadcrumb-node">Sysdig Agent</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ee770b85-3c82-28cf-48e0-a38a6f973bc1" data-permalink="33836-17701-sysdig-agent.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-74b470d4-de21-ef38-a4da-f5ae30470583"><div class="titlepage"><div><div class="title"><h4 class="title">Sysdig Agent</h4></div></div></div><p>Sysdig agents are simple to deploy and upgrade, and out of the box they will gather and report on a wide variety of pre-defined metrics. Agent installation can be as simple as copy/pasting a few lines of code from a Wizard prompt, or you can follow step-by-step instructions to check supported environments and distributions, review installation options, and customize the agent configuration file post-install.</p><p>This section includes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d" title="Agent Installation">Agent Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-e5ec64a7-b0f9-921f-f908-0ed6c1680a47" title="Agent Configuration">Agent Configuration</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2" title="Agent Upgrade">Agent Upgrade</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45" title="**Agent Stop | Start | Disable | Remove">**Agent Stop | Start | Disable | Remove</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d" title="Agent Uninstall">Agent Uninstall</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8" title="Troubleshooting Agent Installation">Troubleshooting Agent Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31" title="**Copy of Host Requirements for Agent Installation**">**Copy of Host Requirements for Agent Installation**</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-813a9695-5e30-e72f-2e2c-26c84ddecb33" data-publication-date="" id="UUID-d8162233-fc9f-b751-4d79-1696312db414"><div class="titlepage"><div><div class="title"><h5 class="title">Host Requirements for Agent Installation</h5></div></div></div><p>Sysdig agents can be installed on a wide array of Linux hosts. Check your environment to ensure it meets the minimum supported platform, operating system, runtime, and orchestration requirements and use the appropriate installation instructions.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-AgentInstallationRequirements"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Installation Requirements</h6></div></div></div><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-CloudPlatformorPrivateDataCenter" class="bridgehead">Cloud Platform or Private Data Center</h6><h7 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-CloudPlatformsSupported" class="bridgehead">Cloud Platforms Supported</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>AWS</strong></span> Elastic Cloud Compute (EC2) and AWS Elastic Container Service (ECS)</p></li><li class="listitem"><p><span class="bold bold"><strong>Google</strong></span> Cloud Provider (GCP) and Google Kubernetes Engine (GKE).</p></li><li class="listitem"><p><span class="bold bold"><strong>Microsoft</strong></span> Azure and Microsoft Azure Container Service (AKS)</p></li><li class="listitem"><p><span class="bold bold"><strong>IBM: </strong></span>Including IBM Cloud Kubernetes Service (IKS)</p></li></ul></div><h7 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-PrivateDataCenter" class="bridgehead">Private Data Center</h7><p>See the <span class="italic italic">Supported Linux Distributions</span> table, below.</p><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-ContainerRuntimes" class="bridgehead">Container Runtimes</h6><p>The agent supports detection of Docker, RKT, LXC, containerd, CRI-O, and Mesos containers.</p><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedLinuxDistributions" class="bridgehead">Supported Linux Distributions</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Private Data Center</p></th><th class="th"><p>AWS EC2</p></th><th class="th"><p>GCP</p></th><th class="th"><p>GKE</p></th><th class="th"><p>Azure</p></th></tr></thead><tbody><tr><td class="td"><p><span class="underline underline"><span class="bold bold"><strong>Core set of distributions:</strong></span></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Debian</strong></span> 6.0+</p></li><li class="listitem"><p><span class="bold bold"><strong>Ubuntu</strong></span> 10.04+</p></li><li class="listitem"><p><span class="bold bold"><strong>CentOS</strong></span> 6+</p></li><li class="listitem"><p><span class="bold bold"><strong>RHEL</strong></span> 6+</p></li><li class="listitem"><p><span class="bold bold"><strong>Fedora</strong></span> 13+</p></li><li class="listitem"><p><span class="bold bold"><strong>Linux Mint</strong></span> 9+</p></li><li class="listitem"><p><span class="bold bold"><strong>CoreOS</strong></span></p></li><li class="listitem"><p><span class="bold bold"><strong>Oracle</strong></span> 6.0+ (UEK kernels R3+, all RHCK kernels)</p></li></ul></div></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Amazon AMI</strong></span></p><p>(any version available from the AWS Marketplace) and</p><p><span class="bold bold"><strong>Amazon Linux 2</strong></span></p><p>+</p></li><li class="listitem"><p><span class="underline underline"><span class="bold bold"><strong>Core set</strong></span></span></p></li></ul></div></td><td class="td"><p><span class="underline underline"><span class="bold bold"><strong>Core set</strong></span></span></p></td><td class="td"><p><span class="bold bold"><strong>Ubuntu</strong></span> only</p></td><td class="td"><p><span class="bold bold"><strong><span class="underline underline">Core set</span></strong></span></p></td></tr></tbody></table></div><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-OrchestratorYesNo" class="bridgehead">Orchestrator: Yes/No</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If NO orchestrator is used, follow the installation instructions for <a class="xref" href="33836-17701-sysdig-agent.html#UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e" title="Agent Install: Non-Orchestrated (Docker Agent | Service Agent )"><span class="xreftitle">Agent Install: Non-Orchestrated (Docker Agent | Service Agent )</span></a></p></li><li class="listitem"><p>If you ARE using an orchestrator what kind are you using?</p></li></ul></div><h7 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedOpenSourceOrchestrators" class="bridgehead">Supported Open Source Orchestrators</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>Kubernetes</p></th><th class="th"><p>Mesos/Marathon</p></th><th class="th"><p>Docker Swarm</p></th></tr></thead><tbody><tr><td class="td"><p>Supported versions</p></td><td class="td"><p>1.2+</p></td><td class="td"></td><td class="td"><p>Docker 1.12+</p></td></tr><tr><td class="td"><p>Use Orchestrator to install agents?</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank"><span class="xreftitle">Agent Install: Kubernetes | GKE | OpenShift | IBM</span></a></p></td><td class="td"><p><a class="xref" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b" title="Agent Install: Mesos | Marathon | DCOS"><span class="xreftitle">Agent Install: Mesos | Marathon | DCOS</span></a></p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a></p></td></tr></tbody></table></div><h7 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedContainerPlatforms" class="bridgehead">Supported Container Platforms</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>OpenShift</p></th><th class="th"><p>GKE</p></th><th class="th"><p>ECS</p></th><th class="th"><p>Azure CS</p></th><th class="th"><p>Docker Datacenter</p></th><th class="th"><p>Rancher</p></th></tr></thead><tbody><tr><td class="td"><p>Special installation instructions?</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank">Agent Install: Kubernetes</a></p><p>(with OpenShift options)</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank">Agent Install: Kubernetes</a></p><p>(with GKE options)</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a></p><p>(+ <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206307449/AWS+Integrate+AWS+Account+and+CloudWatch+Metrics+Optional" target="_blank">AWS Integration</a> instructions)</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a></p><p>No special instructions</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a></p><p>No special instructions</p></td><td class="td"><p><a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a></p><p>No special instructions</p></td></tr></tbody></table></div><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedJavaVersionsandVendors" class="bridgehead">Supported Java Versions and Vendors</h6><p>The Sysdig agent supports only:</p><p><span class="bold bold"><strong>Java versions:</strong></span> 7 and above</p><p><span class="bold bold"><strong>Vendors:</strong></span> Oracle, OpenJDK</p><p>For Java-based applications (Cassandra, Elasticsearch, Kafka, Tomcat, Zookeeper and etc.), the Sysdig agent requires the Java runtime environment (JRE) to be installed to poll for metrics (beans).</p><p>If the Docker-container-based Sysdig agent is installed, the JRE is installed alongside the agent binaries and no further dependencies exist. However, if you are installing the service-based agent (non-container) and you do not see the JVM/JMX metrics reporting, your host may not have the JRE installed or it may not be installed in the expected location: <code class="code">usr/bin/java </code></p><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-ResourceLimits" class="bridgehead">Resource Limits</h6><p>The resource requirements of the agent are subjective to the size of and load on your host. At a minimum, the agent requires 2% of total CPU and 512 MiB of memory.</p><h6 id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedBrowsers" class="bridgehead">Supported Browsers</h6><p>Sysdig supports, tests, and verifies the <span class="bold bold"><strong>latest version of Chrome</strong></span>.</p><p>Other browsers may also work, but are not tested in the same way.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SeeAlso"><div class="titlepage"><div><div class="title"><h6 class="title">See Also</h6></div></div></div><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee" title="Additional Host Requirements &amp; Kernel Header Troubleshooting">Additional Host Requirements &amp; Kernel Header Troubleshooting</a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-AgentInstallationRequirements" title="Agent Installation Requirements">Agent Installation Requirements </a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-CloudPlatformorPrivateDataCenter" title="Cloud Platform or Private Data Center">Cloud Platform or Private Data Center </a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-CloudPlatformsSupported" title="Cloud Platforms Supported">Cloud Platforms Supported </a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-PrivateDataCenter" title="Private Data Center">Private Data Center </a></p></li></ul></div></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-ContainerRuntimes" title="Container Runtimes">Container Runtimes</a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedLinuxDistributions" title="Supported Linux Distributions">Supported Linux Distributions </a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-OrchestratorYesNo" title="Orchestrator: Yes/No">Orchestrator: Yes/No </a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedOpenSourceOrchestrators" title="Supported Open Source Orchestrators">Supported Open Source Orchestrators </a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedContainerPlatforms" title="Supported Container Platforms">Supported Container Platforms </a></p></li></ul></div></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedJavaVersionsandVendors" title="Supported Java Versions and Vendors">Supported Java Versions and Vendors </a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-ResourceLimits" title="Resource Limits">Resource Limits </a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SupportedBrowsers" title="Supported Browsers">Supported Browsers</a></p></li></ul></div></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SeeAlso" title="See Also">See Also</a></p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-fb774f3c-1576-8544-a624-5dbfc0585809" data-publication-date="" id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee"><div class="titlepage"><div><div class="title"><h6 class="title">Additional Host Requirements &amp; Kernel Header Troubleshooting</h6></div></div></div><p>In addition to the information on <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a>, this page describes host requirements and kernel headers.</p><h6 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-AdditionalRequirements" class="bridgehead">Additional Requirements</h6><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Accesskey" class="bridgehead">Access key</h7><p>The installation of the Sysdig agent requires an <span class="bold bold"><strong>access key</strong></span>. This key and the agent installation instructions are presented to you after activating your account and using a web-based wizard upon initial login.</p><p>The same information can also be found in the <code class="code">Settings &gt; Agent Installation</code> menu of the web interface after logging in. See <a class="link" href="33836-17746-administration-settings.html#UUID-49ef4cbc-2a02-504e-185b-844beca5fc39" title="Agent Installation: Overview and Key">Agent Installation: Overview and Key</a> for details.</p><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Networkconnection" class="bridgehead">Network connection</h7><p>A small Sysdig agent (containerized or native) is installed into each host being monitored and will need to be able to connect to the Sysdig Monitor backend servers to report host metrics. The agent must be able to reach the address '<a class="link" href="http://collector.sysdigcloud.com" target="_blank">collector.sysdigcloud.com</a>' (via multiple IPs) over <code class="code">port tcp/6443</code> default.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In earlier versions, the Sysdig Agent connected to port 6666. This behavior has been deprecated, as the Sysdig agent now connects to port 6443.</p></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The agent doesn't use HTTP protocol, thus does not support HTTP proxies. It is possible to use transparent TCP proxy: if a TCP proxy is in use, it must be transparent.</p></div><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Tags" class="bridgehead">Tags</h7><p>Tagging your hosts is highly recommended. Tags allow you to sort nodes of your infrastructure into custom groups in Sysdig Monitor.</p><p>Replace the [TAGS] parameter in configuration file with a comma-separated list in the form of <span class="bold bold"><strong> <code class="code">TAG_NAME:TAG_VALUE</code> </strong></span>. For example: <span class="bold bold"><strong> <code class="code">role:webserver</code> </strong></span>,<span class="bold bold"><strong> <code class="code">location:europe</code> </strong></span>.</p><p>See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/198934553" target="_blank">Understanding the Agent Config Files</a>.</p><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-TracePointsSupport" class="bridgehead">TracePoints Support</h7><p>All supported distribution released kernels have this support but if creating a custom kernel, it must support the following options:</p><p> <code class="code">CONFIG_TRACEPOINTS </code> </p><p> <code class="code">CONFIG_HAVE_SYSCALL_TRACEPOINTS</code> </p><h6 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-AboutKernelHeadersandtheKernelModule" class="bridgehead">About Kernel Headers and the Kernel Module</h6><p>The Sysdig agent requires a kernel module in order to install successfully on a host. This can be obtained in three ways:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Agent compiles the module using kernel headers.</strong></span> </p><p>If the hosts in your environment already have kernel header files pre-installed, no special action is needed. Or you can install the kernel headers manually; see below.</p></li><li class="step"><p> <span class="bold bold"><strong>Agent auto-downloads precompiled modules from Sysdig's AWS storage location. </strong></span> </p><p>If the headers are not already installed but the agent is able to auto-download, no special action is needed. If there is no internet connectivity, you can use method 3 (download from an internal URL).</p></li><li class="step"><p> <span class="bold bold"><strong>Agent downloads precompiled modules from an internal URL.</strong></span> </p><p>Use the environment variable <code class="code">SYSDIG_PROBE_URL</code>. See also <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a>. Contact Sysdig support for assistance.</p></li></ol></div><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ToInstallKernelHeaders" class="bridgehead">To Install Kernel Headers</h7><p>In some cases, the host(s) in your environment may use Unix versions that do not match the provided headers, and the agent may fail to install correctly. In those cases, you must install the kernal headers manually.</p><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Debian-Style" class="bridgehead">Debian-Style</h7><p>For Debian-syle distributions, run the command:</p><pre class="programlisting">apt-get -y install linux-headers-$(uname -r)</pre><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-RHEL-Style" class="bridgehead">RHEL-Style</h7><p>For RHEL-style distributions, run the command:</p><pre class="programlisting">yum -y install kernel-devel-$(uname -r)</pre><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-RancherOS" class="bridgehead">RancherOS</h7><p>For RancherOS distributions, the kernel headers are available in the form of a system service and therefore are enabled using the <code class="code">ros </code>service command:</p><pre class="programlisting">sudo ros service enable kernel-headers-system-docker 
sudo ros service up -d kernel-headers-system-docker</pre><p>NOTE: Some cloud hosting service providers supply pre-configured Linux instances with customized kernels. You may need to contact your provider's support desk for instructions on obtaining appropriate header files, or for installing the distribution's default kernel.</p><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ToCorrectKernelHeaderErrorsinAWSAMI" class="bridgehead">To Correct Kernel Header Errors in AWS AMI</h7><p>During an agent installation in an Amazon machine image (AMI) you may encounter the following errors while the installer is trying to compile the Sysdig kernel module:</p><p> <span class="bold bold"><strong>Errors</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="italic italic">"Unable to find kernel development files for the current kernel version</span>" or</p></li><li class="listitem"><p> <span class="italic italic">"FATAL: Module sysdigcloud-probe not found"</span> </p></li></ul></div><p>This indicates your machine is running a kernel in an older AMI for which the kernel headers are no longer available in the configured repositories. The issue has to do with Amazon purging packages in the yum repository when new Amazon Linux machine images are released.</p><p>The solution is either to update your kernel to a version for which header files are readily available (recommended), or perform a one-time installation of the kernel headers for your older AMI.</p><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Option1UpgradeYourHostsKernel" class="bridgehead">Option 1: Upgrade Your Host's Kernel</h7><p>First install a new kernel and reboot your instance:</p><pre class="programlisting"><code class="code">sudo yum -y install kernel
sudo reboot</code></pre><p>After rebooting, check to see if the host is reporting metrics to your Sysdig account. If not, you may need to issue three more commands to install the required header files:</p><pre class="programlisting"><code class="code">sudo yum -y install kernel-devel-$(uname -r)
sudo /usr/lib/dkms/dkms_autoinstaller start
sudo service dragent restart</code></pre><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Option2InstallOlderKernelHeaders" class="bridgehead">Option 2: Install Older Kernel Headers</h7><p>Although it is recommended to upgrade to the latest kernel for security and performance reasons, you can alternatively install the older headers for your AMI.</p><p>Find the the AMI version string and install the appropriate headers with the commands:</p><pre class="programlisting">releasever=$(cat /etc/os-release | grep 'VERSION_ID' | grep -Eo "[0-9]{4}\.[0-9]{2}")
sudo yum -y --releasever=${releasever} install kernel-devel-$(uname -r)</pre><pre class="programlisting"></pre><p>Issue the remaining commands to allow the Sydig Agent to start successfully:</p><pre class="programlisting">sudo /usr/lib/dkms/dkms_autoinstaller start
sudo service dragent restart</pre><h7 id="UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ReferenceFindYourAWSInstanceImageVersion" class="bridgehead">Reference: Find Your AWS Instance Image Version</h7><p>The file <code class="code">/etc/image-id</code> shows information about the original machine image with which your instance was set up:</p><pre class="programlisting">[ec2-user ~]$ cat /etc/image-id
image_name="amzn-ami-hvm"
image_version="2017.03"
image_arch="x86_64"image_file="amzn-ami-hvm-2017.03.0.20170401-x86_64.ext4.gpt"image_stamp="26a3-ed31"
image_date="20170402053945"
recipe_name="amzn ami"
recipe_id="47cfa924-413c-d460-f4f2-2af7-feb6-9e37-7c9f1d2b"</pre><p>This file will not change as you install updates from the yum repository.</p><p>The file <code class="code">/etc/system-release</code> will tell what version of the AWS image is currently installed:</p><pre class="programlisting">[ec2-user ~]$ cat /etc/system-release
Amazon Linux AMI release 2017.03</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-AdditionalRequirements" title="Additional Requirements">Additional Requirements</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Accesskey" title="Access key">Access key</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Networkconnection" title="Network connection">Network connection</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Tags" title="Tags">Tags</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-TracePointsSupport" title="TracePoints Support">TracePoints Support</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-AboutKernelHeadersandtheKernelModule" title="About Kernel Headers and the Kernel Module">About Kernel Headers and the Kernel Module</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ToInstallKernelHeaders" title="To Install Kernel Headers">To Install Kernel Headers </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Debian-Style" title="Debian-Style">Debian-Style</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-RHEL-Style" title="RHEL-Style">RHEL-Style</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-RancherOS" title="RancherOS">RancherOS </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ToCorrectKernelHeaderErrorsinAWSAMI" title="To Correct Kernel Header Errors in AWS AMI">To Correct Kernel Header Errors in AWS AMI</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Option1UpgradeYourHostsKernel" title="Option 1: Upgrade Your Host's Kernel">Option 1: Upgrade Your Host's Kernel</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-Option2InstallOlderKernelHeaders" title="Option 2: Install Older Kernel Headers">Option 2: Install Older Kernel Headers</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee_id_AdditionalHostRequirementsKernelHeaderTroubleshooting-ReferenceFindYourAWSInstanceImageVersion" title="Reference: Find Your AWS Instance Image Version">Reference: Find Your AWS Instance Image Version</a> </p></li></ul></div></li></ul></div></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-1bbdf1e4-3277-cf2c-d247-de7a1d067e70" data-publication-date="" id="UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d"><div class="titlepage"><div><div class="title"><h5 class="title">Agent Installation</h5></div></div></div><p>Sysdig agents are delivered as either a container or a service, and can be deployed with or without an orchestrator such as Kubernetes or Mesos.</p><p>A quick install involves just a few lines of code from the Installation Wizard or the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/213352719/Agent+Installation+Overview+and+Key" target="_blank"><span class="xreftitle">Agent Installation: Overview and Key</span></a>page, copied into a shell. The complete install instructions address checking for and installing kernel headers if needed, any prerequisite permissions settings for particular environments, and tips about updating the configuration files after initial installation.</p><p>This section includes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e" title="Agent Install: Non-Orchestrated (Docker Agent | Service Agent )">Agent Install: Non-Orchestrated (Docker Agent | Service Agent )</a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b" title="Agent Install: Mesos | Marathon | DCOS">Agent Install: Mesos | Marathon | DCOS</a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983" title="Agent Install: Manual Linux Installation">Agent Install: Manual Linux Installation</a></p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-d29c9a0d-d7c9-2d1e-330a-0d88009e228c" data-publication-date="" id="UUID-9037d45e-4884-5815-569e-eb7d94c45441"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Install: Kubernetes | GKE | OpenShift | IBM</h6></div></div></div><p>This document describes how to install a Sysdig agent container in a <span class="bold bold"><strong><a class="link" href="https://kubernetes.io/" target="_blank">Kubernetes</a></strong></span> environment. This document assumes you will run the agent container as a Kubernetes pod, which then enables the Sysdig agent automatically to detect and monitor your Kubernetes environment.</p><p>It is relevant for any platform where Kubernetes is deployed, including <span class="bold bold"><strong><a class="link" href="https://cloud.google.com/kubernetes-engine/" target="_blank">Google Kubernetes Engine (GKE)</a>, </strong></span> <span class="bold bold"><strong><a class="link" href="https://www.openshift.com/" target="_blank">Red Hat OpenShift</a>,</strong></span> and <span class="bold bold"><strong><a class="link" href="https://www.ibm.com/cloud/container-service" target="_blank">IBM Cloud Kubernetes Service (IKS)</a></strong></span> <span class="bold bold"><strong>.</strong></span></p><p>You use <a class="link" href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" target="_blank">DaemonSets</a> to deploy agents on every node in your Kubernetes environment. Once deployed, Sysdig Monitor automatically begins monitoring all of your hosts, apps, pods, and services and automatically connects to the Kubernetes API server to pull relevant metadata about the environment. If licensed, Sysdig Secure launches with default policies that you can view and configure to suit your needs. You can access the front-end web interfaces for Sysdig Monitor and Sysdig Secure immediately.</p><h6 id="UUID-9037d45e-4884-5815-569e-eb7d94c45441_id_AgentInstallKubernetesGKEOpenShiftIBM-Prerequisites" class="bridgehead">Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong><span class="bold bold"><strong>A supported distribution.</strong></span></strong></span> See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151570/" target="_blank"><span class="xreftitle">Host Requirements for Agent Installation</span></a> for details.</p></li><li class="listitem"><p><span class="bold bold"><strong>Kubernetes v 1.2+: </strong></span>The agent installation on Kubernetes requires using DaemonSets, which were not available in early versions of Kubernetes.</p></li><li class="listitem"><p><span class="bold bold"><strong>Sysdig account and access key:</strong></span> Request a trial or full account at <a class="link" href="http://Sysdig.com" target="_blank">Sysdig.com</a> and click the <span class="bold bold"><strong>Activate Account</strong></span> button. You create a Sysdig user name and password.</p><p>The Welcome wizard provides an access key.</p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Manual installation is no longer supported in a Kubernetes environment. Please contact Sysdig support if you need assistance with manual steps.</p></div><h6 id="UUID-9037d45e-4884-5815-569e-eb7d94c45441_id_AgentInstallKubernetesGKEOpenShiftIBM-CompletetheInstallation" class="bridgehead">Complete the Installation</h6><p>Choose the appropriate link to complete the installation steps:</p><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc" title="Kubernetes Agent Installation Steps">Kubernetes Agent Installation Steps</a></p><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06" title="GKE Agent Installation Steps">GKE Agent Installation Steps</a></p><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7" title="OpenShift Agent Installation Steps">OpenShift Agent Installation Steps</a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441_id_AgentInstallKubernetesGKEOpenShiftIBM-Prerequisites" title="Prerequisites">Prerequisites</a></p></li><li class="listitem"><p><a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441_id_AgentInstallKubernetesGKEOpenShiftIBM-CompletetheInstallation" title="Complete the Installation">Complete the Installation </a></p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-527533b1-d925-4a44-1a8a-d0855e3658fc" data-publication-date="" id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7"><div class="titlepage"><div><div class="title"><h6 class="title">Runtime Support: CRI-O and Containerd</h6></div></div></div><p>By default, Sysdig agents deployed in Kubernetes automatically detect metadata from <a class="link" href="https://containerd.io/" target="_blank">containerd</a> and CRI-O (in addition to Docker), as long as the prerequisites are fulfilled.</p><p>After reviewing the information on this page, continue with the Sysdig agent installation steps: <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc" title="Kubernetes Agent Installation Steps">Kubernetes Agent Installation Steps</a>.</p><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ContainerdSupport" class="bridgehead">Containerd Support</h8><p>As of agent version 0.88.1, the Sysdig agent will automatically detect <a class="link" href="https://containerd.io/" target="_blank">containerd</a> metadata (as well as any Docker metadata) in your environment, as long as the Prerequisites are fulfilled.</p><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-Prerequisites" class="bridgehead">Prerequisites</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Agent version: </strong></span>Sysdig agent version 0.88.1 or higher</p><p> <span class="bold bold"><strong>NOTE:</strong></span> If you are upgrading from an earlier version of the agent, you must also download the latest <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code>from GitHub.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Configuration parameter: </strong></span>In the agent config file, <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> must be set.</p><p>See <a class="link" href="">Kubernetes Agent Installation Steps#Enable Kube State Metrics and Cluster Name</a> below for details on editing the config file.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Kubernetes-only: </strong></span>The containerd API must support <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md" target="_blank">CRI</a> (a Kubernetes runtime interface).</p></li></ul></div><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ResultsintheSysdigMonitorUI" class="bridgehead">Results in the Sysdig Monitor UI</h8><p>If the Sysdig agent detects containerd metadata, it will be reported in the front end as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Explore/Dashboard views: </strong></span>The icon next to container-specific items (<a class="link" href="http://container.name/" target="_blank">container.name</a>, <a class="link" href="http://container.id/" target="_blank">container.id</a>, etc.) shows whether it's a Docker or containerd object.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="450px"><tr style="height: 144px"><td><img src="image/15d5af4f52b84e.jpg" style="max-width: 450px; max-height: 144px; " alt="373574647.jpg"></img></td></tr></table></div></li><li class="listitem"><p> <span class="bold bold"><strong>Spotlight: </strong></span>Updated for containerd display.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Events: </strong></span>Containerd events <code class="code">die</code> and <code class="code">oom </code>are enabled by default.</p><p>Events <code class="code">create</code> and <code class="code">exit</code> are also supported.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="500px"><tr><td><img src="image/15d5af4f5326d0.jpg" style="max-width: 500px; " alt="373574641.jpg"></img></td></tr></table></div></li></ul></div><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-CRI-OSupport" class="bridgehead">CRI-O Support</h8><p>As of the <a class="link" href="">SaaS March release</a>, the Sysdig agent will automatically detect <a class="link" href="https://cri-o.io/" target="_blank">CRI-O</a> metadata (as well as any Docker and/or containerd metadata) in your environment, as long as the Prerequisites are fulfilled.</p><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-Prerequisites1" class="bridgehead">Prerequisites</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Platform version: </strong></span>Sysdig <a class="link" href="">SaaS March 2019</a> or higher</p></li><li class="listitem"><p> <span class="bold bold"><strong>Agent version: </strong></span>Sysdig agent <a class="link" href="">version 0.89.4</a> or higher</p><p> <span class="bold bold"><strong>NOTE:</strong></span> If you are upgrading from an earlier version of the agent, you must also download the latest <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code>from GitHub.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Configuration parameter: </strong></span>In the agent config file, <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> must be set.</p><p>See <a class="link" href="">Kubernetes Agent Installation Steps#Enable Kube State Metrics and Cluster Name</a> below for details on editing the config file.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Kubernetes-only: </strong></span>The API must support <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md" target="_blank">CRI</a> (a Kubernetes runtime interface).</p></li></ul></div><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ResultsintheSysdigMonitorUI1" class="bridgehead">Results in the Sysdig Monitor UI</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Events: </strong></span>There are no CRI-O events, so the Events pane remains unchanged.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Explore/Dashboard views: </strong></span>The icon next to container-specific items (<a class="link" href="http://container.name/" target="_blank">container.name</a>, <a class="link" href="http://container.id/" target="_blank">container.id</a>, etc.) shows CRI-O type.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Supported Metrics: </strong></span>By default, the same metrics are supported for CRI-O as for Docker and containerd, except for image id (<code class="code"> <a class="link" href="http://container.image.id" target="_blank">container.image.id</a> </code>).</p></li></ul></div><h8 id="UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-EnablingImageIDMetricswithcriextra_queries" class="bridgehead">Enabling Image ID Metrics with cri: extra_queries</h8><p>To enable image id metrics, edit the agent configuration file <code class="code">dragent.yaml </code> to contain the following:</p><pre class="programlisting">cri:
  extra_queries: true

</pre><p>See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/198934553/Understanding+the+Agent+Config+Files" target="_blank">Understanding the Agent Config Files</a> for more information on editing <code class="code">dragent.yaml</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ContainerdSupport" title="Containerd Support">Containerd Support </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-Prerequisites" title="Prerequisites">Prerequisites </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ResultsintheSysdigMonitorUI" title="Results in the Sysdig Monitor UI">Results in the Sysdig Monitor UI </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-CRI-OSupport" title="CRI-O Support">CRI-O Support </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-Prerequisites1" title="Prerequisites">Prerequisites</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-ResultsintheSysdigMonitorUI1" title="Results in the Sysdig Monitor UI">Results in the Sysdig Monitor UI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-59d1ab39-1c94-202e-4ffb-5315c4d081a7_id_RuntimeSupportCRI-OandContainerd-EnablingImageIDMetricswithcriextra_queries" title="Enabling Image ID Metrics with cri: extra_queries">Enabling Image ID Metrics with cri: extra_queries</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-83979d85-1b12-7a06-fad8-748128b33398" data-publication-date="" id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc"><div class="titlepage"><div><div class="title"><h6 class="title">Kubernetes Agent Installation Steps</h6></div></div></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Preparation" class="bridgehead">Preparation</h8><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-KernelHeaders" class="bridgehead">Kernel Headers</h8><p>The Sysdig agent requires kernel header files to install successfully on a host.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This setup step is required for some environments and not others, as noted.</p></div><p> <span class="bold bold"><strong>If the hosts in your environment match the pre-compiled kernel modules available from Sysdig, no special action is required. </strong></span> </p><p>In some cases, the host(s) in your environment may use Unix versions that do not match the provided headers, and the agent may fail to install correctly. In those cases, you must install the kernel headers manually.</p><p>To do so:</p><p> <span class="bold bold"><strong>For Debian-style distributions,</strong></span> run the command:</p><pre class="programlisting">apt-get -y install linux-headers-$(uname -r)</pre><p> <span class="bold bold"><strong>For RHEL-style distributions,</strong></span> run the command:</p><pre class="programlisting">yum -y install kernel-devel-$(uname -r)</pre><p>Background info: see also <a class="link" href="">About Kernel Headers and the Kernel Module</a>.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ContainerdSupport" class="bridgehead">Containerd Support</h8><p>As of agent version 0.88.1, the Sysdig agent will automatically detect <a class="link" href="https://containerd.io/" target="_blank">containerd</a> metadata (as well as any Docker metadata) in your environment, as long as the Prerequisites are fulfilled.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Prerequisites" class="bridgehead">Prerequisites</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Agent version: </strong></span>Sysdig agent version 0.88.1 or higher</p><p> <span class="bold bold"><strong>NOTE:</strong></span> If you are upgrading from an earlier version of the agent, you must also download the latest <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code>from GitHub.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Configuration parameter: </strong></span>In the agent config file, <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> must be set.</p><p>See <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-EnableKubeStateMetricsandClusterName" title="Enable Kube State Metrics and Cluster Name">Enable Kube State Metrics and Cluster Name</a> below for details on editing the config file.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Kubernetes-only: </strong></span>The containerd API must support <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md" target="_blank">CRI</a> (a Kubernetes runtime interface).</p></li></ul></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ResultsintheSysdigMonitorUI" class="bridgehead">Results in the Sysdig Monitor UI</h8><p>If the Sysdig agent detects containerd metadata, it will be reported in the front end as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Explore/Dashboard views: </strong></span>The icon next to container-specific items (<a class="link" href="http://container.name" target="_blank">container.name</a>, <a class="link" href="http://container.id" target="_blank">container.id</a>, etc.) shows whether it's a Docker or containerd object.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="450px"><tr style="height: 144px"><td><img src="image/15d5af4f5396b9.jpg" style="max-width: 450px; max-height: 144px; " alt="373574694.jpg"></img></td></tr></table></div></li><li class="listitem"><p> <span class="bold bold"><strong>Spotlight: </strong></span>Updated for containerd display.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Events:</strong></span> Containerd events <code class="code">die</code> and <code class="code">oom </code>are enabled by default.</p><p>Events <code class="code">create</code> and <code class="code">exit</code> are also supported.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="500px"><tr><td><img src="image/15d5af4f540691.jpg" style="max-width: 500px; " alt="373574688.jpg"></img></td></tr></table></div></li></ul></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-CRI-OSupport" class="bridgehead">CRI-O Support</h8><p>As of the <a class="link" href="">SaaS March release</a>, the Sysdig agent will automatically detect <a class="link" href="https://cri-o.io/" target="_blank">CRI-O</a> metadata (as well as any Docker and/or containerd metadata) in your environment, as long as the Prerequisites are fulfilled.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Prerequisites1" class="bridgehead">Prerequisites</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Platform version: </strong></span>Sysdig <a class="link" href="">SaaS March 2019</a> or higher</p></li><li class="listitem"><p> <span class="bold bold"><strong>Agent version: </strong></span>Sysdig agent <a class="link" href="">version 0.89.4</a> or higher</p><p> <span class="bold bold"><strong>NOTE:</strong></span> If you are upgrading from an earlier version of the agent, you must also download the latest <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code>from GitHub.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Configuration parameter: </strong></span>In the agent config file, <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> must be set.</p><p>See <a class="link" href="">Kubernetes Agent Installation Steps#Enable Kube State Metrics and Cluster Name</a> below for details on editing the config file.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Kubernetes-only: </strong></span>The API must support <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md" target="_blank">CRI</a> (a Kubernetes runtime interface).</p></li></ul></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ResultsintheSysdigMonitorUI1" class="bridgehead">Results in the Sysdig Monitor UI</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Events: </strong></span>There are no CRI-O events, so the Events pane remains unchanged.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Explore/Dashboard views: </strong></span>The icon next to container-specific items (<a class="link" href="http://container.name" target="_blank">container.name</a>, <a class="link" href="http://container.id" target="_blank">container.id</a>, etc.) shows CRI-O type.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Supported Metrics: </strong></span>By default, the same metrics are supported for CRI-O as for Docker and containerd, except for image id (<code class="code">container.image.id</code>).</p></li></ul></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-EnablingImageIDMetricswithcriextra_queries" class="bridgehead">Enabling Image ID Metrics with cri: extra_queries</h8><p>To enable image id metrics, edit the agent configuration file <code class="code">dragent.yaml </code> to contain the following:</p><pre class="programlisting">cri:
  extra_queries: true</pre><p>See <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a> for more information on editing <code class="code">dragent.yaml</code>.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-BackgroundInfo" class="bridgehead">Background Info</h8><p>You can review <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> and the <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a> for additional context, if desired.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-InstallationSteps" class="bridgehead">Installation Steps</h8><p>To deploy agents using Kubernetes daemonsets, you will <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">download</a> the following configuration files, edit them as required, and deploy them.</p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-clusterrole.yaml" target="_blank">sysdig-agent-clusterrole.yaml</a> </code> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-daemonset-v2.yaml" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code> </p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-configmap.yaml" target="_blank">sysdig-agent-configmap.yaml</a> </code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>HELM CHART OPTION</strong></span>Kubernetes also offers a package manager, <a class="link" href="https://helm.sh/" target="_blank">Helm</a>, which uses charts to simplify this process.</p><p>If you are using Helm charts in your K8s environment, we recommend using them to deploy Sysdig agents, as described <a class="link" href="https://github.com/helm/charts/blob/master/stable/sysdig/README.md" target="_blank">here</a>.</p></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-DeploytheAgents" class="bridgehead">Deploy the Agents</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">Download</a> the sample files</strong></span> <code class="code"></code> sysdig-agent-clusterrole.yaml, <code class="code">sysdig-agent-daemonset-v2.yaml,</code> and <code class="code">sysdig-agent-configmap.yaml. </code> </p></li><li class="step"><p> <span class="bold bold"><strong>Create a namespace</strong></span> to use for the Sysdig agent.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>You can use whatever naming you prefer. In this document, we used <code class="code">sysdig-agent</code> for both the namespace and the service account.</p><p>The default service account name was automatically defined in <code class="code">sysdig-agent-daemonset-v2.yaml, at</code> the line: <code class="code">serviceAccount: sysdig-agent.</code> </p></div><pre class="programlisting">kubectl create ns sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>Create a secret key</strong></span> using the command:</p><pre class="programlisting">kubectl create secret generic sysdig-agent --from-literal=access-key=&lt;your sysdig access key&gt; -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>Create a cluster role and service account, and define the cluster role binding </strong></span>that grants the Sysdig agent rules in the cluster role, using the commands:</p><pre class="programlisting">kubectl apply -f sysdig-agent-clusterrole.yaml -n sysdig-agent
kubectl create serviceaccount sysdig-agent -n sysdig-agent
kubectl create clusterrolebinding sysdig-agent --clusterrole=sysdig-agent --serviceaccount=sysdig-agent:sysdig-agent  </pre></li><li class="step"><p> <span class="bold bold"><strong>FOR ON-PREM INSTALLATIONS ONLY: </strong></span> <span class="bold bold"><strong>Edit <code class="code">configmap.yaml </code> </strong></span>to add the <code class="code">collector</code> <code class="code">address</code> and <code class="code">port</code>, and <code class="code">SSL/TLS</code> information :</p><pre class="programlisting">collector: 
    collector_port: 
    ssl: #true or false
    ssl_verify_certificate: #true or false</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">ssl_verify_certificate</code> should be set to fa<code class="code">l</code>se if a self-signed certificate or private, CA-signed cert is used. See information about SSL in on-premises <a class="link" href="">here</a>.</p></div></li><li class="step"><p> <span class="bold bold"><strong>(ALL INSTALLS): Apply the <code class="code">configmap.yaml</code> file</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong> <span class="bold bold"><strong>(ALL INSTALLS): </strong></span>Apply the <code class="code">daemonset-v2.yaml</code> file</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-daemonset-v2.yaml -n sysdig-agent</pre></li></ol></div><p>The agents will be deployed and you can <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">check the Monitor UI</a> to see some metrics. You can make further edits to the <code class="code">configmap</code> as described below.</p><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-EnableKubeStateMetricsandClusterName" class="bridgehead">Enable Kube State Metrics and Cluster Name</h8><p>These steps are optional but recommended.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span> to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> </p><p>This allows kube state metrics to be automatically detected, monitored, and displayed in Sysdig Monitor.</p><p>For more information, see the <a class="link" href="https://sysdig.com/blog/introducing-kube-state-metrics/" target="_blank">Kube State Metrics</a> entry in the Sysdig blog.</p></li><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span> to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">k8s_cluster_name: </code> </strong></span>and add your cluster name.</p><p>Setting cluster name here allows you to view, scope, and segment metrics in the Sysdig Monitor UI by Kubernetes cluster.</p><p> <span class="bold bold"><strong>Note:</strong></span> Alternatively, if you assign a tag with "<code class="code">cluster</code>" in the tag name, Sysdig Monitor will display that as the Kubernetes cluster name.</p></li><li class="step"><p> <span class="bold bold"><strong>Apply the configmap changes</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p>Proceed to <a class="link" href="">verify the metrics</a> in the Sysdig Monitor UI.</p></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>There are two ways to <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/189726885/Agent+Configuration" target="_blank">update the agent configuration</a>:</strong></span> </p><p> <span class="bold bold"><strong>Option 1:</strong></span> Edit the files locally and apply the changes with <code class="code">kubectl apply -f</code>:</p><p> <code class="code">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</code> </p><p> <span class="bold bold"><strong>Option 2:</strong></span> Use <code class="code">kubectl edit</code> to edit files on the fly:</p><p> <code class="code">kubectl edit configmap sysdig-agent </code>-n sysdig-agent</p><p>Running agents will automatically pick the new configuration after Kubernetes pushes the changes across all the nodes in the cluster.</p></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" class="bridgehead">Verify Metrics in Sysdig Monitor UI</h8><p>Log in to Sysdig Monitor to verify that the agent deployed and the metrics are detected and collected appropriately.</p><p>The steps below give one way to do the check.</p><p>(See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor" target="_blank">Sysdig Monitor Documentation</a>.)</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access Sysdig Monitor:</p><p> <span class="bold bold"><strong>SaaS:</strong></span> <a class="link" href="https://app.sysdigcloud.com/" target="_blank">https://app.sysdigcloud.com</a> </p><p>Log in with your Sysdig user name and password.</p></li><li class="step"><p>Select the <code class="code">Explore</code> tab to see if metrics are displayed.</p></li><li class="step"><p>(Once you have enabled <code class="code">new_k8s:true</code>)</p><p>To verify that kube state metrics and cluster name are working correctly: Select the <code class="code">Explore</code> tab and create a grouping by <code class="code"> <a class="link" href="http://kubernetes.cluster.name" target="_blank">kubernetes.cluster.name</a> </code> and <code class="code"> <a class="link" href="http://kubernetes.pod.name" target="_blank">kubernetes.pod.name</a> </code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1064px"><tr style="height: 250px"><td><img src="image/15d5af4f546c5f.png" style="max-width: 1064px; max-height: 250px; " alt="373574807.png"></img></td></tr></table></div></li><li class="step"><p>Select an individual container or pod to see details.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="706px"><tr style="height: 250px"><td><img src="image/15d5af4f550618.png" style="max-width: 706px; max-height: 250px; " alt="373574813.png"></img></td></tr></table></div></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Kubernetes metadata (pods, deployments etc.) appear a minute or two later than the nodes/containers themselves; if pod names do not appear immediately, wait and retry the Explore view.</p><p>If agents are disconnecting, there could be an issue with your MAC addresses. See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/373575015/Troubleshooting+Agent+Installation" target="_blank">Troubleshooting Agent Installation</a> for tips.</p></div><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-AdditionalOptions" class="bridgehead">Additional Options</h8><h8 id="UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ConnecttotheSysdigBackendviaStaticIPsSaaSonly" class="bridgehead">Connect to the Sysdig Backend via Static IPs (SaaS only)</h8><p>Sysdig provides a list of static IP addresses that can be whitelisted in a Sysdig environment, allowing users to establish a network connection to the Sysdig backend without opening complete network connectivity. This is done by setting the Collector IP to <code class="code"> <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </code>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The <code class="code">sysdig-agent-configmap.yaml</code> file can be edited either locally or using the edit command in Kubernetes. refer to the section above for more information.</p></div><p>To configure the collector IP in a Kubernetes SaaS instance:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Open <code class="code">sysdig-agent-configmap.yaml</code> in a text editor.</p></li><li class="step"><p>Uncomment the following lines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>collector:</p></li><li class="listitem"><p>collector_port</p></li></ul></div></li><li class="step"><p>Set the collector: value to <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </p></li><li class="step"><p>Set the collector_port: value to 6443</p></li><li class="step"><p>Save the file.</p></li></ol></div><p>The example file below shows how the <code class="code">sysdig-agent-configmap.yaml</code> file should look after configuration:</p><pre class="programlisting">apiVersion: v1
kind: ConfigMap
metadata:
  name: sysdig-agent
data:
  dragent.yaml: |
    ### Agent tags
    # tags: linux:ubuntu,dept:dev,local:nyc

    #### Sysdig Software related config ####

    # Sysdig collector address
    collector: collector-static.sysdigcloud.com

    # Collector TCP port
    collector_port: 6443

    # Whether collector accepts ssl/TLS
    ssl: true

    # collector certificate validation
    ssl_verify_certificate: true

    # Sysdig Secure
    security:
                enabled: true

    #######################################
    # new_k8s: true
    # k8s_cluster_name: production</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Preparation" title="Preparation">Preparation</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-KernelHeaders" title="Kernel Headers">Kernel Headers</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ContainerdSupport" title="Containerd Support">Containerd Support </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Prerequisites" title="Prerequisites">Prerequisites </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ResultsintheSysdigMonitorUI" title="Results in the Sysdig Monitor UI">Results in the Sysdig Monitor UI </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-CRI-OSupport" title="CRI-O Support">CRI-O Support </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-Prerequisites1" title="Prerequisites">Prerequisites</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-ResultsintheSysdigMonitorUI1" title="Results in the Sysdig Monitor UI">Results in the Sysdig Monitor UI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-EnablingImageIDMetricswithcriextra_queries" title="Enabling Image ID Metrics with cri: extra_queries">Enabling Image ID Metrics with cri: extra_queries</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-BackgroundInfo" title="Background Info">Background Info</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-InstallationSteps" title="Installation Steps">Installation Steps</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-DeploytheAgents" title="Deploy the Agents">Deploy the Agents</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-EnableKubeStateMetricsandClusterName" title="Enable Kube State Metrics and Cluster Name">Enable Kube State Metrics and Cluster Name</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">Verify Metrics in Sysdig Monitor UI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-5edae9d1-70f2-7c5f-025c-8cde2c6118dc_id_KubernetesAgentInstallationSteps-AdditionalOptions" title="Additional Options">Additional Options</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Connect to the Sysdig Backend via Static IPs (SaaS only) </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-29721115-c87b-1ee9-6700-84f485c2be8a" data-publication-date="" id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06"><div class="titlepage"><div><div class="title"><h6 class="title">GKE Agent Installation Steps</h6></div></div></div><p> <a class="link" href="https://cloud.google.com/kubernetes-engine/" target="_blank">Google Kubernetes Engine (GKE)</a> is a managed environment for running Kubernetes in Google Cloud, in order to deploy containerized applications. As of <span class="bold bold"><strong>Sysdig agent version 0.88</strong></span>, Sysdig supports all flavors of GKE, including <span class="bold bold"><strong>Ubuntu</strong></span> and GKE's default <span class="bold bold"><strong>Container-Optimized OS (<a class="link" href="https://cloud.google.com/container-optimized-os/docs/" target="_blank">COS</a>)</strong></span>.</p><p>Note that the standard Sysdig agent cannot be installed on GKE COS because Sysdig relies on a kernel module that COS does not allow. To accommodate this limitation <span class="bold bold"><strong>Sysdig has developed an alternate probe built on <a class="link" href="https://prototype-kernel.readthedocs.io/en/latest/bpf/" target="_blank">eBPF</a>,</strong></span> a "universal in-kernel virtual machine."</p><p>The instructions below describe a standard GKE agent install and call out the special steps needed to install the eBPF probe if you are using COS.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="550px"><tr style="height: 369px"><td><img src="image/image-missing.png" style="max-width: 550px; max-height: 369px; " alt=""></img></td></tr></table></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-Preparation" class="bridgehead">Preparation</h8><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-OpenPort6443forAgentIngressandEgress" class="bridgehead">Open Port 6443 for Agent Ingress and Egress</h8><p>Because GKE uses stateful firewalls, you must actively open port 6443 for the Sysdig agent, for both inbound and outbound traffic.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In earlier versions, the Sysdig Agent connected to port 6666. This behavior has been deprecated, as the Sysdig agent now connects to port 6443.</p></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1000px"><tr><td><img src="image/15d5af4f5592b3.png" style="max-width: 1000px; " alt="373574744.png"></img></td></tr></table></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-GKECOSeBPF-SpecificRequirements" class="bridgehead">GKE COS/eBPF-Specific Requirements</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Linux kernel version &gt;= 4.14.</p></li><li class="listitem"><p>When performing the installation steps, you will add one additional parameter to install the eBPF probe. See Step 7, below.</p></li></ul></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-BackgroundInfo" class="bridgehead">Background Info</h8><p>You can review <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> and the <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a> for additional context, if desired.</p><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-InstallationSteps" class="bridgehead">Installation Steps</h8><p>To deploy agents using Kubernetes daemonsets, you will <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">download</a> the following configuration files, edit them as required, and deploy them.</p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-clusterrole.yaml" target="_blank">sysdig-agent-clusterrole.yaml</a> </code> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-daemonset-v2.yaml" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code> </p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-configmap.yaml" target="_blank">sysdig-agent-configmap.yaml</a> </code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>HELM CHART OPTION</strong></span>Kubernetes also offers a package manager, <a class="link" href="https://helm.sh/" target="_blank">Helm</a>, which uses charts to simplify this process.</p><p>If you are using Helm charts in your K8s environment, we recommend using them to deploy Sysdig agents, as described <a class="link" href="https://github.com/helm/charts/blob/master/stable/sysdig/README.md" target="_blank">here</a>.</p></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-DeploytheAgents" class="bridgehead">Deploy the Agents</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">Download</a> the sample files</strong></span> <code class="code"> sysdig-agent-clusterrole.yaml</code>, <code class="code">sysdig-agent-daemonset-v2.yaml,</code> and <code class="code">sysdig-agent-configmap.yaml. </code> </p></li><li class="step"><p> <span class="bold bold"><strong>Create a namespace</strong></span> to use for the Sysdig agent.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>You can use whatever name you want. In this document, we used <code class="code">sysdig-agent</code> for both the namespace and the service account.</p></div><pre class="programlisting">kubectl create ns sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>Create a secret key</strong></span> using the command:</p><pre class="programlisting">kubectl create secret generic sysdig-agent --from-literal=access-key=&lt;your sysdig access key&gt; -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>If you are running Kubernetes 1.6 or higher,</strong></span> you must</p><ol type="a" class="substeps"><li class="step"><p> <span class="bold bold"><strong>Grant your user the ability to create roles in Kubernetes</strong></span> by running the following command (see <a class="link" href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control" target="_blank">Google documentation</a> for more):</p><pre class="programlisting">kubectl create clusterrolebinding your-user-cluster-admin-binding --clusterrole=cluster-admin --user=your.google.cloud.email@example.org</pre></li><li class="step"><p> <span class="bold bold"><strong>Create a service account for the Sysdig agent</strong></span> using the <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-clusterrole.yaml" target="_blank">clusterrole.yaml</a> </code> file.</p><p>The Sysdig agent must be granted read-only access to certain Kubernetes APIs, which the agent uses to populate metadata and provide component metrics.</p><p>Sysdig provides a config file in GitHub. Deploying this file creates a cluster role and service account in Kubernetes, and defines cluster role binding that grants the Sysdig agent rules in the cluster role.</p><p>Run the following commands (using whatever namespace you defined in Step 2):</p><pre class="programlisting">kubectl apply -f sysdig-agent-clusterrole.yaml -n sysdig-agent
kubectl create serviceaccount sysdig-agent -n sysdig-agent
kubectl create clusterrolebinding sysdig-agent --clusterrole=sysdig-agent --serviceaccount=sysdig-agent:sysdig-agent  </pre></li></ol></li><li class="step"><p> <span class="bold bold"><strong>FOR ON-PREM INSTALLATIONS ONLY: </strong></span> <span class="bold bold"><strong>Edit <code class="code">configmap.yaml </code> </strong></span>to add the <code class="code">collector</code> <code class="code">address</code> and <code class="code">port</code>, and <code class="code">SSL/TLS</code> information :</p><pre class="programlisting">collector: 
    collector_port: 
    ssl: #true or false
    ssl_verify_certificate: #true or false</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">ssl_verify_certificate</code> should be set to fa<code class="code">l</code>se if a self-signed certificate or private, CA-signed cert is used. See information about SSL in on-premises <a class="link" href="">here</a>.</p></div></li><li class="step"><p> <span class="bold bold"><strong>(ALL INSTALLS): Apply the <code class="code">configmap.yaml</code> file</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong> <span class="bold bold"><strong>FOR GKE COS ONLY:</strong></span> <span class="bold bold"><strong>To enable the eBPF probe required for COS: </strong></span>Uncomment the following parameters in <span class="bold bold"><strong> <code class="code">s</code> </strong></span> <span class="bold bold"><strong> <code class="code">ysdig-agent-daemonset-v2.yaml</code> </strong></span> under the env section:</strong></span> </p><pre class="programlisting">env:
  - name: SYSDIG_BPF_PROBE
    value: ""</pre></li><li class="step"><p> <span class="bold bold"><strong> <span class="bold bold"><strong>(ALL INSTALLS): </strong></span>Apply the <code class="code">daemonset-v2.yaml</code> file</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-daemonset-v2.yaml -n sysdig-agent</pre></li></ol></div><p>The agents will be deployed and you can <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">check the Monitor UI</a> to see some metrics. You can make further edits to the <code class="code">configmap</code> as described below.</p><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-EnableKubeStateMetricsandClusterName" class="bridgehead">Enable Kube State Metrics and Cluster Name</h8><p>These steps are optional but recommended.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span> to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> </p><p>This allows kube state metrics to be automatically detected, monitored, and displayed in Sysdig Monitor.</p><p>For more information, see the <a class="link" href="https://sysdig.com/blog/introducing-kube-state-metrics/" target="_blank">Kube State Metrics</a> entry in the Sysdig blog.</p></li><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span> to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">k8s_cluster_name: </code> </strong></span>and add your cluster name.</p><p>Setting cluster name here allows you to view, scope, and segment metrics in the Sysdig Monitor UI by Kubernetes cluster.</p><p> <span class="bold bold"><strong>Note:</strong></span> Alternatively, if you assign a tag with "<code class="code">cluster</code>" in the tag name, Sysdig Monitor will display that as the Kubernetes cluster name.</p></li><li class="step"><p> <span class="bold bold"><strong>Apply the configmap changes</strong></span> using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p>Proceed to <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">verify the metrics</a> in the Sysdig Monitor UI.</p></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>There are two ways to <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/189726885/Agent+Configuration" target="_blank">update the agent configuration</a>:</strong></span> </p><p> <span class="bold bold"><strong>Option 1:</strong></span> Edit the files locally and apply the changes with <code class="code">kubectl apply -f</code>:</p><p> <code class="code">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</code> </p><p> <span class="bold bold"><strong>Option 2:</strong></span> Use <code class="code">kubectl edit</code> to edit files on the fly:</p><p> <code class="code">kubectl edit configmap sysdig-agent </code>-n sysdig-agent</p><p>Running agents will automatically pick the new configuration after Kubernetes pushes the changes across all the nodes in the cluster.</p></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" class="bridgehead">Verify Metrics in Sysdig Monitor UI</h8><p>Log in to Sysdig Monitor to verify that the agent deployed and the metrics are detected and collected appropriately.</p><p>The steps below give one way to do the check.</p><p>(See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor" target="_blank">Sysdig Monitor Documentation</a>.)</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access Sysdig Monitor:</p><p> <span class="bold bold"><strong>SaaS:</strong></span> <a class="link" href="https://app.sysdigcloud.com/" target="_blank">https://app.sysdigcloud.com</a> </p><p>Log in with your Sysdig user name and password.</p></li><li class="step"><p>Select the <code class="code">Explore</code> tab to see if metrics are displayed.</p></li><li class="step"><p>(Once you have enabled <code class="code">new_k8s:true</code>)</p><p>To verify that kube state metrics and cluster name are working correctly: Select the <code class="code">Explore</code> tab and create a grouping by <code class="code"> <a class="link" href="http://kubernetes.cluster.name" target="_blank">kubernetes.cluster.name</a> </code> and <code class="code"> <a class="link" href="http://kubernetes.pod.name" target="_blank">kubernetes.pod.name</a> </code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1064px"><tr style="height: 250px"><td><img src="image/15d5af4f546c5f.png" style="max-width: 1064px; max-height: 250px; " alt="373574807.png"></img></td></tr></table></div></li><li class="step"><p>Select an individual container or pod to see details.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="706px"><tr style="height: 250px"><td><img src="image/15d5af4f550618.png" style="max-width: 706px; max-height: 250px; " alt="373574813.png"></img></td></tr></table></div></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Kubernetes metadata (pods, deployments etc.) appear a minute or two later than the nodes/containers themselves; if pod names do not appear immediately, wait and retry the Explore view.</p><p>If agents are disconnecting, there could be an issue with your MAC addresses. See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/373575015/Troubleshooting+Agent+Installation" target="_blank">Troubleshooting Agent Installation</a> for tips.</p></div><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-AdditionalOptions" class="bridgehead">Additional Options</h8><h8 id="UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-ConnecttotheSysdigBackendviaStaticIPsSaaSonly" class="bridgehead">Connect to the Sysdig Backend via Static IPs (SaaS only)</h8><p>Sysdig provides a list of static IP addresses that can be whitelisted in a Sysdig environment, allowing users to establish a network connection to the Sysdig backend without opening complete network connectivity. This is done by setting the Collector IP to <code class="code"> <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </code>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The <code class="code">sysdig-agent-configmap.yaml</code> file can be edited either locally or using the edit command in Kubernetes. refer to the section above for more information.</p></div><p>To configure the collector IP in a Kubernetes SaaS instance:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Open <code class="code">sysdig-agent-configmap.yaml</code> in a text editor.</p></li><li class="step"><p>Uncomment the following lines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>collector:</p></li><li class="listitem"><p>collector_port</p></li></ul></div></li><li class="step"><p>Set the collector: value to <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </p></li><li class="step"><p>Set the collector_port: value to 6443</p></li><li class="step"><p>Save the file.</p></li></ol></div><p>The example file below shows how the <code class="code">sysdig-agent-configmap.yaml</code> file should look after configuration:</p><pre class="programlisting">apiVersion: v1
kind: ConfigMap
metadata:
  name: sysdig-agent
data:
  dragent.yaml: |
    ### Agent tags
    # tags: linux:ubuntu,dept:dev,local:nyc

    #### Sysdig Software related config ####

    # Sysdig collector address
    collector: collector-static.sysdigcloud.com

    # Collector TCP port
    collector_port: 6443

    # Whether collector accepts ssl/TLS
    ssl: true

    # collector certificate validation
    ssl_verify_certificate: true

    # Sysdig Secure
    security:
                enabled: true

    #######################################
    # new_k8s: true
    # k8s_cluster_name: production</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-Preparation" title="Preparation">Preparation</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-OpenPort6443forAgentIngressandEgress" title="Open Port 6443 for Agent Ingress and Egress">Open Port 6443 for Agent Ingress and Egress </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-GKECOSeBPF-SpecificRequirements" title="GKE COS/eBPF-Specific Requirements">GKE COS/eBPF-Specific Requirements </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-BackgroundInfo" title="Background Info">Background Info</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-InstallationSteps" title="Installation Steps">Installation Steps</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-DeploytheAgents" title="Deploy the Agents">Deploy the Agents</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-EnableKubeStateMetricsandClusterName" title="Enable Kube State Metrics and Cluster Name">Enable Kube State Metrics and Cluster Name</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">Verify Metrics in Sysdig Monitor UI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-87b9fa2e-4447-90f3-6aa9-a20351793c06_id_GKEAgentInstallationSteps-AdditionalOptions" title="Additional Options">Additional Options</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Connect to the Sysdig Backend via Static IPs (SaaS only) </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cfe6c7cd-6f8a-b6e8-5d6d-3ed8432efe07" data-publication-date="" id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7"><div class="titlepage"><div><div class="title"><h6 class="title">OpenShift Agent Installation Steps</h6></div></div></div><p>Review the Prerequisites in <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> and the <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a>, then proceed with installation.</p><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-ConfigureforOpenShift" class="bridgehead">Configure for OpenShift</h8><p>If you are using Red Hat OpenShift, these steps are required. They describe how to create a project, assign and label the node selector, create a privileged service account, and add it to a cluster role.</p><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-CopyPasteSampleCodeBlock" class="bridgehead">Copy/Paste Sample Code Block</h8><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In the example code, this document uses <span class="bold bold"><strong> <code class="code">sysdig-agent </code> </strong></span>for the PROJECT NAME (<code class="code">-n</code>), the SERVICE ACCOUNT (<code class="code">-z</code>), and the NODE SELECTOR.</p></div><p>You can copy-paste the code as-is, or follow the steps below to customize your naming conventions.</p><pre class="programlisting">oc adm new-project sysdig-agent --node-selector='app=sysdig-agent'
oc label node --all "app=sysdig-agent"
oc project sysdig-agent
oc create serviceaccount sysdig-agent
oc adm policy add-scc-to-user privileged -n sysdig-agent -z sysdig-agent
oc adm policy add-cluster-role-to-user cluster-reader -n sysdig-agent -z sysdig-agent</pre><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-OrCustomizetheCode" class="bridgehead">Or Customize the Code</h8><p>You can use your own PROJECT NAME and NODE SELECTOR names if desired.</p><p>Note that if you use a different SERVICE ACCOUNT name, you will need to edit the default service account in the <a class="link" href="">OpenShift Agent Installation Steps#Sysdig Installation Steps</a>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create a new OpenShift project for the Sysdig agent deployment and assign the node selector:</p><pre class="programlisting">oc adm new-project PROJECT-NAME --node-selector="app=APP-NAME"</pre></li><li class="step"><p>Label the node with the node selector:</p><pre class="programlisting">oc label node --all "app=APP-NAME"</pre></li><li class="step"><p>Change to the new OpenShift Project for the Sysdig agent deployment:</p><pre class="programlisting">oc project PROJECT-NAME</pre></li><li class="step"><p>Create a service account for the project:</p><pre class="programlisting">oc create serviceaccount SERVICE-ACCOUNT</pre></li><li class="step"><p>Add the service account to <span class="bold bold"><strong>privileged</strong></span> Security Context Constraints:</p><pre class="programlisting">oc adm policy add-scc-to-user privileged -n PROJECT-NAME -z SERVICE-ACCOUNT</pre></li><li class="step"><p>Add the service account to the <code class="code">cluster-reader </code>Cluster Role:</p><pre class="programlisting">oc adm policy add-cluster-role-to-user cluster-reader -n PROJECT-NAME -z SERVICE-ACCOUNT</pre></li></ol></div><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-SysdigInstallationSteps" class="bridgehead">Sysdig Installation Steps</h8><p>To deploy agents using Kubernetes daemonsets, you <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">download</a> the configuration files, edit them as required, and deploy them.</p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-daemonset-v2.yaml" target="_blank">sysdig-agent-daemonset-v2.yaml</a> </code> </p><p> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/agent_deploy/kubernetes/sysdig-agent-configmap.yaml" target="_blank">sysdig-agent-configmap.yaml</a> </code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>HELM CHART OPTION</strong></span>Kubernetes also offers a package manager, <a class="link" href="https://helm.sh/" target="_blank">Helm</a>, which uses charts to simplify this process.</p><p>If you are using Helm charts in your K8s environment, we recommend using them to deploy Sysdig agents, as described <a class="link" href="https://github.com/helm/charts/blob/master/stable/sysdig/README.md" target="_blank">here</a>.</p></div><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-DeploytheAgents" class="bridgehead">Deploy the Agents</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">Download</a> </strong></span>the sample files<code class="code"></code> <code class="code">sysdig-agent-daemonset-v2.yaml,</code> and <code class="code">sysdig-agent-configmap.yaml </code> </p></li><li class="step"><p>Create a secret key using the command:</p><pre class="programlisting">kubectl create secret generic sysdig-agent --from-literal=access-key=&lt;your sysdig access key&gt; -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>If you created a service account name other than <code class="code">sysdig-agent</code>: </strong></span>Edit <code class="code">sysdig-agent-daemonset-v2.yaml</code>to provide your custom value:<code class="code"></code> </p><pre class="programlisting">serviceAccount: sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong>FOR ON-PREM INSTALLATIONS ONLY: </strong></span>Edit <code class="code">configmap.yaml </code>to add the <code class="code">collector</code> <code class="code">address</code> and <code class="code">port</code>, and <code class="code">SSL/TLS</code> information :</p><pre class="programlisting">collector:
collector_port: 443
ssl: #true or false
ssl_verify_certificate: #true or false</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">ssl_verify_certificate</code> should be set to fa<code class="code">l</code>se if a self-signed certificate or private, CA-signed cert is used. See information about SSL in on-premises <a class="link" href="">here</a>.</p></div></li><li class="step"><p> <span class="bold bold"><strong>(ALL INSTALLS): </strong></span>Apply the <code class="code">configmap.yaml </code>file using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p> <span class="bold bold"><strong> <span class="bold bold"><strong>(ALL INSTALLS): </strong></span> </strong></span>Apply the <code class="code">daemonset-v2.yaml </code>file using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-daemonset-v2.yaml -n sysdig-agent</pre></li></ol></div><p>The agents are deployed and you can <a class="link" href="">check the Monitor UI </a>to see some metrics. You can make further edits to the <code class="code">configmap</code> as described below.</p><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-EnableKubeStateMetricsandClusterName" class="bridgehead">Enable Kube State Metrics and Cluster Name</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span> to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">new_k8s: true</code> </strong></span> </p><p>This allows kube state metrics to be automatically detected, monitored, and displayed in Sysdig Monitor.</p><p>For more information, see the <a class="link" href="https://sysdig.com/blog/introducing-kube-state-metrics/" target="_blank">Kube State Metrics</a> entry in the Sysdig blog.</p></li><li class="step"><p> <span class="bold bold"><strong>Edit <code class="code">sysdig-agent-configmap.yaml</code> </strong></span>to <span class="bold bold"><strong>uncomment </strong></span> the line: <span class="bold bold"><strong> <code class="code">k8s_cluster_name: </code> </strong></span>and add your cluster name.</p><p>Setting cluster name here allows you to view, scope, and segment metrics in the Sysdig Monitor UI by Kubernetes cluster.</p><p> <span class="bold bold"><strong>Note:</strong></span> Alternatively, if you assign a tag with "<code class="code">cluster</code>" in the tag name, Sysdig Monitor displays that as the Kubernetes cluster name.</p></li><li class="step"><p> <span class="bold bold"><strong>Apply the configmap changes </strong></span>using the command:</p><pre class="programlisting">kubectl apply -f sysdig-agent-configmap.yaml -n sysdig-agent</pre></li><li class="step"><p>Proceed to <a class="link" href="">verify the metrics</a> in the Sysdig Monitor UI.</p></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>There are two ways to <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/189726885/Agent+Configuration" target="_blank">update the agent configuration</a>:</strong></span> </p><p> <span class="bold bold"><strong>Option 1:</strong></span> Edit the files locally and apply the changes with <code class="code">kubectl apply -f</code>:</p><p> <code class="code">kubectl apply -f sysdig-agent-configmap.yaml -n </code>sysdig-agent</p><p> <span class="bold bold"><strong>Option 2: </strong></span>Edit the files on the fly with <code class="code">kubectl edit</code>:</p><p> <code class="code">kubectl edit configmap sysdig-agent -n sysdig-agent</code> </p><p>Running agents automatically pick the new configuration after Kubernetes pushes the changes across all the nodes in the cluster.</p></div><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" class="bridgehead">Verify Metrics in Sysdig Monitor UI</h8><p>Log in to Sysdig Monitor to verify that the agent deployed and the metrics are detected and collected appropriately.</p><p>The steps below give one way to do the check.</p><p>(See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor" target="_blank">Sysdig Monitor Documentation</a>.)</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access Sysdig Monitor:</p><p> <span class="bold bold"><strong>SaaS:</strong></span> <a class="link" href="https://app.sysdigcloud.com/" target="_blank">https://app.sysdigcloud.com</a> </p><p>Log in with your Sysdig user name and password.</p></li><li class="step"><p>Select the <code class="code">Explore</code> tab to see if metrics are displayed.</p></li><li class="step"><p>(Once you have enabled <code class="code">new_k8s:true</code>)</p><p>To verify that kube state metrics and cluster name are working correctly: Select the <code class="code">Explore</code> tab and create a grouping by <code class="code"> <a class="link" href="http://kubernetes.cluster.name" target="_blank">kubernetes.cluster.name</a> </code> and <code class="code"> <a class="link" href="http://kubernetes.pod.name" target="_blank">kubernetes.pod.name</a> </code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1064px"><tr style="height: 250px"><td><img src="image/15d5af4f546c5f.png" style="max-width: 1064px; max-height: 250px; " alt="373574807.png"></img></td></tr></table></div></li><li class="step"><p>Select an individual container or pod to see details.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="706px"><tr style="height: 250px"><td><img src="image/15d5af4f550618.png" style="max-width: 706px; max-height: 250px; " alt="373574813.png"></img></td></tr></table></div></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Kubernetes metadata (pods, deployments etc.) appear a minute or two later than the nodes/containers themselves; if pod names do not appear immediately, wait and retry the Explore view.</p><p>If agents are disconnecting, there could be an issue with your MAC addresses. See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/373575015/Troubleshooting+Agent+Installation" target="_blank">Troubleshooting Agent Installation</a> for tips.</p></div><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-AdditionalOptions" class="bridgehead">Additional Options</h8><h8 id="UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-ConnecttotheSysdigBackendviaStaticIPsSaaSonly" class="bridgehead">Connect to the Sysdig Backend via Static IPs (SaaS only)</h8><p>Sysdig provides a list of static IP addresses that can be whitelisted in a Sysdig environment, allowing users to establish a network connection to the Sysdig backend without opening complete network connectivity. This is done by setting the Collector IP to <code class="code"> <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </code>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The <code class="code">sysdig-agent-configmap.yaml</code> file can be edited either locally or using the edit command in Kubernetes. refer to the section above for more information.</p></div><p>To configure the collector IP in a Kubernetes SaaS instance:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Open <code class="code">sysdig-agent-configmap.yaml</code> in a text editor.</p></li><li class="step"><p>Uncomment the following lines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>collector:</p></li><li class="listitem"><p>collector_port</p></li></ul></div></li><li class="step"><p>Set the collector: value to <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </p></li><li class="step"><p>Set the collector_port: value to 6443</p></li><li class="step"><p>Save the file.</p></li></ol></div><p>The example file below shows how the <code class="code">sysdig-agent-configmap.yaml</code> file should look after configuration:</p><pre class="programlisting">apiVersion: v1
kind: ConfigMap
metadata:
  name: sysdig-agent
data:
  dragent.yaml: |
    ### Agent tags
    # tags: linux:ubuntu,dept:dev,local:nyc

    #### Sysdig Software related config ####

    # Sysdig collector address
    collector: collector-static.sysdigcloud.com

    # Collector TCP port
    collector_port: 6443

    # Whether collector accepts ssl/TLS
    ssl: true

    # collector certificate validation
    ssl_verify_certificate: true

    # Sysdig Secure
    security:
                enabled: true

    #######################################
    # new_k8s: true
    # k8s_cluster_name: production</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-ConfigureforOpenShift" title="Configure for OpenShift">Configure for OpenShift </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-CopyPasteSampleCodeBlock" title="Copy/Paste Sample Code Block">Copy/Paste Sample Code Block </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-OrCustomizetheCode" title="Or Customize the Code">Or Customize the Code</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-SysdigInstallationSteps" title="Sysdig Installation Steps">Sysdig Installation Steps </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-DeploytheAgents" title="Deploy the Agents">Deploy the Agents</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-EnableKubeStateMetricsandClusterName" title="Enable Kube State Metrics and Cluster Name">Enable Kube State Metrics and Cluster Name</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-VerifyMetricsinSysdigMonitorUI" title="Verify Metrics in Sysdig Monitor UI">Verify Metrics in Sysdig Monitor UI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7_id_OpenShiftAgentInstallationSteps-AdditionalOptions" title="Additional Options">Additional Options</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Connect to the Sysdig Backend via Static IPs (SaaS only) </p></li></ul></div></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-a7c65022-ed74-4a0e-dacb-ac0c09e99a8b" data-publication-date="" id="UUID-2e20860b-9ea6-02ce-db21-34afc910b005"><div class="titlepage"><div><div class="title"><h6 class="title">Common Verify</h6></div></div></div><h8 id="UUID-2e20860b-9ea6-02ce-db21-34afc910b005_id_CommonVerify-VerifyMetricsinSysdigMonitorUI" class="bridgehead">Verify Metrics in Sysdig Monitor UI</h8><p>Log in to Sysdig Monitor to verify that the agent deployed and the metrics are detected and collected appropriately.</p><p>The steps below give one way to do the check.</p><p>(See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor" target="_blank">Sysdig Monitor Documentation</a>.)</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access Sysdig Monitor:</p><p> <span class="bold bold"><strong>SaaS:</strong></span> <a class="link" href="https://app.sysdigcloud.com/" target="_blank">https://app.sysdigcloud.com</a> </p><p>Log in with your Sysdig user name and password.</p></li><li class="step"><p>Select the <code class="code">Explore</code> tab to see if metrics are displayed.</p></li><li class="step"><p>(Once you have enabled <code class="code">new_k8s:true</code>)</p><p>To verify that kube state metrics and cluster name are working correctly: Select the <code class="code">Explore</code> tab and create a grouping by <code class="code"> <a class="link" href="http://kubernetes.cluster.name" target="_blank">kubernetes.cluster.name</a> </code> and <code class="code"> <a class="link" href="http://kubernetes.pod.name" target="_blank">kubernetes.pod.name</a> </code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1064px"><tr style="height: 250px"><td><img src="image/15d5af4f546c5f.png" style="max-width: 1064px; max-height: 250px; " alt="373574807.png"></img></td></tr></table></div></li><li class="step"><p>Select an individual container or pod to see details.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="706px"><tr style="height: 250px"><td><img src="image/15d5af4f550618.png" style="max-width: 706px; max-height: 250px; " alt="373574813.png"></img></td></tr></table></div></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Kubernetes metadata (pods, deployments etc.) appear a minute or two later than the nodes/containers themselves; if pod names do not appear immediately, wait and retry the Explore view.</p><p>If agents are disconnecting, there could be an issue with your MAC addresses. See <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8" title="Troubleshooting Agent Installation">Troubleshooting Agent Installation</a> for tips.</p></div><h8 id="UUID-2e20860b-9ea6-02ce-db21-34afc910b005_id_CommonVerify-AdditionalOptions" class="bridgehead">Additional Options</h8><h8 id="UUID-2e20860b-9ea6-02ce-db21-34afc910b005_id_CommonVerify-ConnecttotheSysdigBackendviaStaticIPsSaaSonly" class="bridgehead">Connect to the Sysdig Backend via Static IPs (SaaS only)</h8><p>Sysdig provides a list of static IP addresses that can be whitelisted in a Sysdig environment, allowing users to establish a network connection to the Sysdig backend without opening complete network connectivity. This is done by setting the Collector IP to <code class="code"> <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </code>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The <code class="code">sysdig-agent-configmap.yaml</code> file can be edited either locally or using the edit command in Kubernetes. refer to the section above for more information.</p></div><p>To configure the collector IP in a Kubernetes SaaS instance:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Open <code class="code">sysdig-agent-configmap.yaml</code> in a text editor.</p></li><li class="step"><p>Uncomment the following lines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>collector:</p></li><li class="listitem"><p>collector_port</p></li></ul></div></li><li class="step"><p>Set the collector: value to <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a> </p></li><li class="step"><p>Set the collector_port: value to 6443</p></li><li class="step"><p>Save the file.</p></li></ol></div><p>The example file below shows how the <code class="code">sysdig-agent-configmap.yaml</code> file should look after configuration:</p><pre class="programlisting">apiVersion: v1
kind: ConfigMap
metadata:
  name: sysdig-agent
data:
  dragent.yaml: |
    ### Agent tags
    # tags: linux:ubuntu,dept:dev,local:nyc

    #### Sysdig Software related config ####

    # Sysdig collector address
    collector: collector-static.sysdigcloud.com

    # Collector TCP port
    collector_port: 6443

    # Whether collector accepts ssl/TLS
    ssl: true

    # collector certificate validation
    ssl_verify_certificate: true

    # Sysdig Secure
    security:
                enabled: true

    #######################################
    # new_k8s: true
    # k8s_cluster_name: production</pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-bfcc51c2-1321-2074-ca5c-107c28690a91" data-publication-date="" id="UUID-43fa1989-6685-dbcc-8ca3-15d493d128b1"><div class="titlepage"><div><div class="title"><h6 class="title">IBM Cloud Kubernetes Service (IKS) Installation Steps</h6></div></div></div><p>In the case of IBM's Cloud Kubernetes Service (IKS), IBM maintains Sysdig agent installation information on their own website.</p><p>See <a class="link" href="">https://console.bluemix.net/docs/services/Monitoring-with-Sysdig/index.html#getting-started</a>.</p><p> <a class="link" href=""><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="700px"><tr><td><img src="image/15d5af4f560f77.png" style="max-width: 700px; " alt="373574828.png"></img></td></tr></table></div></a> </p></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-4027e40a-6b41-084e-7df4-13641f11dde6" data-publication-date="" id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Install: Non-Orchestrated (Docker Agent | Service Agent )</h6></div></div></div><p>This section describes how to install the Sysdig agent directly on a Linux host, without using an orchestrator such as Kubernetes or Mesos.</p><p>The agent can be installed two ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>As a standard Docker container</p></li><li class="listitem"><p>As a non-containerized service</p></li></ul></div><p>The steps for each flavor differ slightly depending on whether you are using the <span class="bold bold"><strong>SaaS</strong></span> or <span class="bold bold"><strong>on-premises</strong></span> version of the Sysdig platform.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If you are installing the Sysdig agent in an environment that has Kubernetes, use the <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> instructions instead.</p></div><h6 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-Prerequisites" class="bridgehead">Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151570" target="_blank">Host Requirements for Agent Installation</a>. There you can check the requirements concerning:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="">Supported Linux distributions</a> </p></li><li class="listitem"><p> <a class="link" href="">Network connection</a> </p></li><li class="listitem"><p> <a class="link" href="">Sysdig access key</a> </p></li><li class="listitem"><p> <a class="link" href="">Cloud service providers</a> (AWS, Google, and Microsoft Azure) and any steps you may need to configure to integrate the Sysdig agent.</p></li></ul></div></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>On kernel headers: </strong></span>The Sysdig agent requires kernel header files in order to install successfully on a host, and the agent is delivered with precompiled headers. If the hosts in your environment match the kernel versions included with the agent, no special action is needed.</p><p>In some cases, the host(s) in your environment may use Unix versions that do not match the provided headers, and the agent may fail to install correctly. In those cases, you must install the kernel headers manually. See <a class="link" href="">About Kernel Headers and the Kernel Module</a> for details.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run any commands as <span class="bold bold"><strong>root</strong></span> or with the <code class="code">sudo</code> command.</p></li><li class="listitem"><p>Have your Sysdig access key on hand.</p><p>If you launch an agent install from <a class="link" href="http://www.sysdig.com," target="_blank">www.sysdig.com,</a> the welcome wizard will present an access key.</p></li></ul></div><h6 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-DockerContainerAgentInstallation" class="bridgehead">Docker Container Agent Installation</h6><p>The Sysdig agent can be deployed as a Docker container.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The commands below can also be copy/pasted from the Welcome Wizard or the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/213352719/Agent+Installation+Overview+and+Key" target="_blank">Agent Installation</a> page in the Sysdig UI.</p><p>In that case, your access key will already be included in the command automatically.</p></div><h7 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-SaaS" class="bridgehead">SaaS</h7><p>Run the agent image, providing the access key and (optional) user-defined tags:</p><pre class="programlisting">docker run -d --name sysdig-agent \
--restart always \
--privileged \
--net host \
--pid host\
 -e ACCESS_KEY=[ACCESS_KEY] \
-e TAGS=[TAGS] \
-v /var/run/docker.sock:/host/var/run/docker.sock \
-v /dev:/host/dev \
-v /proc:/host/proc:ro \
-v /boot:/host/boot:ro \
-v /lib/modules:/host/lib/modules:ro \
-v /usr:/host/usr:ro --shm-size=512m sysdig/agent</pre><h7 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-On-Premises" class="bridgehead">On-Premises</h7><p>Provide collector and SSL/TLS information in addition to access key and optional tags:</p><pre class="programlisting">docker run -d --name sysdig-agent \
--restart always \
--privileged \
--net host \
--pid host \
-e ACCESS_KEY=[ACCESS_KEY] \
-e COLLECTOR=[COLLECTOR_ADDRESS] \
-e SECURE=true \
-e CHECK_CERTIFICATE=true \
[-e TAGS=[TAGS]] 
-v /var/run/docker.sock:/host/var/run/docker.sock \
-v /dev:/host/dev \
-v /proc:/host/proc:ro \
-v /boot:/host/boot:ro \
-v /lib/modules:/host/lib/modules:ro \
-v /usr:/host/usr:ro --shm-size=512m sysdig/agent</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">CHECK_CERTIFICATE</code> should be set to fa<code class="code">l</code>se if a self-signed certificate or private, CA-signed cert is used. See information about SSL in on-premises <a class="link" href="">here</a>.</p></div><p>See also: i<a class="link" href="">nformation on finding the collector address</a>.</p><h6 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-ServiceAgentInstallationonLinuxHost" class="bridgehead">Service Agent Installation on Linux Host</h6><p>Use these instructions to install the agent on the host itself, not in a container. Install on each host in the environment.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The command lines below can also be copy/pasted from the Welcome wizard or the <code class="code">Settings&gt;Agent Installation</code> page in the Sysdig Monitor interface.</p><p>In that case, your access key will already be included in the command automatically.</p></div><h7 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-SaaS1" class="bridgehead">SaaS</h7><p>Run the following command:</p><pre class="programlisting">curl -s https://download.sysdig.com/stable/install-agent | sudo bash -s -- --access_key [ACCESS_KEY] [--tags [TAGS]]</pre><p>Where <code class="code">[ACCESS_KEY]</code> is your unique agent access key string(e.g.<span class="bold bold"><strong> <code class="code">1234-your-key-here-1234</code> </strong></span>) and <code class="code">[TAGS]</code> is an optional list of user-defined agent tags (e.g. <code class="code">role:webserver,location:europe</code>).</p><h7 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-On-Premises1" class="bridgehead">On-Premises</h7><p>Run the following command:</p><pre class="programlisting">curl -s https://download.sysdig.com/stable/install-agent | sudo bash -s -- --access_key [ACCESS_KEY] --collector [COLLECTOR_ADDRESS] --secure true --ssl_verify_certificate true [--tags [TAGS]]</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">ssl_verify_certificate</code> should be set to fa<code class="code">l</code>se if a self-signed certificate or private, CA-signed cert is used. See information about SSL in on-premises <a class="link" href="">here</a>.</p></div><p>See also: i<a class="link" href="">nformation on finding the collector address</a>.</p><p>Additional Installation Options</p><h7 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-ConnecttotheSysdigBackendviaStaticIPsSaaSonly" class="bridgehead">Connect to the Sysdig Backend via Static IPs (SaaS only)</h7><p>Sysdig provides a list of static IP addresses that can be whitelisted in a Sysdig environment, allowing users to establish a network connection to the Sysdig backend without opening complete network connectivity. This is done by setting the Collector IP to <a class="link" href="http://collector-static.sysdigcloud.com" target="_blank">collector-static.sysdigcloud.com</a>:</p><pre class="programlisting">user@host:~$ docker run --name sysdig-agent \
--privileged \
--net host \
--pid host \
-e ACCESS_KEY=[ACCESS_KEY] \
-e TAGS=[TAGS] \
-v /var/run/docker.sock:/host/var/run/docker.sock \
-v /dev:/host/dev \
-v /proc:/host/proc:ro \
-v /boot:/host/boot:ro \
-v /lib/modules:/host/lib/modules:ro \
-v /usr:/host/usr:ro \
-e COLLECTOR=collector-static.sysdigcloud.com \
-e COLLECTOR_PORT=6443 \
-e SECURE=true \
-e CHECK_CERTIFICATE=true \
--shm-size=512m \
sysdig/agent</pre><h6 id="UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e_id_AgentInstallNon-OrchestratedDockerAgentServiceAgent-NoteonManualAgentInstallation" class="bridgehead">Note on Manual Agent Installation</h6><p>In the following cases, it may be preferrable to perform a manual installation.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Full control over the deployment process</p></li><li class="listitem"><p>Integration with configuration management tools</p></li><li class="listitem"><p>Custom kernel</p></li><li class="listitem"><p>Unsupported distribution</p></li></ul></div><p>If desired, see <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983" title="Agent Install: Manual Linux Installation">Agent Install: Manual Linux Installation</a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Prerequisites </p></li><li class="listitem"><p> Docker Container Agent Installation  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> SaaS </p></li><li class="listitem"><p> On-Premises </p></li></ul></div></li><li class="listitem"><p> Service Agent Installation on Linux Host </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> SaaS </p></li><li class="listitem"><p> On-Premises </p></li><li class="listitem"><p> Connect to the Sysdig Backend via Static IPs (SaaS only) </p></li></ul></div></li><li class="listitem"><p> Note on Manual Agent Installation  </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-6956b41a-a0c1-115d-25cb-4b7d1911e1f5" data-publication-date="" id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Install: Mesos | Marathon | DCOS</h6></div></div></div><p>Marathon is the container orchestration platform for Mesosphere’s Datacenter Operating System (DC/OS) and Apache Mesos.</p><p>This guide describes how to install the Sysdig agent container on each underlying host in your Mesos cluster. Once installed, the agent will automatically connect to the Mesos and Marathon APIs to pull relevant metadata about the environment, and will begin monitoring all of your hosts, apps, containers, and frameworks.</p><h6 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-StandardInstallationInstructions" class="bridgehead">Standard Installation Instructions</h6><p>Review the <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a>.</p><p>In this three-part installation, you:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Deploy the Sysdig agent on all Mesos Agent (aka "Slave") nodes, either automatically or by creating and posting a .<code class="code">json</code> file to the leader Marathon API server.</p></li><li class="listitem"><p>Deploy the Sysdig agent on the Mesos Master nodes.</p></li><li class="listitem"><p>Special configuration steps: modify the Sysdig agent config file to monitor Marathon instances.</p></li></ul></div><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-DeploytheSysdigagentonyourMesosAgentnodes" class="bridgehead">Deploy the Sysdig agent on your Mesos Agent nodes</h7><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-PreferredOptionAutomaticinstallDCOS111" class="bridgehead">Preferred Option: Automatic install (DC/OS 1.11+)</h7><p>If you're using DC/OS 1.8 or higher, then you can find Sysdig in the Mesosphere Universe marketplace and install it from there.</p><p>It will automatically deploy the Sysdig agent container on each of your Mesos Agent nodes as a Marathon app.</p><p>Proceed to Deploy the Sysdig Agent.</p><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-AlternateOptionPostajsonfile" class="bridgehead">Alternate Option: Post a .json file</h7><p>If you are using a version of DC/OS earlier than 1.8 then:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create a .json file for Marathon, in the following format.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <code class="code">COLLECTOR, COLLECTOR_PORT, SECURE,</code> and <code class="code">CHECK_CERT</code> are used in environments with Sysdig's on-premises backend installed. See information on <a class="link" href="">finding the collector address</a>.</p><p>They are not needed to install the agent for Sysdig SaaS accounts.</p></div><pre class="programlisting">$cat &lt;&lt;- EOF &gt; "sysdig.json"
{
  "id": "sysdig-agent",
  "cpus": 1.0,
  "constraints": [["hostname", "UNIQUE"]],
  "mem": 850.0,
  "instances": YOUR-NUMBER-OF-INSTANCES-HERE,
  "labels" : {"role" : "monitoring", "name" : "sdc-agent" },
  "container": {
    "type": "DOCKER",
    "docker": {
      "image": "sysdig/agent",
      "forcePullImage": true,
      "network": "HOST",
      "privileged": true,
      "parameters": [
        { "key": "pid", "value": "host" },
        { "key": "env", "value": "ACCESS_KEY=YOUR-ACCESS-KEY-HERE" },
        { "key": "env", "value": "COLLECTOR=COLLECTOR-ADDRESS-HERE" },
        { "key": "env", "value": "COLLECTOR_PORT=COLLECTOR-PORT-HERE" },
        { "key": "env", "value": "CHECK_CERT=false" },
        { "key": "shm-size", "value": "350m" }
      ]
    },
    "volumes": [
        { 
          "containerPath": "/host/var/run/docker.sock",
          "hostPath": "/var/run/docker.sock", 
          "mode": "RW" 
        },
        {
          "containerPath": "/host/dev",
          "hostPath": "/dev",
          "mode": "RW"
        },
        {
          "containerPath": "/host/proc",
          "hostPath": "/proc",
          "mode": "RO"
        },
        {
          "containerPath": "/host/boot",
          "hostPath": "/boot",
          "mode": "RO"
        },
        {
          "containerPath": "/host/lib/modules",
          "hostPath": "/lib/modules",
          "mode": "RO"
        },
        {
          "containerPath": "/host/usr",
          "hostPath": "/usr",
          "mode": "RO"
        }
      ]
  }
}
EOF</pre><p>See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/207224862/Table+1+Environment+Variables+for+Agent+Config+File" target="_blank">Table 1: Environment Variables</a> for the Sysdig <code class="code">name:value</code> definitions.</p><p>Complete the “<code class="code">cpus</code>”, “<code class="code">mem</code>” and “<code class="code">labels</code>” (i.e. Marathon labels) entries to fit the capacity and requirements of the cluster environment.</p></li><li class="step"><p>POST the created .<code class="code">json</code> file to the leader Marathon API server.</p><p> <code class="code">$curl -X POST http://$(hostname -i):8080/v2/apps -d @sysdig.json -H "Content-type: application/json"</code> </p></li></ol></div><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-DeploytheSysdigAgent" class="bridgehead">Deploy the Sysdig Agent</h7><p>After deploying the agent to the Mesos Agent nodes, you will install agents on each of the Mesos Master nodes as well.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If any cluster node has both Mesos Master and Mesos Agent roles, do not perform this installation step on that node. It already will have a Sysdig agent installed from the procedure in step A. Running duplicate Sysdig agents on a node will cause errors.</p></div><p>Use the <a class="link" href="33836-17701-sysdig-agent.html#UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e" title="Agent Install: Non-Orchestrated (Docker Agent | Service Agent )">Agent Install: Non-Orchestrated (Docker Agent | Service Agent )</a> instructions to install the agent directly on each of your Mesos Master nodes.</p><p>Use the Docker container instructions, or the non-containerized, service agent instructions, depending on your environment.</p><p>When the Sysdig agent is successfully installed on the master nodes, it will automatically connect to the local Mesos and Marathon (if available) API servers via <code class="code"> <a class="link" href="http://localhost:5050" target="_blank">http://localhost:5050</a> </code> and <code class="code"> <a class="link" href="http://localhost:8080" target="_blank">http://localhost:8080</a> </code> respectively, to collect cluster configuration and current state metadata in addition to host metrics.</p><h6 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-SpecialConfigurationSteps" class="bridgehead">Special Configuration Steps</h6><p>In certains situations, you may need to add additional configurations to the <code class="code">dragent.yaml</code> file:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the Sysdig agent cannot be run directly on the Mesos API server</p></li><li class="listitem"><p>If the API server is protected with a username/password.</p></li></ul></div><p>Descriptions and examples are shown below.</p><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-IftheSysdigAgentCannotRunOntheMesosAPIServer" class="bridgehead">If the Sysdig Agent Cannot Run On the Mesos API Server</h7><p>Mesos allows multiple masters. If the API server can not be instrumented with a Sysdig agent, simply delegate ONE other node with an agent installed to remotely receive infrastructure information from the API server.</p><p>NOTE: If you manually configure the agent to point to a master with a static configuration file entry, then automatic detection/following of leader changes will no longer be enabled.</p><p>Add the following Mesos parameter to the delegated agent's <code class="code">dragent.yaml</code> file to allow it to connect to the remote API server and authenticate, either by:</p><p>a. Directly editing <code class="code">dragent.yaml</code> on the host, or</p><p>b. Converting the YAML code to a single-line format and adding it as an <code class="code">ADDITIONAL_CONF</code> argument in a Docker command.</p><p>See <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a> for details.</p><p>Specify the API server's connection method, address, and port. Also specify credentials if necessary.</p><p> <span class="bold bold"><strong>YAML example:</strong></span> </p><pre class="programlisting">mesos_state_uri: http://[acct:passwd@][hostname][:port]
marathon_uris:
  - http://[acct:passwd@][hostname][:port]</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Although `marathon_uris:` is an array, currently only a single "root" Marathon framework per cluster is supported. Multiple side-by-side Marathon frameworks should not be configured in order for our agent to function properly. Multiple side-by-side "root" Marathon frameworks on the same cluster are currently not supported. The only supported multiple-Marathon configuration is with one "root" Marathon and other Marathon frameworks as its apps.</p></div><h7 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-IftheMesosAPIserverrequiresauthentication" class="bridgehead">If the Mesos API server requires authentication</h7><p>If the agent is installed on the API server but the API server uses a different port or requires authentication, those parameters must be explicitly specified.</p><p>Add the following Mesos parameters to the API server's <code class="code">dragent.yaml</code> to make it connect to the API server and authenticate with any unique account and password, either by:</p><p>a. Directly editing <code class="code">dragent.yaml</code> on the host, or</p><p>b. Converting the YAML code to a single-line format and adding it as an <code class="code">ADDITIONAL_CONF</code> argument in a Docker command.</p><p>See <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a> for details.</p><p>Specify the API server's protocol, user credentials, and port:</p><pre class="programlisting">mesos_state_uri: http://[username:password@][hostname][:port]
marathon_uris:
  - http://[acct:passwd@][hostname][:port]</pre><p>*HTTPS protocol is also supported.</p><h6 id="UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-TroubleshootingTurningOffMetadataReception" class="bridgehead">Troubleshooting: Turning Off Metadata Reception</h6><p>In troubleshooting cases where auto-detection and reporting of your Mesos infrastructure needs to be temporarily turned off in a designated agent:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Comment out the Mesos parameter entries in the agent's dragent.yaml file.</p><p>Example parameters to disable: <code class="code">mesos_state_uri, marathon_uris </code> </p></li><li class="step"><p>If the agent is running on the API server (Master node) and auto-detecting a default configuration, you can add the line:</p><p> <code class="code">mesos_autodetect: false</code> </p><p>either directly in the dragent.yaml file or as an <code class="code">ADDITIONAL_CONF</code> parameter in a Docker command.</p></li><li class="step"><p>Restart the agent.</p></li></ol></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-StandardInstallationInstructions" title="Standard Installation Instructions">Standard Installation Instructions</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-DeploytheSysdigagentonyourMesosAgentnodes" title="Deploy the Sysdig agent on your Mesos Agent nodes">Deploy the Sysdig agent on your Mesos Agent nodes</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Preferred Option: Automatic install (DC/OS 1.11+)  </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-AlternateOptionPostajsonfile" title="Alternate Option: Post a .json file">Alternate Option: Post a .json file </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-DeploytheSysdigAgent" title="Deploy the Sysdig Agent">Deploy the Sysdig Agent</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-SpecialConfigurationSteps" title="Special Configuration Steps">Special Configuration Steps </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-IftheSysdigAgentCannotRunOntheMesosAPIServer" title="If the Sysdig Agent Cannot Run On the Mesos API Server">If the Sysdig Agent Cannot Run On the Mesos API Server</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-IftheMesosAPIserverrequiresauthentication" title="If the Mesos API server requires authentication">If the Mesos API server requires authentication</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b_id_AgentInstallMesosMarathonDCOS-TroubleshootingTurningOffMetadataReception" title="Troubleshooting: Turning Off Metadata Reception">Troubleshooting: Turning Off Metadata Reception</a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e9365ca7-ba78-6c3f-f7f5-1024441cac2c" data-publication-date="" id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Install: Manual Linux Installation</h6></div></div></div><p>Manual installation of the native Linux agent is recommended in the following cases:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Full control over the deployment process</p></li><li class="listitem"><p>Integration with configuration management tools</p></li><li class="listitem"><p>Custom kernel</p></li><li class="listitem"><p>Unsupported distribution (within Debian/Fedora flavors)</p></li></ul></div><p>Otherwise, you may want to just follow the standard Installation Guide:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e" title="Agent Install: Non-Orchestrated (Docker Agent | Service Agent )">Agent Install: Standard (Docker | Native Linux)</a> </p></li></ul></div><p>NOTE: If you are installing the Sysdig agent in an orchestrated infrastructure such as Kubernetes, Mesos/Marathon, use the respective Installation Guides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b" title="Agent Install: Mesos | Marathon | DCOS">Agent Install: Mesos | Marathon | DCOS</a> </p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Run the commands as root or with sudo.</p></div><h6 id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-InstallationOptions" class="bridgehead">Installation Options</h6><p>Review the <a class="link" href="33836-17701-sysdig-agent.html#UUID-d8162233-fc9f-b751-4d79-1696312db414" title="Host Requirements for Agent Installation">Host Requirements for Agent Installation</a>. Then follow the steps for the appropriate Linux distribution, below.</p><h7 id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-DebianUbuntu" class="bridgehead">Debian, Ubuntu</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Trust the Sysdig Monitor GPG key, configure the apt repository, and update the package list:</p><pre class="programlisting">curl -s https://download.sysdig.com/DRAIOS-GPG-KEY.public | apt-key add -
curl -s -o /etc/apt/sources.list.d/draios.list http://download.draios.com/stable/deb/draios.list
apt-get update</pre><pre class="programlisting"></pre></li><li class="step"><p>Install kernel development files.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>The following command might not work with every kernel. Make sure to customize the name of the package properly.</p></div><pre class="programlisting">apt-get -y install linux-headers-$(uname -r)</pre></li><li class="step"><p>Install, configure, and restart the Sysdig agent.</p><pre class="programlisting">apt-get -y install draios-agent
echo customerid: ACCESS_KEY &gt;&gt; /opt/draios/etc/dragent.yaml
echo tags: [TAGS] &gt;&gt; /opt/draios/etc/dragent.yaml
service dragent restart</pre><p>Replace <code class="code">ACCESS_KEY</code> with your unique access key string. Contact <a class="link" href="mailto:support@sysdigcloud.com" target="_blank">support@sysdig.com</a> to receive (or be reminded of) your access key. <code class="code">[TAGS]</code> is an optional parameter you can use to list one or more tags for this host (see below).</p></li></ol></div><h7 id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-CentOSRHELFedoraAmazonAMIAmazonLinux2" class="bridgehead">CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Trust the Sysdig Monitor GPG key, configure the yum repository.</p><pre class="programlisting">rpm --import https://download.sysdig.com/DRAIOS-GPG-KEY.public
curl -s -o /etc/yum.repos.d/draios.repo http://download.draios.com/stable/rpm/draios.repo</pre><pre class="programlisting"></pre></li><li class="step"><p>Install the EPEL repository</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The following command is required only if DKMS is not available in the distribution. You can verify if DKMS is available with <span class="bold bold"><strong> <code class="code">yum list dkms</code> </strong></span> </p><p>The command below contains a sample release number; be sure to update with the correct release.</p></div><pre class="programlisting"></pre><pre class="programlisting">rpm -i http://mirror.us.leaseweb.net/epel/6/i386/epel-release-6-8.noarch.rpm</pre></li><li class="step"><p>Install kernel development files.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>The following command might not work with every kernel. Make sure to customize the name of the package properly.</p></div><pre class="programlisting">yum -y install kernel-devel-$(uname -r)</pre></li><li class="step"><p>Install, configure, and start the Sysdig agent.</p><pre class="programlisting">yum -y install draios-agent
echo customerid: ACCESS_KEY &gt;&gt; /opt/draios/etc/dragent.yaml
echo tags: [TAGS] &gt;&gt; /opt/draios/etc/dragent.yaml
service dragent start</pre><p>Replace <code class="code">ACCESS_KEY</code> with your unique access key string. Contact <a class="link" href="mailto:support@sysdigcloud.com" target="_blank">support@sysdig.com</a> to receive (or be reminded of) your access key. <code class="code">[TAGS]</code> is an optional parameter you can use to list one or more tags for this host (see below).</p></li></ol></div><h7 id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-OtherLinuxDistributions" class="bridgehead">Other Linux Distributions</h7><p>The Sysdig Agent is unsupported outside of the Debian, Fedora, and Amazon distributions.</p><h6 id="UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-AgentTags" class="bridgehead">Agent Tags</h6><p>Tagging your hosts is highly recommended. Agent Tags allow you to sort nodes of your infrastructure into custom groups in Sysdig Monitor.</p><p>Replace the [TAGS] parameter above with a comma-separated list of <span class="bold bold"><strong> <code class="code">TAG_NAME:TAG_VALUE</code> </strong></span>.</p><p>For example: <span class="bold bold"><strong> <code class="code">role:webserver,location:europe</code> </strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-InstallationOptions" title="Installation Options">Installation Options </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-DebianUbuntu" title="Debian, Ubuntu">Debian, Ubuntu</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-CentOSRHELFedoraAmazonAMIAmazonLinux2" title="CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2">CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-OtherLinuxDistributions" title="Other Linux Distributions">Other Linux Distributions</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983_id_AgentInstallManualLinuxInstallation-AgentTags" title="Agent Tags">Agent Tags</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-5595fb10-5c8e-1d38-1652-275b75d701cf" data-publication-date="" id="UUID-e5ec64a7-b0f9-921f-f908-0ed6c1680a47"><div class="titlepage"><div><div class="title"><h5 class="title">Agent Configuration</h5></div></div></div><p>Out of the box, the Sysdig agent will gather and report on a wide variety of pre-defined metrics. It can also accommodate any number of custom parameters for additional metrics collection.</p><p>Use this section when you need to change the default or pre-defined settings by <span class="bold bold"><strong>editing the agent configuration files</strong></span>, or for other special circumstances.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a>: Describes the core configuration files, how to access them, and how to add custom environment variables.</p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-aec19556-b6aa-7968-e550-15ffb871e570" title="Edit the Agent Config File to Filter Data">Edit the Agent Config File to Filter Data</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ae0e42cf-8e06-abca-16dc-07280e511ee0" title="Blacklist Ports">Blacklist Ports</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85" title="Enable/Disable Event Data">Enable/Disable Event Data</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-d843ff97-159f-fb72-c4d6-b66b6598585a" title="Include/Exclude Custom Metrics">Include/Exclude Custom Metrics</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73" title="Include/Exclude Designated Containers">Include/Exclude Designated Containers</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193" title="Optional: Change the Agent Log Level">Optional: Change the Agent Log Level</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa" title="Optional: Agent Auto-Config">Optional: Agent Auto-Config</a>: Describes how to use the Sysdig REST APIs and Python client wrappers to auto-orchestrate changes to all agents in an environment, in the (rare) situation in which a standard orchestration tool such as Kubernetes, Chef, or Ansible is not being used.</p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204931197/Integrations" target="_blank">Integrations</a> </strong></span>also require editing the agent config files.</p><p>By default, the Sysdig agent is configured to collect metric data from a range of platforms and applications. You can edit the agent config files to extend the default behavior, including additional metrics for <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204734661/Integrate+JMX+Metrics+from+Java+Virtual+Machines" target="_blank">JMX</a>, <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204832927/Integrate+StatsD+Metrics" target="_blank">StatsD</a>, <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204603650/Prometheus" target="_blank">Prometheus</a>, or a wide range of <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204767363/Integrate+Custom+Metrics+with+App+Check+Scripts" target="_blank">other applications</a>. You can also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/297238558/Monitor+Log+Files+and+Create+Metrics+using+LogWatcher+Chisel" target="_blank">monitor log files</a> for targeted text strings.</p></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-c32d8ed3-afb5-a861-50d5-a99ad85d5d4c" data-publication-date="" id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403"><div class="titlepage"><div><div class="title"><h6 class="title">Understanding the Agent Config Files</h6></div></div></div><p>Out of the box, the Sysdig agent will gather and report on a wide variety of pre-defined metrics. It can also accommodate any number of custom parameters for additional metrics collection.</p><p>The agent relies on a pair of configuration files to define metrics collection parameters:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><tbody><tr><td class="td"><p> <code class="code">dragent.default.yaml</code> </p></td><td class="td"><p>The core configuration file. You can look at it to understand more about the default configurations provided.</p><p>Location: "<code class="code">/opt/draios/etc/dragent.default.yaml</code>."</p><p> <span class="bold bold"><strong>CAUTION. This file should never be edited. </strong></span> </p></td></tr><tr><td class="td"><p> <code class="code">dragent.yaml</code> or <code class="code">configmap.yaml</code> (Kubernetes)</p></td><td class="td"><p>The configuration file where parameters can be added, either directly in YAML as <code class="code">name/value</code> pairs, or using environment variables such as '<code class="code">ADDTIIONAL_CONF." </code>Location: "<code class="code">/opt/draios/etc/dragent.yaml</code>."</p></td></tr></tbody></table></div><p>The "<code class="code">dragent.yaml</code>" file can be accessed and edited in several ways, depending on how the agent was installed. This document describes how to modify <code class="code">dragent.yaml.</code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>One additional file, <code class="code">dragent.auto.yaml</code> is also created and used in special circumstances. See <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa" title="Optional: Agent Auto-Config">Optional: Agent Auto-Config</a> for more detail.</p></div><h6 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-AccessandEdittheConfigFile" class="bridgehead">Access and Edit the Config File</h6><p>There are various ways to add or edit parameters in<code class="code">dragent.yaml</code>.</p><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Option1Withdragentyamlfortesting" class="bridgehead">Option 1: With dragent.yaml (for testing)</h7><p>It is possible to edit the container’s file directly on the host.</p><p>Add parameters directly in YAML.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Access</strong></span> <code class="code">dragent.yaml</code>directly at"<code class="code">/opt/draios/etc/dragent.yaml</code>."</p></li><li class="step"><p> <span class="bold bold"><strong>Edit</strong></span> the file. Use proper <a class="link" href="">YAML syntax</a>.</p><p>See the examples at the bottom of the page.</p></li><li class="step"><p> <span class="bold bold"><strong>Restart</strong></span> the agent for changes to take effect</p></li></ol></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Native agent: <code class="code">service dragent restart</code> </p></li><li class="listitem"><p>Container agent: <code class="code">docker restart sysdig-agent</code> </p></li></ul></div><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Option2WithconfigmapyamlKubernetes" class="bridgehead">Option 2: With configmap.yaml(Kubernetes)</h7><p>Configmap.yaml is the configuration file where parameters can be added, either directly in YAML as name/value pairs, or using environment variables such as 'ADDTIIONAL_CONF."</p><p>If you install agents as DaemonSets on a system running Kubernetes, you use <code class="code">configmap.yaml</code> to connect with and manipulate the underlying<code class="code">dragent.yaml</code>file.</p><p>See also: <a class="link" href="33836-17701-sysdig-agent.html#UUID-9037d45e-4884-5815-569e-eb7d94c45441" title="Agent Install: Kubernetes | GKE | OpenShift | IBM">Agent Install: Kubernetes | GKE | OpenShift | IBM</a> </p><p>Add parameters directly in YAML.</p><p>Edit the files locally and apply with the changes with<code class="code">kubectl -f.</code> </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access the<code class="code">configmap.yaml</code>.</p></li><li class="step"><p>Edit the file as needed.</p></li><li class="step"><p>Apply the changes:</p><p> <code class="code">kubectl apply -f sysdig-agent-configmap.yaml </code> </p></li></ol></div><p>Running agents will automatically pick the new configuration after Kubernetes pushes the changes across all the nodes in the cluster.</p><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Option3WithDockerRunDocker" class="bridgehead">Option 3: With Docker Run (Docker)</h7><p>Add<code class="code">-e ADDITIONAL_CONF=”&lt;VARIABLES&gt;”</code>to a Docker run command, where <code class="code">&lt;VARIABLES&gt;</code> contains all the customized parameters you want to include, in a single-line format.</p><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-ConvertYAMLParameterstoSingle-LineFormat" class="bridgehead">Convert YAML Parameters to Single-Line Format</h7><p>To insert <code class="code">ADDITIONAL_CONF</code> parameters in a Docker run command or a <code class="code">daemonset</code> file, you must convert the YAML code into a single-line format.</p><p>You can do the conversion manually for short snippets. To convert longer portions of YAML, use e<code class="code">cho|sed</code> commands.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In earlier versions, the Sysdig Agent connected to port 6666. This behavior has been deprecated, as the Sysdig agent now connects to port 6443.</p></div><p>The basic procedure:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Write your configuration in YAML, as it would be entered directly in <code class="code">dragent.yaml</code>.</p></li><li class="step"><p>In a bash shell, use <span class="bold bold"><strong> <code class="code">echo</code> </strong></span> and <span class="bold bold"><strong> <code class="code">sed</code> </strong></span>to convert to a single line.</p><p> <code class="code">sed</code> script: <span class="bold bold"><strong>" | sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/\\n/g'</strong></span> </p></li><li class="step"><p>Insert the resulting line into a Docker run command or add it to the <code class="code">daemonset</code> file as an <code class="code">ADDITIONAL_CONF</code>.</p></li></ol></div><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Examplesimple" class="bridgehead">Example: simple</h7><p>Insert parameters to turn off StatsD collection and blacklist port 6443.</p><p> <span class="bold bold"><strong>YAML format </strong></span> </p><p> <code class="code">statsd </code> <code class="code"> enabled: false </code> <code class="code">blackisted_ports: </code> <code class="code"> - 6443</code> </p><p> <span class="bold bold"><strong>Single-line format (manual) </strong></span> </p><p>Use spaces, hyphens, and <code class="code">\n </code>correctly when manually converting to a single line:</p><p> <code class="code">ADDITIONAL_CONF="statsd:\n disabled: false\nblacklisted_ports:\n - 6443"</code> </p><p>Here the single line is incorporated into a full agent startup Docker command.</p><pre class="programlisting">docker run --name sysdig-agent  --privileged --net host --pid host -e ACCESS_KEY=1234-your-key-here-1234 -e TAGS=dept:sales,local:NYC -e ADDITIONAL_CONF="statsd:\n  enabled: false\nblacklisted_ports:\n  - 6443" -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro sysdig/agent</pre><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Examplecomplex" class="bridgehead">Example: complex</h7><p>Insert parameters to override the default configuration for a RabbitMQ app check.</p><p> <span class="bold bold"><strong>YAML format </strong></span> </p><pre class="programlisting">app_checks:
  - name: rabbitmq
    pattern:
      port: 15672
    conf:
      rabbitmq_api_url: "http://localhost:15672/api/"
      rabbitmq_user: myuser
      rabbitmq_pass: mypassword
      queues:
        - MyQueue1
        - MyQueue2</pre><p> <span class="bold bold"><strong>Single-line format (echo |sed) </strong></span> </p><p>From a bash shell, issue the echo command and sed script.</p><pre class="programlisting">echo "app_checks:
  - name: rabbitmq
    pattern:
      port: 15672
    conf:
      rabbitmq_api_url: "http://localhost:15672/api/"
      rabbitmq_user: myuser
      rabbitmq_pass: mypassword
      queues:
        - MyQueue1
        - MyQueue2
" | sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/\\n/g'</pre><p>This results in the single-line format to be used with ADDITIONAL_CONF in a Docker command or daemonset file.</p><pre class="programlisting">"app_checks:\n - name: rabbitmq\n  pattern:\n    port: 15672\n  conf:\n    rabbitmq_api_url: http://localhost:15672/api/\n    rabbitmq_user: myuser\n    rabbitmq_pass: mypassword\n    queues:\n      - MyQueue1\n      - MyQueue2\n"</pre><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Option4WithHELMFormat" class="bridgehead">Option 4: With HELM Format</h7><p>If you installed the Sysdig agent in <a class="link" href="">Kubernetes using a Helm chart</a>, then no <code class="code">configmap.yaml</code> file was downloaded. You edit <code class="code">dragent.yaml</code> using Helm syntax:</p><h7 id="UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Example" class="bridgehead">Example</h7><pre class="programlisting">$helm install --name sysdig-agent-1 --set 
sysdig.settings.tags='linux:ubuntu,dept:dev,local:nyc' --set 
sysdig.settings.k8s_cluster_name='my_cluster' stable/sysdig</pre><p>Will be transformed into</p><pre class="programlisting">data:
 dragent.yaml: |
  tags: linux:ubuntu,dept:dev,local:nyc
  k8s_cluster_name: my_cluster</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-AccessandEdittheConfigFile" title="Access and Edit the Config File">Access and Edit the Config File</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Option 1: With dragent.yaml (for testing) </p></li><li class="listitem"><p> Option 2: With configmap.yaml (Kubernetes) </p></li><li class="listitem"><p> Option 3: With Docker Run (Docker) </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-ConvertYAMLParameterstoSingle-LineFormat" title="Convert YAML Parameters to Single-Line Format">Convert YAML Parameters to Single-Line Format</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Examplesimple" title="Example: simple">Example: simple</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Examplecomplex" title="Example: complex">Example: complex</a> </p></li></ul></div></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Option4WithHELMFormat" title="Option 4: With HELM Format">Option 4: With HELM Format </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403_id_UnderstandingtheAgentConfigFiles-Example" title="Example">Example</a> </p></li></ul></div></li></ul></div></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-828cd7ae-8e6e-45d3-9a08-b8f845a90c63" data-publication-date="" id="UUID-407e1e7e-0045-809a-88a6-5d1f00b77e29"><div class="titlepage"><div><div class="title"><h6 class="title">Table 1: Environment Variables for Agent Config File</h6></div></div></div><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Name</p></th><th class="th"><p>Value</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">ACCESS_KEY</code> </p></td><td class="td"><p> <code class="code">&lt;your Sysdig access key&gt;</code> </p></td><td class="td"><p>Required</p></td></tr><tr><td class="td"><p> <code class="code">TAGS</code> </p></td><td class="td"><p> <code class="code">&lt;meaningful tags you want applied to your instances&gt;</code> </p></td><td class="td"><p>Optional. These are displayed in Sysdig Monitor for ease of use.</p></td></tr><tr><td class="td"><p> <code class="code">COLLECTOR</code> </p></td><td class="td"><p> <code class="code">&lt;<a class="link" href="http://collector-staging.sysdigcloud.com" target="_blank">collector-hostname.com</a>&gt; or 111.222.333.400</code> </p></td><td class="td"><p>On-prem only. Enter the host name or IP address of the Sysdig collector service. Note that when used within <code class="code">dragent.yaml</code>, must be lowercase <code class="code">collector</code>.</p></td></tr><tr><td class="td"><p> <code class="code">COLLECTOR_PORT</code> </p></td><td class="td"><p> <code class="code">6443</code> </p></td><td class="td"><p>On-prem only. The port used by the Sysdig collector service; default 6443.</p></td></tr><tr><td class="td"><p> <code class="code">SECURE</code> </p></td><td class="td"><p> <code class="code">"true"</code> </p></td><td class="td"><p>On-prem only. If using SSL/TLS to connect to collector service value = "true" otherwise "false."</p></td></tr><tr><td class="td"><p> <code class="code">CHECK_CERTIFICATE</code> </p></td><td class="td"><p> <code class="code">"false"</code> </p></td><td class="td"><p>On-prem only. Set to "true" when using SSL/TLS to connect to the collector service and should check for valid SSL/TLS certificate.</p></td></tr><tr><td class="td"><p> <code class="code">ADDITIONAL_CONF</code> </p></td><td class="td"></td><td class="td"><p>Optional. A place to provide custom configuration values to the agent as environment variables .</p></td></tr><tr><td class="td"><p> <code class="code">SYSDIG_PROBE_URL</code> </p></td><td class="td"></td><td class="td"><p>Optional. An alternative URL to download precompiled kernel module.</p></td></tr></tbody></table></div><h8 id="UUID-407e1e7e-0045-809a-88a6-5d1f00b77e29_id_Table1EnvironmentVariablesforAgentConfigFile-SampleDockerCommandUsingVariables" class="bridgehead">Sample Docker Command Using Variables</h8><pre class="programlisting">docker run --name sysdig-agent --privileged --net host --pid host -e ACCESS_KEY=3e762f9a-3936-4c60-9cf4-c67e7ce5793b -e COLLECTOR=mycollector.elb.us-west-1.amazonaws.com -e COLLECTOR_PORT=6443 -e CHECK_CERTIFICATE=false -e TAGS=my_tag:some_value -e ADDITIONAL_CONF="log:\n file_priority: debug\n console_priority: error"
-v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro --shm-size=350m sysdig/agent</pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e914254f-b26f-d65b-6af6-7e4c10de82d7" data-publication-date="" id="UUID-aec19556-b6aa-7968-e550-15ffb871e570"><div class="titlepage"><div><div class="title"><h6 class="title">Edit the Agent Config File to Filter Data</h6></div></div></div><p>The <code class="code">dragent.yaml</code> file elements are wide-reaching. This section describes the parameters to edit in <code class="code">dragent.yaml</code> to perform a range of activities:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ae0e42cf-8e06-abca-16dc-07280e511ee0" title="Blacklist Ports">Blacklist Ports</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85" title="Enable/Disable Event Data">Enable/Disable Event Data</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-d843ff97-159f-fb72-c4d6-b66b6598585a" title="Include/Exclude Custom Metrics">Include/Exclude Custom Metrics</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73" title="Include/Exclude Designated Containers">Include/Exclude Designated Containers</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-c8452f58-b034-04e5-0235-97a75cd0c938" title="Disable Captures">Disable Captures</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8" title="**Prioritize/Include/Exclude Designated Containers**">**Prioritize/Include/Exclude Designated Containers**</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-0423dd2e-a4b0-7f60-debc-315020507b91" data-publication-date="" id="UUID-ae0e42cf-8e06-abca-16dc-07280e511ee0"><div class="titlepage"><div><div class="title"><h6 class="title">Blacklist Ports</h6></div></div></div><p>Use the <code class="code">blacklisted_ports</code> parameter in the the agent configuration file to block network traffic and metrics from unnecessary network ports.</p><p> <span class="bold bold"><strong>Note: </strong></span>Port 53 (DNS) is always blacklisted.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access the agent configuration file, using one of the <a class="link" href="">options listed</a>.</p></li><li class="step"><p>Add <code class="code">blacklisted_ports</code> with desired port numbers.</p><p> <span class="bold bold"><strong>Example (YAML):</strong></span> </p><p> <code class="code">blacklisted_ports:</code> </p><p> <code class="code"> - 6443</code> </p><p> <code class="code"> - 6379</code> </p></li><li class="step"><p>Restart the agent (if editing <code class="code">dragent.yaml</code> file directly), using either the <code class="code">service dragent restart</code> or <code class="code">docker restart sysdig-agent</code> command as appropriate.</p></li></ol></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-06e25d7d-d444-beeb-9f8b-6ce9124591a8" data-publication-date="" id="UUID-da043072-a101-77f7-1635-ee2005ffac85"><div class="titlepage"><div><div class="title"><h6 class="title">Enable/Disable Event Data</h6></div></div></div><p>Sysdig Monitor supports event integrations with certain applications by default. The Sysdig agent will automatically discover these services and begin collecting event data from them.</p><p>The following applications are currently supported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Docker</p></li><li class="listitem"><p>Kubernetes</p></li></ul></div><p>Other methods of ingesting custom events into Sysdig Monitor are touched upon in <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/222822463/Custom+Events" target="_blank">Custom Events</a>.</p><p>By default, only a limited set of events is collected for a supported application, and are listed in the agent's default settings configuration file (<code class="code">/opt/draios/etc/dragent.default.yaml</code>).</p><p>To enable collecting other supported events, add an <code class="code">events</code> entry to <code class="code">dragent.yaml</code>.</p><p>You can also change <code class="code">log</code> entry in <code class="code">dragent.yaml</code> to filter events by severity.</p><p>Learn more about it in the following sections.</p><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-SupportedApplicationEvents" class="bridgehead">Supported Application Events</h8><p>Events marked with <code class="code">*</code> are enabled by default; see the <code class="code">dragent.default.yaml</code> file.</p><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-DockerEvents" class="bridgehead">Docker Events</h8><p>The following Docker events are supported.</p><pre class="programlisting"><code class="code">  docker:
    container:
      - attach       # Container Attached      (information)
      - commit       # Container Committed     (information)
      - copy         # Container Copied        (information)
      - create       # Container Created       (information)
      - destroy      # Container Destroyed     (warning)
      - die          # Container Died          (warning)
      - exec_create  # Container Exec Created  (information)
      - exec_start   # Container Exec Started  (information)
      - export       # Container Exported      (information)
      - kill         # Container Killed        (warning)*
      - oom          # Container Out of Memory (warning)*
      - pause        # Container Paused        (information)
      - rename       # Container Renamed       (information)
      - resize       # Container Resized       (information)
      - restart      # Container Restarted     (warning)
      - start        # Container Started       (information)
      - stop         # Container Stopped       (information)
      - top          # Container Top           (information)
      - unpause      # Container Unpaused      (information)
      - update       # Container Updated       (information)
    image:
      - delete # Image Deleted  (information)
      - import # Image Imported (information)
      - pull   # Image Pulled   (information)
      - push   # Image Pushed   (information)
      - tag    # Image Tagged   (information)
      - untag  # Image Untaged  (information)
    volume:
      - create  # Volume Created    (information)
      - mount   # Volume Mounted    (information)
      - unmount # Volume Unmounted  (information)
      - destroy # Volume Destroyed  (information)
    network:
      - create     # Network Created       (information)
      - connect    # Network Connected     (information)
      - disconnect # Network Disconnected  (information)
      - destroy    # Network Destroyed     (information)</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-KubernetesEvents" class="bridgehead">Kubernetes Events</h8><p>The following Kubernetes events are supported.</p><pre class="programlisting"><code class="code">
  kubernetes:
    node:
      - TerminatedAllPods       # Terminated All Pods      (information)
      - RegisteredNode          # Node Registered          (information)*
      - RemovingNode            # Removing Node            (information)*
      - DeletingNode            # Deleting Node            (information)*
      - DeletingAllPods         # Deleting All Pods        (information)
      - TerminatingEvictedPod   # Terminating Evicted Pod  (information)*
      - NodeReady               # Node Ready               (information)*
      - NodeNotReady            # Node not Ready           (information)*
      - NodeSchedulable         # Node is Schedulable      (information)*
      - NodeNotSchedulable      # Node is not Schedulable  (information)*
      - CIDRNotAvailable        # CIDR not Available       (information)*
      - CIDRAssignmentFailed    # CIDR Assignment Failed   (information)*
      - Starting                # Starting Kubelet         (information)*
      - KubeletSetupFailed      # Kubelet Setup Failed     (warning)*
      - FailedMount             # Volume Mount Failed      (warning)*
      - NodeSelectorMismatching # Node Selector Mismatch   (warning)*
      - InsufficientFreeCPU     # Insufficient Free CPU    (warning)*
      - InsufficientFreeMemory  # Insufficient Free Mem    (warning)*
      - OutOfDisk               # Out of Disk              (information)*
      - HostNetworkNotSupported # Host Ntw not Supported   (warning)*
      - NilShaper               # Undefined Shaper         (warning)*
      - Rebooted                # Node Rebooted            (warning)*
      - NodeHasSufficientDisk   # Node Has Sufficient Disk (information)*
      - NodeOutOfDisk           # Node Out of Disk Space   (information)*
      - InvalidDiskCapacity     # Invalid Disk Capacity    (warning)*
      - FreeDiskSpaceFailed     # Free Disk Space Failed   (warning)*
    pod:
      - Pulling           # Pulling Container Image          (information)
      - Pulled            # Ctr Img Pulled                   (information)
      - Failed            # Ctr Img Pull/Create/Start Fail   (warning)*
      - InspectFailed     # Ctr Img Inspect Failed           (warning)*
      - ErrImageNeverPull # Ctr Img NeverPull Policy Violate (warning)*
      - BackOff           # Back Off Ctr Start, Image Pull   (warning)
      - Created           # Container Created                (information)
      - Started           # Container Started                (information)
      - Killing           # Killing Container                (information)*
      - Unhealthy         # Container Unhealthy              (warning)
      - FailedSync        # Pod Sync Failed                  (warning)
      - FailedValidation  # Failed Pod Config Validation     (warning)
      - OutOfDisk         # Out of Disk                      (information)*
      - HostPortConflict  # Host/Port Conflict               (warning)*
    replicationController:
      - SuccessfulCreate    # Pod Created        (information)*
      - FailedCreate        # Pod Create Failed  (warning)*
      - SuccessfulDelete    # Pod Deleted        (information)*
      - FailedDelete        # Pod Delete Failed  (warning)*
</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-EnableDisableEventsCollectionwitheventsParameter" class="bridgehead">Enable/Disable Events Collection with events Parameter</h8><p>To customize the default events collected for a specific application (by either enabling or disabling events), add an <code class="code">events</code> entry to <code class="code">dragent.yaml</code> as described in the examples below.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>An entry in a section in <code class="code">dragent.yaml</code> overrides <span class="bold bold"><strong>the entire section</strong></span> in the default configuration.</p><p>For example, the <code class="code">Pulling</code> entry below will permit only kubernetes pod <code class="code">Pulling</code> events to be collected and all other kubernetes pod events settings in <code class="code">dragent.default.yaml</code> will be ignored.</p><p>However, other kubernetes sections - <code class="code">node</code> and <code class="code">replicationController</code>- remain intact and will be used as specified in <code class="code">dragent.default.yaml.</code> </p></div><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example1CollectOnlyCertainEvents" class="bridgehead">Example 1: Collect Only Certain Events</h8><p>Collect only 'Pulling' events from Kubernetes for pods:</p><pre class="programlisting"><code class="code">events:
  kubernetes:
    pod:
      - Pulling</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example2DisableAllEventsinaSection" class="bridgehead">Example 2: Disable All Events in a Section</h8><p>To disable all events in a section, set the event section to <code class="code">none</code>:</p><pre class="programlisting"><code class="code">events:
  kubernetes: none
  docker: none</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example3CombineMethods" class="bridgehead">Example 3: Combine Methods</h8><p>These methods can be combined. For example, disable all kubernetes node and docker image events and limit docker container events to <code class="code">[attach, commit, copy]</code> (components events in other sections will be collected as specified by default):</p><pre class="programlisting"><code class="code">events:
  kubernetes:
    node: none
  docker:
    image: none
    container:
      - attach
      - commit
      - copy</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-NoteFormatSequencesasListorSingleLine" class="bridgehead">Note: Format Sequences as List or Single Line</h8><p>In addition to bulleted lists, sequences can also be specified in a bracketed single line, eg.:</p><pre class="programlisting"><code class="code">events:
  kubernetes:
    pod: [Pulling, Pulled, Failed]
</code></pre><p>So, the following two settings are equivalent, permitting only <code class="code">Pulling, Pulled, Failed</code> events for pods to be emitted:</p><pre class="programlisting"><code class="code">events:
  kubernetes:
    pod: [Pulling, Pulled, Failed]
</code></pre><pre class="programlisting"><code class="code">
events:
  kubernetes:
    pod:
      - Pulling
      - Pulled
      - Failed</code></pre><pre class="programlisting"></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-ChangeEventCollectionbySeveritywithlogParameter" class="bridgehead">Change Event Collection by Severity with log Parameter</h8><p>Events are limited globally at the agent level based on severity, using the <code class="code">log </code>settings in <code class="code">dragent.yaml</code>.</p><p>The default setting for the events severity filter is <span class="bold bold"><strong> <code class="code">information</code> </strong></span> (only warning and higher severity events are transmitted).</p><p>Valid severity levels are: <code class="code">none, emergency, alert, critical, error, warning, notice, information, debug</code>.</p><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example1BlockLow-SeverityMessages" class="bridgehead">Example 1: Block Low-Severity Messages</h8><p>Block all low-severity messages (<code class="code">notice, information, debug</code>):</p><pre class="programlisting"><code class="code">log:
  event_priority: warning</code></pre><h8 id="UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example2BlockAllEventCollection" class="bridgehead">Example 2: Block All Event Collection</h8><p>Block all event collection:</p><pre class="programlisting"><code class="code">log:
  event_priority: none</code></pre><p>For other uses of the <code class="code">log</code> settings see <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193" title="Optional: Change the Agent Log Level">Optional: Change the Agent Log Level</a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-SupportedApplicationEvents" title="Supported Application Events">Supported Application Events</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-DockerEvents" title="Docker Events">Docker Events </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-KubernetesEvents" title="Kubernetes Events">Kubernetes Events </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-EnableDisableEventsCollectionwitheventsParameter" title="Enable/Disable Events Collection with events Parameter">Enable/Disable Events Collection with events Parameter</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example1CollectOnlyCertainEvents" title="Example 1: Collect Only Certain Events">Example 1: Collect Only Certain Events </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example2DisableAllEventsinaSection" title="Example 2: Disable All Events in a Section">Example 2: Disable All Events in a Section</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example3CombineMethods" title="Example 3: Combine Methods">Example 3: Combine Methods </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-NoteFormatSequencesasListorSingleLine" title="Note: Format Sequences as List or Single Line">Note: Format Sequences as List or Single Line</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-ChangeEventCollectionbySeveritywithlogParameter" title="Change Event Collection by Severity with log Parameter">Change Event Collection by Severity with log Parameter</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example1BlockLow-SeverityMessages" title="Example 1: Block Low-Severity Messages">Example 1: Block Low-Severity Messages </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-da043072-a101-77f7-1635-ee2005ffac85_id_EnableDisableEventData-Example2BlockAllEventCollection" title="Example 2: Block All Event Collection">Example 2: Block All Event Collection </a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-6d68378d-ec0b-bb98-5e64-083b22a0c6cd" data-publication-date="" id="UUID-d843ff97-159f-fb72-c4d6-b66b6598585a"><div class="titlepage"><div><div class="title"><h6 class="title">Include/Exclude Custom Metrics</h6></div></div></div><p>For more information, see <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204767363" target="_blank">Integrate Applications (Default App Checks)</a>.</p><p>It is possible to filter custom metrics in the following ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Ability to include/exclude custom metrics using configurable patterns,</p></li><li class="listitem"><p>Ability to log which custom metrics are exceeding limits</p></li></ul></div><p>After you identify those key custom metrics that must be received, use the new 'include' and 'exclude' filtering parameters to make sure you receive them before the metrics limit is hit.</p><h8 id="UUID-d843ff97-159f-fb72-c4d6-b66b6598585a_id_IncludeExcludeCustomMetrics-FilterMetricsExample" class="bridgehead">Filter Metrics Example</h8><p>Here is an example configuration entry that would be put into the agent config file: (/opt/draios/etc/dragent.yaml)</p><pre class="programlisting">metrics_filter:
  - include: test.*
  - exclude: test.*
  - include: haproxy.backend.*
  - exclude: haproxy.*
  - exclude: redis.*</pre><p>Given the config entry above, this is the action for these metrics:</p><p>test.* → send</p><p>haproxy.backend.request → send</p><p>haproxy.frontend.bytes → drop</p><p>redis.keys → drop</p><p>The semantic is: whenever the agent is reading metrics, they are filtered according to configured filters and the filtering rule order - the first rule that matches will be applied. Thus since the inclusion item for test.* was listed first it will be followed and that second 'exclude' rule for the same exact metric entry will be ignored.</p><h8 id="UUID-d843ff97-159f-fb72-c4d6-b66b6598585a_id_IncludeExcludeCustomMetrics-LoggingAcceptedDroppedMetrics" class="bridgehead">Logging Accepted/Dropped Metrics</h8><p>Logging is disabled by default. You can enable logging to see which metrics are accepted or dropped by adding the following configuration entry into the dragent.yaml config file:</p><pre class="programlisting"><code class="code">metrics_excess_log: true</code></pre><p>When logging of excess metrics is enabled, logging occurs at INFO-level, every 30 seconds and lasts for 10 seconds. The entries that can be seen in <code class="code">/opt/draios/logs/draios.log</code> will be formatted like this:</p><pre class="programlisting"><code class="code">+/-[type] [metric included/excluded]: metric.name (filter: +/-[metric.filter])</code></pre><p>The first '+' or '-', followed by 'type' provides an easy way to quickly scan the list of metrics and spot which are included or excluded ('+' means "included", '-' means "excluded").</p><p>The second entry specifies metric type ("statsd", "app_check", "service_check", or "jmx").</p><p>A third entry spells out whether "included" or "excluded", followed by the metric name. Finally, inside the last entry (in parentheses), there is information about filter applied and its effect ('+' or '-', meaning "include" or "exclude").</p><p>With this example filter rule set:</p><pre class="programlisting"><code class="code">metrics_filter:
  - include: mongo.statsd.net*
  - exclude: mongo.statsd.*</code></pre><p>We might see the following INFO-level log entries (timestamps stripped):</p><pre class="programlisting"><code class="code">-[statsd] metric excluded: mongo.statsd.vsize (filter: -[mongo.statsd.*])
+[statsd] metric included: mongo.statsd.netIn (filter: +[mongo.statsd.net*])</code></pre></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-b805e6e4-e342-04d4-7d45-f6d4760ad5bb" data-publication-date="" id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73"><div class="titlepage"><div><div class="title"><h6 class="title">Include/Exclude Designated Containers</h6></div></div></div><p>By default, a Sysdig agent will collect metrics from all containers it detects in an environment. However, as of <a class="link" href="">agent version 0.86</a>, it is possible to exclude designated containers from metrics collection. This can help reduce agent and backend load by not monitoring unnecessary containers, or-- if encountering backend limits for containers-- you can filter to ensure that the important containers are always reported on.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This feature affects the monitoring of all the processes/metrics within a container, including Prometheus, StatsD, JMX, app-checks, and built-in metrics.</p></div><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Overview" class="bridgehead">Overview</h8><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If necessary, review <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a>.</p></div><p>The examples on this page show how to enable/disable container filtering in the <code class="code">dragent.yaml</code> file. Convert the examples to Docker or Helm commands, if applicable for your situation.</p><p>By default, the filtering feature is turned off. It can be enabled by adding the following line to the agent configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">use_container_filter: true</code> </p></li></ul></div><p>When enabled, the agent will follow include/exclude filtering rules based on:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>container image</p></li><li class="listitem"><p>container name</p></li><li class="listitem"><p>container label</p></li><li class="listitem"><p>Kubernetes annotation or label</p></li></ul></div><p>The default behavior in <code class="code">default.dragent.yaml</code> excludes based on a <span class="bold bold"><strong>container label</strong></span> (<code class="code">com.sysdig.report</code>) and/or a <span class="bold bold"><strong>Kubernetes pod annotation</strong></span> (<code class="code">.<a class="link" href="http://sysdig.com/report" target="_blank">sysdig.com/report</a> </code>).</p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-ContainerConditionParametersandRules" class="bridgehead">Container Condition Parameters and Rules</h8><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Parameters" class="bridgehead">Parameters</h8><p>The condition parameters are described in the following table:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Pattern name</p></th><th class="th"><p>Description</p></th><th class="th"><p>Example</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">container.image</code> </p></td><td class="td"><p>Matches if the process is running inside a container running the specified image</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.image: luca3m/prometheus-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code">container.name</code> </p></td><td class="td"><p>Matches if the process is running inside a container with the specified name</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.name: my-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code">container.label.*</code> </p></td><td class="td"><p>Matches if the process is running in a container that has a Label matching the given value</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.label.class: exporter</code> </p></td></tr><tr><td class="td"><p> <code class="code">kubernetes.&lt;object&gt;.annotation.* kubernetes.&lt;object&gt;.label.*</code> </p></td><td class="td"><p>Matches if the process is attached to a Kubernetes object (Pod, Namespace, etc.) that is marked with the Annotation/Label matching the given value.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> kubernetes.pod.annotation.prometheus.io/scrape: true</code> </p></td></tr><tr><td class="td"><p>all</p></td><td class="td"><p>Matches all. Use as last rule to determine default behavior.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> all</code> </p></td></tr></tbody></table></div><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Rules" class="bridgehead">Rules</h8><p>Once enabled (when <code class="code">use_container_filter: true</code> is set), the agent will follow filtering rules from the <code class="code">container_filter</code> section.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Each rule is an <code class="code">include</code> or <code class="code">exclude</code> rule which can contain one or more conditions.</p></li><li class="listitem"><p>The first matching rule in the list will determine if the container is included or excluded.</p></li><li class="listitem"><p>The conditions consist of a key name and a value. If the given key for a container matches the value, the rule will be matched.</p></li><li class="listitem"><p>If a rule contains multiple conditions they all need to match for the rule to be considered a match.</p></li></ul></div><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Default" class="bridgehead">Default</h8><p>The dragent.default.yaml contains the following default configuration for container filters:</p><pre class="programlisting">use_container_filter: false

container_filter:
  - include:
      container.label.com.sysdig.report: true
  - exclude:
      container.label.com.sysdig.report: false
  - include:
      kubernetes.pod.annotation.sysdig.com/report: true
  - exclude:
      kubernetes.pod.annotation.sysdig.com/report: false
  - include:
        all</pre><p>Note that it excludes via a <code class="code">container.label</code> and by a <code class="code">kubernetes.pod.annotation. </code> </p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EnableContainerFilteringintheAgentConfigFile" class="bridgehead">Enable Container Filtering in the Agent Config File</h8><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Option1UsetheDefault" class="bridgehead">Option 1: Use the Default</h8><p>To enable container filtering using the default configuration in <code class="code">default.dragent.yaml</code> (above), follow the steps below.</p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-ApplyLabelsandorAnnotationstoDesignatedContainers" class="bridgehead">Apply Labels and/or Annotations to Designated Containers</h8><p>To set up, decide which containers should be excluded from automatic monitoring.</p><p>Apply the container label <code class="code">.com.sysdig.report</code> and/or the Kubernetes pod annotation <code class="code">sysdig.com/report</code> to the designated containers.</p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EdittheAgentConfiguration" class="bridgehead">Edit the Agent Configuration</h8><p>Add the following line to <code class="code">dragent.yaml</code> to turn on the default functionality:</p><pre class="programlisting">use_container_filter: true</pre><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Option2DefineYourOwnRules" class="bridgehead">Option 2: Define Your Own Rules</h8><p>You can also edit <code class="code">dragent.yaml</code> to apply your own container filtering rules.</p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-DesignateContainers" class="bridgehead">Designate Containers</h8><p>To set up, decide which containers should be excluded from automatic monitoring.</p><p>Note the image, name, label, or Kubernetes pod information as appropriate, and build your rule set accordingly.</p><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EdittheAgentConfiguration1" class="bridgehead">Edit the Agent Configuration</h8><p>For example:</p><pre class="programlisting">use_container_filter: true

container_filter:
  - include:
      container.name: my-app
  - include:
      container.label.com.sysdig.report: true
  - exclude:
      kubernetes.namespace.name: kube-system
      container.image: "gcr.io*"
  - include:
      all</pre><p>The above example shows a <code class="code">container_filter</code> with 3 include rules and 1 exclude rule.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the container name is "<code class="code">my-app</code>" it will be included.</p></li><li class="listitem"><p>Likewise if the container has a label with the key "<code class="code">com.sysdig.report</code>" and with the value "<code class="code">true</code>".</p></li><li class="listitem"><p>If neither of those rules are true, and the container is part of a Kubernetes hierarchy within the "<code class="code">kube-system</code>" namespace, and the container image starts with "<code class="code">gcr.io</code>" it will be excluded.</p></li><li class="listitem"><p>The last rule includes all, so any containers not matching an earlier rule will be monitored and metrics for them will be sent to the backend.</p></li></ul></div><h8 id="UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Logging" class="bridgehead">Logging</h8><p>When the log level is set to DEBUG, the following messages may be found in the logs:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>message</p></th><th class="th"><p>meaning</p></th></tr></thead><tbody><tr><td class="td"><p>container &lt;id&gt;, no filter configured</p></td><td class="td"><p>container filtering is not enabled</p></td></tr><tr><td class="td"><p>container &lt;id&gt;, include in report</p></td><td class="td"><p>container is included</p></td></tr><tr><td class="td"><p>container &lt;id&gt;, exclude in report</p></td><td class="td"><p>container is excluded</p></td></tr><tr><td class="td"><p>Not reporting thread &lt;thread-id&gt; in container &lt;id&gt;</p></td><td class="td"><p>Process thread is excluded</p></td></tr></tbody></table></div><p>See also: <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193" title="Optional: Change the Agent Log Level">Optional: Change the Agent Log Level</a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Overview" title="Overview">Overview </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-ContainerConditionParametersandRules" title="Container Condition Parameters and Rules">Container Condition Parameters and Rules</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Parameters" title="Parameters">Parameters</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Rules" title="Rules">Rules</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Default" title="Default">Default </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EnableContainerFilteringintheAgentConfigFile" title="Enable Container Filtering in the Agent Config File">Enable Container Filtering in the Agent Config File</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Option1UsetheDefault" title="Option 1: Use the Default">Option 1: Use the Default </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-ApplyLabelsandorAnnotationstoDesignatedContainers" title="Apply Labels and/or Annotations to Designated Containers">Apply Labels and/or Annotations to Designated Containers</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EdittheAgentConfiguration" title="Edit the Agent Configuration">Edit the Agent Configuration </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Option2DefineYourOwnRules" title="Option 2: Define Your Own Rules">Option 2: Define Your Own Rules</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-DesignateContainers" title="Designate Containers">Designate Containers </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-EdittheAgentConfiguration1" title="Edit the Agent Configuration">Edit the Agent Configuration</a> </p></li></ul></div></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ff717c5c-94a6-161c-0265-d59b7a9b9b73_id_IncludeExcludeDesignatedContainers-Logging" title="Logging">Logging</a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-15cc6580-5eb9-841e-ddd8-2fa08bd2de2b" data-publication-date="" id="UUID-c8452f58-b034-04e5-0235-97a75cd0c938"><div class="titlepage"><div><div class="title"><h6 class="title">Disable Captures</h6></div></div></div><p>Sometimes, security requirements dictate that capture functionality should NOT be triggered at all (for example, PCI compliance for payment information).</p><p>To disable Captures altogether:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Access using one of the <a class="link" href="">options listed</a>.</p><p>This example accesses <code class="code">dragent.yaml </code>directly. <code class="code"></code> </p></li><li class="step"><p>Set the parameter:</p><pre class="programlisting">sysdig_capture_enabled: false </pre></li><li class="step"><p>Restart the agent, using the command: <code class="code"></code> </p><pre class="programlisting">service dragent restart</pre></li></ol></div><p>See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/205684760/Captures" target="_blank">Captures</a> for more information on the feature</p></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e11084ae-2149-1efa-4fa8-5775dfeb06db" data-publication-date="" id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8"><div class="titlepage"><div><div class="title"><h6 class="title">**Prioritize/Include/Exclude Designated Containers**</h6></div></div></div><p>To get the most out of Sysdig Monitor, you may want to customize the way in which container data is prioritized and reported. Use this page to understand the default behavior and sorting rules, and to implement custom behavior when and where you need it. This can help reduce agent and backend load by not monitoring unnecessary containers, or-- if encountering backend limits for containers-- you can filter to ensure that the important containers are always reported.</p><p>This section describes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Overview" title="Overview">Overview </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandDefaultBehavior" title="Understand Default Behavior">Understand Default Behavior</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSimpleContainerFiltering" title="Understand Simple Container Filtering">Understand Simple Container Filtering</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSmartContainerReporting" title="Understand Smart Container Reporting">Understand Smart Container Reporting</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSysdigAggregatedContainer" title="Understand Sysdig Aggregated Container">Understand Sysdig Aggregated Container</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UseSimpleContainerFiltering" title="Use Simple Container Filtering">Use Simple Container Filtering </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-ContainerConditionParametersandRules" title="Container Condition Parameters and Rules">Container Condition Parameters and Rules</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Parameters" title="Parameters">Parameters</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Rules" title="Rules">Rules</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-DefaultConfiguraton" title="Default Configuraton">Default Configuraton</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-EnableContainerFilteringintheAgentConfigFile" title="Enable Container Filtering in the Agent Config File">Enable Container Filtering in the Agent Config File</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Option1UsetheDefaultConfiguration" title="Option 1: Use the Default Configuration">Option 1: Use the Default Configuration</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-1ApplyLabelsandorAnnotationstoDesignatedContainers" title="1. Apply Labels and/or Annotations to Designated Containers">1. Apply Labels and/or Annotations to Designated Containers</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-2EdittheAgentConfiguration" title="2. Edit the Agent Configuration">2. Edit the Agent Configuration </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Option2DefineYourOwnRules" title="Option 2: Define Your Own Rules">Option 2: Define Your Own Rules</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-1DesignateContainers" title="1. Designate Containers">1. Designate Containers </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-2EdittheAgentConfiguration1" title="2. Edit the Agent Configuration">2. Edit the Agent Configuration</a> </p></li></ul></div></li></ul></div></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UseSmartContainerReporting" title="Use Smart Container Reporting">Use Smart Container Reporting </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-EnableSmartContainerReportingandsysdig_aggregated" title="Enable Smart Container Reporting and sysdig_aggregated">Enable Smart Container Reporting and sysdig_aggregated</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Logging" title="Logging">Logging</a> </p></li></ul></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Overview" class="bridgehead">Overview</h8><p>By default, a Sysdig agent will collect metrics from all containers it detects in an environment. When reporting to the Monitor interface, it uses default sorting behavior to prioritize what container information to display first.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandDefaultBehavior" class="bridgehead">Understand Default Behavior</h8><p>Out of the box, it chooses the containers with the highest</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>CPU</p></li><li class="listitem"><p>Memory</p></li><li class="listitem"><p>File IO</p></li><li class="listitem"><p>Net IO</p></li></ul></div><p>and allocates approximately 1/4 of the total limit to each stat type.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSimpleContainerFiltering" class="bridgehead">Understand Simple Container Filtering</h8><p>As of <a class="link" href="">agent version 0.86</a>, it is possible set a <span class="bold bold"><strong> <code class="code">use_container_filter</code> </strong></span> parameter in the agent <code class="code">config</code> file, tag/label specific containers, and set i<code class="code">nclude/exclude</code> rules to push those containers to the top of the reporting hierarchy.</p><p>This is an effective sorting tool when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>You can manually mark each container with an <code class="code">include</code> or <code class="code">exclude</code> tag, AND</p></li><li class="listitem"><p>The number of includes is small (say, less than 100)</p></li></ul></div><p>In this case, the containers that explicitly match the <code class="code">include</code> rules will take top priority.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSmartContainerReporting" class="bridgehead">Understand Smart Container Reporting</h8><p>In some enterprises, the number of containers is too high to tag with simple filtering rules, and/or the <code class="code">include_all</code> group is too large to ensure that the most-desired containers are consistently reported. As of &lt;agent version ??&gt;, you can append another parameter to the agent config file, <code class="code">smart_container_reporting</code>.</p><p>This is an effective sorting tool when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The number of containers is large and you can't or won't mark each one with include/exclude tags, AND</p></li><li class="listitem"><p>There are certain containers you would like to always prioritize</p></li></ul></div><p>This helps ensure that even when there are thousands of containers in an environment, the most-desired containers are consistently reported.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Container filtering and smart container reporting affect the monitoring of all the processes/metrics within a container, including StatsD, JMX, app-checks, and built-in metrics.</p><p>Prometheus metrics are attached to processes, rather than containers, and are therefore handled differently.</p><p>The container limit is set in dragent.yaml under <code class="code">containers:limit: </code> </p></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UnderstandSysdigAggregatedContainer" class="bridgehead">Understand Sysdig Aggregated Container</h8><p>The <code class="code">sydig_aggregated</code> parameter is automatically activated when smart container reporting is enabled, to capture the most-desired metrics from the containers that were excluded by smart filtering and report them under a single entity. It appears like any other container in the Sysdig Monitor UI, with the name "<code class="code">sysdig_aggregated.</code>"</p><p> <code class="code">Sysdig_aggregated</code> can report on a wide array of metrics; see <a class="link" href="33836-17701-sysdig-agent.html#UUID-0f4c4fbe-3a8d-ea5c-f496-47996c2e3a77" title="**Sysdig_aggregated Container Metrics**">**Sysdig_aggregated Container Metrics**</a>. However, because this is not a regular container, certain limitations apply:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>container_id and container_image do not exist.</p></li><li class="listitem"><p>The aggregated container cannot be segmented by certain metrics that are excluded, such as process.</p></li><li class="listitem"><p>Some default dashboards associated with the aggregated container may have some empty graphs.</p></li></ul></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UseSimpleContainerFiltering" class="bridgehead">Use Simple Container Filtering</h8><p>By default, the filtering feature is turned off. It can be enabled by adding the following line to the agent configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">use_container_filter: true</code> </p></li></ul></div><p>When enabled, the agent will follow include/exclude filtering rules based on:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>container image</p></li><li class="listitem"><p>container name</p></li><li class="listitem"><p>container label</p></li><li class="listitem"><p>Kubernetes annotation or label</p></li></ul></div><p>The default behavior in <code class="code">default.dragent.yaml</code> excludes based on a <span class="bold bold"><strong>container label</strong></span> (<code class="code">com.sysdig.report</code>) and/or a <span class="bold bold"><strong>Kubernetes pod annotation</strong></span> (<code class="code">.<a class="link" href="http://sysdig.com/report" target="_blank">sysdig.com/report</a> </code>).</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-ContainerConditionParametersandRules" class="bridgehead">Container Condition Parameters and Rules</h8><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Parameters" class="bridgehead">Parameters</h8><p>The condition parameters are described in the following table:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Pattern name</p></th><th class="th"><p>Description</p></th><th class="th"><p>Example</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">container.image</code> </p></td><td class="td"><p>Matches if the process is running inside a container running the specified image</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.image: luca3m/prometheus-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code">container.name</code> </p></td><td class="td"><p>Matches if the process is running inside a container with the specified name</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.name: my-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code">container.label.*</code> </p></td><td class="td"><p>Matches if the process is running in a container that has a Label matching the given value</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.label.class: exporter</code> </p></td></tr><tr><td class="td"><p> <code class="code">kubernetes.&lt;object&gt;.annotation.* kubernetes.&lt;object&gt;.label.*</code> </p></td><td class="td"><p>Matches if the process is attached to a Kubernetes object (Pod, Namespace, etc.) that is marked with the Annotation/Label matching the given value.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> kubernetes.pod.annotation.prometheus.io/scrape: true</code> </p></td></tr><tr><td class="td"><p>all</p></td><td class="td"><p>Matches all. Use as last rule to determine default behavior.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> all</code> </p></td></tr></tbody></table></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Rules" class="bridgehead">Rules</h8><p>Once enabled (when <code class="code">use_container_filter: true</code> is set), the agent will follow filtering rules from the <code class="code">container_filter</code> section.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Each rule is an <code class="code">include</code> or <code class="code">exclude</code> rule which can contain one or more conditions.</p></li><li class="listitem"><p>The first matching rule in the list will determine if the container is included or excluded.</p></li><li class="listitem"><p>The conditions consist of a key name and a value. If the given key for a container matches the value, the rule will be matched.</p></li><li class="listitem"><p>If a rule contains multiple conditions they all need to match for the rule to be considered a match.</p></li></ul></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-DefaultConfiguraton" class="bridgehead">Default Configuraton</h8><p>The <code class="code">dragent.default.yaml</code> contains the following default configuration for container filters:</p><pre class="programlisting">use_container_filter: false

container_filter:
  - include:
      container.label.com.sysdig.report: true
  - exclude:
      container.label.com.sysdig.report: false
  - include:
      kubernetes.pod.annotation.sysdig.com/report: true
  - exclude:
      kubernetes.pod.annotation.sysdig.com/report: false
  - include:
        all</pre><p>Note that it excludes via a <code class="code">container.label</code> and by a <code class="code">kubernetes.pod.annotation. </code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The examples on this page show how to edit in the <code class="code">dragent.yaml</code> file directly. Convert the examples to Docker or Helm commands, if applicable for your situation.</p></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-EnableContainerFilteringintheAgentConfigFile" class="bridgehead">Enable Container Filtering in the Agent Config File</h8><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Option1UsetheDefaultConfiguration" class="bridgehead">Option 1: Use the Default Configuration</h8><p>To enable container filtering using the default configuration in <code class="code">default.dragent.yaml</code> (above), follow the steps below.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-1ApplyLabelsandorAnnotationstoDesignatedContainers" class="bridgehead">1. Apply Labels and/or Annotations to Designated Containers</h8><p>To set up, decide which containers should be excluded from automatic monitoring.</p><p>Apply the container label <span class="bold bold"><strong> <code class="code">.com.sysdig.report</code> </strong></span> and/or the Kubernetes pod annotation <span class="bold bold"><strong> <code class="code">sysdig.com/report</code> </strong></span> to the designated containers.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-2EdittheAgentConfiguration" class="bridgehead">2. Edit the Agent Configuration</h8><p>Add the following line to <code class="code">dragent.yaml</code> to turn on the default functionality:</p><pre class="programlisting">use_container_filter: true</pre><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Option2DefineYourOwnRules" class="bridgehead">Option 2: Define Your Own Rules</h8><p>You can also edit <code class="code">dragent.yaml</code> to apply your own container filtering rules.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-1DesignateContainers" class="bridgehead">1. Designate Containers</h8><p>To set up, decide which containers should be excluded from automatic monitoring.</p><p>Note the image, name, label, or Kubernetes pod information as appropriate, and build your rule set accordingly.</p><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-2EdittheAgentConfiguration1" class="bridgehead">2. Edit the Agent Configuration</h8><p>For example:</p><pre class="programlisting">use_container_filter: true

container_filter:
  - include:
      container.name: my-app
  - include:
      container.label.com.sysdig.report: true
  - exclude:
      kubernetes.namespace.name: kube-system
      container.image: "gcr.io*"
  - include:
      all</pre><p>The above example shows a <code class="code">container_filter</code> with 3 include rules and 1 exclude rule.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the container name is "<code class="code">my-app</code>" it will be included.</p></li><li class="listitem"><p>Likewise, if the container has a label with the key "<code class="code">com.sysdig.report</code>" and with the value "<code class="code">true</code>".</p></li><li class="listitem"><p>If neither of those rules is true, and the container is part of a Kubernetes hierarchy within the "<code class="code">kube-system</code>" namespace and the container image starts with "<code class="code">gcr.io</code>", it will be excluded.</p></li><li class="listitem"><p>The last rule includes all, so any containers not matching an earlier rule will be monitored and metrics for them will be sent to the backend.</p></li></ul></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-UseSmartContainerReporting" class="bridgehead">Use Smart Container Reporting</h8><p>As of &lt;agent version ??&gt; you can add another parameter to the config file: <code class="code">smart_container_reporting = true</code> </p><p>This enables several new prioritization checks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>container_filter (you would enable and set include/exclude rules, as described above)</p></li><li class="listitem"><p>container age</p></li><li class="listitem"><p>high stats</p></li><li class="listitem"><p>legacy patterns</p></li></ul></div><p>The sort is modified with the following rules in priority order:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>User-specified containers come before others</p></li><li class="step"><p>Containers reported previously should be reported before those which have never been reported</p></li><li class="step"><p>Containers with higher usage by each of the 4 default stats should come before those with lower usage</p></li></ol></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-EnableSmartContainerReportingandsysdig_aggregated" class="bridgehead">Enable Smart Container Reporting and sysdig_aggregated</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Set up any simple container filtering rules you need, following either <a class="link" href="">Option 1</a> or <a class="link" href="">Option 2</a>, above.</p></li><li class="step"><p>Edit the agent configuration:</p><pre class="programlisting">smart_container_reporting: true</pre></li><li class="step"><p>This turns on both <code class="code">smart_container_reporting</code> and <code class="code">sysdig_aggregated</code>. The changes will be visible in the Sysdig Monitor UI.</p><p>See also <a class="link" href="33836-17701-sysdig-agent.html#UUID-0f4c4fbe-3a8d-ea5c-f496-47996c2e3a77" title="**Sysdig_aggregated Container Metrics**">**Sysdig_aggregated Container Metrics**</a>..</p></li></ol></div><h8 id="UUID-ee904ec5-8cdd-c5c1-9e68-72a6729943f8_id_id-PrioritizeIncludeExcludeDesignatedContainers-Logging" class="bridgehead">Logging</h8><p>When the log level is set to DEBUG, the following messages may be found in the logs:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>message</p></th><th class="th"><p>meaning</p></th></tr></thead><tbody><tr><td class="td"><p>container &lt;id&gt;, no filter configured</p></td><td class="td"><p>container filtering is not enabled</p></td></tr><tr><td class="td"><p>container &lt;id&gt;, include in report</p></td><td class="td"><p>container is included</p></td></tr><tr><td class="td"><p>container &lt;id&gt;, exclude in report</p></td><td class="td"><p>container is excluded</p></td></tr><tr><td class="td"><p>Not reporting thread &lt;thread-id&gt; in container &lt;id&gt;</p></td><td class="td"><p>Process thread is excluded</p></td></tr></tbody></table></div><p>See also: <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193" title="Optional: Change the Agent Log Level">Optional: Change the Agent Log Level</a>.</p><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-1ddbd7a7-14c0-cfed-469a-c4d00db1a95b" data-publication-date="" id="UUID-0f4c4fbe-3a8d-ea5c-f496-47996c2e3a77"><div class="titlepage"><div><div class="title"><h6 class="title">**Sysdig_aggregated Container Metrics**</h6></div></div></div><p>Sysdig_aggregated containers can report on the following metrics:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>tcounters</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>other</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns</p></li><li class="listitem"><p>time_percentage</p></li><li class="listitem"><p>count</p></li></ul></div></li><li class="listitem"><p>io_file</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>time_ns_other</p></li><li class="listitem"><p>time_percentage_in</p></li><li class="listitem"><p>time_percentage_out</p></li><li class="listitem"><p>time_percentage_other</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li><li class="listitem"><p>count_other</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>bytes_other</p></li></ul></div></li><li class="listitem"><p>io_net</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>time_ns_other</p></li><li class="listitem"><p>time_percentage_in</p></li><li class="listitem"><p>time_percentage_out</p></li><li class="listitem"><p>time_percentage_other</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li><li class="listitem"><p>count_other</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>bytes_other</p></li></ul></div></li><li class="listitem"><p>processing</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns</p></li><li class="listitem"><p>time_percentage</p></li><li class="listitem"><p>count</p></li></ul></div></li></ul></div></li><li class="listitem"><p>reqcounters</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>other</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns</p></li><li class="listitem"><p>time_percentage</p></li><li class="listitem"><p>count</p></li></ul></div></li><li class="listitem"><p>io_file</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>time_ns_other</p></li><li class="listitem"><p>time_percentage_in</p></li><li class="listitem"><p>time_percentage_out</p></li><li class="listitem"><p>time_percentage_other</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li><li class="listitem"><p>count_other</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>bytes_other</p></li></ul></div></li><li class="listitem"><p>io_net</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>time_ns_other</p></li><li class="listitem"><p>time_percentage_in</p></li><li class="listitem"><p>time_percentage_out</p></li><li class="listitem"><p>time_percentage_other</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li><li class="listitem"><p>count_other</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>bytes_other</p></li></ul></div></li><li class="listitem"><p>processing</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>time_ns</p></li><li class="listitem"><p>time_percentage</p></li><li class="listitem"><p>count</p></li></ul></div></li></ul></div></li><li class="listitem"><p>max_transaction_counters</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li></ul></div></li><li class="listitem"><p>resource_counters</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>connection_queue_usage_pct</p></li><li class="listitem"><p>fd_usage_pct</p></li><li class="listitem"><p>cpu_pct</p></li><li class="listitem"><p>resident_memory_usage_kb</p></li><li class="listitem"><p>swap_memory_usage_kb</p></li><li class="listitem"><p>major_pagefaults</p></li><li class="listitem"><p>minor_pagefaults</p></li><li class="listitem"><p>fd_count</p></li><li class="listitem"><p>cpu_shares</p></li><li class="listitem"><p>memory_limit_kb</p></li><li class="listitem"><p>swap_limit_kb</p></li><li class="listitem"><p>count_processes</p></li><li class="listitem"><p>proc_start_count</p></li><li class="listitem"><p>threads_count</p></li></ul></div></li><li class="listitem"><p>syscall_errors</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>count</p></li><li class="listitem"><p>count_file</p></li><li class="listitem"><p>count_file_opened</p></li><li class="listitem"><p>count_net</p></li></ul></div></li><li class="listitem"><p>protos</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>http</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>server_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li><li class="listitem"><p>client_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li></ul></div></li><li class="listitem"><p>mysql</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>server_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li><li class="listitem"><p>client_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li></ul></div></li><li class="listitem"><p>postgres</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>server_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li><li class="listitem"><p>client_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li></ul></div></li><li class="listitem"><p>mongodb</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>server_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li><li class="listitem"><p>client_totals</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncalls</p></li><li class="listitem"><p>time_tot</p></li><li class="listitem"><p>time_max</p></li><li class="listitem"><p>bytes_in</p></li><li class="listitem"><p>bytes_out</p></li><li class="listitem"><p>nerrors</p></li></ul></div></li></ul></div></li></ul></div></li><li class="listitem"><p>names</p></li><li class="listitem"><p>transaction_counters</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>time_ns_in</p></li><li class="listitem"><p>time_ns_out</p></li><li class="listitem"><p>count_in</p></li><li class="listitem"><p>count_out</p></li></ul></div></li></ul></div></section></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-2a34f1bf-1807-f6fd-4025-e1ec0ed21044" data-publication-date="" id="UUID-4deb5ff8-74bf-1171-a0ee-2546d0d9294c"><div class="titlepage"><div><div class="title"><h6 class="title">Enable Kube State Metrics Collection with K8s_extra_resources</h6></div></div></div><p>Updated versions of the Sysdig agent can collect HPA, PVS, and other kube state metrics. See <a class="link" href="33836-17701-sysdig-agent.html#UUID-4deb5ff8-74bf-1171-a0ee-2546d0d9294c" title="Enable Kube State Metrics Collection with K8s_extra_resources">Enable Kube State Metrics Collection with K8s_extra_resources</a>.</p><p>First, you must edit the agent config file, <code class="code">dragent.yaml</code>, as follows:</p><pre class="programlisting">k8s_extra_resources:
    include:
      - services
      - resourcequotas
      - persistentvolumes
      - persistentvolumeclaims
      - horizontalpodautoscalers</pre><p>See also: <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a>.</p></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-fc2a83a3-3caf-72ff-222f-0b0d934977b9" data-publication-date="" id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193"><div class="titlepage"><div><div class="title"><h6 class="title">Optional: Change the Agent Log Level</h6></div></div></div><p>The Sysdig agent generates log entries in <code class="code">/opt/draios/logs/draios.log</code>. The agent will rotate out the log file when it reaches 10MB in size, keeping the 10 most recent log files archived with a date-stamp appended to the filename.</p><p>The log level available are: [ <span class="bold bold"><strong>none | error | warning | info | debug | trace</strong></span> ].</p><p>The default level (<span class="bold bold"><strong>info</strong></span>) creates an entry for each aggregated metrics transmission to the backend servers, once per second, in addition to entries for any warnings and errors.</p><p>The type and amount of logging can be changed by adding parameters and log level arguments shown below to the agent's user settings configuration file here:</p><p> <code class="code">/opt/draios/etc/dragent.yaml</code> </p><p>After editing the <code class="code">dragent.yaml</code> file, restart the agent at the shell with: <code class="code">service dragent restart</code> to affect changes.</p><p>Note that <code class="code">dragent.yaml</code> code can be written in both YAML and JSON. The examples below use YAML.</p><h6 id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-FileLogLevel" class="bridgehead">File Log Level</h6><p>When troubleshooting agent behavior, increase the logging to debug for full detail:</p><pre class="programlisting">log:
  file_priority: debug </pre><p>If you wish to reduce log messages going to the <code class="code">/opt/draios/logs/draios.log</code> file, add the <code class="code">log:</code> parameter with one of the following arguments under it and indented two spaces: [ none | error | warning | info | debug | trace ]</p><pre class="programlisting">log:
  file_priority: error</pre><h6 id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-ContainerConsoleLogging" class="bridgehead">Container Console Logging</h6><p>If you are running the containerized agent, you can also reduce container console output by adding the additional parameter <code class="code">console_priority:</code>with the same arguments [ none | error | warning | info | debug | trace ]</p><pre class="programlisting">log:
  console_priority: warning</pre><p>Note that troubleshooting a host with less than the default 'info' level will be more difficult or not possible. You should revert to 'info' when you are done troubleshooting the agent.</p><p>A level of 'error' will generate the fewest log entries, a level of 'trace' will give the most, 'info' is the default if no entry exists.</p><h6 id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-Exampleindragentyaml" class="bridgehead">Example in dragent.yaml</h6><pre class="programlisting">customerid: 831f3-Your-Access-Key-9401
tags: local:sf,acct:eng,svc:websvr
log:
 file_priority: warning
 console_priority: info</pre><pre class="programlisting"></pre><p>OR</p><pre class="programlisting">customerid: 831f3-Your-Access-Key-9401
tags: local:sf,acct:eng,svc:websvr
log: { file_priority: debug, console_priority: debug }</pre><h7 id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-Dockerruncommand" class="bridgehead">Docker run command</h7><p>If you are using the "ADDITIONAL_CONF" parameter to start a Docker containerized agent, you would specify this entry in the Docker run command:</p><pre class="programlisting">-e ADDITIONAL_CONF=“log:  { file_priority: error, console_priority: none }”
-e ADDITIONAL_CONF="log:\n  file_priority: error\n  console_priority: none"</pre><pre class="programlisting"></pre><h7 id="UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-KubernetesInfrastructure" class="bridgehead">Kubernetes Infrastructure</h7><p>When running in a Kubernetes infrastructure (installed using <a class="link" href="">the v1 method</a>), comment in the "ADDITIONAL_CONF" line in the agent <code class="code">sysdig-daemonset.yaml</code> manifest file, and modify as needed:</p><pre class="programlisting">- name: ADDITIONAL_CONF #OPTIONAL pass additional parameters to the agent
  value: "log:\n file_priority: debug\n console_priority: error"</pre><pre class="programlisting"></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-FileLogLevel" title="File Log Level">File Log Level</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-ContainerConsoleLogging" title="Container Console Logging">Container Console Logging</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-Exampleindragentyaml" title="Example in dragent.yaml">Example in dragent.yaml </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-Dockerruncommand" title="Docker run command">Docker run command</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193_id_OptionalChangetheAgentLogLevel-KubernetesInfrastructure" title="Kubernetes Infrastructure">Kubernetes Infrastructure</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-7729ce12-a550-dfb7-fcaa-1beee015c4d6" data-publication-date="" id="UUID-53a22bf0-831f-3d33-3243-8b6030689caa"><div class="titlepage"><div><div class="title"><h6 class="title">Optional: Agent Auto-Config</h6></div></div></div><h6 id="UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-Introduction" class="bridgehead">Introduction</h6><p>If you want to maintain centralized control over the configuration of your Sysdig Monitor Agents, one of the following approaches is typically ideal:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Via an orchestration system, such as using <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345/" target="_blank">Kubernetes DaemonSets</a> or <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348168/Agent+Install+Mesos+Marathon+DCOS" target="_blank">Mesos/Marathon</a>.</p></li><li class="step"><p>Using a configuration management system, such as <a class="link" href="https://github.com/chef/chef" target="_blank">Chef</a> or <a class="link" href="https://github.com/ansible/ansible" target="_blank">Ansible</a>.</p></li></ol></div><p>However, if these approaches are not viable for your environment, or to further augment your Agent configurations via central control, Sysdig Monitor provides an Auto-Config option for agents. The feature allows you to upload fragments of YAML configuration to Sysdig Monitor that will be automatically pushed and applied to some/all of your Agents based on your requirements.</p><h6 id="UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-EnablingAgentAuto-Config" class="bridgehead">Enabling Agent Auto-Config</h6><p>Independent of the Auto-Config feature, typical Agent configuration lives in <span class="bold bold"><strong>/opt/draios/etc</strong></span> and is derived from a combination of base config in the <span class="bold bold"><strong>dragent.default.yaml</strong></span> file and any overrides that may be present in <span class="bold bold"><strong>dragent.yaml</strong></span>. See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/198934553/" target="_blank">Understanding the Agent Config Files</a>.</p><p>Agent Auto-Config adds a middle layer of possible overrides in an additional file <span class="bold bold"><strong>dragent.auto.yaml</strong></span>.When present, the the order of config application from highest precedence to lowest now becomes:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>dragent.yaml</p></li><li class="step"><p>dragent.auto.yaml</p></li><li class="step"><p>dragent.default.yaml</p></li></ol></div><p>While all Agents are by default prepared to receive and make use of Auto-Config data, the file <span class="bold bold"><strong>dragent.auto.yaml</strong></span> will not be present on an Agent until you've pushed central Auto-Config data to be applied to that Agent.</p><p>Auto-Config settings are performed via Sysdig Monitor's <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/209059843/Developer+Documentation" target="_blank">REST API</a>. Simplified examples are available that use the <a class="link" href="https://github.com/draios/python-sdc-client" target="_blank">Python client library</a> to <a class="link" href="https://raw.githubusercontent.com/draios/python-sdc-client/master/examples/get_agents_config.py" target="_blank">get</a> or <a class="link" href="https://raw.githubusercontent.com/draios/python-sdc-client/master/examples/set_agents_config.py" target="_blank">set</a> current Auto-Config settings. Detailed examples using the REST API are shown below.</p><p>The REST endpoint for Auto-Config is <span class="bold bold"><strong>/api/agents/config</strong></span>. Use the <span class="bold bold"><strong>GET </strong></span>method to review the current configuration. The following example shows the initial empty settings that result in no <span class="bold bold"><strong>dragent.auto.yaml</strong></span> files being present on your Agents.</p><pre class="programlisting">curl -X GET \
       --header "Authorization: Bearer xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" \
       https://app.sysdigcloud.com/api/agents/config
 
 
Output:
{
    "files": []
}</pre><p>Use the <span class="bold bold"><strong>PUT</strong></span> method to centrally push YAML that will be distributed and applied to your Agents as <span class="bold bold"><strong>dragent.auto.yaml</strong></span> files. The <span class="bold bold"><strong>content</strong></span> parameter must contain syntactically-correct YAML. The <span class="bold bold"><strong>filter</strong></span> option is used to specify if the config should be sent to one agent or all of them, such as in this example to globally enable Debug logging on all Agents:</p><pre class="programlisting">curl -X PUT \
       --header "Content-Type: application/json" \
       --header "Authorization: Bearer xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" \
       https://app.sysdigcloud.com/api/agents/config -d '
{
  "files": [
    {
      "filter": "*",
      "content": "log:\n  console_priority: debug"
    }
  ]
}'</pre><pre class="programlisting"></pre><p>Alternatively, the <span class="bold bold"><strong>filter</strong></span> can specify a hardware MAC address for a single Agent that should receive a certain YAML config. All MAC-specific configs should appear at the top of the JSON object and are <span class="bold bold"><strong>not</strong></span> additive to any global Auto-Config specified with <span class="bold bold"><strong>"filter": "*"</strong></span> at the bottom. For example, when the following config is applied, the one Agent that has the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/204636397/MySQL" target="_blank">MySQL Application Check</a> configured would <span class="bold bold"><strong>not</strong></span> have Debug logging enabled, but all others would.</p><pre class="programlisting">curl -X PUT \
       --header "Content-Type: application/json" \
       --header "Authorization: Bearer xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" \
       https://app.sysdigcloud.com/api/agents/config -d '
{
  "files": [
    {
      "filter": "host.mac = \"08:00:27:de:5b:b9\"",
      "content": "app_checks:\n  - name: mysql\n    pattern:\n      comm: mysqld\n    conf:\n      server: 127.0.0.1\n      user: sysdig-cloud\n      pass: sysdig-cloud-password"
    },
    {
      "filter": "*",
      "content": "log:\n  console_priority: debug"
    }
  ]
}'</pre><pre class="programlisting"></pre><p>To update the active central Auto-Config settings, simply <span class="bold bold"><strong>PUT</strong></span> a complete replacement JSON object.</p><p>All connected Agents will receive centrally-pushed Auto-Config updates that apply to them based on the <span class="bold bold"><strong>filter</strong></span> settings. Any Agent whose Auto-Config is enabled/disabled/changed based on the centrally-pushed settings will immediately restart, putting the new configuration into effect. Any central Auto-Config settings that would result in a particular Agent's Auto-Config remaining the same will <span class="bold bold"><strong>not</strong></span> trigger a restart.</p><h6 id="UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-DisablingAgentAuto-Config" class="bridgehead">Disabling Agent Auto-Config</h6><p>To clear all Agent Auto-Configs, use the <span class="bold bold"><strong>PUT</strong></span>method to upload the original blank config setting of <span class="bold bold"><strong>'{ "files": [] }'</strong></span>.</p><p>It is also possible to override active Auto-Config on an individual Agent. To do so, follow these steps for your Agent:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Add the following config directly to the <span class="bold bold"><strong>dragent.yaml</strong></span> file: <span class="bold bold"><strong>auto_config: false</strong></span>.</p></li><li class="step"><p>Delete the file <span class="bold bold"><strong>/opt/draios/etc/dragent.auto.yaml</strong></span>.</p></li><li class="step"><p>Restart the Agent.</p></li></ol></div><p>For such an Agent to opt-in to Auto-Config again, remove <span class="bold bold"><strong>auto_config: false </strong></span>from the <span class="bold bold"><strong>dragent.yaml </strong></span>and restart the Agent.</p><h6 id="UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-Restrictions" class="bridgehead">Restrictions</h6><p>To prevent the possibility of pushing Auto-Config that would damage an Agent's ability to connect, the following keys will not be accepted in the centrally-pushed YAML.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>auto_config</p></li><li class="listitem"><p>customerid</p></li><li class="listitem"><p>collector</p></li><li class="listitem"><p>collector_port</p></li><li class="listitem"><p>ssl</p></li><li class="listitem"><p>ssl_verify_certificate</p></li><li class="listitem"><p>ca_certificate</p></li><li class="listitem"><p>compression</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-Introduction" title="Introduction">Introduction</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-EnablingAgentAuto-Config" title="Enabling Agent Auto-Config">Enabling Agent Auto-Config</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-DisablingAgentAuto-Config" title="Disabling Agent Auto-Config">Disabling Agent Auto-Config</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-53a22bf0-831f-3d33-3243-8b6030689caa_id_OptionalAgentAuto-Config-Restrictions" title="Restrictions">Restrictions</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-a2991ad8-39da-4686-6ca1-d0838e93e523" data-publication-date="" id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2"><div class="titlepage"><div><div class="title"><h5 class="title">Agent Upgrade</h5></div></div></div><p>The steps to upgrade an agent differ depending on whether the agent was <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/Agent+Install+Non-Orchestrated+Docker+Agent+Service+Agent" target="_blank">originally installed</a> as a Docker container or as a service.</p><p>This section describes how to check the current version of the installed agents, and then how to upgrade them.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is highly recommended to follow upgrade best practices:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Keep upgrades current</p></li><li class="listitem"><p>Upgrade progressively without skipping versions, and</p></li><li class="listitem"><p>Test upgrades in a non-mission-critical or staging environment before rolling in to production.</p></li></ul></div></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-AgentVersionCheck"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Version Check</h6></div></div></div><h6 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ContainerDockerInstallation" class="bridgehead">Container/Docker Installation</h6><p>If the agent is installed as container, run a command similar to:</p><pre class="programlisting">docker exec sysdig-agent /opt/draios/bin/dragent --version</pre><h6 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ServiceInstallation" class="bridgehead">Service Installation</h6><p>If the agent is installed as a service, run:</p><pre class="programlisting">/opt/draios/bin/dragent --version</pre><p>The agent version can also be found in the agent log file: <code class="code">/opt/draios/logs/draios.log.</code> </p><p>Look for the "Agent starting" message, which is logged whenever the agent restarts.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-UpdateAgent"><div class="titlepage"><div><div class="title"><h6 class="title">Update Agent</h6></div></div></div><p>Update the containerized agent version as you normally update any container; the basic steps are below.</p><p>Use the full run command as shown in the <span class="bold bold"><strong> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/213352719/Agent+Installation+Overview+and+Key" target="_blank">Settings &gt; Agent Installation</a> </strong></span> tab of your account. CoreOS users can use the fleet script also shown on the Agent Installation tab.</p><h6 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ContainerizedAgent" class="bridgehead">Containerized Agent</h6><p>To see which agent versions are available see <a class="link" href="https://hub.docker.com/r/sysdig/agent/tags/" target="_blank">this link</a>.</p><h7 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-Docker" class="bridgehead">Docker</h7><p>Basic Steps: stop the agent, remove it, pull the new agent, and install it.</p><p>The exact Docker command can also be found in the Sysdig <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/213352719/Agent+Installation+Overview+and+Key" target="_blank">Settings &gt; Agent Installation</a> menu.</p><pre class="programlisting">docker stop sysdig-agent 
docker rm sysdig-agent
docker pull sysdig/agent
docker run . . .  </pre><h7 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-Kubernetes" class="bridgehead">Kubernetes</h7><p>Check whether <code class="code">.yaml</code> files must be updated:</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Updating the agent image does not overwrite the <code class="code">daemonset.yaml</code> and <code class="code">configmap.yaml</code> on your local system. Check the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SRN/pages/256540682/Sysdig+Agent+Release+Notes" target="_blank">release notes</a> to see if you need to download the latest <code class="code">.yaml</code> files from <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">GitHub</a>.</p></div><p>Perform update:</p><pre class="programlisting">kubectl set image ds/sysdig-agent sysdig-agent=sysdig/agent:&lt;TAG&gt;</pre><p>Watch update status:</p><pre class="programlisting">kubectl rollout status ds/sysdig-agent</pre><h6 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ServiceAgent" class="bridgehead">Service Agent</h6><p>For service (non-containerized) agent installations, updates are installed as part of the normal system upgrade available with <code class="code">`apt-get`</code> or <code class="code">`yum`.</code> </p><h7 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-DebianUbuntu" class="bridgehead">Debian, Ubuntu</h7><pre class="programlisting">apt-get update
apt-get -y install draios-agent</pre><h7 id="UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-CentOSRHELFedoraAmazonAMIAmazonLinux2" class="bridgehead">CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2</h7><pre class="programlisting">yum clean expire-cache
yum -y install draios-agent</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-AgentVersionCheck" title="Agent Version Check">Agent Version Check </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ContainerDockerInstallation" title="Container/Docker Installation">Container/Docker Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ServiceInstallation" title="Service Installation">Service Installation </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-UpdateAgent" title="Update Agent">Update Agent</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ContainerizedAgent" title="Containerized Agent">Containerized Agent</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-Docker" title="Docker">Docker</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-Kubernetes" title="Kubernetes">Kubernetes </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-ServiceAgent" title="Service Agent">Service Agent</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-DebianUbuntu" title="Debian, Ubuntu">Debian, Ubuntu</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-CentOSRHELFedoraAmazonAMIAmazonLinux2" title="CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2">CentOS, RHEL, Fedora, Amazon AMI, Amazon Linux 2</a> </p></li></ul></div></li></ul></div></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-34276f78-88ad-274e-0736-c6ccf91b5aaa" data-publication-date="" id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45"><div class="titlepage"><div><div class="title"><h5 class="title">**Agent Stop | Start | Disable | Remove</h5></div></div></div><p>&lt;intro&gt;</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Contents"><div class="titlepage"><div><div class="title"><h6 class="title">Contents</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Container Agents (Docker, non-Kubernetes)  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Run" title="Run">Run</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-StopStartRestart" title="Stop | Start | Restart">Stop | Start | Restart </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-EnableDisable" title="Enable | Disable">Enable | Disable </a> </p></li></ul></div></li><li class="listitem"><p> Non-Containerized (Service) Agents  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-StopStartRestart1" title="Stop | Start | Restart">Stop | Start | Restart </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-General" title="General">General </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Systemd-BasedDistributions" title="Systemd-Based Distributions">Systemd-Based Distributions </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-Systemd-BasedDistributions" title="Non-Systemd-Based Distributions">Non-Systemd-Based Distributions</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-DisableEnable" title="Disable | Enable">Disable | Enable</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Systemd-BasedDistributions1" title="Systemd-Based Distributions">Systemd-Based Distributions </a> </p></li><li class="listitem"><p> Non-Systemd (Debian/Ubuntu)  </p></li><li class="listitem"><p> Non-Systemd (CentOS/RHEL)  </p></li></ul></div></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Remove" title="Remove">Remove </a> </p></li></ul></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-ContainerAgentsDockernon-Kubernetes"><div class="titlepage"><div><div class="title"><h6 class="title">Container Agents (Docker, non-Kubernetes)</h6></div></div></div><p>Docker policies are described here: <a class="link" href="https://docs.docker.com/config/containers/start-containers-automatically/" target="_blank">https://docs.docker.com/config/containers/start-containers-automatically/</a> </p><h6 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Run" class="bridgehead">Run</h6><p>explain --name</p><pre class="programlisting">docker run --name sysdig-agent ...</pre><h6 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-StopStartRestart" class="bridgehead">Stop | Start | Restart</h6><p>where's --name?</p><pre class="programlisting">docker stop|start|restart sysdig-agent</pre><h6 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-EnableDisable" class="bridgehead">Enable | Disable</h6><p>where's --name?</p><p>what all is going on here?</p><pre class="programlisting">docker update --restart no|always|on-failure|stopped sysdig-agent</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-ContainerizedServiceAgents"><div class="titlepage"><div><div class="title"><h6 class="title">Non-Containerized (Service) Agents</h6></div></div></div><h6 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-StopStartRestart1" class="bridgehead">Stop | Start | Restart</h6><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-General" class="bridgehead">General</h7><pre class="programlisting">service dragent stop [start] [restart]</pre><p>If the general command does not work for some reason, use one of the alternatives below.</p><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Systemd-BasedDistributions" class="bridgehead">Systemd-Based Distributions</h7><p>CentOS/RHEL 7+, Ubuntu 16.04+, Debian 8+ and others</p><pre class="programlisting">systemctl start dragent.service</pre><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-Systemd-BasedDistributions" class="bridgehead">Non-Systemd-Based Distributions</h7><p>CentOS/RHEL 6, older Debian and Ubuntu</p><pre class="programlisting">/etc/init.d/dragent start</pre><h6 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-DisableEnable" class="bridgehead">Disable | Enable</h6><p>Disabling the agent will stop it without removing it entirely, and it will not start after a reboot until enabled.</p><p>To enable/disable the agent start on boot:</p><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Systemd-BasedDistributions1" class="bridgehead">Systemd-Based Distributions</h7><pre class="programlisting">systemctl enable|disable dragent.service</pre><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-SystemdDebianUbuntu" class="bridgehead">Non-Systemd (Debian/Ubuntu)</h7><pre class="programlisting">update-rc.d dragent disable [enable]</pre><h7 id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-SystemdCentOSRHEL" class="bridgehead">Non-Systemd (CentOS/RHEL)</h7><pre class="programlisting">chkconfig dragent on|off</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Remove"><div class="titlepage"><div><div class="title"><h6 class="title">Remove</h6></div></div></div><p>To remove the agent entirely, see <a class="link" href="33836-17701-sysdig-agent.html#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d" title="Agent Uninstall">Agent Uninstall</a>.</p><p>&lt;Note: that uninstall page needs updating too, and needs K8s/Docker instructions&gt;</p><pre class="programlisting"></pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ead96597-570b-8e87-7eef-ce217e0b7b3b" data-publication-date="" id="UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d"><div class="titlepage"><div><div class="title"><h5 class="title">Agent Uninstall</h5></div></div></div><p>This section describes uninstalling the Sysdig agent when it was installed as a service. If the agent was installed as a container, remove it using standard Docker commands.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-DebianUbuntuDistributions"><div class="titlepage"><div><div class="title"><h6 class="title">Debian/Ubuntu Distributions</h6></div></div></div><p>To uninstall the agent from Debian Linux distributions, including Ubuntu:</p><p>As the <code class="code">sudo</code> user, run the following command in a terminal on each host:</p><pre class="programlisting">sudo apt-get remove draios-agent</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-FedoraCentOSRHELAmazonAMIAmazonLinux2Distributions"><div class="titlepage"><div><div class="title"><h6 class="title">Fedora/CentOS/RHEL/Amazon AMI/ Amazon Linux 2 Distributions</h6></div></div></div><p>To uninstall the agent from Fedora Linux distributions, including CentOS, Red Hat Enterprise Linux, as well as Amazon AMI and Amazon Linux 2:</p><p>As the <code class="code">sudo</code> user, run the following command in a terminal on each host:</p><pre class="programlisting">sudo yum erase draios-agent</pre><pre class="programlisting"></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-DebianUbuntuDistributions" title="Debian/Ubuntu Distributions">Debian/Ubuntu Distributions</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-FedoraCentOSRHELAmazonAMIAmazonLinux2Distributions" title="Fedora/CentOS/RHEL/Amazon AMI/ Amazon Linux 2 Distributions">Fedora/CentOS/RHEL/Amazon AMI/ Amazon Linux 2 Distributions</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-4c9eb77e-478d-6fe5-84d3-3e8f86cd8cb7" data-publication-date="" id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8"><div class="titlepage"><div><div class="title"><h5 class="title">Troubleshooting Agent Installation</h5></div></div></div><p>This section describes methods for troubleshooting two types of issue:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Disconnecting Agents</p></li><li class="listitem"><p>Can't See Metrics After Agent Install</p></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-DisconnectingAgents"><div class="titlepage"><div><div class="title"><h6 class="title">Disconnecting Agents</h6></div></div></div><p>If agents are disconnecting, there could be problems with addresses that need to be resolved in the agent configuration files. See also <a class="link" href="33836-17701-sysdig-agent.html#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403" title="Understanding the Agent Config Files">Understanding the Agent Config Files</a>.</p><h6 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckforDuplicateMACaddresses" class="bridgehead">Check for Duplicate MAC addresses</h6><p>The Sysdig agent will use the <code class="code">eth0</code> MAC address to identify the different hosts within an infrastructure. In a virtualized environment, you should confirm each of your VM's <code class="code">eth0</code> MAC addresses are unique.</p><p>If a unique address cannot be configured, you can supply an additional parameter in the Sysdig agent's <code class="code">dragent.yaml</code> configuration file: <code class="code">machine_id_prefix: prefix</code> </p><p>The prefix text can be any string and will be prepended to the MAC address as reported in the Sysdig Monitor web interface's Explore tables.</p><p> <span class="bold bold"><strong>Example:</strong></span> (using <code class="code">ADDITIONAL_CONF</code> rather than Kubernetes <code class="code">Configmap</code>)</p><p>Here is an example Docker run command installing the parameter via the <code class="code">ADDITIONAL_CONF</code> parameter</p><pre class="programlisting">docker run --name sysdig-agent --privileged --net host --pid host -e ACCESS_KEY=abc123-1234-abcd-4321-abc123def456 -e TAGS=tag1:value1 -e ADDITIONAL_CONF="machine_id_prefix: MyPrefix123-" -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro sysdig/agent</pre><p>The resulting <code class="code">/opt/draios/etc/dragent.yaml</code> config file would look like this:</p><pre class="programlisting">customerid:abc123-1234-abcd-4321-abc123def456
tags: tag1:value1
machine_id_prefix: MyPrefix123-</pre><p>You will then see all of your hosts, provided that all the prefixes are unique. The prefix will be visible whenever the MAC address is displayed in any view.</p><p>See also: <a class="link" href="33836-17701-sysdig-agent.html#UUID-e5ec64a7-b0f9-921f-f908-0ed6c1680a47" title="Agent Configuration">Agent Configuration</a>.</p><h6 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckforConflictingMACaddressesinGKEenvironments" class="bridgehead">Check for Conflicting MAC addresses in GKE environments</h6><p>In Google Container Engine (GKE) environments, MAC addresses could be repeated across multiple hosts. This would cause some hosts running Sysdig agents not to appear in your web interface.</p><p>To address this, add a unique machine ID prefix to each config you use to <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345/Agent+Install+Kubernetes+GKE+OpenShift" target="_blank">deploy the agent</a> to a given cluster (i.e. each <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">sysdig-daemonset.yaml</a> file).</p><p> <span class="bold bold"><strong>Note:</strong></span> This example uses the (<a class="link" href="">v1</a>) <code class="code">ADDITIONAL_CONF</code>, rather than (<a class="link" href="">v2</a>) <code class="code">Configmap</code> method.</p><p> <code class="code">- name: ADDITIONAL_CONF value: "machine_id_prefix: mycluster1-prefix-" </code> </p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CantSeeMetricsAfterAgentInstall"><div class="titlepage"><div><div class="title"><h6 class="title">Can't See Metrics After Agent Install</h6></div></div></div><p>If agents were successfully installed, you could log in to the Sysdig Monitor UI, but no metrics are displayed in the Explore panel, first confirm that the agent license count has not been exceeded. Then check for any proxy, firewall, or host security policies preventing proper agent communication to the Sysdig Monitor backend infrastructure.</p><h6 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckLicenseCount" class="bridgehead">Check License Count</h6><p>If network connectivity is good, the agent will connect to the backend but will be disconnected after a few seconds if the license count has been exceeded.</p><p>To check whether you are over-subscribed, go to <span class="bold bold"><strong> <code class="code">Settings &gt; Subscription</code>.</strong></span> </p><p>See <a class="link" href="33836-17746-administration-settings.html#UUID-27271d88-181f-eb3b-e51c-2ea171f388bd" title="Subscription: Change Number of Licensed Agents">Subscription: Change Number of Licensed Agents</a> for details.</p><h6 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckNetworkPolicy" class="bridgehead">Check Network Policy</h6><h7 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-AgentConnectionPort" class="bridgehead">Agent Connection Port</h7><p>Check your service provider VPC security groups to verify that network ACLs are set to allow the agent's <span class="bold bold"><strong>outbound traffic over TCP port 6443</strong></span>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In earlier versions, the Sysdig Agent connected to port 6666. This behavior has been deprecated, as the Sysdig agent now connects to port 6443.</p></div><h7 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-OutboundIPAddresses" class="bridgehead">Outbound IP Addresses</h7><p>Due to the distributed nature of the Sysdig Monitor infrastructure, the agent must be open for outbound connections to <span class="italic italic"> <a class="link" href="http://collector.sysdigcloud.com" target="_blank">collector.sysdigcloud.com</a> </span> on all outbound IP addresses.</p><p>Check <a class="link" href="https://ip-ranges.amazonaws.com/ip-ranges.json" target="_blank">Amazon’s public IP ranges file</a> to see all the potential IP addresses the Sysdig agent can use to communicate with the Sysdig backend databases.</p><h7 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-TransparentProxies" class="bridgehead">Transparent Proxies</h7><p>While completely transparent proxies should work, non-transparent proxies (HTTP Proxies) will prevent proper communication.</p><p>You can troubleshoot basic connectivity from the Sysdig agent on your host to our backend with:</p><pre class="programlisting">ping collector.sysdigcloud.com
telnet collector.sysdigcloud.com 6443</pre><p>It should reply '<code class="code">connected</code>'.</p><p>(For on-premises installations, see <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8faaeb82-7c97-a3ba-6744-f96ff4827430" title="Architecture &amp; System Requirements">Architecture &amp; System Requirements</a> for more information on proxies.)</p><h7 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-AWSMetadataEndpoint" class="bridgehead">AWS Metadata Endpoint</h7><p>AWS metadata is used for gathering information about the instance itself, such as instance id, public IP address, etc.</p><p>When running on an AWS instance, access to the following AWS metadata endpoint is also needed: 169.254.169.254</p><h6 id="UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckLocalHostPolicy" class="bridgehead">Check Local Host Policy</h6><p>The agent requires access to the following local system resources in order to gather metrics:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Read/Write access to <code class="code">/dev/sysdig</code> devices.</p></li><li class="listitem"><p>Read access to all the files under <code class="code">/proc</code> file system.</p></li><li class="listitem"><p>For container support, the Docker API endpoint <code class="code">/var/run/docker.sock</code> </p></li></ul></div><p>If any settings or firewall modifications are made, you may need to restart the agent service. In a shell on the affected instances issue the following command:</p><pre class="programlisting"><code class="code">sudo service dragent restart</code></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-DisconnectingAgents" title="Disconnecting Agents">Disconnecting Agents </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckforDuplicateMACaddresses" title="Check for Duplicate MAC addresses">Check for Duplicate MAC addresses</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckforConflictingMACaddressesinGKEenvironments" title="Check for Conflicting MAC addresses in GKE environments">Check for Conflicting MAC addresses in GKE environments</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CantSeeMetricsAfterAgentInstall" title="Can't See Metrics After Agent Install">Can't See Metrics After Agent Install</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckLicenseCount" title="Check License Count">Check License Count</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckNetworkPolicy" title="Check Network Policy">Check Network Policy</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-AgentConnectionPort" title="Agent Connection Port">Agent Connection Port</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-OutboundIPAddresses" title="Outbound IP Addresses">Outbound IP Addresses</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-TransparentProxies" title="Transparent Proxies">Transparent Proxies</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-AWSMetadataEndpoint" title="AWS Metadata Endpoint">AWS Metadata Endpoint </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CheckLocalHostPolicy" title="Check Local Host Policy">Check Local Host Policy</a> </p></li></ul></div></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-5fed75f2-49db-93e2-69e1-12a3100c50c6" data-publication-date="" id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31"><div class="titlepage"><div><div class="title"><h5 class="title">**Copy of Host Requirements for Agent Installation**</h5></div></div></div><p>Use this page to update discussion of Container Runtimes and link to new Containerd docs.</p><p>Sysdig agents can be installed on a wide array of Linux hosts. Check your environment to ensure it meets the minimum supported platform, operating system, runtime, and orchestration requirements and use the appropriate installation instructions.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-AgentInstallationRequirements" title="Agent Installation Requirements">Agent Installation Requirements </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-CloudPlatformorPrivateDataCenter" title="Cloud Platform or Private Data Center">Cloud Platform or Private Data Center </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-CloudPlatformsSupported" title="Cloud Platforms Supported">Cloud Platforms Supported </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-PrivateDataCenter" title="Private Data Center">Private Data Center </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-ContainerRuntimes" title="Container Runtimes">Container Runtimes</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedLinuxDistributions" title="Supported Linux Distributions">Supported Linux Distributions </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-OrchestratorYesNo" title="Orchestrator: Yes/No">Orchestrator: Yes/No </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedOpenSourceOrchestrators" title="Supported Open Source Orchestrators">Supported Open Source Orchestrators </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedContainerPlatforms" title="Supported Container Platforms">Supported Container Platforms </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedJavaVersionsandVendors" title="Supported Java Versions and Vendors">Supported Java Versions and Vendors </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-ResourceLimits" title="Resource Limits">Resource Limits </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedBrowsers" title="Supported Browsers">Supported Browsers</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SeeAlso" title="See Also">See Also</a> </p></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-AgentInstallationRequirements"><div class="titlepage"><div><div class="title"><h6 class="title">Agent Installation Requirements</h6></div></div></div><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-CloudPlatformorPrivateDataCenter" class="bridgehead">Cloud Platform or Private Data Center</h6><h7 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-CloudPlatformsSupported" class="bridgehead">Cloud Platforms Supported</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>AWS</strong></span> Elastic Cloud Compute (EC2) and AWS Elastic Container Service (ECS)</p></li><li class="listitem"><p> <span class="bold bold"><strong>Google</strong></span> Cloud Provider (GCP) and Google Kubernetes Engine (GKE).</p></li><li class="listitem"><p> <span class="bold bold"><strong>Microsoft</strong></span> Azure and Microsoft Azure Container Service (AKS)</p></li></ul></div><h7 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-PrivateDataCenter" class="bridgehead">Private Data Center</h7><p>See the <span class="italic italic">Supported Linux Distributions</span> table, below.</p><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-ContainerRuntimes" class="bridgehead">Container Runtimes</h6><p>The agent supports detection of Docker, RKT, LXC, and Mesos containers.</p><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedLinuxDistributions" class="bridgehead">Supported Linux Distributions</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Private Data Center</p></th><th class="th"><p>AWS EC2</p></th><th class="th"><p>GCP</p></th><th class="th"><p>GKE</p></th><th class="th"><p>Azure</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="underline underline"> <span class="bold bold"><strong>Core set of distributions:</strong></span> </span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Debian</strong></span> 6.0+</p></li><li class="listitem"><p> <span class="bold bold"><strong>Ubuntu</strong></span> 10.04+</p></li><li class="listitem"><p> <span class="bold bold"><strong>CentOS</strong></span> 6+</p></li><li class="listitem"><p> <span class="bold bold"><strong>RHEL</strong></span> 6+</p></li><li class="listitem"><p> <span class="bold bold"><strong>Fedora</strong></span> 13+</p></li><li class="listitem"><p> <span class="bold bold"><strong>Linux Mint</strong></span> 9+</p></li><li class="listitem"><p> <span class="bold bold"><strong>CoreOS</strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>Oracle</strong></span> 6.0+ (UEK kernels R3+, all RHCK kernels)</p></li></ul></div></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Amazon AMI</strong></span> </p><p>(any version available from the AWS Marketplace) and</p><p> <span class="bold bold"><strong>Amazon Linux 2</strong></span> </p><p>+</p></li><li class="listitem"><p> <span class="underline underline"> <span class="bold bold"><strong>Core set</strong></span> </span> </p></li></ul></div></td><td class="td"><p> <span class="underline underline"> <span class="bold bold"><strong>Core set</strong></span> </span> </p></td><td class="td"><p> <span class="bold bold"><strong>Ubuntu</strong></span> only</p></td><td class="td"><p> <span class="bold bold"><strong> <span class="underline underline">Core set</span> </strong></span> </p></td></tr></tbody></table></div><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-OrchestratorYesNo" class="bridgehead">Orchestrator: Yes/No</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If NO orchestrator is used, follow the installation instructions for <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> .</p></li><li class="listitem"><p>If you ARE using an orchestrator what kind are you using?</p></li></ul></div><h7 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedOpenSourceOrchestrators" class="bridgehead">Supported Open Source Orchestrators</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>Kubernetes</p></th><th class="th"><p>Mesos/Marathon</p></th><th class="th"><p>Docker Swarm</p></th></tr></thead><tbody><tr><td class="td"><p>Supported versions</p></td><td class="td"><p>1.2+</p></td><td class="td"></td><td class="td"><p>Docker 1.12+</p></td></tr><tr><td class="td"><p>Use Orchestrator to install agents?</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank">Agent Install: Kubernetes</a> </p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348168" target="_blank">Agent Install: Mesos/Marathon</a> </p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> </p></td></tr></tbody></table></div><h7 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedContainerPlatforms" class="bridgehead">Supported Container Platforms</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>OpenShift</p></th><th class="th"><p>GKE</p></th><th class="th"><p>ECS</p></th><th class="th"><p>Azure CS</p></th><th class="th"><p>Docker Datacenter</p></th><th class="th"><p>Rancher</p></th></tr></thead><tbody><tr><td class="td"><p>Special installation instructions?</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank">Agent Install: Kubernetes</a> </p><p>(with OpenShift options)</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345" target="_blank">Agent Install: Kubernetes</a> </p><p>(with GKE options)</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> </p><p>(+ <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206307449/AWS+Integrate+AWS+Account+and+CloudWatch+Metrics+Optional" target="_blank">AWS Integration</a> instructions)</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> </p><p>No special instructions</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> </p><p>No special instructions</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192151563/" target="_blank">Agent Install: Non-Orchestrated</a> </p><p>No special instructions</p></td></tr></tbody></table></div><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedJavaVersionsandVendors" class="bridgehead">Supported Java Versions and Vendors</h6><p>The Sysdig agent supports only:</p><p> <span class="bold bold"><strong>Java versions:</strong></span> 7 and above</p><p> <span class="bold bold"><strong>Vendors:</strong></span> Oracle, OpenJDK</p><p>For Java-based applications (Cassandra, Elasticsearch, Kafka, Tomcat, Zookeeper and etc.), the Sysdig agent requires the Java runtime environment (JRE) to be installed to poll for metrics (beans).</p><p>If the Docker-container-based Sysdig agent is installed, the JRE is installed alongside the agent binaries and no further dependencies exist. However, if you are installing the service-based agent (non-container) and you do not see the JVM/JMX metrics reporting, your host may not have the JRE installed or it may not be installed in the expected location: <code class="code">usr/bin/java </code> </p><p>See also: Troubleshooting: Why Can't I See Java (JMX) Metrics?</p><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-ResourceLimits" class="bridgehead">Resource Limits</h6><p>The resource requirements of the agent are subjective to the size of and load on your host. At a minimum, the agent requires 2% of total CPU and 512 MiB of memory.</p><h6 id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SupportedBrowsers" class="bridgehead">Supported Browsers</h6><p>Sysdig supports, tests, and verifies the <span class="bold bold"><strong>latest version of Chrome</strong></span>.</p><p>Other browsers may also work, but are not tested in the same way.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SeeAlso"><div class="titlepage"><div><div class="title"><h6 class="title">See Also</h6></div></div></div><p> <a class="link" href="33836-17701-sysdig-agent.html#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee" title="Additional Host Requirements &amp; Kernel Header Troubleshooting">Additional Host Requirements &amp; Kernel Header Troubleshooting</a> </p></section></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-74b470d4-de21-ef38-a4da-f5ae30470583">Sysdig Agent</a></li><li><a href="#UUID-d8162233-fc9f-b751-4d79-1696312db414">Host Requirements for Agent Installation</a><ul class="nav"><li><a href="#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-AgentInstallationRequirements">Agent Installation Requirements</a></li><li><a href="#UUID-d8162233-fc9f-b751-4d79-1696312db414_id_HostRequirementsforAgentInstallation-SeeAlso">See Also</a></li><li><a href="#UUID-0d5e40e0-0370-ceed-3989-4667010c20ee">Additional Host Requirements &amp; Kernel Header Troubleshooting</a></li></ul></li><li><a href="#UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d">Agent Installation</a><ul class="nav"><li><a href="#UUID-9037d45e-4884-5815-569e-eb7d94c45441">Agent Install: Kubernetes | GKE | OpenShift | IBM</a><ul class="nav"></ul></li><li><a href="#UUID-c36a2251-dd2e-9254-9639-8ae7faf40a2e">Agent Install: Non-Orchestrated (Docker Agent | Service Agent )</a></li><li><a href="#UUID-92c3405f-5416-e79e-cf72-b452e77a4e5b">Agent Install: Mesos | Marathon | DCOS</a></li><li><a href="#UUID-fcaa8bba-4a23-1ef2-df3e-defdf7957983">Agent Install: Manual Linux Installation</a></li></ul></li><li><a href="#UUID-e5ec64a7-b0f9-921f-f908-0ed6c1680a47">Agent Configuration</a><ul class="nav"><li><a href="#UUID-b9162eae-6ae3-d3eb-baca-0a3906c3e403">Understanding the Agent Config Files</a><ul class="nav"></ul></li><li><a href="#UUID-aec19556-b6aa-7968-e550-15ffb871e570">Edit the Agent Config File to Filter Data</a><ul class="nav"></ul></li><li><a href="#UUID-4deb5ff8-74bf-1171-a0ee-2546d0d9294c">Enable Kube State Metrics Collection with K8s_extra_resources</a></li><li><a href="#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193">Optional: Change the Agent Log Level</a></li><li><a href="#UUID-53a22bf0-831f-3d33-3243-8b6030689caa">Optional: Agent Auto-Config</a></li></ul></li><li><a href="#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2">Agent Upgrade</a><ul class="nav"><li><a href="#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-AgentVersionCheck">Agent Version Check</a></li><li><a href="#UUID-f32e6f8d-3420-8536-83f4-bb9d23980eb2_id_AgentUpgrade-UpdateAgent">Update Agent</a></li></ul></li><li><a href="#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45">**Agent Stop | Start | Disable | Remove</a><ul class="nav"><li><a href="#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Contents">Contents</a></li><li><a href="#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-ContainerAgentsDockernon-Kubernetes">Container Agents (Docker, non-Kubernetes)</a></li><li><a href="#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Non-ContainerizedServiceAgents">Non-Containerized (Service) Agents</a></li><li><a href="#UUID-a06f43ef-2986-d2be-46e9-0bf41d28fd45_id_id-AgentStopStartDisableRemove-Remove">Remove</a></li></ul></li><li><a href="#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d">Agent Uninstall</a><ul class="nav"><li><a href="#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-DebianUbuntuDistributions">Debian/Ubuntu Distributions</a></li><li><a href="#UUID-bef8a1a9-507e-23ba-bc30-09e8b639350d_id_AgentUninstall-FedoraCentOSRHELAmazonAMIAmazonLinux2Distributions">Fedora/CentOS/RHEL/Amazon AMI/ Amazon Linux 2 Distributions</a></li></ul></li><li><a href="#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8">Troubleshooting Agent Installation</a><ul class="nav"><li><a href="#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-DisconnectingAgents">Disconnecting Agents</a></li><li><a href="#UUID-96c5300a-763f-fb2e-e4fe-f4a211fd4ab8_id_TroubleshootingAgentInstallation-CantSeeMetricsAfterAgentInstall">Can't See Metrics After Agent Install</a></li></ul></li><li><a href="#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31">**Copy of Host Requirements for Agent Installation**</a><ul class="nav"><li><a href="#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-AgentInstallationRequirements">Agent Installation Requirements</a></li><li><a href="#UUID-96673ac8-671e-cd93-a519-8d1c3fef6b31_id_id-CopyofHostRequirementsforAgentInstallation-SeeAlso">See Also</a></li></ul></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div class="voting-title">Was this helpful?</div><div class="btn-group btn-group-toggle" data-toggle="buttons"><button id="feedback-yes-btn" class="btn toggle-yes">Yes</button><button id="feedback-no-btn" class="btn">No</button></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-17626-on-premises-deployments.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-17746-administration-settings.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
