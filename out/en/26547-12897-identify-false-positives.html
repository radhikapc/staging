<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Identify False Positives</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="26547-12896-configure-groupings-in-sysdig-secure.html" title="Configure Groupings in Sysdig Secure"></link><link rel="next" href="26547-12899-event-forwarding.html" title="Event Forwarding"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-12896-configure-groupings-in-sysdig-secure.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-12899-event-forwarding.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="26547-11020-sysdig-secure.html">Sysdig Secure</a></li><li class="breadcrumb-link"><a href="26547-12895-policy-events.html">Policy Events</a></li><li class="breadcrumb-node">Identify False Positives</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-18edc6fd-576c-b883-4f95-338239e1ea9a" data-permalink="26547-12897-identify-false-positives.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893"><div class="titlepage"><div><div class="title"><h4 class="title">Identify False Positives</h4></div></div></div><p>False positive policy events (events that trigger based on normal activity) can occur after an initial installation of Sysdig Secure. While not harmful, it is considered best practice to mitigate these events if possible. Identifying false positives generally involves the following steps:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Identify the most commonly occurring policy events.</p></li><li class="step"><p>Determine if the events are unique to the environment.</p></li><li class="step"><p>Address the false positives via Falco rule changes.</p></li><li class="step"><p>Address the false positives via policy scope.</p></li><li class="step"><p>Disable the policy/policies that trigger the events.</p></li></ol></div><p>Examples for each of the steps are outlined below.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-Contents"><div class="titlepage"><div><div class="title"><h5 class="title">Contents</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-IdentifyCommonPolicyEvents" title="Identify Common Policy Events">Identify Common Policy Events</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DeterminePolicyUniqueness" title="Determine Policy Uniqueness">Determine Policy Uniqueness</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigureFalcoRulesforFalsePositives" title="Configure Falco Rules for False Positives">Configure Falco Rules for False Positives</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigurePolicyScopeforFalsePositives" title="Configure Policy Scope for False Positives">Configure Policy Scope for False Positives</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DisablePolicies" title="Disable Policies">Disable Policies</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ExampleWalkthrough" title="Example Walkthrough">Example Walkthrough</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-IdentifytheContainerImagetoWhitelist" title="Identify the Container / Image to Whitelist">Identify the Container / Image to Whitelist</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-FromtheSysdigSecureUI" title="From the Sysdig Secure UI">From the Sysdig Secure UI</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-FromtheHostCLI" title="From the Host CLI">From the Host CLI</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-AddtheWhitelistRule" title="Add the Whitelist Rule">Add the Whitelist Rule</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12897-identify-false-positives.html#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-CheckPolicyEventsareCleared" title="Check Policy Events are Cleared">Check Policy Events are Cleared</a> </p></li></ul></div></li></ul></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-IdentifyCommonPolicyEvents"><div class="titlepage"><div><div class="title"><h5 class="title">Identify Common Policy Events</h5></div></div></div><p>The events that occur the most often should be addressed first. This can be done from the <code class="code">Policy Events</code> module, by reviewing the list for the most common occurrences:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-692a115d-f697-0e7e-c6ce-0d4377511665-en.png" style="max-width: 600px; " alt="288849921.png"></img></td></tr></table></div><p>For a more detailed view, Sysdig provides the <a class="link" href="https://github.com/draios/python-sdc-client" target="_blank">python-sdc-client</a> and the Sysdig Secure APIs to access the direct policy event stream. The example program <a class="link" href="https://raw.githubusercontent.com/draios/python-sdc-client/master/examples/get_secure_policy_events.py" target="_blank">get_secure<span class="italic italic">_</span>policy_events.py</a>, with the <code class="code">--summarize</code> argument, provides a summarized view of the policy events ordered by frequency. <code class="code">--summarize</code> also removes any container information from the output strings, to allow for better aggregation of similar events.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Sysdig also recommends using the <a class="link" href="https://github.com/draios/python-sdc-client" target="_blank">python-sdc-client</a>, and in particular <code class="code">get_secure_policy_events.py</code>, to collect policy events for on-premises customers, as Sysdig does not have direct access to the UI for troubleshooting, and the program can be written to a file, and passed on as feedback. For more information about the <a class="link" href="https://github.com/draios/python-sdc-client" target="_blank">python-sdc-client</a>, refer to the <a class="link" href="https://python-sdc-client.readthedocs.io/en/latest/" target="_blank">Sysdig Cloud Python Script Library</a> documentation.</p></div><p>Example output is shown below:</p><pre class="programlisting">
user@host:~$ python examples/get_secure_policy_events.py --help
usage: examples/get_secure_policy_events.py [-s|--summarize] [-l|--limit &lt;limit&gt;] &lt;sysdig-token&gt; [&lt;duration sec&gt;|&lt;from sec&gt; &lt;to sec&gt;]
-s|--summarize: group policy events by sanitized output and print by frequency
-l|--limit: with -s, only print the first &lt;limit&gt; outputs
You can find your token at https://secure.sysdig.com/#/settings/user

user@host:~$ python examples/get_secure_policy_events.py --summarize 5b83272d-6e3f-44b3-b3b8-9dd8671f98b7 604800
56 Database-related program spawned process other than itself (user=root program=sh -c ls &gt; /dev/null parent=mysqld)
24 Sensitive file opened for reading by non-trusted program (user=root name=ftest command=ftest -i 25200 -a exfiltration file=/etc/shadow parent=docker-containe gparent=docker-containe ggparent=dockerd gggparent=systemd)
14 Rpm database opened for writing by a non-rpm program (command=ftest -i 43200 -a write_rpm_database file=/var/lib/rpm/created-by-event-generator-sh)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34870)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34871)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34872)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34869)
1 A shell was spawned in a container with an attached terminal (user=root  shell=bash parent=exe cmdline=bash  terminal=34816)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34867)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34868)
1 A shell was spawned in a container with an attached terminal (user=root  shell=sh parent=exe cmdline=sh  terminal=34866)</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DeterminePolicyUniqueness"><div class="titlepage"><div><div class="title"><h5 class="title">Determine Policy Uniqueness</h5></div></div></div><p>In many cases, policy events are related to the use of common software used in many environments, resulting in multiple customers seeing the same events. If the policy event is likely to occur for other customers, contact Sysdig Support so that the default Falco rules can be updated.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigureFalcoRulesforFalsePositives"><div class="titlepage"><div><div class="title"><h5 class="title">Configure Falco Rules for False Positives</h5></div></div></div><p>For policy events local to the environment, the first step to address them is by adding custom Falco rules via the <code class="code">Rules Editor</code> tab of the <code class="code">Policies</code> module. These additions will extend or overwrite the behavior of a list, macro, or rule from the default rules section, in order to address the false positive.</p><p>A number of rules have a macro with the prefix user_, that can be overridden in the custom rules section in order to change the behavior of a rule. Some examples include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">user_known_write_etc_conditions</code> </p></li><li class="listitem"><p> <code class="code">user_read_sensitive_file_conditions</code> </p></li><li class="listitem"><p> <code class="code">user_known_change_thread_namespace_binaries</code> </p></li><li class="listitem"><p> <code class="code">user_shell_container_exclusions</code> </p></li><li class="listitem"><p> <code class="code">user_trusted_containers</code> </p></li><li class="listitem"><p> <code class="code">user_sensitive_mount_containers</code> </p></li></ul></div><p>If a <code class="code">user_</code> macro is not available, Sysdig recommends appending changes to an existing list, macro, or rule, instead of overwriting them.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>Overwritten lists, macros, and rules will remain static when the default rules are updated. This could lead to new default rules being shadowed and inaccessible to the user.</p></div><p>The specific changes necessary to the Falco rules depend heavily on the policy that triggered the false positives. A few examples are shown below:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">Write below etc</code> </p><p>For the <code class="code">Write Below etc</code> policy, there may be an additional program that writes specific file(s) below <code class="code">/etc</code> (this example uses the program <code class="code">catsd</code>, and the file <code class="code">/etc/catfood.cfg</code>). A macro could then be defined as follows:</p><pre class="programlisting">- macro: catsd_writing_catfood_cfg
  condition: (proc.name=catsd and fd.name=/etc/catfood.cfg)</pre><p>In addition, the macro <code class="code">user_known_write_etc_conditions</code> would need to be overwritten to add a new exception:</p><pre class="programlisting">- macro: user_known_write_etc_conditions
  condition: catsd_writing_catfood_cfg</pre></li><li class="listitem"><p> <code class="code">Launch Privileged Container </code>For the <code class="code">Launch Privileged Container</code> policy, there may be a specific container that must run with privileges. The example macro below uses images starting with <code class="code">registry.customer.com/mydatastore</code>, and overrides the <code class="code">user_trusted_containers</code> macro:</p><pre class="programlisting">- macro: user_trusted_containers
  condition: (container.image startswith registry.customer.com/mydatastore)</pre></li><li class="listitem"><p> <code class="code">Run shelluntrusted</code> </p><p>For the <code class="code">Run shelluntrusted</code> policy, a program may be present that spawns shells in the environment for legitimate purposes. The example below appends <code class="code">php</code> to the list of known shell spawn binaries, using the <code class="code">user_known_shell_spawn_binaries</code> list:</p><pre class="programlisting">- list: user_known_shell_spawn_binaries
  append: true
  items: [php]</pre></li></ul></div><p>For more information on creating Falco rules, refer to the <a class="link" href="https://github.com/draios/falco/wiki/Falco-Rules" target="_blank">Falco Rules</a> documentation.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigurePolicyScopeforFalsePositives"><div class="titlepage"><div><div class="title"><h5 class="title">Configure Policy Scope for False Positives</h5></div></div></div><p>If Falco rule changes cannot address the false positive, the scope of the policy can be modified to focus on the parts of the environment where it does/does not occur. For example, there could be a dev environment, run under Kubernetes in a dev namespace, that spawns lots of shells. In this case, the policy could be modified to exclude the dev namespace from the scope, by changing the scope from Entire Infrastructure to <code class="code">kubernetes.namespace.name != "dev"</code>:</p><p> <code class="code"><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-02ac75f9-39f9-ab93-8212-af4620ef98f1-en.png" style="max-width: 600px; " alt="278069283.png"></img></td></tr></table></div></code> </p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DisablePolicies"><div class="titlepage"><div><div class="title"><h5 class="title">Disable Policies</h5></div></div></div><p>If none of the above actions work, the policy can be disabled. To disable a policy:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>From the <code class="code">Policies</code> module, select the relevant policy.</p></li><li class="step"><p>Toggle the <code class="code">Enabled</code> switch to disable the policy:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-06cd15fc-eae2-140c-03b6-aba37b466b6c-en.png" style="max-width: 600px; " alt="278069271.png"></img></td></tr></table></div></li><li class="step"><p>Click the <code class="code">Apply Changes</code> button.</p></li></ol></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ExampleWalkthrough"><div class="titlepage"><div><div class="title"><h5 class="title">Example Walkthrough</h5></div></div></div><p>The example walkthrough below covers modifying a policy and the underlying rules to whitelist a container, in order to minimize false positive results.</p><h6 id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-IdentifytheContainerImagetoWhitelist" class="bridgehead">Identify the Container / Image to Whitelist</h6><p>The container/image can be identified either from the Sysdig Secure UI (if an event has already been triggered), or directly from the host.</p><h6 id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-FromtheSysdigSecureUI" class="bridgehead">From the Sysdig Secure UI</h6><p>To find the container / image:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>From the <code class="code">Policy Events</code> module, use the left-hand drill-down menu to identify the object to whitelist. In this example, the desired object is one of the built-in Kubernetes components (k8s_kube-addon-manager):</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-7fcbf3e3-f79d-9c1e-f3e2-b1419401f228-en.png" style="max-width: 600px; " alt="288718862.png"></img></td></tr></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Using the drill-down menu is not strictly necessary, as all of the information is contained within the <code class="code">Policy Event Details</code> window. However, using the drill-down menu can help verify the correct object to whitelist.</p></div></li><li class="step"><p>Click on the relevant event to open the <code class="code">Policy Event Details</code> window to review the event details, and identify the object to be whitelisted. In this example, the image is a <code class="code">sha256 digest</code> as it is an internal component of Kubernetes, so the container name should be used instead, in case the component is upgraded at a later date.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-93d5af5e-4b3e-1971-3a7c-10047defc2c4-en.png" style="max-width: 600px; " alt="288686141.png"></img></td></tr></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>A variety of metadata can be used for whitelisting. For containers, container name, image name, or digest could be used. Container name is the most common approach, but this option could be spoofed. Image name (such as sysdig/agent) is a more secure option. Using the digest is the most secure option as the source is guaranteed, but may require an automated solution to ensure the platform continues to whitelist the object correctly after component updates.</p></div></li><li class="step"><p>Identify the name of the policy rule triggered by the object:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-d706f751-6317-add3-ea47-f4a8972e6cae-en.png" style="max-width: 600px; " alt="288686149.png"></img></td></tr></table></div></li></ol></div><h6 id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-FromtheHostCLI" class="bridgehead">From the Host CLI</h6><p>To find the container / image:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In a terminal on the host, run the following command:</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The example command below limits the output of <code class="code">docker ps</code> to only provide the relevant information, as it is only seeking the container name or source image.</p></div><pre class="programlisting">
user@host:~$ docker ps --format "table {{.Names}}\t{{.Image}}"</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>For larger lists, either use <code class="code">more|less</code> or <code class="code">grep</code> to find the specific object. In the example output below, <code class="code">grep</code> is used to find <code class="code">addon</code>, as the desired image is <code class="code">k8s_kube-addon-manager</code>. The command also includes the table headings:</p><pre class="programlisting">
user@host:~$ docker ps --format "table {{.Names}}\t{{.Image}}" | grep 'addon\|NAME' | more
NAMES                                                                                                                                                                                                   IMAGE
k8s_kube-addon-manager_kube-addon-manager-minikube_kube-system_8b52f08746ac78d32737b5f7fdffec52_3               9c16409588eb
k8s_POD_kube-addon-manager-minikube_kube-system_8b52f08746ac78d32737b5f7fdffec52_3                                              k8s.gcr.io/pause-amd64:3.1</pre></div></li><li class="step"><p>Identify the policy rule violated.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This can only be done via the Sysdig Secure UI.</p></div></li></ol></div><h6 id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-AddtheWhitelistRule" class="bridgehead">Add the Whitelist Rule</h6><p>The default Falco rules within Sysdig Secure are read-only. To modify a rule, rewrite it as a custom rule:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>From the <code class="code">Policies</code> module, navigate to the <code class="code">Rules Editor</code> tab.</p></li><li class="step"><p>Define the macro by either creating a new macro, or editing an existing macro:</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This example edits an existing macro. The process is the same for creating a new macro, but requires a unique name.</p></div><ol type="a" class="substeps"><li class="step"><p>Find the existing macro in the <code class="code">Default Rules</code> section, and copy it into the <code class="code">Custom Rules</code> section</p></li><li class="step"><p>Add a condition to the macro that defines the object to be whitelisted:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1000px"><tr style="height: 152px"><td><img src="image/uuid-5d912722-2c60-56ed-bf56-894dcd5caa4f-en.png" style="max-width: 1000px; max-height: 152px; " alt="289243271.png"></img></td></tr></table></div></li></ol></li><li class="step"><p>Find the existing default rule, and determine if it uses the <code class="code">user_trusted containers</code> macro:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-70e80575-5709-738d-8043-61aae89e5985-en.png" style="max-width: 600px; " alt="289276014.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-f4dd7a7b-452f-0345-b871-05c5a73e7261-en.png" style="max-width: 600px; " alt="289243279.png"></img></td></tr></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In this example, Write below root does not use the <code class="code">user_trusted_containers</code> macro.</p></div></li><li class="step"><p>Copy the rule to the <code class="code">Custom Rules</code> section.</p></li><li class="step"><p>Add the configured macro to the rule:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr style="height: 215px"><td><img src="image/uuid-eed3ed22-7c53-70f4-f806-4731202965c8-en.png" style="max-width: 600px; max-height: 215px; " alt="289243290.png"></img></td></tr></table></div></li><li class="step"><p>Click the <code class="code">Save</code> button to save the changes.</p></li></ol></div><p>The updated rule will be available the next time the Sysdig Agent checks into the back-end (usually every 10 seconds or so).</p><h6 id="UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-CheckPolicyEventsareCleared" class="bridgehead">Check Policy Events are Cleared</h6><p>Once the policy has been applied and the events are cleared from being notified, the whitelisted object should show either <code class="code">No events found</code>, or with this policy no longer triggered:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-e5e4b715-3c3f-8206-8f6a-4b9f9a9e3feb-en.png" style="max-width: 600px; " alt="289243295.png"></img></td></tr></table></div></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893">Identify False Positives</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-Contents">Contents</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-IdentifyCommonPolicyEvents">Identify Common Policy Events</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DeterminePolicyUniqueness">Determine Policy Uniqueness</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigureFalcoRulesforFalsePositives">Configure Falco Rules for False Positives</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ConfigurePolicyScopeforFalsePositives">Configure Policy Scope for False Positives</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-DisablePolicies">Disable Policies</a></li><li><a href="#UUID-dcba42b6-c52c-6328-48e1-a5730c7b1893_id_IdentifyFalsePositives-ExampleWalkthrough">Example Walkthrough</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-12896-configure-groupings-in-sysdig-secure.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-12899-event-forwarding.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
