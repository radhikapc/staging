<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="no"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>On-Premises Deployments</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="33836-17625-sysdig-platform.html#UUID-6da28333-1f8a-b8ac-b505-bec8415f5368_id_SysdigPlatform-AuthenticationAuthorization" title="Authentication &amp; Authorization"></link><link rel="next" href="33836-17701-sysdig-agent.html" title="Sysdig Agent"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><ul class="toc nav nav-site-sidebar"><li><a href="33836-7424-mon--sysdig-monitor-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-069aba38-24df-cfe3-6295-806f95c1d6d3" data-permalink="33836-7424-mon--sysdig-monitor-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> MON (Sysdig Monitor)</a><ul><li><a href="33836-9744-sysdig-monitor.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-80c03485-8397-80ea-8f5f-fc2cae33cb49" data-permalink="33836-9744-sysdig-monitor.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Monitor</a><ul><li><a href="33836-9745-getting-started.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-f338dfdd-e52a-3369-fc78-7c91004d8538" data-permalink="33836-9745-getting-started.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started</a></li><li><a href="33836-9747-overview.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5cc77116-7dd1-a2a9-0b81-8302f36ce5a6" data-permalink="33836-9747-overview.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Overview</a></li><li><a href="33836-9753-explore.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9f1e2c9c-0fde-5a17-7d03-c6508d9a121c" data-permalink="33836-9753-explore.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Explore</a></li><li><a href="33836-9760-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9ecc347f-4d82-142f-f23f-eef54921905c" data-permalink="33836-9760-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics</a></li><li><a href="33836-9769-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3db0303c-3326-331c-b50e-43aee72438f5" data-permalink="33836-9769-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Dashboards</a></li><li><a href="33836-9784-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-0dd6f084-a8c7-47bd-60fd-99e6a6d32231" data-permalink="33836-9784-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Events</a></li><li><a href="33836-9795--doc-785--alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-2c45e57c-0a2c-7a96-4c9c-61ae662e4c78" data-permalink="33836-9795--doc-785--alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">[DOC-785] Alerts</a></li><li><a href="33836-9803-alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-207f896d-385a-ef7f-6a49-006fa7cf0ac9" data-permalink="33836-9803-alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Alerts</a></li><li><a href="33836-9804-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d8263ae-e350-e76b-b33c-a4a6ed9910c5" data-permalink="33836-9804-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li></ul></li></ul></li><li><a href="33836-31726-ss--sysdig-secure-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-9d238259-cba8-538a-45d2-7146377b7970" data-permalink="33836-31726-ss--sysdig-secure-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SS (Sysdig Secure)</a><ul><li><a href="33836-31918-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a4e13476-09e2-0efc-ae18-7955d3e4e07f" data-permalink="33836-31918-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Secure</a><ul><li><a href="33836-31919-getting-started-with-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-34b1cd4b-0b04-382d-958d-c37e8514fd79" data-permalink="33836-31919-getting-started-with-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started with Sysdig Secure</a></li><li><a href="33836-31920-policies.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a6f83873-7719-6a0c-4355-512ead6227e9" data-permalink="33836-31920-policies.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policies</a></li><li><a href="33836-31925-policy-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a0c9d18f-6753-34fe-5537-e841a0c7ebc7" data-permalink="33836-31925-policy-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policy Events</a></li><li><a href="33836-31930-commands-audit.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-e607ad4e-4aff-6808-d2da-124d665c2935" data-permalink="33836-31930-commands-audit.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Commands Audit</a></li><li><a href="33836-31931-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c330d73e-7372-4819-7660-e9c3ebe57377" data-permalink="33836-31931-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li><li><a href="33836-31932-image-scanning.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-138616ae-4150-ab6a-92c5-cda4c1b29469" data-permalink="33836-31932-image-scanning.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Image Scanning</a></li><li><a href="33836-31943-compliance.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b790f1cd-3616-783f-4854-d3561cef37f0" data-permalink="33836-31943-compliance.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Compliance</a></li></ul></li></ul></li><li><a href="33836-14843-sp--sysdig-platform-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-5f790757-94c6-c118-c525-e894abac1da1" data-permalink="33836-14843-sp--sysdig-platform-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SP (Sysdig Platform)</a><ul><li><a href="33836-17625-sysdig-platform.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-d7f578b2-c960-970c-a969-10cebb31d199" data-permalink="33836-17625-sysdig-platform.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Platform</a><ul><li><a href="33836-17626-on-premises-deployments.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b0fbda15-008f-f5ef-e82b-44edcdbddf2f" data-permalink="33836-17626-on-premises-deployments.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">On-Premises Deployments</a></li><li><a href="33836-17701-sysdig-agent.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-ee770b85-3c82-28cf-48e0-a38a6f973bc1" data-permalink="33836-17701-sysdig-agent.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent</a></li><li><a href="33836-17746-administration-settings.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-79535d85-dcdb-4dfd-1b55-de1edacb346d" data-permalink="33836-17746-administration-settings.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Administration Settings</a></li><li><a href="33836-17794-get-help---using-sysdig-support.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-712b3b75-2584-30e3-5bd9-e1e57d3d8756" data-permalink="33836-17794-get-help---using-sysdig-support.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Get Help | Using Sysdig Support</a></li></ul></li></ul></li><li><a href="33836-1790-si--sysdig-integrations-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-a547c8f5-9ae9-1c4c-5e8c-8fe12da3bcb0" data-permalink="33836-1790-si--sysdig-integrations-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SI (Sysdig Integrations)</a><ul><li><a href="33836-3104-sysdig-integrations.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c9afbbe1-ebba-13d8-6b7e-280e11acba65" data-permalink="33836-3104-sysdig-integrations.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Integrations</a><ul><li><a href="33836-3105-integrate-prometheus-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a9b82586-6669-653a-af4c-e3d71e6093b7" data-permalink="33836-3105-integrate-prometheus-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Prometheus Metrics</a></li><li><a href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-eb4a14da-a0d4-5d37-b74c-9c1d4fd24a76" data-permalink="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate JMX Metrics from Java Virtual Machines</a></li><li><a href="33836-3118-integrate-statsd-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6efe354e-5d0d-8dc2-d58c-103524dcb0cb" data-permalink="33836-3118-integrate-statsd-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate StatsD Metrics</a></li><li><a href="33836-3119-integrate-node-js-application-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fd238571-3246-4a22-59ae-18a993d11d70" data-permalink="33836-3119-integrate-node-js-application-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Node.js Application Metrics</a></li><li><a href="33836-3120-integrate-applications--default-app-checks-.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-771652e1-1419-993b-6a15-6ffb08f23cbe" data-permalink="33836-3120-integrate-applications--default-app-checks-.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Applications (Default App Checks)</a></li><li><a href="33836-3163-monitor-log-files.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fab0e8c0-9a8b-6da1-72ed-1a6f78bcc819" data-permalink="33836-3163-monitor-log-files.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Monitor Log Files</a></li><li><a href="33836-3164-create-a-custom-app-check.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-87fda1aa-3729-5b0b-0e6d-3826c07008b2" data-permalink="33836-3164-create-a-custom-app-check.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create a Custom App Check</a></li><li><a href="33836-3165-create-per-container-custom-app-checks.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-be3c8a46-1153-ae68-9ffa-a743b9f4c5c7" data-permalink="33836-3165-create-per-container-custom-app-checks.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create Per-Container Custom App Checks</a></li><li><a href="33836-3167---copy-of-integrate-statsd-metrics--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-62916008-0afc-b3b9-9a57-0619ffd7162c" data-permalink="33836-3167---copy-of-integrate-statsd-metrics--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Copy of Integrate StatsD Metrics**</a></li></ul></li></ul></li><li><a href="33836-321-sd--sysdig-developer-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-02c2a850-5ddd-8c69-e72e-a6c25dd77bd6" data-permalink="33836-321-sd--sysdig-developer-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SD (Sysdig Developer)</a><ul><li><a href="33836-407-sysdig-developer.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c6f9da21-9261-0143-c7bf-cc1911bfd830" data-permalink="33836-407-sysdig-developer.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Developer</a><ul><li><a href="33836-408-sysdig-python-client.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3221c4bb-2722-3923-2318-fface3c5a7dc" data-permalink="33836-408-sysdig-python-client.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Python Client</a></li><li><a href="33836-411-sysdig-rest-api-conventions.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-cd967606-7ed2-3987-4ae5-ebe61c5c63b3" data-permalink="33836-411-sysdig-rest-api-conventions.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig REST API Conventions</a></li><li><a href="33836-412-working-with-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-dab3ac7a-75a7-ca54-b757-48eb6c152382" data-permalink="33836-412-working-with-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Working with Dashboards</a></li><li><a href="33836-415-metrics-dictionary.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb8f1cb0-689d-02b1-685e-ce078d15458d" data-permalink="33836-415-metrics-dictionary.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics Dictionary</a></li><li><a href="33836-486---sample-use-cases--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9560c9cf-68e1-76fb-d9d1-8bc20520c9e9" data-permalink="33836-486---sample-use-cases--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Sample Use Cases**</a></li></ul></li></ul></li><li><a href="33836-29920-srn--sysdig-release-notes-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-3347f819-20ba-fc5a-b851-ef9c9b052358" data-permalink="33836-29920-srn--sysdig-release-notes-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SRN (Sysdig Release Notes)</a><ul><li><a href="33836-30013-sysdig-release-notes-home.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5a6ffc5f-ac34-9a7b-dadd-93a6660c0797" data-permalink="33836-30013-sysdig-release-notes-home.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Release Notes Home</a><ul><li><a href="33836-30014-sysdig-agent-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d6e3387-7f79-746c-f6dc-307df42de9b6" data-permalink="33836-30014-sysdig-agent-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent Release Notes</a></li><li><a href="33836-30015-saas--sysdig-monitor-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6f9142b1-da9d-e39a-a544-b636187d1f1c" data-permalink="33836-30015-saas--sysdig-monitor-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Monitor Release Notes</a></li><li><a href="33836-30016-saas--sysdig-secure-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb47596c-e097-c65e-7b1f-aea99cbe7e6d" data-permalink="33836-30016-saas--sysdig-secure-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Secure Release Notes</a></li><li><a href="33836-30017-sysdig-on-premises-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b883612b-b2eb-205b-e04d-5108476566f9" data-permalink="33836-30017-sysdig-on-premises-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig On-Premises Release Notes</a></li><li><a href="33836-30018-terms-of-use.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-005c4ff8-26e9-cd84-5f78-729f0870b46f" data-permalink="33836-30018-terms-of-use.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Terms of Use</a></li></ul></li></ul></li></ul></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-17625-sysdig-platform.html#UUID-6da28333-1f8a-b8ac-b505-bec8415f5368_id_SysdigPlatform-AuthenticationAuthorization">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-17701-sysdig-agent.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="33836-14843-sp--sysdig-platform-.html">SP (Sysdig Platform)</a></li><li class="breadcrumb-link"><a href="33836-17625-sysdig-platform.html">Sysdig Platform</a></li><li class="breadcrumb-node">On-Premises Deployments</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-b0fbda15-008f-f5ef-e82b-44edcdbddf2f" data-permalink="33836-17626-on-premises-deployments.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-6beb0149-6f48-f422-2293-f423ba246e92"><div class="titlepage"><div><div class="title"><h4 class="title">On-Premises Deployments</h4></div></div></div><p>The term "<a class="link" href="https://www.webopedia.com/TERM/O/on-premises.html" target="_blank">on-premises</a>" (or "on-prem") is both industry-standard and evolving, so it means different things to different people.</p><p>In the context of Sysdig, on-prem customers install and manage the Sysdig backend components as they see fit. This could be in a data center, or in an enterprise's cloud-provider space, such as AWS or GKE.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-6beb0149-6f48-f422-2293-f423ba246e92_id_On-PremisesDeployments-Contents"><div class="titlepage"><div><div class="title"><h5 class="title">Contents</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8faaeb82-7c97-a3ba-6744-f96ff4827430" title="Architecture &amp; System Requirements">Architecture &amp; System Requirements</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9765e37a-1be5-8950-2c73-a5c79fb7eed0" title="On-Premises Installation">On-Premises Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250" title="On-Premises Upgrades">On-Premises Upgrades</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">Find the Super Admin Credentials and API Token</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644" title="Upgrade an On-Premises License">Upgrade an On-Premises License</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac" title="Securing Elasticsearch">Securing Elasticsearch</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e" title="Securing Cassandra">Securing Cassandra</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a6838af5-084b-2767-1990-f0fcc15fa720" title="Authentication and Authorization (On-Prem Options)">Authentication and Authorization (On-Prem Options)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb" title="**Backup and Restore Best Practices**">**Backup and Restore Best Practices**</a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cd539f11-f1ce-b46c-2e31-33817e7fbcfe" data-publication-date="" id="UUID-8faaeb82-7c97-a3ba-6744-f96ff4827430"><div class="titlepage"><div><div class="title"><h5 class="title">Architecture &amp; System Requirements</h5></div></div></div><p>Before installing an on-premises solution, review the Sysdig architecture, sizing tips, configuration options, and installation options.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-497a9bf0-df44-a664-aa1f-09340e104bcd" title="Architecture">Architecture</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f" title="Supported Configurations">Supported Configurations</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-f4680579-0bb3-2f1f-dfc8-930b303f332a" title="Hardening and Securing User Passwords">Hardening and Securing User Passwords</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9365be32-ac6f-00b4-a2ae-fcf35617e6a8" title="Software Sizing Tips">Software Sizing Tips</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-0209f6e2-369c-e1e1-8a29-d254a77fb071" title="Installation Options">Installation Options</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e134bf8e-ecf7-9902-5fbb-7debaf43ea51" data-publication-date="" id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd"><div class="titlepage"><div><div class="title"><h6 class="title">Architecture</h6></div></div></div><p>Review the diagram and component descriptions. When installing on-premises, you can decide where to deploy various components.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="900px"><tr style="height: 374px"><td><img src="image/15d5af4f33f52f.png" style="max-width: 900px; max-height: 374px; " alt="374046785.png"></img></td></tr></table></div><h6 id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-Agent" class="bridgehead">Agent</h6><p>The agent lives on the hosts being monitored and collects the appropriate metrics and events.</p><h6 id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-BackendComponentsstateless" class="bridgehead">Backend Components (stateless)</h6><p>The backend components connect with each other internally on port 9000.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Component</p></th><th class="th"><p>Description</p></th><th class="th"><p>Ports</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>API Servers</strong></span> </p></td><td class="td"><p>Provide a web and API interface to the Sysdig application.</p><p>You can write scripts to interact directly with the API.</p></td><td class="td"><p>9000</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Collectors</strong></span> </p></td><td class="td"><p>Agents connect here to deliver data to the Sysdig Monitor backend.</p></td><td class="td"><p>9000</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Workers</strong></span> </p></td><td class="td"><p>Process data aggregations and alerts.</p></td><td class="td"><p>9000</p></td></tr></tbody></table></div><h6 id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-CacheLayerstateful" class="bridgehead">Cache Layer (stateful)</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Component</p></th><th class="th"><p>Description</p></th><th class="th"><p>Ports</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Redis</strong></span> </p></td><td class="td"><p>An open-source (BSD licensed) data structure store used as an intra-service cache</p></td><td class="td"><p>6639</p></td></tr></tbody></table></div><h6 id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-Datastoresstateful" class="bridgehead">Datastores (stateful)</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Component</p></th><th class="th"><p>Description</p></th><th class="th"><p>Ports</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>MySQL</strong></span> </p></td><td class="td"><p>Stores user credentials and environmental data</p></td><td class="td"><p>3306</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Elasticsearch</strong></span> </p></td><td class="td"><p>Stores all events and metadata</p></td><td class="td"><p>9200</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Cassandra</strong></span> </p></td><td class="td"><p>Stores all metrics</p></td><td class="td"><p>9042</p></td></tr></tbody></table></div><h6 id="UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-LoadBalancerServices" class="bridgehead">Load Balancer Services</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Component</p></th><th class="th"><p>Description</p></th><th class="th"><p>Ports</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>lb-api service</strong></span> </p></td><td class="td"><p>Load balancer for API server</p><p>(may be named differently in different orchestrators)</p></td><td class="td"><p>80, 443</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>lb-collector service</strong></span> </p></td><td class="td"><p>Load balancer for collector</p><p>(may be named differently in different orchestrators)</p></td><td class="td"><p>6443, 6666</p></td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-Agent" title="Agent">Agent</a> </p></li><li class="listitem"><p> Backend Components (stateless)  </p></li><li class="listitem"><p> Cache Layer (stateful) </p></li><li class="listitem"><p> Datastores (stateful)  </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-497a9bf0-df44-a664-aa1f-09340e104bcd_id_Architecture-LoadBalancerServices" title="Load Balancer Services">Load Balancer Services </a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ea380c9f-7536-d5b7-1c91-8fede1d2deaf" data-publication-date="" id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f"><div class="titlepage"><div><div class="title"><h6 class="title">Supported Configurations</h6></div></div></div><h6 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-LinuxDistributions" class="bridgehead">Linux Distributions</h6><p>A 64-bit Linux distribution with a minimum kernel version of 3.10, and support of docker-engine 1.7.1 or later, is required for each server instance.</p><p> <span class="bold bold"><strong>Recommended Linux distributions:</strong></span> RedHat, Ubuntu, Amazon AMI, Amazon Linux 2.</p><h6 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-DockerRequirements" class="bridgehead">Docker Requirements</h6><p>For the Docker installation, <span class="bold bold"><strong>running devicemapper in 'loopback mode' is not supported</strong></span>. It has known performance problems and a different storage driver should be used.</p><p>Please see this note from our Replicated infrastructure partner: <a class="link" href="https://help.replicated.com/community/t/devicemapper-installation-warning/22" target="_blank">devicemapper-installation-warning</a>.</p><p>Installing the latest version of Docker is recommended.</p><h6 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Cassandra" class="bridgehead">Cassandra</h6><p>Cassandra is used as the metrics store for Sysdig agents. It is the most dynamic component of the system, and requires additional attention to ensure that your system is performing well and highly responsive.</p><p>This component is stateful, and should be treated more carefully than stateless components. Cassandra sizing is based on a minimum replication factor as well as the number of agents writing data.</p><p> <span class="bold bold"><strong>A minimum replication factor of 3 is recommended for the Sysdig application,</strong></span> which allows the cluster to survive the failure of 1 Cassandra instance.</p><p>Each agent consumes anywhere from 500MB to 2GB of Cassandra storage, with average sizing at 1.5GB/agent. Because of Sysdig's data aggregation model, this storage should comfortably handle multi-year history. This needs to then be multiplied by the replication factor to determine the total disk space required. A rough calculation might be:</p><p>100 agents = 150GB raw, X replication factor of 3, = 450GB total</p><p>To be safe we recommend that you size some additional disk space as buffer (say 25-50%) on top of that.</p><h6 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-NetworkConfiguration" class="bridgehead">Network Configuration</h6><p>The following firewall/security configurations are required for inbound and outbound traffic for the Sysdig platform:</p><h7 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Ports" class="bridgehead">Ports</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows" style="text-align: left;"><colgroup><col></col><col></col><col></col><col></col></colgroup><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Port</strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong>State</strong></span> </p></td><td class="td"><p>Direction</p></td><td class="td"><p> <span class="bold bold"><strong>Description</strong></span> </p></td></tr><tr><td class="td"><p>6666</p></td><td class="td"><p>Open (optional)</p></td><td class="td"><p>Inbound</p></td><td class="td"><p>Agent communication (unencrypted)</p></td></tr><tr><td class="td"><p>6443</p></td><td class="td"><p>Open</p></td><td class="td"><p>Inbound</p></td><td class="td"><p>Agent Communication (TLS/encrypted)</p></td></tr><tr><td class="td"><p>443</p></td><td class="td"><p>Open</p></td><td class="td"><p>Inbound</p></td><td class="td"><p>Sysdig Monitor user-interface access inbound</p></td></tr><tr><td class="td"><p>443*</p></td><td class="td"><p>Open</p></td><td class="td"><p>Outbound</p></td><td class="td"><p>*Optional, used if collecting AWS CloudWatch metrics. See also <a class="link" href="33836-17746-administration-settings.html#UUID-71bafabd-2efa-0f8a-1555-3d7b1eafe183" title="AWS: Integrate AWS Account and CloudWatch Metrics (Optional)">AWS: Integrate AWS Account and CloudWatch Metrics (Optional)</a>.</p></td></tr><tr><td class="td"><p>443*</p></td><td class="td"><p>Open</p></td><td class="td"><p>Outbound</p></td><td class="td"><p>*Optional, needed if using Sysdig Secure Image Scanning to download vulnerability definitions.</p><p>Must be open to Cloudflare IP ranges: <a class="link" href="https://www.cloudflare.com/ips/" target="_blank">https://www.cloudflare.com/ips/</a>.</p></td></tr><tr><td class="td"><p>8800</p></td><td class="td"><p>Open</p></td><td class="td"><p>Inbound</p></td><td class="td"><p>Replicated Management Console access (for on-premises installations that don't use Kubernetes)</p></td></tr></tbody></table></div><p> <span class="bold bold"><strong>Warning:</strong></span> Port 6666 should only be opened if agents will be communicating with the collectors without encryption.</p><p>Additional ports may need to be configured for the Replicated infrastructure manager. Refer to the <a class="link" href="https://help.replicated.com/community/t/customer-firewalls/55" target="_blank">Replicated port requirements</a> documentation for more information.</p><h6 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-HTTPHTTPSandProxySupport" class="bridgehead">HTTP/HTTPS and Proxy Support</h6><p>All non-airgapped hosts require outbound HTTP/S internet access for:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>License validation</p></li><li class="listitem"><p>Pulling Sysdig/Agent containers from the Docker hub repository</p></li><li class="listitem"><p>Release update checks</p></li></ul></div><p> <span class="bold bold"><strong>Note:</strong></span> Sysdig does not support HTTP/S proxies for Sysdig platform components.</p><h7 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-SummaryPlanProxySupportforNotificationChannelsCloudWatchMetricsCaptureStorage" class="bridgehead">Summary: Plan Proxy Support for Notification Channels, CloudWatch Metrics, Capture Storage</h7><p>In release #760 and newer of the Sysdig platform back-end, an option is available to configure outgoing HTTP/HTTPS connections to be made via proxy. This has been tested and supports outgoing web connections that are necessary to support the following features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Notification Channels</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>PagerDuty</p></li><li class="listitem"><p>Slack</p></li><li class="listitem"><p>Amazon SNS</p></li><li class="listitem"><p>VictorOps</p></li><li class="listitem"><p>OpsGenie</p></li><li class="listitem"><p>WebHook</p></li></ul></div></li><li class="listitem"><p>Gathering of AWS CloudWatch data</p></li><li class="listitem"><p>Capture storage to an AWS S3 bucket</p></li></ul></div><p>Proxied web connectivity to support authentication mechanisms (SAML. OpenID Connect, OAuth) are <span class="bold bold"><strong>not</strong></span> supported at this time.</p><h7 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-ConfigureProxyUsingJVMOptions" class="bridgehead">Configure Proxy Using JVM Options</h7><p>The proxy settings are configured via the JVM options passed to the Sysdig software components. JVM options can be added/appended at any time (with a required restart).</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>In a <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204767355/Sysdig+and+Replicated+Client+Install" target="_blank">Replicated on-premises install</a>, use the Advanced Settings panel to enter JVM options in the <span class="bold bold"><strong>Sysdig application JVM options </strong></span>field. (See "Define Advanced Settings" on <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506" title="Install Using the Replicated GUI">Install Using the Replicated GUI</a>.)</p><p>If JVM settings have already been set, log in to the Replicated Management console and choose the <span class="bold bold"><strong>Settings</strong></span> tab. At the bottom of the screen, check the box to <span class="bold bold"><strong>Show Advanced Settings</strong></span> to reveal the configuration option.</p></li><li class="listitem"><p>In a <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204669178/Sysdig+Install+with+Existing+Kubernetes+1.9+" target="_blank">Kubernetes-based on-premises install</a>, set the <span class="bold bold"><strong>sysdigcloud.jvm.options</strong></span> in the <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/sysdigcloud/config.yaml" target="_blank">config.yaml</a> used to set the ConfigMap:</p><pre class="programlisting"># Optional: Sysdig Cloud application JVM options. For heavy load environments you'll need to tweak 
# the memory or garbage collection settings
  sysdigcloud.jvm.options: ""</pre></li><li class="listitem"><p>Enter the proxy parameters, as in the example below.</p><p>This JVM options string will forward all HTTP and HTTPS traffic via outgoing port <span class="bold bold"><strong>8888</strong></span> on a proxy at hostname <a class="link" href="http://proxy.example.com" target="_blank">proxy.example.com</a>. IP address may be specified instead of hostname.</p><pre class="programlisting">-Dhttp.proxyHost=proxy.example.com -Dhttp.proxyPort=8888 -Dhttps.proxyPort=8888 -Dhttps.proxyHost=proxy.example.com</pre></li></ul></div><h7 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Exclusions" class="bridgehead">Exclusions</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Do not use local host or 127.0.0.1. By default, HTTP/HTTPS requests to localhost or 127.0.0.1 will <span class="italic italic">not</span> be directed by the back-end toward any configured proxy, which is necessary for the functioning of some web components internal to the Sysdig platform containers.</p></li><li class="listitem"><p>If you deploy the Sysdig platform in AWS, add an additional proxy parameter</p><p> <code class="code">-Dhttp.nonProxyHosts=169.254.169.254</code> </p><p>Rational: This provides a work-around for the backend occasionally making HTTP requests to a special <a class="link" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html" target="_blank">instance metadata address</a> 169.254.169.254, which is undesirable when using a proxy.</p><p>This IP address will be excluded from proxying by default in a future release.</p></li><li class="listitem"><p>If you have additional proxy exclusions you wish to specify that are unique to your environment, these can also be added using the pipe separator.</p><p>For example, assume your deployment was in AWS and you also had a webhook target 192.168.1.2 that was not reachable via your proxy.To exclude both:</p><p> <span class="bold bold"><strong>Replicated:</strong></span> your complete string to enter into the console for <span class="bold bold"><strong>Sysdig application JVM options</strong></span> would be:</p><pre class="programlisting">-Dhttp.proxyHost=proxy.example.com -Dhttp.proxyPort=8888 -Dhttps.proxyPort=8888 -Dhttps.proxyHost=proxy.example.com -Dhttp.nonProxyHosts=169.254.169.254|192.168.1.2</pre><p> <span class="bold bold"><strong>Kubernetes: </strong></span> when setting the <code class="code">sysdigcloud.jvm.api.options</code> and <code class="code">sysdigcloud.jvm.worker.options</code> in the <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/sysdigcloud/config.yaml" target="_blank">config.yaml</a> for the ConfigMap, the pipe separator must be double-escaped, such as:</p><pre class="programlisting"># Optional: Sysdig Cloud application JVM options. For heavy load environments you'll need to tweak 
# the memory or garbage collection settings
  sysdigcloud.jvm.api.options: "-Xms2048m -Xmx2048m -Dhttp.proxyHost=xxx.xxx.sysdig.com -Dhttp.proxyPort=80 -Dhttps.proxyPort=80 -Dhttps.proxyHost=xx.xx.sysdig.com -Dhttp.nonProxyHosts=169.123.169.123\\|127.0.0.1\\|localhost\\|.sysdig.com"</pre></li></ul></div><h7 id="UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-TimeSynchronization" class="bridgehead">Time Synchronization</h7><p>The Sysdig platform requires the system clocks to be closely synchronized between hosts. When provisioning hosts for installation, ensure the system clocks are synchronized.</p><p> <span class="bold bold"><strong>Recommended: </strong></span>Install NTP to ensure all host clocks stay synchronized.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-LinuxDistributions" title="Linux Distributions">Linux Distributions</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-DockerRequirements" title="Docker Requirements">Docker Requirements</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Cassandra" title="Cassandra">Cassandra </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-NetworkConfiguration" title="Network Configuration">Network Configuration</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Ports" title="Ports">Ports</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-HTTPHTTPSandProxySupport" title="HTTP/HTTPS and Proxy Support">HTTP/HTTPS and Proxy Support</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-SummaryPlanProxySupportforNotificationChannelsCloudWatchMetricsCaptureStorage" title="Summary: Plan Proxy Support for Notification Channels, CloudWatch Metrics, Capture Storage">Summary: Plan Proxy Support for Notification Channels, CloudWatch Metrics, Capture Storage</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-ConfigureProxyUsingJVMOptions" title="Configure Proxy Using JVM Options">Configure Proxy Using JVM Options</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-Exclusions" title="Exclusions">Exclusions</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f_id_SupportedConfigurations-TimeSynchronization" title="Time Synchronization">Time Synchronization</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-82ace18f-9592-9298-fd89-94e9800f1fa7" data-publication-date="" id="UUID-f4680579-0bb3-2f1f-dfc8-930b303f332a"><div class="titlepage"><div><div class="title"><h6 class="title">Hardening and Securing User Passwords</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For MySQL, Redis, and the <a class="link" href="">initial "super admin" user</a>, a strong password is recommended, 16-20 characters, alphanumeric.</p></li><li class="listitem"><p>For Cassandra and MySQL, it is also possible to set up third-party authentication</p></li><li class="listitem"><p>For Redis, users can set up an SSH tunnel and Sysdig can connect over this tunnel.</p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-45124c04-b15a-aa28-498a-bf0cc411ef31" data-publication-date="" id="UUID-9365be32-ac6f-00b4-a2ae-fcf35617e6a8"><div class="titlepage"><div><div class="title"><h6 class="title">Software Sizing Tips</h6></div></div></div><h6 id="UUID-9365be32-ac6f-00b4-a2ae-fcf35617e6a8_id_SoftwareSizingTips-" class="bridgehead"></h6><p>Sizing for the Sysdig platform depends on many factors, both within the existing infrastructure and regarding how an enterprise plans to use Sysdig products. Some things to take into consideration are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Platform Usage - Monitor, Secure, Both</p></li><li class="listitem"><p>Number of Hosts - Important to know</p></li><li class="listitem"><p>Container Density - Important to know</p></li><li class="listitem"><p>Container Churn - Important to know</p></li><li class="listitem"><p>Metric Density - Important to know</p></li><li class="listitem"><p>Alert Load - Good to know</p></li><li class="listitem"><p>API Load - Good to know</p></li><li class="listitem"><p>(Number of concurrent users)</p></li><li class="listitem"><p>Event Load - Good to know</p></li></ul></div><p>The Sysdig Professional Services team works with each enterprise to define platform sizing more accurately.</p><p>For a proof-of-concept environment, here are some initial guidelines: <span class="bold bold"><strong>Details:</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Host VM for single-node Sysdig platform deployment:</strong></span> 16 CPU, 32 G RAM with 500 GB HDD.</p><p>The POC environment assumes:</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig Monitor</strong></span> to be deployed</p></li><li class="listitem"><p> <span class="bold bold"><strong>Number of hosts</strong></span> &lt;= 40</p></li><li class="listitem"><p> <span class="bold bold"><strong>Container Density</strong></span> &lt;= 25 / host</p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e0498d3d-847e-2660-87fd-9c6de36fcec8" data-publication-date="" id="UUID-0209f6e2-369c-e1e1-8a29-d254a77fb071"><div class="titlepage"><div><div class="title"><h6 class="title">Installation Options</h6></div></div></div><p>The different installation flavors for backend installation are described in two primary documents, as shown below.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Install Tool</p></th><th colspan="4" class="th"><p>REPLICATED</p></th><th colspan="4" class="th"><p>KUBERNETES</p></th></tr><tr><th class="th"><p> <span class="bold bold"><strong>Environment</strong></span> </p></th><td class="td"><p>Single Host</p></td><td class="td"></td><td class="td"><p>Multi-Host</p></td><td class="td"></td><td class="td"><p>Single Host</p></td><td class="td"></td><td class="td"><p>Multi-Host</p></td><td class="td"></td></tr></thead><tbody><tr><th class="th tableheader"><p> <span class="bold bold"><strong>Internet Access</strong></span> </p></th><td class="td"><p>Connected</p></td><td class="td"><p>Airgapped</p></td><td class="td"><p>Connected</p></td><td class="td"><p>Airgapped</p></td><td class="td"><p>Connected</p></td><td class="td"><p>Airgapped</p></td><td class="td"><p>Connected</p></td><td class="td"><p>Airgapped</p></td></tr><tr><th class="th tableheader"><p> <span class="bold bold"><strong>About</strong></span> </p></th><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Sysdig Install with Replicated</a> </p></td><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a> with</p><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Sysdig Install with Replicated</a> </p></td><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Sysdig Install with Replicated</a> </p></td><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a> with</p><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Sysdig Install with Replicated</a> </p></td><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e" title="Sysdig Install on Kubernetes 1.9+">Sysdig Install on Kubernetes 1.9+</a> </p></td><td class="td"><p>Contact Support</p></td><td class="td"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e" title="Sysdig Install on Kubernetes 1.9+">Sysdig Install on Kubernetes 1.9+</a> </p></td><td class="td"><p>Contact Support</p></td></tr></tbody></table></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-f3f2b80c-ab17-0417-e900-5e28acb4e13d" data-publication-date="" id="UUID-9765e37a-1be5-8950-2c73-a5c79fb7eed0"><div class="titlepage"><div><div class="title"><h5 class="title">On-Premises Installation</h5></div></div></div><p>When planning to install Sysdig products on-premises, enterprises should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Organize resources for a test environment and the production environment</p></li><li class="listitem"><p>Understand the architecture, component requirements, and installation options in <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8faaeb82-7c97-a3ba-6744-f96ff4827430" title="Architecture &amp; System Requirements">Architecture &amp; System Requirements</a> </p></li><li class="listitem"><p>Decide whether to install using Replicated orchestrator or Kubernetes</p></li><li class="listitem"><p>Consider the SSO options and plan accordingly (see <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a6838af5-084b-2767-1990-f0fcc15fa720" title="Authentication and Authorization (On-Prem Options)">Authentication and Authorization (On-Prem Options)</a>).</p></li></ul></div><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>The information in this section provides proof-of-concept install steps, but for a true enterprise deployment Sysdig expects Sysdig support/system engineers to assist with on-premises deployments.</p></div><p>Topics in this section:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e" title="Sysdig Install on Kubernetes 1.9+">Sysdig Install on Kubernetes 1.9+</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23" title="Sysdig Install on OpenShift (v1929+)">Sysdig Install on OpenShift (v1929+)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Sysdig Install with Replicated</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d" title="Troubleshooting On-Premises Installation">Troubleshooting On-Premises Installation</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ea992727-71b2-665e-102e-f883f98dd3c1" data-publication-date="" id="UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e"><div class="titlepage"><div><div class="title"><h6 class="title">Sysdig Install on Kubernetes 1.9+</h6></div></div></div><p>This section describes how to install the backend components of the Sysdig platform on an existing Kubernetes orchestrator.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>To install the Sysdig backend on OpenShift, </strong></span> see <a class="link" href="33836-17626-on-premises-deployments.html#UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23" title="Sysdig Install on OpenShift (v1929+)">Sysdig Install on OpenShift (v1929+)</a>.</p></div><h6 id="UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-KeyFeatures" class="bridgehead">Key Features</h6><p>As of version 1.9, the Sysdig platform supports:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Datastore Persistence: Persistent volumes can use block disks from the cloud provider(s) dynamically. The disks can be encrypted, adjusted for IOPS-specific performance, and can use snapshots for backups.</p></li><li class="listitem"><p>Datastore stateful sets.</p></li></ul></div><h6 id="UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-UnderstandtheEnvironment" class="bridgehead">Understand the Environment</h6><p>The Sysdig platform includes both Sysdig Monitor and Sysdig Secure, which are licensed separately. All installations include Sysdig Monitor, while some of the Secure components are installed and configured as additional steps within the overall installation process.</p><p>When installing the Sysdig platform with Kubernetes as the orchestrator, you install each backend component with separate <code class="code">kubectl</code> commands.</p><h6 id="UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-InstallSysdigPlatform" class="bridgehead">Install Sysdig Platform</h6><p>To install Sysdig Platform on Kuberntes v1.9 and above:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374407169/Installation+Instructions" target="_blank">Prepare the environment</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374341646/Install+Components" target="_blank">Install the components</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374407260/Accessing+Sysdig+Platform" target="_blank">Access Sysdig Platform</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374308896/Troubleshoot+Data" target="_blank">Collect troubleshooting data</a> </p></li></ol></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-KeyFeatures" title="Key Features">Key Features</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-UnderstandtheEnvironment" title="Understand the Environment">Understand the Environment</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e_id_SysdigInstallonKubernetes19-InstallSysdigPlatform" title="Install Sysdig Platform">Install Sysdig Platform</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-1107022b-89b1-4f4b-a871-cc97977d7f95" data-publication-date="" id="UUID-a546982b-6723-b0ec-4852-805feb622149"><div class="titlepage"><div><div class="title"><h6 class="title">Set up Kubernetes Environment</h6></div></div></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Prerequisites" class="bridgehead">Prerequisites</h8><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Overview" class="bridgehead">Overview</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Access to a running Kubernetes cluster 1.9+</p><p>(Note: if your environment is installed elsewhere, such as your own data center, contact Sysdig Professional Services to customize the installation instructions appropriately.)</p></li><li class="listitem"><p>Two items from your Sysdig purchase-confirmation email:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Your Sysdig license key</p></li><li class="listitem"><p>Your Sysdig <a class="link" href="http://quay.io" target="_blank">quay.io</a> pull secret</p></li></ul></div></li><li class="listitem"><p> <code class="code">kubectl</code> installed on your machine and communicating with the Kubernetes cluster</p><p>(Note that your <code class="code">kubectl</code> and Kubernetes versions should match to avoid errors.)</p></li><li class="listitem"><p>An External Load Balancer (required for production – see below)</p><p>If installing in a cloud-provider environment (such as AWS, GCloud, or Azure), you will deploy an HAProxy load balancer and point a DNS record to that load balancer.</p><p>If installing in your own data center, then you will need two DNS records, one for the collector and one for the UI.</p></li><li class="listitem"><p>A DNS server and control over a DNS name that you can point to Sysdig</p></li></ul></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-AddExternalLoadBalancer" class="bridgehead">Add External Load Balancer</h8><p>Create a TCP load balancer (i.e., AWS NLB) that forwards ports 80, 443, 6443 to the Kubernetes worker nodes, with a healthcheck to <code class="code">/healthz</code> on port 10253.</p><p>This can be done in three ways:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Use an existing external load balancer. Sysdig relies heavily on DNS; you need a DNS record pointing to the load balancer.</p></li><li class="step"><p>Create a load balancer in your cloud provider. (For example in AWS, see <a class="link" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-network-load-balancer.html" target="_blank">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-network-load-balancer.html</a>.) You need a DNS record that points to the load balancer. This is the fully qualified domain name required later in the <code class="code">config.yaml, api-ingress.yaml</code> and/or <code class="code">api-ingress-with-secure.yaml</code>.</p></li><li class="step"><p>Create a yaml with the following content and apply it to the sysdigcloud namespace. This automatically creates a load balancer in the cloud provider environment, with an external DNS name.</p><p>This is the fully qualified domain name required later in the <code class="code">config.yaml, api-ingress.yaml</code> and/or <code class="code">api-ingress-with-secure.yaml</code>.</p><pre class="programlisting">---
apiVersion: v1
kind: Service
metadata:
  name: haproxy-ingress-lb-service
spec:
  type: LoadBalancer
  ports:
  - name: http
    port: 80
    targetPort: 80
  - name: https
    port: 443
    targetPort: 443
  - name: https2
    port: 6443
    targetPort: 6443
  selector:
    run: haproxy-ingress</pre></li><li class="step"><p>To get the DNS name, run the command:</p><pre class="programlisting">$ kubectl get svc -o wide -n sysdigcloud</pre><p>The output shows the External-IP (DNS name):</p><pre class="programlisting">NAME                         TYPE           CLUSTER-IP       EXTERNAL-IP                           PORT(S)                                        AGE       SELECTOR
haproxy-ingress-lb-service   LoadBalancer   100.66.118.183  sample123.us-east-1.elb.amazonaws.com  80:31688/TCP,443:32324/TCP,6443:30668/TCP      1d        run=haproxy-ingress</pre></li></ol></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-DNSEntryForTestEnvironmentswithoutLoadBalancer" class="bridgehead">DNS Entry (For Test Environments without Load Balancer)</h8><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>Not for production environments.</p></div><p>Create a DNS entry for your Sysdig install using the fully qualified domain name that contains all the external IPs as A records.</p><p>This will use DNS round-robin to load balance your clients to the Kubernetes cluster.</p><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-PreparetheEnvironment" class="bridgehead">Prepare the Environment</h8><p>The install images, scripts, and other files are located in a GitHub repository:<span class="underline underline"> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes.git" target="_blank">https://github.com/draios/sysdigcloud-kubernetes</a> </span> </p><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step1ClonetheSourceFilesintoaNewNamespace" class="bridgehead">Step 1 Clone the Source Files into a New Namespace</h8><p>Sysdig provides the necessary scripts, images, and <code class="code">.yaml</code> files in a GitHub repository. The first step is to clone those files and check out the latest version. (These examples use 1765.)</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Run the command:</p><pre class="programlisting">git clone https://github.com/draios/sysdigcloud-kubernetes.git
cd sysdigcloud-kubernetes
git checkout tags/v1765</pre></li><li class="step"><p>Create a namespace called <code class="code">sysdigcloud</code>:</p><pre class="programlisting">kubectl create namespace sysdigcloud</pre></li></ol></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step2ConfigureBackendComponents" class="bridgehead">Step 2 Configure Backend Components</h8><p> <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/sysdigcloud/config.yaml" target="_blank">The ConfigMap (<code class="code">config.yaml</code>)</a> is populated with information about usernames, passwords, SSL certs, and various application-specific settings.</p><p>The steps below give the minimum edits that should be performed in a test environment.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is necessary to review and customize the entries in <code class="code">config.yaml</code> before launching in a production environment.</p><p>See Making Configuration Changes for the <code class="code">kubectl</code> format to use for post-install edits, such as <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206503992/Authentication+and+Authorization+On-Prem+Options" target="_blank">adding third party authenticators</a> like LDAP.</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Add your license key:</strong></span> </p><p>In <code class="code">config.yaml,</code> enter the key that was emailed to you in the following parameter:</p><pre class="programlisting"># Required: Sysdig Cloud license
  sysdigcloud.license: "</pre></li><li class="step"><p> <span class="bold bold"><strong>Change the super admin name and password,</strong></span> which are the super admin credentials for the entire system. See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206569685/Find+the+Super+Admin+Credentials+and+API+Token" target="_blank">here</a> for details.</p><p>Find the settings in <code class="code">config.yaml</code> here:</p><pre class="programlisting"> sysdigcloud.default.user: test@sysdig.com
  # Required: Sysdig Cloud super admin user password
  # NOTE: Change upon first login
  sysdigcloud.default.user.password: test</pre></li><li class="step"><p> <span class="bold bold"><strong>Edit the collector endpoint and api-url:</strong></span>Change the defaults (<code class="code">sysdigcloud-collector</code> and <code class="code">sysdigcloud-api:443)</code> to point to the DNS name you have established for Sysdig.</p><p>Note: The collector port should remain 6443.</p><pre class="programlisting">collector.endpoint: &lt;DNS_NAME&gt;
collector.port: "6443"
api.url: https://&lt;DNS_NAME&gt;:443</pre></li><li class="step"><p> <span class="bold bold"><strong>Recommended: edit the file to set the JVM options</strong></span> for Cassandra, Elasticsearch, and API, worker, and collector as well.</p><p>(To use the AWS implicit key, edit the JVM options as described in <a class="link" href="33836-17746-administration-settings.html#UUID-71bafabd-2efa-0f8a-1555-3d7b1eafe183" title="AWS: Integrate AWS Account and CloudWatch Metrics (Optional)">AWS: Integrate AWS Account and CloudWatch Metrics (Optional)</a>.)</p><p>For installations over 100 agents, it is recommended to allocate 8 GB per JVM.</p><pre class="programlisting">  cassandra.jvm.options: "-Xms8G -Xmx8G"
  elasticsearch.jvm.options: "-Xms8G -Xmx8G"
  sysdigcloud.jvm.api.options: "-Xms8G -Xmx8G"
  sysdigcloud.jvm.worker.options: "-Xms8G -Xmx8G"
  sysdigcloud.jvm.collector.options: "-Xms8G -Xmx8G"</pre><p> <span class="bold bold"><strong>Note: If you do not wish to use SSL between the agent and the collector, use the following settings instead: </strong></span> </p><pre class="programlisting">cassandra.jvm.options: "-Xms8G -Xmx8G"
elasticsearch.jvm.options: "-Xms8G -Xmx8G"
sysdigcloud.jvm.api.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"
sysdigcloud.jvm.worker.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"
sysdigcloud.jvm.collector.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"</pre><p>See also: <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step5SetUpSSLConnectivitytotheBackend" title="Step 5 Set Up SSL Connectivity to the Backend">Step 5 Set Up SSL Connectivity to the Backend</a>.</p></li><li class="step"><p> <span class="bold bold"><strong>Deploy the configuration map and secrets</strong></span> for all services by running the commands:</p><p> <span class="bold bold"><strong>For Sysdig Monitor: </strong></span> </p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/config.yaml</pre><p> <span class="bold bold"><strong>To add Sysdig Secure:</strong></span> </p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/scanning-secrets.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/anchore-secrets.yaml</pre></li><li class="step"><p> <span class="bold bold"><strong>Configure DNS name</strong></span> in<code class="code"> api-ingress.yaml</code> (or <code class="code">api-ingress-with-secure.yaml</code> if using Secure). (Files located in <code class="code">sysdigcloud/)</code> </p><p>Edit: <code class="code">host: &lt;EXTERNAL-DNS-NAME&gt;</code> to suit your DNS name</p></li><li class="step"><p> <span class="bold bold"><strong>Define namespace</strong></span> in <code class="code">ingress-clusterrolebinding.yaml</code>. (File located in <code class="code">sysdigcloud/ingress_controller/) Edit namespace: sysdigcloud</code> </p></li></ol></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step3Secure-OnlyEditmysql-deploymentyaml" class="bridgehead">Step 3 (Secure-Only): Edit mysql-deployment yaml</h8><p>If using Sysdig Secure :</p><p> <span class="bold bold"><strong>Edit the MySQL deployment to uncomment the MYSQL_EXTRADB_* environment variables.</strong></span> This forces mysql to create the necessary scanning database on startup.</p><p>File location: <code class="code">datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml </code> </p><pre class="programlisting"> - name: MYSQL_EXTRADB_SCANNING_DBNAME
              valueFrom:
                configMapKeyRef:
                  name: sysdigcloud-config
                  key: scanning.mysql.dbname
            - name: MYSQL_EXTRADB_SCANNING_USER
              valueFrom:
                configMapKeyRef:
                  name: sysdigcloud-config
                  key: scanning.mysql.user
            - name: MYSQL_EXTRADB_SCANNING_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: sysdigcloud-scanning
                  key: scanning.mysql.password
</pre><p> <code class="code"></code> </p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>The scanning service will not start unless MySQL creates the scanning database.</p></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step4DeployYourQuayPullSecret" class="bridgehead">Step 4 Deploy Your Quay Pull Secret</h8><p>A specific Quay pull secret is sent via email with your license key.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Edit the file <code class="code">sysdigcloud/pull-secret.yaml</code> and change the place holder <code class="code">&lt;PULL_SECRET&gt;</code> with the provided pull secret.</p></li><li class="step"><p>Deploy the pull secret object:</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/pull-secret.yaml</pre></li></ol></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step5SetUpSSLConnectivitytotheBackend" class="bridgehead">Step 5 Set Up SSL Connectivity to the Backend</h8><p>SSL-secured communication is used between user browsers and the Sysdig API server(s), and between the Sysdig agent and the collectors.</p><p>To set this up, you must:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use existing standard certs for API and collector, or</p></li><li class="listitem"><p>Create self-signed certificates and keys for API and collector</p></li></ul></div><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-TodisableSSLbetweenagentandcollector" class="bridgehead">To disable SSL between agent and collector:</h8><p>To disable SSL between agent and collectors, you <a class="link" href="">set a JVM option when configuring backend components</a>.</p><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Tocreateself-signedcerts" class="bridgehead">To create self-signed certs:</h8><p>Run these commands (edit to add your <code class="code">API_DNS_NAME </code>and <code class="code">COLLECTOR_DNS_NAME</code>):</p><pre class="programlisting">openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -subj "/C=US/ST=CA/L=SanFrancisco/O=ICT/CN=&lt;API_DNS_NAME&gt;" -keyout server.key -out server.crt
openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -subj "/C=US/ST=CA/L=SanFrancisco/O=ICT/CN=&lt;COLLECTOR_DNS_NAME&gt;" -keyout collector.key -out collector.crt</pre><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-TocreateKubernetessecrets" class="bridgehead">To create Kubernetes secrets:</h8><p>Uses two different certificates, one for the API/UI, and one for the collector.</p><p>Run these commands:</p><pre class="programlisting">kubectl -n sysdigcloud create secret tls sysdigcloud-ssl-secret --cert=server.crt --key=server.key
kubectl -n sysdigcloud create secret tls sysdigcloud-ssl-secret-collector --cert=collector.crt --key=collector.key</pre><h8 id="UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step6OptionalUseCACertsforExternalSSLConnections" class="bridgehead">Step 6 (Optional) Use CA Certs for External SSL Connections</h8><p>The Sysdig platform may sometimes open connections over SSL to certain external services, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP over SSL</p></li><li class="listitem"><p>SAML over SSL</p></li><li class="listitem"><p>OpenID Connect over SSL</p></li><li class="listitem"><p>HTTPS Proxies</p></li></ul></div><p>If the signing authorities for the certificates presented by these services are not well-known to the Sysdig Platform (e.g., if you maintain your own Certificate Authority), they are not trusted by default.</p><p>To allow the Sysdig platform to trust these certificates, use the command below to upload one or more PEM-format CA certificates. You must ensure you've uploaded all certificates in the CA approval chain to the root CA.</p><pre class="programlisting">kubectl -n sysdigcloud create secret generic sysdigcloud-java-certs --from-file=certs1.crt --from-file=certs2.crt </pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Prerequisites" title="Prerequisites">Prerequisites </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Overview" title="Overview">Overview</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-AddExternalLoadBalancer" title="Add External Load Balancer">Add External Load Balancer</a> </p></li><li class="listitem"><p> DNS Entry (For Test Environments without Load Balancer)  </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-PreparetheEnvironment" title="Prepare the Environment">Prepare the Environment</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step1ClonetheSourceFilesintoaNewNamespace" title="Step 1 Clone the Source Files into a New Namespace">Step 1 Clone the Source Files into a New Namespace </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step2ConfigureBackendComponents" title="Step 2 Configure Backend Components">Step 2 Configure Backend Components</a> </p></li><li class="listitem"><p> Step 3 (Secure-Only): Edit mysql-deployment yaml  </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step4DeployYourQuayPullSecret" title="Step 4 Deploy Your Quay Pull Secret">Step 4 Deploy Your Quay Pull Secret </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Step5SetUpSSLConnectivitytotheBackend" title="Step 5 Set Up SSL Connectivity to the Backend">Step 5 Set Up SSL Connectivity to the Backend </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-TodisableSSLbetweenagentandcollector" title="To disable SSL between agent and collector:">To disable SSL between agent and collector:</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-Tocreateself-signedcerts" title="To create self-signed certs:">To create self-signed certs: </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a546982b-6723-b0ec-4852-805feb622149_id_SetupKubernetesEnvironment-TocreateKubernetessecrets" title="To create Kubernetes secrets:">To create Kubernetes secrets:</a> </p></li></ul></div></li><li class="listitem"><p> Step 6 (Optional) Use CA Certs for External SSL Connections  </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-4f32da48-160a-ef57-fd4a-c1353fcfc5f5" data-publication-date="" id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7"><div class="titlepage"><div><div class="title"><h6 class="title">Install Components on Kubernetes</h6></div></div></div><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-ConfigureStorageClass" class="bridgehead">Configure Storage Class</h8><p>If you are using EKS or GKE, default storage classes are provided; check for them in step 1.</p><p>In other environments, you may need to create a storage class (step 2).</p><p>Finally, enter the storageClassName in the appropriate <code class="code">.yaml</code> files, as detailed in step 3.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Verify whether a storage class has been created, by running the command:</p><pre class="programlisting">kubectl get storageclass</pre></li><li class="step"><p>If no storage class has been defined, create a manifest for one, and then deploy it.</p><p>For example, a manifest could be named <code class="code">sysdigcloud-storageclass.yaml </code>and contain the following contents (for a storage class using GP2 volumes in AWS):</p><pre class="programlisting">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: gp2
  annotations:
    storageclass.beta.kubernetes.io/is-default-class: "true"
  labels:
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: EnsureExists
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp2</pre><p>Now run the command:</p><pre class="programlisting">kubectl apply -f sysdigcloud-storageclass.yaml </pre></li><li class="step"><p>Using either the existing storage class name from step 1, or the storage class name defined in step 2, edit the <code class="code">storageClassName</code> in the following .<code class="code">yaml</code> files:</p><p> <span class="bold bold"><strong>For Monitor:</strong></span> </p><pre class="programlisting">datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml
datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml
datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml</pre><p> <span class="bold bold"><strong>With Secure: </strong></span> </p><pre class="programlisting">datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre></li></ol></div><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-InstallDatastoresandBackendComponents" class="bridgehead">Install Datastores and Backend Components</h8><p> <span class="bold bold"><strong>For Sysdig Monitor</strong></span> </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the datastore statefulsets for Elasticsearch and Cassandra. Elasticsearch and Cassandra are automatically set up with <span class="bold bold"><strong> <code class="code">--replica=3</code> </strong></span> generating full clusters.</p><pre class="programlisting">kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-service.yaml
kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml
kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-service.yaml
kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml</pre><pre class="programlisting"></pre></li><li class="step"><p>Create the database and caching systems: MySQL, and Redis.</p><pre class="programlisting">kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml
kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/redis/redis-deployment.yaml</pre><p> <span class="bold bold"><strong>To add Sysdig Secure: </strong></span>Create the PostgreSQL database:</p><pre class="programlisting">kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-service.yaml
kubectl -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre></li><li class="step"><p>Wait until datastore pods are in <code class="code">ready</code> state:</p><p>Run the command:</p><pre class="programlisting">kubectl -n sysdigcloud get pods</pre><p>Then look in the READY column to ensure all pods are ready. For example, displaying a 1/1 means 1 of 1 pods is ready</p><p>Then deploy the backend deployment sets (worker, collector, and API).</p><p>Pause for 60 seconds after creating the API deployment.</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/api-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/collector-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/worker-deployment.yaml</pre></li><li class="step"><p>Create the service for the api and collector<code class="code">:</code> </p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/api-headless-service.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/collector-headless-service.yaml</pre><p>If you are installing Sysdig Monitor only, skip to <a class="link" href="">Sysdig Install with Kubernetes 1.9+#Configure Access for Connectivity to the Cluster</a>.</p><p> <span class="bold bold"><strong>For Sysdig Secure</strong></span> </p></li><li class="step"><p>Create <code class="code">anchore-engine</code> deployments and service (used in scanning):</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/anchore-service.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/anchore-core-config.yaml 
kubectl -n sysdigcloud apply -f sysdigcloud/anchore-core-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/anchore-worker-config.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/anchore-worker-deployment.yaml</pre><p>Wait 60 seconds to ensure the core-deployment is in <code class="code">Running</code> status, then deploy the rest of the Secure-related yamls:</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/scanning-api-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/scanning-alertmgr-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/scanning-service.yaml</pre></li></ol></div><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-ConnectingtotheCluster" class="bridgehead">Connecting to the Cluster</h8><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-GCloudGKEOnlyAddCluster-AdmintoUser" class="bridgehead">GCloud/GKE Only: Add Cluster-Admin to User</h8><pre class="programlisting">kubectl create clusterrolebinding cluster-admin-binding --clusterrole cluster-admin --user $(gcloud config get-value account)</pre><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-AddIngressController" class="bridgehead">Add Ingress Controller</h8><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-SysdigMonitor" class="bridgehead">Sysdig Monitor</h8><p>To permit incoming connections to the Sysdig API and collector, deploy the following <code class="code">ingress</code> yamls.</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-clusterrole.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-clusterrolebinding.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-role.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-rolebinding.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-serviceaccount.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/default-backend-service.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/default-backend-deployment.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-configmap.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-tcp-services-configmap.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/ingress_controller/ingress-daemonset.yaml
kubectl -n sysdigcloud apply -f sysdigcloud/api-ingress.yaml</pre><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-SysdigSecure" class="bridgehead">Sysdig Secure</h8><p>If you are installing Sysdig Monitor and Secure, <span class="bold bold"><strong>replace</strong></span> the <code class="code">api-ingress.yaml</code> with the following line:</p><pre class="programlisting">kubectl -n sysdigcloud apply -f sysdigcloud/api-ingress-with-secure.yaml</pre><p>There are two ways to change the original installation parameters:</p><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-MakingConfigurationChanges" class="bridgehead">Making Configuration Changes</h8><p>There are two ways to change the original installation parameters:</p><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-Option1EdittheConfigmap" class="bridgehead">Option 1 Edit the Configmap</h8><p>Run the following command:</p><pre class="programlisting">kubectl edit configmap/sysdigcloud-config --namespace sysdigcloud</pre><p>A text editor is presented with the configmap to be edited. Enter parameters as needed, then save and quit.</p><p>Perform the <a class="link" href="">Sysdig Install with Kubernetes 1.9+#Required Restart</a>.</p><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-Option2OverwritetheConfigmap" class="bridgehead">Option 2 Overwrite the Configmap</h8><p>If the configmap is edited on the client side (for example, to keep it synced in a git repository), it can be overridden with the following command:</p><pre class="programlisting">kubectl replace -f sysdigcloud/config.yaml --namespace sysdigcloud</pre><p>When completed, perform the <a class="link" href="">Sysdig Install with Kubernetes 1.9+#Required Restart</a>.</p><h8 id="UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-RestartConfigmap" class="bridgehead">Restart Configmap</h8><p>After updating the configmap, the Sysdig components must be restarted for the changed parameters to take effect. This can be done by forcing a rolling update of the deployments.</p><p>A possible way to do so is to change something innocuous, which forces a rolling update. E.g.:</p><pre class="programlisting">oc -n sysdigcloud patch deployment [deploymnet] -p \
 "{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"$(date +'%s')\"}}}}}"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-ConfigureStorageClass" title="Configure Storage Class">Configure Storage Class</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-InstallDatastoresandBackendComponents" title="Install Datastores and Backend Components">Install Datastores and Backend Components </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-ConnectingtotheCluster" title="Connecting to the Cluster">Connecting to the Cluster </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-GCloudGKEOnlyAddCluster-AdmintoUser" title="GCloud/GKE Only: Add Cluster-Admin to User">GCloud/GKE Only: Add Cluster-Admin to User</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-AddIngressController" title="Add Ingress Controller">Add Ingress Controller </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-SysdigMonitor" title="Sysdig Monitor">Sysdig Monitor</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-SysdigSecure" title="Sysdig Secure">Sysdig Secure</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-MakingConfigurationChanges" title="Making Configuration Changes">Making Configuration Changes</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-Option1EdittheConfigmap" title="Option 1 Edit the Configmap">Option 1 Edit the Configmap</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-Option2OverwritetheConfigmap" title="Option 2 Overwrite the Configmap">Option 2 Overwrite the Configmap</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1bfe2c64-0859-4cf3-f619-50903254f7b7_id_InstallComponentsonKubernetes-RestartConfigmap" title="Restart Configmap">Restart Configmap</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-70740cd5-3cb9-864f-32c7-852da047e5dc" data-publication-date="" id="UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df"><div class="titlepage"><div><div class="title"><h6 class="title">Access Sysdig Platform</h6></div></div></div><h8 id="UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-AccesstheSysdigPlatformFrontEnd" class="bridgehead">Access the Sysdig Platform Front End</h8><p>Point your browser to the DNS name you defined.</p><h8 id="UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-LogInasSuperAdmin" class="bridgehead">Log In as Super Admin</h8><p>You are directed to log in with the admin credentials you set in the <code class="code">config.yaml</code> (see Step 2).</p><p>Then the Sysdig Welcome Wizard guides you to installing your first Sysdig agent.</p><h8 id="UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-InstallinganAgent" class="bridgehead">Installing an Agent</h8><p>The Welcome Wizard should be populated with install parameters from your environment (access key, collector name, and collector port.)</p><p>For example:</p><pre class="programlisting">{docker run -d --name sysdig-agent --restart always --privileged --net host --pid host -e ACCESS_KEY=xxxxxxxxxx -e COLLECTOR=abc.us-west.elb.amazonaws.com -e COLLECTOR_PORT=6443 -e CHECK_CERTIFICATE=false -e TAGS=example_tag:example_value -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro --shm-size=350m sysdig/agent</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-AccesstheSysdigPlatformFrontEnd" title="Access the Sysdig Platform Front End">Access the Sysdig Platform Front End </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-LogInasSuperAdmin" title="Log In as Super Admin">Log In as Super Admin </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-bc97081a-02ce-9a8f-7c00-0cad146e29df_id_AccessSysdigPlatform-InstallinganAgent" title="Installing an Agent">Installing an Agent </a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-06de1d81-a3f3-cf76-55d6-8586bb22a1ad" data-publication-date="" id="UUID-2bdc2004-9474-7d83-e11d-eb18fdb8cdea"><div class="titlepage"><div><div class="title"><h6 class="title">Troubleshoot Data</h6></div></div></div><p>When experiencing issues, you can collect troubleshooting data that can help the support team. The data can be collected by hand, or Sysdig provides a very simple <code class="code">get_support_bundle.sh</code> script that takes as an argument the namespace where Sysdig is deployed and generates a tarball containing some information (mostly log files). The script is located in the GitHub repository: <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes.git" target="_blank">https://github.com/draios/sysdigcloud-kubernetes</a>.</p><p>(See also Get Help | Using Sysdig Support (On-Prem).)</p><pre class="programlisting">$ ./scripts/get_support_bundle.sh sysdigcloud
Getting support logs for sysdigcloud-api-1477528018-4od59
Getting support logs for sysdigcloud-api-1477528018-ach89
Getting support logs for sysdigcloud-cassandra-2987866586-fgcm8
Getting support logs for sysdigcloud-collector-2526360198-e58uy
Getting support logs for sysdigcloud-collector-2526360198-v1egg
Getting support logs for sysdigcloud-mysql-2388886613-a8a12
Getting support logs for sysdigcloud-redis-1701952711-ezg8q
Getting support logs for sysdigcloud-worker-1086626503-4cio9
Getting support logs for sysdigcloud-worker-1086626503-sdtrc
Support bundle generated: 1473897425_sysdig_cloud_support_bundle.tgz</pre><pre class="programlisting"></pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-4af994c0-7549-3b20-26e5-5f88049bfd1d" data-publication-date="" id="UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23"><div class="titlepage"><div><div class="title"><h6 class="title">Sysdig Install on OpenShift (v1929+)</h6></div></div></div><p>This section describes how to install the backend components of the Sysdig platform using an existing OpenShift cluster. It applies to backend versions 1929 and higher.</p><h6 id="UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23_id_SysdigInstallonOpenShiftv1929-UnderstandtheInfrastructure" class="bridgehead">Understand the Infrastructure</h6><p>The Sysdig platform includes both Sysdig Monitor and Sysdig Secure, which are licensed separately. All installations include Sysdig Monitor, while some of the Secure components are installed and configured as additional steps within the overall installation process.</p><p>When installing the Sysdig platform on OpenShift, you will install each backend component with separate <code class="code">oc</code> commands.</p><h6 id="UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23_id_SysdigInstallonOpenShiftv1929-InstallSysdigPlatform" class="bridgehead">Install Sysdig Platform</h6><p>To install Sysdig Platform on OpenShift v1929 and above:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374440143/Set+up+OpenShift+Environment" target="_blank">Prepare the environment</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374505531/Install+Components+on+OpenShift" target="_blank">Install the components</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374374674/Access+the+Sysdig+Platform" target="_blank">Access Sysdig Platform</a> </p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/374407338/Collect+Troubleshooting+Data" target="_blank">Collect troubleshooting data</a> </p></li></ol></div><pre class="programlisting"></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Understand the Infrastructure  </p></li><li class="listitem"><p> Install Sysdig Platform </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-28609975-8b4b-9368-1ae3-da55e455c659" data-publication-date="" id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a"><div class="titlepage"><div><div class="title"><h6 class="title">Set up OpenShift Environment</h6></div></div></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Prerequisites" class="bridgehead">Prerequisites</h8><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Overview" class="bridgehead">Overview</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Access to a running OpenShift 3.11+ instance</p></li><li class="listitem"><p>Two items from your Sysdig purchase-confirmation email:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Your Sysdig license key</p></li><li class="listitem"><p>Your Sysdig <a class="link" href="http://quay.io" target="_blank">quay.io</a> pull secret</p></li></ul></div></li><li class="listitem"><p> <code class="code">octools</code> installed on your machine and communicating with the OpenShift cluster. (Note that your <code class="code">oc</code> and OpenShift versions should match to avoid errors.)</p></li></ul></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-DNSPreparation" class="bridgehead">DNS Preparation</h8><p>If you want more information on OpenShift's DNS requirements; see the OpenShift <a class="link" href="">documentation</a>.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Option1DNSwithoutWildcard" class="bridgehead">Option 1: DNS without Wildcard</h8><p>You need to request two different DNS records from your DNS team: one for the Sysdig API/UI and another for the Sysdig collector. These records should point to your infrastructure nodes and are the two routes that will be exposed, i.e., <code class="code"> <a class="link" href="http://sysdig.api.example.com" target="_blank">sysdig.api.example.com</a> </code> and <code class="code"> <a class="link" href="http://sysdig.collector.example.com" target="_blank">sysdig.collector.example.com</a> </code>.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Option2DNSwithWildcard" class="bridgehead">Option 2: DNS with Wildcard</h8><p>With wildcard DNS, you do not have to make an official request from the DNS team. Your implementation team can pick any two DNS names to use for the API/UI and Collector. These will be exposed to the infrastructure nodes once the configuration is completed. (i.e. <code class="code"> <a class="link" href="http://sysdig.api.example.com" target="_blank">sysdig.api.example.com</a> </code> and <code class="code"> <a class="link" href="http://sysdig.collector.example.com" target="_blank">sysdig.collector.example.com</a> </code>.)</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLCertificatePreparation" class="bridgehead">SSL Certificate Preparation</h8><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step5SetUpSSLConnectivitytotheBackend" title="Step 5 Set Up SSL Connectivity to the Backend">Step 5 Set Up SSL Connectivity to the Backend</a> discusses how to implement SSL; decide ahead of time whether you will use SSL with wildcard or without.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLwithWildcard" class="bridgehead">SSL with Wildcard</h8><p>With wildcard SSL, you use the same certificate for both the API and the collector.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLwithoutWildcard" class="bridgehead">SSL without Wildcard</h8><p>You need two SSL certs, one for each DNS record.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-PreparetheEnvironment" class="bridgehead">Prepare the Environment</h8><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step1DownloadandUnpacktheLatestRelease" class="bridgehead">Step 1 Download and Unpack the Latest Release</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Download the latest release from <span class="underline underline"> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/latest" target="_blank">https://github.com/draios/sysdigcloud-kubernetes/releases/latest</a> </span> </p></li><li class="step"><p>Unpack the .tar ball.</p><p>The source link has the format: <code class="code">https://github.com/draios/sysdigcloud-kubernetes/archive/&lt;v1234&gt;.tar.gz. </code>To unpack it, run the following commands (replacing version number as appropriate):</p><pre class="programlisting">wget https://github.com/draios/sysdigcloud-kubernetes/archive/&lt;v1234&gt;.tar.gz
tar zxf &lt;v1234&gt;.tar.gz
cd sysdigcloud-kubernetes-&lt;1234&gt;</pre></li><li class="step"><p>Create a new project called <code class="code">sysdigcloud</code> and copy the cloned folders into it:</p><pre class="programlisting">oc new-project sysdigcloud</pre></li><li class="step"><p>Apply the correct security contexts to the namespace. (This allows you to run privileged containers in the sysdigcloud namespace)</p><pre class="programlisting">oc adm policy add-scc-to-user anyuid -n sysdigcloud -z default
oc adm policy add-scc-to-user privileged -n sysdigcloud -z default</pre></li></ol></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step2ConfigureBackendComponents" class="bridgehead">Step 2 Configure Backend Components</h8><p> <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/sysdigcloud/config.yaml" target="_blank">The ConfigMap (<code class="code">config.yaml</code>)</a> is populated with information about usernames, passwords, SSL certs, and various application-specific settings.</p><p>The steps below give the minimum edits that should be performed in a test environment.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is necessary to review and customize the entries in <code class="code">config.yaml</code> before launching in a production environment.</p><p>See <a class="link" href="">Sysdig Install on OpenShift (v. 1929+)#Making Configuration Changes</a> for the <code class="code">oc</code> format to use for post-install edits, such as <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206503992/Authentication+and+Authorization+On-Prem+Options" target="_blank">adding third-party authenticators</a> like LDAP.</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Add your license key:</strong></span> </p><p>In <code class="code">config.yaml,</code> enter the key that was emailed to you in the following parameter:</p><pre class="programlisting"># Required: Sysdig Cloud license
  sysdigcloud.license: ""</pre></li><li class="step"><p> <span class="bold bold"><strong>Change the super admin name and password,</strong></span> which are the super admin credentials for the entire system. See <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206569685/Find+the+Super+Admin+Credentials+and+API+Token" target="_blank">here</a> for details.</p><p>Find the settings in <code class="code">config.yaml</code> here:</p><pre class="programlisting"> sysdigcloud.default.user: test@sysdig.com
  # Required: Sysdig Cloud super admin user password
  # NOTE: Change upon first login
  sysdigcloud.default.user.password: test</pre></li><li class="step"><p> <span class="bold bold"><strong>Edit the collector endpoint and API URL:</strong></span>Change the placeholder to point to the DNS names you have established for Sysdig.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Remember that you must have defined one name for the collector and another for the API URL. See <a class="link" href="">Sysdig Install on OpenShift (v. 1929+)#Prerequisites</a>, above.</p></div><p>Note: Change the collector port to 443.</p><pre class="programlisting">collector.endpoint: &lt;COLLECTOR_DNS_NAME&gt;
collector.port: "443"
api.url: https://&lt;API_DNS_NAME&gt;:443</pre></li><li class="step"><p> <span class="bold bold"><strong>Recommended: edit the file to set the JVM options</strong></span> for Cassandra, Elasticsearch, and API, worker, and collector as well.</p><p>(To use the AWS implicit key, edit the JVM options as described in <a class="link" href="33836-17746-administration-settings.html#UUID-71bafabd-2efa-0f8a-1555-3d7b1eafe183" title="AWS: Integrate AWS Account and CloudWatch Metrics (Optional)">AWS: Integrate AWS Account and CloudWatch Metrics (Optional)</a>.)</p><p>For installations over 100 agents, it is recommended to allocate 8 GB of heap per JVM.</p><pre class="programlisting">  cassandra.jvm.options: "-Xms8G -Xmx8G"
  elasticsearch.jvm.options: "-Xms8G -Xmx8G"
  sysdigcloud.jvm.api.options: "-Xms4G -Xmx8G"
  sysdigcloud.jvm.worker.options: "-Xms4G -Xmx8G"
  sysdigcloud.jvm.collector.options: "-Xms4G -Xmx8G"</pre><p> <span class="bold bold"><strong>Note: If you do not wish to use SSL between the agent and the collector, use the following settings instead: </strong></span> </p><pre class="programlisting">cassandra.jvm.options: "-Xms8G -Xmx8G"
elasticsearch.jvm.options: "-Xms8G -Xmx8G"
sysdigcloud.jvm.api.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"
sysdigcloud.jvm.worker.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"
sysdigcloud.jvm.collector.options: "-Xms8G -Xmx8G -Ddraios.agents.installParams.sslEnabled=false"</pre></li><li class="step"><p> <span class="bold bold"><strong>Deploy the configuration maps and secrets</strong></span> for all services by running the commands:</p><p> <span class="bold bold"><strong>For Sysdig Monitor: </strong></span> </p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/config.yaml</pre></li><li class="step"><p> <span class="bold bold"><strong>(For Sysdig Secure only) Edit and apply secrets for Anchore and the scanning component:</strong></span>Edit the<code class="code">yaml</code> files<code class="code">:</code> </p><p> <code class="code">scanning-secrets.yaml</code> </p><pre class="programlisting">stringData:
  scanning.mysql.password: change_me</pre><p> <code class="code">anchore-secrets yaml</code> </p><pre class="programlisting">stringData:
  anchore.admin.password: change_me
  anchore.db.password: change_me</pre><p>Then apply the files:</p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/scanning-secrets.yaml
oc -n sysdigcloud apply -f sysdigcloud/anchore-secrets.yaml</pre></li><li class="step"><p> <span class="bold bold"><strong>Edit the API DNS name</strong></span> in either <code class="code">api-ingress.yaml</code> or <code class="code">api-ingress-with-secure.yaml</code> (if using Secure).</p><p>The files are located in <code class="code">sysdigcloud/</code> </p><pre class="programlisting"> spec:
   rules:
     - host: &lt;API_DNS_NAME&gt;
...

 tls:
     - hosts:
         - &lt;API_DNS_NAME&gt;
       secretName: sysdigcloud-ssl-secret</pre></li><li class="step"><p> <span class="bold bold"><strong>Edit the collector DNS name in the file </strong></span> <code class="code">openshift-collector-router.yaml</code>. Use the collector DNS name you created in the Prerequisites.</p><p>The file is located in <code class="code">sysdigcloud/openshift/</code>.</p><pre class="programlisting">spec:
  host: &lt;COLLECTOR_DNS_NAME&gt;</pre></li></ol></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step3Secure-OnlyEditmysql-deploymentyaml" class="bridgehead">Step 3 (Secure-Only): Edit mysql-deployment.yaml</h8><p>If using Sysdig Secure :</p><p> <span class="bold bold"><strong>Edit the MySQL deployment to uncomment the MYSQL_EXTRADB_* environment variables.</strong></span> This forces MySQL to create the necessary scanning database on startup.</p><p>File location: <code class="code">datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml </code> </p><pre class="programlisting"> - name: MYSQL_EXTRADB_SCANNING_DBNAME
              valueFrom:
                configMapKeyRef:
                  name: sysdigcloud-config
                  key: scanning.mysql.dbname
            - name: MYSQL_EXTRADB_SCANNING_USER
              valueFrom:
                configMapKeyRef:
                  name: sysdigcloud-config
                  key: scanning.mysql.user
            - name: MYSQL_EXTRADB_SCANNING_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: sysdigcloud-scanning
                  key: scanning.mysql.password
</pre><p> <code class="code"></code> </p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>The scanning service will not start unless MySQL creates the scanning database.</p></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step4DeployYourQuayPullSecret" class="bridgehead">Step 4 Deploy Your Quay Pull Secret</h8><p>A specific Quay pull secret is sent via email with your license key.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Edit the file <code class="code">sysdigcloud/pull-secret.yaml</code> </strong></span> and change the place holder <code class="code">&lt;PULL_SECRET&gt;</code> with the provided pull secret.</p><pre class="programlisting">vi sysdigcloud/pull-secret.yaml
 
    ---
    apiVersion: v1
    kind: Secret
    metadata:
    name: sysdigcloud-pull-secret
    data:
    .dockerconfigjson: &lt;PULL_SECRET&gt;
    type: kubernetes.io/dockerconfigjson</pre></li><li class="step"><p> <span class="bold bold"><strong>Deploy the pull secret object:</strong></span> </p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/pull-secret.yaml</pre></li></ol></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step5SetUpSSLConnectivitytotheBackend" class="bridgehead">Step 5 Set Up SSL Connectivity to the Backend</h8><p>SSL-secured communication is used between user browsers and the Sysdig API server(s), and between the Sysdig agent and the collectors.</p><p>To set this up, you must:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use an existing wildcard SSL certificate and key, or</p></li><li class="listitem"><p>Use existing standard certs for API and collector, or</p></li><li class="listitem"><p>Create self-signed certificates and keys for API and collector</p></li></ul></div><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>If you are not using wildcard SSL, you have to use two separate certificates, one for API URL and one for the collector.</p></div><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-TodisableSSLbetweenagentandcollector" class="bridgehead">To disable SSL between agent and collector:</h8><p>To disable SSL between agent and collectors, you <a class="link" href="">set a JVM option when configuring backend components</a>.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Tocreateself-signedcerts" class="bridgehead">To create self-signed certs:</h8><p>Run these commands (edit to add your <code class="code">API_DNS_NAME </code>and <code class="code">COLLECTOR_DNS_NAME</code>):</p><pre class="programlisting">openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -subj "/C=US/ST=CA/L=SanFrancisco/O=ICT/CN=&lt;API_DNS_NAME&gt;" -keyout server.key -out server.crt
openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -subj "/C=US/ST=CA/L=SanFrancisco/O=ICT/CN=&lt;COLLECTOR_DNS_NAME&gt;" -keyout collector.key -out collector.crt</pre><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Touseanexistingwildcardcert" class="bridgehead">To use an existing wildcard cert:</h8><p>Obtain the respective <code class="code">server.crt</code> and <code class="code">server.key</code> files.</p><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-TocreateKubernetessecretsforthecerts" class="bridgehead">To create Kubernetes secrets for the certs:</h8><p> <span class="bold bold"><strong>With Wildcard</strong></span> </p><p>Uses the same certificate for both the API/UI and the collector.</p><p>Run these commands:</p><pre class="programlisting">oc -n sysdigcloud create secret tls sysdigcloud-ssl-secret --cert=server.crt --key=server.key
oc -n sysdigcloud create secret tls sysdigcloud-ssl-secret-collector --cert=server.crt --key=server.key</pre><p> <span class="bold bold"><strong>Without Wildcard</strong></span> </p><p>Uses two different certificates, one for the API/UI, and one for the collector.</p><p>Run these commands:</p><pre class="programlisting">oc -n sysdigcloud create secret tls sysdigcloud-ssl-secret --cert=server.crt --key=server.key
oc -n sysdigcloud create secret tls sysdigcloud-ssl-secret-collector --cert=collector.crt --key=collector.key</pre><h8 id="UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step6OptionalUseCACertsforExternalSSLConnections" class="bridgehead">Step 6 (Optional): Use CA Certs for External SSL Connections</h8><p>The Sysdig platform may sometimes open connections over SSL to certain external services, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP over SSL</p></li><li class="listitem"><p>SAML over SSL</p></li><li class="listitem"><p>OpenID Connect over SSL</p></li><li class="listitem"><p>HTTPS Proxies</p></li></ul></div><p>If the signing authorities for the certificates presented by these services are not well-known to the Sysdig Platform (e.g., if you maintain your own Certificate Authority), they are not trusted by default.</p><p>To allow the Sysdig platform to trust these certificates, use the command below to upload one or more PEM-format CA certificates. You must ensure you've uploaded all certificates in the CA approval chain to the root CA.</p><pre class="programlisting">oc -n sysdigcloud create secret generic sysdigcloud-java-certs --from-file=certs1.crt --from-file=certs2.crt </pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Prerequisites" title="Prerequisites">Prerequisites </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Overview" title="Overview">Overview</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-DNSPreparation" title="DNS Preparation">DNS Preparation </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Option1DNSwithoutWildcard" title="Option 1: DNS without Wildcard">Option 1: DNS without Wildcard</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Option2DNSwithWildcard" title="Option 2: DNS with Wildcard">Option 2: DNS with Wildcard </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLCertificatePreparation" title="SSL Certificate Preparation">SSL Certificate Preparation </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLwithWildcard" title="SSL with Wildcard">SSL with Wildcard </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-SSLwithoutWildcard" title="SSL without Wildcard">SSL without Wildcard </a> </p></li></ul></div></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-PreparetheEnvironment" title="Prepare the Environment">Prepare the Environment</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step1DownloadandUnpacktheLatestRelease" title="Step 1 Download and Unpack the Latest Release">Step 1 Download and Unpack the Latest Release </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step2ConfigureBackendComponents" title="Step 2 Configure Backend Components">Step 2 Configure Backend Components</a> </p></li><li class="listitem"><p> Step 3 (Secure-Only): Edit mysql-deployment.yaml  </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step4DeployYourQuayPullSecret" title="Step 4 Deploy Your Quay Pull Secret">Step 4 Deploy Your Quay Pull Secret </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Step5SetUpSSLConnectivitytotheBackend" title="Step 5 Set Up SSL Connectivity to the Backend">Step 5 Set Up SSL Connectivity to the Backend </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-TodisableSSLbetweenagentandcollector" title="To disable SSL between agent and collector:">To disable SSL between agent and collector:</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Tocreateself-signedcerts" title="To create self-signed certs:">To create self-signed certs: </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-Touseanexistingwildcardcert" title="To use an existing wildcard cert:">To use an existing wildcard cert: </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-a1da5f1a-9cda-5957-f96c-45ae81d84e1a_id_SetupOpenShiftEnvironment-TocreateKubernetessecretsforthecerts" title="To create Kubernetes secrets for the certs:">To create Kubernetes secrets for the certs: </a> </p></li></ul></div></li><li class="listitem"><p> Step 6 (Optional): Use CA Certs for External SSL Connections  </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-edae344e-a8c4-a23d-1ad5-3a33987b075a" data-publication-date="" id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91"><div class="titlepage"><div><div class="title"><h6 class="title">Install Components on OpenShift</h6></div></div></div><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-EditstorageClassNameParameters" class="bridgehead">Edit storageClassName Parameters</h8><p>You need a storage class; step 2 shows how to create one if needed.</p><p>Enter the storageClassName in the appropriate <code class="code">.yaml</code> files (see step 3).</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Verify whether a storage class has been created, by running the command:</p><pre class="programlisting">oc get storageclass</pre></li><li class="step"><p>If no storage class has been defined, create a manifest for one, and then deploy it.</p><p>For example, a manifest could be named <code class="code">sysdigcloud-storageclass.yaml </code>and contain the following contents (for a storage class using GP2 volumes in AWS):</p><pre class="programlisting">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: gp2
  labels:
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: EnsureExists
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp2</pre><p>Now run the command:</p><pre class="programlisting">oc apply -f sysdigcloud-storageclass.yaml </pre></li><li class="step"><p>Using either the existing storage class name from step 1, or the storage class name defined in step 2, edit the <code class="code">storageClassName</code> in the following .<code class="code">yaml</code> files:</p><p> <span class="bold bold"><strong>For Monitor:</strong></span> </p><pre class="programlisting">datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml
datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml
datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml</pre><p> <span class="bold bold"><strong>With Secure: </strong></span> </p><pre class="programlisting">datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre><p>In each file, the code snippet looks the same:</p><pre class="programlisting">volumeClaimTemplates:
 - metadata:
     name: data
   spec:
     accessModes: ["ReadWriteOnce"]
     resources:
       requests:
         storage: 50Gi
     storageClassName: &lt;STORAGECLASS_NAME&gt;</pre></li></ol></div><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-InstallDatastoresandBackendComponents" class="bridgehead">Install Datastores and Backend Components</h8><p> <span class="bold bold"><strong>For Sysdig Monitor</strong></span> </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the datastore statefulsets for Elasticsearch and Cassandra. Elasticsearch and Cassandra are automatically set up with <span class="bold bold"><strong> <code class="code">--replica=3</code> </strong></span> generating full clusters.</p><pre class="programlisting">oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-service.yaml
oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml
oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-service.yaml
oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml</pre><pre class="programlisting"></pre></li><li class="step"><p>Create the MySQL and Redis databases:</p><pre class="programlisting">oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/mysql/mysql-deployment.yaml
oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/redis/redis-deployment.yaml</pre><p> <span class="bold bold"><strong>To add Sysdig Secure: </strong></span>Create the PostgreSQL database:</p><pre class="programlisting">oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-service.yaml
oc -n sysdigcloud apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre></li><li class="step"><p>Wait until datastore pods are in <code class="code">ready</code> state, then deploy the backend deployment sets (worker, collector, and API).</p><p>Run the command:</p><pre class="programlisting">kubectl -n sysdigcloud get pods

</pre><p>Then look in the READY column to ensure all pods are ready. For example, displaying a 1/1 means 1 of 1 pods is ready</p><p>Then deploy the backend deployment sets (worker, collector, and API).</p><p>Pause for 60 seconds after creating the API deployment.</p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/api-deployment.yaml
oc -n sysdigcloud apply -f sysdigcloud/openshift/openshift-collector-deployment.yaml
oc -n sysdigcloud apply -f sysdigcloud/worker-deployment.yaml</pre></li><li class="step"><p>Create the service for the API and collector<code class="code">:</code> </p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/api-headless-service.yaml
oc -n sysdigcloud apply -f sysdigcloud/openshift/openshift-collector-service.yaml</pre><p>If you are installing Sysdig Monitor only, skip to <a class="link" href="">Sysdig Install on OpenShift (v. 1929+)#Configure Access for Connectivity to the Cluster</a>.</p><p> <span class="bold bold"><strong>For Sysdig Secure</strong></span> </p></li><li class="step"><p>Wait for the API, worker, and collector to come up before proceeding.</p><p>Then create <code class="code">anchore-engine</code> deployments and service (used in scanning):</p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/anchore-service.yaml  
oc -n sysdigcloud apply -f sysdigcloud/anchore-core-config.yaml 
oc -n sysdigcloud apply -f sysdigcloud/anchore-core-deployment.yaml
oc -n sysdigcloud apply -f sysdigcloud/anchore-worker-config.yaml
oc -n sysdigcloud apply -f sysdigcloud/anchore-worker-deployment.yaml</pre><p>Wait 60 seconds to ensure the core-deployment is in <code class="code">Running</code> status, then deploy the rest of the Secure-related yamls:</p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/scanning-api-deployment.yaml
oc -n sysdigcloud apply -f sysdigcloud/scanning-alertmgr-deployment.yaml
oc -n sysdigcloud apply -f sysdigcloud/scanning-service.yaml</pre></li></ol></div><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-ConfigureAccessforConnectivitytotheCluster" class="bridgehead">Configure Access for Connectivity to the Cluster</h8><p>Apply the appropriate ingress yaml. (The <code class="code">API_DNS</code> name was entered in step 7, in <a class="link" href="">Configure Backend Components</a>.) This configures the route to the Sysdig UI.</p><p> <span class="bold bold"><strong>For Sysdig Monitor</strong></span> </p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/api-ingress.yaml</pre><p> <span class="bold bold"><strong> <span class="bold bold"><strong>With Sysdig Secure</strong></span>:</strong></span> </p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/api-ingress-with-secure.yaml</pre><p>Configure connectivity to the collector for the agent:</p><pre class="programlisting">oc -n sysdigcloud apply -f sysdigcloud/openshift/openshift-collector-router.yaml</pre><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-MakingConfigurationChanges" class="bridgehead">Making Configuration Changes</h8><p>There are two ways to change the original installation parameters:</p><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-Option1EdittheConfigmap" class="bridgehead">Option 1 Edit the Configmap</h8><p>Run the following command:</p><pre class="programlisting">oc -n sysdigcloud edit configmap/sysdigcloud-config</pre><p>A text editor is presented with the configmap to be edited. Enter parameters as needed, then save and quit.</p><p>Perform the <a class="link" href="">Sysdig Install on OpenShift (v. 1929+)#Required Restart</a>.</p><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-Option2OverwritetheConfigmap" class="bridgehead">Option 2 Overwrite the Configmap</h8><p>If the configmap is edited on the client side (for example, to keep it synced in a git repository), it can be overridden with the following command:</p><pre class="programlisting">oc -n sysdigcloud replace -f sysdigcloud/config.yaml </pre><p>When completed, perform the <a class="link" href="">Sysdig Install on OpenShift (v. 1929+)#Required Restart</a>.</p><h8 id="UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-RequiredRestart" class="bridgehead">Required Restart</h8><p>After updating the configmap, the Sysdig components must be restarted for the changed parameters to take effect. This can be done by forcing a rolling update of the deployments.</p><p>A possible way to do so is to change something innocuous, which forces a rolling update. E.g.:</p><pre class="programlisting">oc -n sysdigcloud patch deployment [deploymnet] -p \
 "{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"$(date +'%s')\"}}}}}"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-EditstorageClassNameParameters" title="Edit storageClassName Parameters">Edit storageClassName Parameters</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-InstallDatastoresandBackendComponents" title="Install Datastores and Backend Components">Install Datastores and Backend Components </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-ConfigureAccessforConnectivitytotheCluster" title="Configure Access for Connectivity to the Cluster">Configure Access for Connectivity to the Cluster </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-MakingConfigurationChanges" title="Making Configuration Changes">Making Configuration Changes</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-Option1EdittheConfigmap" title="Option 1 Edit the Configmap">Option 1 Edit the Configmap</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-Option2OverwritetheConfigmap" title="Option 2 Overwrite the Configmap">Option 2 Overwrite the Configmap</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c1d496d6-e2fe-d048-daff-7adc6ed5ab91_id_InstallComponentsonOpenShift-RequiredRestart" title="Required Restart">Required Restart</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-4f1d0280-f48e-6d0a-107f-cd5c211373d6" data-publication-date="" id="UUID-213eedfb-678c-db63-ed03-f02717d842c8"><div class="titlepage"><div><div class="title"><h6 class="title">Access the Sysdig Platform</h6></div></div></div><h8 id="UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-AccesstheSysdigPlatformFrontEnd" class="bridgehead">Access the Sysdig Platform Front End</h8><p>Point your browser to <code class="code"> <a class="link" href="https://API_DNS_NAME" target="_blank">https://API_DNS_NAME</a>.</code> </p><h8 id="UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-LogInasSuperAdmin" class="bridgehead">Log In as Super Admin</h8><p>You are directed to log in with the admin credentials you set in the <code class="code">config.yaml</code> (see Step 2).</p><p>Then the Sysdig Welcome Wizard guides you to installing your first Sysdig agent.</p><h8 id="UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-InstallingtheFirstAgent" class="bridgehead">Installing the First Agent</h8><p>The Welcome Wizard should be populated with install parameters from your environment (access key, collector name, and collector port.)</p><p>See complete instructions here if needed: <a class="link" href="33836-17701-sysdig-agent.html#UUID-6f641869-8d58-7abc-f51d-a605825eeef7" title="OpenShift Agent Installation Steps">OpenShift Agent Installation Steps</a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-AccesstheSysdigPlatformFrontEnd" title="Access the Sysdig Platform Front End">Access the Sysdig Platform Front End </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-LogInasSuperAdmin" title="Log In as Super Admin">Log In as Super Admin </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-213eedfb-678c-db63-ed03-f02717d842c8_id_AccesstheSysdigPlatform-InstallingtheFirstAgent" title="Installing the First Agent">Installing the First Agent </a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-19280042-3987-0da7-e709-13868082ce4e" data-publication-date="" id="UUID-2444ac54-bc87-01aa-9f80-19fe8d8ff5ab"><div class="titlepage"><div><div class="title"><h6 class="title">Collect Troubleshooting Data</h6></div></div></div><p>When experiencing issues, you can collect troubleshooting data that can help the support team. The data can be collected by hand, or Sysdig provides a very simple <code class="code">get_support_bundle.sh</code> script that takes as an argument the namespace where Sysdig is deployed and will generate a tarball containing some information (mostly log files). The script is located in the GitHub repository: <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes.git" target="_blank">https://github.com/draios/sysdigcloud-kubernetes</a>. (See also Get Help | Using Sysdig Support (On-Prem).)</p><pre class="programlisting">$ ./scripts/get_support_bundle.sh sysdigcloud
Getting support logs for sysdigcloud-api-1477528018-4od59
Getting support logs for sysdigcloud-api-1477528018-ach89
Getting support logs for sysdigcloud-cassandra-2987866586-fgcm8
Getting support logs for sysdigcloud-collector-2526360198-e58uy
Getting support logs for sysdigcloud-collector-2526360198-v1egg
Getting support logs for sysdigcloud-mysql-2388886613-a8a12
Getting support logs for sysdigcloud-redis-1701952711-ezg8q
Getting support logs for sysdigcloud-worker-1086626503-4cio9
Getting support logs for sysdigcloud-worker-1086626503-sdtrc
Support bundle generated: 1473897425_sysdig_cloud_support_bundle.tgz</pre><pre class="programlisting"></pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cefd6b52-655b-15f4-9e94-f96dd60a6dcc" data-publication-date="" id="UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04"><div class="titlepage"><div><div class="title"><h6 class="title">Sysdig Install with Replicated</h6></div></div></div><h6 id="UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04_id_SysdigInstallwithReplicated-UnderstandtheChoicePoints" class="bridgehead">Understand the Choice Points</h6><p>When planning an on-premises installation, the following choice points must be decided upon.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <span class="bold bold"><strong>Infrastructure Managers: </strong></span>To install Sysdig on-premises, administrators choose one of two infrastructure managers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Kubernetes</strong></span> (see <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e" title="Sysdig Install on Kubernetes 1.9+">Sysdig Install on Kubernetes 1.9+</a>), or</p></li><li class="listitem"><p> <span class="bold bold"><strong>Replicated:</strong></span> an easy-to-use orchestrator that includes a GUI management tool.</p><p>This guide describes how to install the Replicated client and use it to install and manage the Sysdig platform.</p></li></ul></div></li><li class="step"><p> <span class="bold bold"><strong>Single-Host or Multi-Host Install: </strong></span>For test or proof-of-concept installations, a single-host install will include all components; for production, a distributed environment is needed.</p></li><li class="step"><p> <span class="bold bold"><strong>Airgapped or non-airgapped environment:</strong></span> </p><p>If your environment is accessible to the Internet during the install process, then the installation options include both script-based or GUI-based.</p><p>In airgapped environments (no Internet access), you must download components into your airgapped repository, and can only use the GUI-based installation.</p><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a>.</p></li><li class="step"><p> <span class="bold bold"><strong>Where to put the Replicated Management Console: </strong></span>When installing on-premises using Replicated as the orchestrator, the following Replicated components will be installed on your system:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Replicated UI (on a host you designate to host the Replicated Management Console)</p></li><li class="listitem"><p>Replicated retraced containers that handle logging (on the Management Console host only)</p></li><li class="listitem"><p>Replicated operator component (will go on all hosts)</p></li></ul></div></li></ol></div><p>In a multi-host installation, one server will be the Replicated Management Console host. The system load for these components is minor.</p><p>No matter which installation options you choose, you will use the Replicated GUI post-installation to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Start/stop Sysdig components</p></li><li class="listitem"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/224591877/Upgrade+Replicated+Installations" target="_blank">Upgrade</a> Sysdig backend components</p></li><li class="listitem"><p>Collect and view logs (<a class="link" href="">support bundles</a>).</p></li></ul></div><h6 id="UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04_id_SysdigInstallwithReplicated-UnderstandtheInstallationProcess" class="bridgehead">Understand the Installation Process</h6><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Review and complete the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/227573777/" target="_blank">Pre-Install</a> requirements.</p></li><li class="step"><p>If installing on multiple nodes, decide which node will host the Replicated Management Console.</p></li><li class="step"><p>If using an airgapped environment, set up for an <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a>.</p></li><li class="step"><p> <a class="link" href="">Install the Replicated Client</a> on a host.</p></li><li class="step"><p> <a class="link" href="">Log In to Replicated Management Console </a>and set the Replicated Management Console Password.</p></li><li class="step"><p> <a class="link" href="">Configure Sysdig Admin Password and Basic Settings</a>.</p></li><li class="step"><p> <a class="link" href="">Configure Sysdig Application Advanced Settings</a> (if necessary).</p></li><li class="step"><p>Complete Distributed Install Steps (if necessary).</p></li><li class="step"><p>Restart the host(s).</p></li></ol></div><h6 id="UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04_id_SysdigInstallwithReplicated-TopicsinthisGuide" class="bridgehead">Topics in this Guide</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506" title="Install Using the Replicated GUI">Install Using the Replicated GUI</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579" title="Post-Install Configuration">Post-Install Configuration</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-4bf322c0-7559-53af-30d5-f4feaf3c5730" title="Uninstall Replicated Installations">Uninstall Replicated Installations</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-4c38ba2f-226c-ad3e-88e7-12b9ba3bd2f0" title="**Quick Install: Replicated **">**Quick Install: Replicated **</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-aa3e0530-5361-bea3-b8aa-d958e7d82e0e" data-publication-date="" id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527"><div class="titlepage"><div><div class="title"><h6 class="title">Airgapped Installation</h6></div></div></div><p>To install the Sysdig platform on-premises, in an environment that has no inbound or outbound paths available to internet traffic, you must use the Replicated GUI-based installation option. No script-based option is currently available.</p><p>Perform the following steps to download the required Sysdig installation files, the Replicated components, and the Sysdig license file, and save them to a repository on your airgapped server. Then perform the setup steps in the Replicated Management Console, as described below.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-Prerequisites" title="Prerequisites">Prerequisites</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-Instructions" title="Instructions">Instructions </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-DownloadComponentstoaRepository" title="Download Components to a Repository">Download Components to a Repository </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-InstallandSetUpReplicatedManagementInfrastructure" title="Install and Set Up Replicated Management Infrastructure">Install and Set Up Replicated Management Infrastructure </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-CompletetheInstallationSteps" title="Complete the Installation Steps">Complete the Installation Steps </a> </p></li></ul></div></li></ul></div><h8 id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-Prerequisites" class="bridgehead">Prerequisites</h8><p>A server instance with Docker version 1.7.1 or later installed is required prior to installation.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The Replicated <code class="code">.airgap</code> installation script does not install <code class="code">docker-engine</code>. Sysdig recommends using the latest version of Docker available for the server operating system.</p><p>For more information on installing Docker in an airgapped environment, refer to the <a class="link" href="https://help.replicated.com/docs/kb/supporting-your-customers/installing-docker-in-airgapped/" target="_blank">Installing Docker in an Airgapped Environment</a> documentation.</p></div><h8 id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-Instructions" class="bridgehead">Instructions</h8><h8 id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-DownloadComponentstoaRepository" class="bridgehead">Download Components to a Repository</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Download the latest Sysdig installation files using the links provided by the Sysdig Sales Engineer:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The Sysdig platform application .<code class="code">airgap</code> package</p></li><li class="listitem"><p>The Sysdig application license file (<code class="code">.rli</code>)</p></li><li class="listitem"><p>(Optional) The <a class="link" href="https://hub.docker.com/r/sysdig/agent/" target="_blank">Sysdig Agent Docker image</a> </p></li></ul></div></li><li class="step"><p>Download the latest Replicated installation file from:</p><p> <a class="link" href="https://s3.amazonaws.com/replicated-airgap-work/replicated.tar.gz" target="_blank">https://s3.amazonaws.com/replicated-airgap-work/replicated.tar.gz</a> </p></li><li class="step"><p>Copy all downloaded files to a designated location on your airgapped server. For example:</p><p> <code class="code">/var/tmp/sysdig</code> </p><p>(Note this path to be used when you complete the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506" title="Install Using the Replicated GUI">Install Using the Replicated GUI</a>.)</p></li><li class="step"><p>Open a command shell on the airgapped server and extract the<code class="code"> replicated.tar.gz</code> file:</p><pre class="programlisting">sudo tar xzvf replicated.tar.gz</pre></li></ol></div><h8 id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-InstallandSetUpReplicatedManagementInfrastructure" class="bridgehead">Install and Set Up Replicated Management Infrastructure</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Run the following command to install the Replicated infrastructure manager:</p><p> <code class="code">sudo cat ./install.sh | sudo bash -s airgap </code> </p></li><li class="step"><p>In a browser, navigate to the Replicated Management Console: <code class="code"> <a class="link" href="https://server_address:8800/" target="_blank">https://server_address:8800</a> </code> <span class="bold bold"><strong>(</strong></span>Replace <code class="code">server_address</code> with the server name/IP address.)</p></li><li class="step"><p>Accept the default self-signed certificate, or provide a custom one, and click <code class="code">Continue</code>.</p></li><li class="step"><p>On the next screen, once the “preflight” checks have been resolved, select the <code class="code">Airgapped</code> option, and click <span class="bold bold"><strong> <code class="code">Continue</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="300px"><tr><td><img src="image/15d5af4f3463b7.png" style="max-width: 300px; " alt="5d4d586b21172.png"></img></td></tr></table></div></li><li class="step"><p>Upload the <code class="code">.rli</code> license file.</p></li><li class="step"><p>Provide a path to the Sysdig application <code class="code">.airgap</code> file.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Should you need to upgrade an airgapped license at a future time, see <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644" title="Upgrade an On-Premises License">Upgrade an On-Premises License</a>. For general license information, see <a class="link" href="33836-17746-administration-settings.html#UUID-e10d8043-d45f-1d3a-a3d9-61b6d3081eea" title="How Does Licensing Work">How Does Licensing Work</a>.</p></div></li></ol></div><h8 id="UUID-7f8181d0-96f7-fdea-17bc-c4d921598527_id_AirgappedInstallation-CompletetheInstallationSteps" class="bridgehead">Complete the Installation Steps</h8><p>Continue with "Setting the Replication Management Password" and the rest of the installation steps in <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506" title="Install Using the Replicated GUI">Install Using the Replicated GUI</a>.</p></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-a8377621-792c-5278-f6d2-458bc8d4acf4" data-publication-date="" id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506"><div class="titlepage"><div><div class="title"><h6 class="title">Install Using the Replicated GUI</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-InstalltheReplicatedClient" title="Install the Replicated Client">Install the Replicated Client </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-DefineBasicSettingsLicenseInfo" title="Define Basic Settings &amp; License Info">Define Basic Settings &amp; License Info</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-LogIntoReplicatedAdminConsoleadminconsoleandSetSSLCertificate" title='Log In to Replicated Admin Console/ "admin console" and Set SSL Certificate'>Log In to Replicated Admin Console/ "admin console" and Set SSL Certificate </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-SettheReplicatedAdminConsolePassword" title="Set the Replicated Admin Console Password">Set the Replicated Admin Console Password</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-ConfigureSysdigSuperAdminPasswordandBasicSettings" title="Configure Sysdig Super Admin Password and Basic Settings">Configure Sysdig Super Admin Password and Basic Settings</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-DefineAdvancedSettings" title="Define Advanced Settings">Define Advanced Settings </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-Single-HostInstallationWrap-Up" title="Single-Host Installation Wrap-Up">Single-Host Installation Wrap-Up </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-Multi-HostInstallationWrap-Up" title="Multi-Host Installation Wrap-Up">Multi-Host Installation Wrap-Up</a> </p></li></ul></div><p>You can use the Replicated UI to install the Sysdig platform on either a single host or on multiple hosts. If multi-host, decide which machine will also run the Replicated Admin Console and begin there.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If your environment is "airgapped" (no access to inbound or outbound internet traffic), there are some setup steps you must perform before doing the GUI-based Replicated installation.</p><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a> for details.</p></div><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-InstalltheReplicatedClient" class="bridgehead">Install the Replicated Client</h8><p>Log in to the chosen machine with a shell and run a command to install the Replicated components. You can also install Docker if it's not already on the environment.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log into the designated server instance with SSH.</p></li><li class="step"><p>Run the following commands:</p><p>a. <span class="bold bold"><strong>To install the Replicated Infrastructure and Docker:</strong></span> </p><pre class="programlisting">sudo curl -sSL https://install.sysdigcloud.com/docker | sudo bash</pre><p>b.<span class="bold bold"><strong> If Docker is already installed on the server instance, add<code class="code">-s --no-docker</code>to the command:</strong></span> </p><pre class="programlisting">sudo curl -sSL https://install.sysdigcloud.com/docker | sudo bash -s -- no-docker</pre><p>c. <span class="bold bold"><strong>If installing the Replicated Infrastructure behind a proxy, modify the installation command as shown below:</strong></span> </p><pre class="programlisting">sudo curl -sSL -x http://&lt;proxy&gt;:&lt;port&gt; -o /tmp/sdc-onpremises-installer.sh https://install.sysdigcloud.com/docker &amp;&amp; bash /tmp/sdc-onpremises-installer.sh http-proxy=http://&lt;proxy&gt;:&lt;port&gt;</pre></li></ol></div><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-DefineBasicSettingsLicenseInfo" class="bridgehead">Define Basic Settings &amp; License Info</h8><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-LogIntoReplicatedAdminConsoleadminconsoleandSetSSLCertificate" class="bridgehead">Log In to Replicated Admin Console/ "admin console" and Set SSL Certificate</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>As prompted, open the Replicated Client at <code class="code">https://&lt;yourserver&gt;:8800. </code> </p></li><li class="step"><p>Supply the DNS hostname for the Replicated Admin Console.</p></li><li class="step"><p>Accept the self-signed certificate, or upload a custom SSL certificate and private key.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>Note:</strong></span> If a self-signed certificate is uploaded, it must include the end user, all intermediate, and the root certificates, as the certificate will be used by the Sysdig platform, as well as for the Replicated Admin Console.</p><p>To later replace a self-sign cert with a custom cert, see <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/edit/224624659?draftId=224624668&amp;draftShareId=e84b4b4f-b330-4783-93d0-5dd9088b0d38&amp;" target="_blank">Replace a Self-Signed Cert</a>.</p></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="376px"><tr style="height: 250px"><td><img src="image/15d5af4f34d050.jpg" style="max-width: 376px; max-height: 250px; " alt="373573422.jpg"></img></td></tr></table></div></li><li class="step"><p>Click the <code class="code">Choose License </code>button, and upload the Sysdig license file supplied from Sysdig Sales.</p></li><li class="step"><p>Choose <span class="bold bold"><strong>Online</strong></span> installation option if prompted.</p></li></ol></div><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-SettheReplicatedAdminConsolePassword" class="bridgehead">Set the Replicated Admin Console Password</h8><p>Once the Sysdig license validation is complete, secure the Replicated Admin Console using a local password, LDAP user account, or anonymous access (insecure).</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f354096.jpg" style="max-height: 250px; " alt="373573408.jpg"></img></td></tr></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Sysdig recommends securing the console with either a local password or LDAP user account.</p></div><p>Click <span class="bold bold"><strong> <code class="code">Continue</code>. </strong></span> </p><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-ConfigureSysdigSuperAdminPasswordandBasicSettings" class="bridgehead">Configure Sysdig Super Admin Password and Basic Settings</h8><p>After clicking Continue, the Settings page is displayed. Here you enter the configuration information that will be used by Replicated to orchestrate the Sysdig installation.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="450px"><tr><td><img src="image/15d5af4f35a400.jpg" style="max-width: 450px; " alt="373573443.jpg"></img></td></tr></table></div></th><td class="td"><p> <span class="bold bold"><strong>Configure the Basic Settings for the Sysdig installation</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Hostname:</strong></span> The host name where the Replicated Admin Console is installed (re-enter).</p><p>By default, the value is the admin server's public IP. If the Sysdig Monitor instance is installed behind a private network, firewall, or proxy, configure the hostname to the server's private address or routable DNS.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Admin User/Default User:</strong></span> The Sysdig administrator (super admin) <span class="bold bold"><strong>Email</strong></span> and <span class="bold bold"><strong>Password</strong></span>.</p><p>Save this account information in a secure place.</p><p>See also "System-Based Privileges" in <a class="link" href="33836-17746-administration-settings.html#UUID-af0f76c8-bafd-4c22-2eba-ba3fcc26187d" title="User and Team Administration">User and Team Administration</a>, and <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">Find the Super Admin Credentials and API Token</a> for more information on this role.</p></li></ul></div><p> <span class="bold bold"><strong>SMTP Relay Configuration</strong></span>This information will be used for e-mail notifications. See also <a class="link" href="33836-17746-administration-settings.html#UUID-dbb8cc36-8bb9-797f-a3b6-493ca976f18d" title="Notifications Management">Notifications Management</a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>SMPT Server Endpoint: </strong></span>URL of SMTP server to be used for email notifications.</p></li><li class="listitem"><p> <span class="bold bold"><strong>SMTP Port: </strong></span>default 25. Port to be used for email communication.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Username (SMTP): </strong></span>default blank.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Password (SMTP): </strong></span>default blank.</p></li><li class="listitem"><p> <span class="bold bold"><strong>SMTP Secure:</strong></span> Choose encryption if needed.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Email Header Configuration:</strong></span> Optional setting for the "From" field in Notifications.</p><p>See also <a class="link" href="33836-17746-administration-settings.html#UUID-dbb8cc36-8bb9-797f-a3b6-493ca976f18d" title="Notifications Management">Notifications Management</a>.</p></li></ul></div><p>Click <code class="code">Show Advanced Settings</code> to continue.</p><p>Note: Advanced Settings are defined after consultation with a Sysdig Sales Engineer.</p></td></tr></thead></table></div><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-DefineAdvancedSettings" class="bridgehead">Define Advanced Settings</h8><p>These settings are typically defined with consultation from a Sysdig Sales Engineer.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="500px"><tr><td><img src="image/15d5af4f361099.jpg" style="max-width: 500px; " alt="373573450.jpg"></img></td></tr></table></div></th><td class="td"><p> <span class="bold bold"><strong>JVM Entries (Required)</strong></span> </p><p>Any JVM options to be passed to the application, such as memory constraint settings for the Java Virtual Machine components, proxy settings, etc.</p><p>At a minimum, it is recommended to define the memory constraints, in the format:</p><p> <code class="code">-Xms###g Xmx###g</code>.</p><p> <span class="bold bold"><strong>Note that if multiple components are on a single machine, adjust the percentages as needed so JVMs all fit in a node. </strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Cassandra JVM options</strong></span>: recommended to allocate 50% of the host's memory to this JVM</p><p>(in a multi-node environment)</p></li><li class="listitem"><p> <span class="bold bold"><strong>Elasticsearch JVM options:</strong></span> recommended to allocate 50% of the host's memory to this JVM</p><p>(in a multi-node environment)</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig Cloud application JVM options:</strong></span> recommended to allocate up to 80% of the host's memory to this JVM.</p><p>This is also used to set proxy settings; see <a class="link" href="https://sysdigdocs.atlassian.net//sysdigdocs.atlassian.net/wiki/ConsiderArchitecture,Sizing,Requirements-HTTP/HTTPSandProxySupport" target="_blank">HTTP/HTTPS and Proxy Support</a>.</p><p>It is also used to set an implicit key in AWS; see <a class="link" href="33836-17746-administration-settings.html#UUID-71bafabd-2efa-0f8a-1555-3d7b1eafe183" title="AWS: Integrate AWS Account and CloudWatch Metrics (Optional)">AWS: Integrate AWS Account and CloudWatch Metrics (Optional)</a>.</p><p>NOTE: If you do not want to use SSL between the agent and the collectors, you append the following settings to the Sysdig Cloud application JVM options entry:</p><pre class="programlisting">-Ddraios.agents.installParams.sslEnabled=false</pre><p>E.g.</p><pre class="programlisting">-Xms8G Xmx8G -Ddraios.agents.installParams.sslEnabled=false</pre></li></ul></div><p> <span class="bold bold"><strong>Ports and Security</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Sysdig UI port:</strong></span> default 80. Port used for the Sysdig Monitor/ Sysdig Secure GUI.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig UI secure port:</strong></span> default 433. SSL port used for Sysdig Monitor/ Sysdig Secure GUI.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Force HTTPS:</strong></span> This turns off the unsecured port (80) access.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Forward Sysdig application logs to <code class="code">stdout</code>:</strong></span> switches logging from the application log files to Linux standard output (<code class="code">stdout)</code>.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig collector port: </strong></span>default 6443. Port used for agent metrics collection. See also <a class="link" href="33836-17701-sysdig-agent.html#UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d" title="Agent Installation">Agent Installation</a>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In earlier versions, the Sysdig Agent connected to port 6666. This behavior has been deprecated, as the Sysdig agent now connects to port 6443.</p></div></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig secure collector port: </strong></span>default 6443. Port used for agent metrics collection. See also <a class="link" href="33836-17701-sysdig-agent.html#UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d" title="Agent Installation">Agent Installation</a>.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Exposed port for HTTP traffic inbound to Sysdig Platform backend container:</strong></span> 27878 – do not change without the recommendation of Sysdig Support.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Exposed port for Collector traffic inbound: </strong></span> 27877 – do not change without the recommendation of Sysdig Support.</p></li></ul></div><p> <span class="bold bold"><strong>Database Entries</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Store Sysdig Captures in Cassandra (recommended):</strong></span> Default checked. Used for Sysdig trace file storage when capture function is used. If you do not store files in the Cassandra DB, you can alternately configure an AWS S3 bucket storage location.</p><p>See also: <a class="link" href="33836-17746-administration-settings.html#UUID-7dae7940-9bda-7498-7386-98a1620e779a" title="Storage: Configure AWS Capture File Storage (Optional)">Storage: Configure AWS Capture File Storage (Optional)</a> and <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Monitor/pages/205684760/Captures" target="_blank">Captures</a>.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig data directory:</strong></span> default <code class="code">/opt</code>. Where Cassandra, MySQL, and Elasticsearch databases will be created on a host.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig Cassandra user:</strong></span> If you are using your own Cassandra database, enter a user account for Sysdig access.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig Cassandra password: </strong></span>If you are using your own Cassandra database, enter a user password for Sysdig access.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Enable Cassandra SSL:</strong></span> Default unchecked.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Cassandra certificate upload:</strong></span> If using Cassandra SSL, upload the appropriate CA certificate.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig MySQL user: </strong></span>default admin, recommend changing</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig MySQL password:</strong></span> Enter a unique password and store securely.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>This password is needed for future updates and will not be visible in the Replicated Admin Console. Retain this password for future use.</p></div></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig MySQL max connections:</strong></span> default 1024</p></li><li class="listitem"><p> <span class="bold bold"><strong>Sysdig Redis password:</strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>Cassandra replication factor:</strong></span> should be either 1 or 3, never 2.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Cassandra CQL native client's port:</strong></span> default 9042.</p></li><li class="listitem"><p> <span class="bold bold"><strong>External MySQL service:</strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>External Cassandra service: </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>External Redis service:</strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>External Elasticsearch service URL: </strong></span>external service URL with user name and password embedded</p></li><li class="listitem"><p> <span class="bold bold"><strong>Elasticsearch CA certificate: </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>OAuth allowed domains:</strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>Google OAuth client ID: </strong></span>Used when integrating Google-based user login.</p><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-75a13b23-2396-d5df-9111-385ec8054322" title="Google OAuth (On-Prem)">Google OAuth (On-Prem)</a> </p></li><li class="listitem"><p> <span class="bold bold"><strong>Google OAuth client secret: </strong></span>Used when integrating Google-based user login. <span class="bold bold"><strong> See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-75a13b23-2396-d5df-9111-385ec8054322" title="Google OAuth (On-Prem)">Google OAuth (On-Prem)</a> </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>SSO CA certificate: </strong></span> </p></li></ul></div></td></tr></thead></table></div><p>When fields are complete, click <span class="bold bold"><strong> <code class="code">Save</code>. </strong></span> </p><p>After Saving, click <code class="code">Start Now</code> to apply settings to the environment immediately. Click <span class="bold bold"><strong> <code class="code">Cancel</code> </strong></span>to apply settings at a later time.</p><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-Single-HostInstallationWrap-Up" class="bridgehead">Single-Host Installation Wrap-Up</h8><p>After completing the Settings and restarting, no further installation steps are required for a single-host install.</p><p>The dashboard will remain in <span class="italic italic">Starting</span> mode for approximately 4-5 minutes, depending on the internet connection bandwidth, while Sysdig application software is downloaded and installed. Once the installation is complete, the dashboard will move to <span class="italic italic">Started</span> mode.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Click the <code class="code">Open</code> link to navigate to the Sysdig Monitor login panel.</p></li><li class="step"><p>Input the Super Admin user login credentials defined in the basic settings, above.</p></li></ol></div><p> <span class="bold bold"><strong>Next Steps</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>To start, stop, and update the application, or to retrieve support information, use the Replicated Admin Console: <code class="code">https://&lt;yourserver&gt;:8800</code>.</p></li><li class="listitem"><p>To login as a user and see metrics for hosts with the Sysdig Agent installed, use the Sysdig Monitor Web Interface: <code class="code">https://&lt;yourserver&gt;:80</code> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If you have not yet done so, install Sysdig Agents to monitor your environment. See <a class="link" href="33836-17701-sysdig-agent.html#UUID-8d33e5e9-b275-4816-14b0-9f8fcbb5196d" title="Agent Installation">Agent Installation</a> for details.</p></li></ul></div></li></ul></div><h8 id="UUID-c85c4abc-9a9a-386f-0d50-ba01322e7506_id_InstallUsingtheReplicatedGUI-Multi-HostInstallationWrap-Up" class="bridgehead">Multi-Host Installation Wrap-Up</h8><p>After configuring the settings and clicking <code class="code">Start Now</code>, an error will indicate the need to assign and install the remaining components. You will need to define the hosts/nodes to be used and will assign the Sysdig components to be installed on them. The steps below describe the actions on one host; they must be repeated on all applicable hosts and all the Sysdig components must be assigned.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Choose the <code class="code">Cluster</code> tab in the Replicated Admin Console.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="700px"><tr><td><img src="image/15d5af4f368ef2.png" style="max-width: 700px; " alt="373573429.png"></img></td></tr></table></div><p>From here, you can tag components to be run on the local host, and/or add new nodes.</p><p>To add and configure new nodes:</p></li><li class="step"><p>Click <code class="code">Add Node</code>.</p><p>The Add Node worksheet is displayed. Here you enter the IP address and then tag the Sysdig component(s) to be installed on that node.</p><p>Replicated will compile either an installation script or a Docker run command out of your entries, which you will copy and use on the given node.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr style="height: 490px"><td><img src="image/15d5af4f370873.jpg" style="max-width: 400px; max-height: 490px; " alt="373573401.jpg"></img></td></tr></table></div></li><li class="step"><p>On the Add Node worksheet page, do the following:</p><ol type="a" class="substeps"><li class="step"><p>Choose <code class="code">Installation script</code> or <code class="code">Docker run command</code> option.</p></li><li class="step"><p>Enter private and/or public IP address, depending on the type of access you want to permit.</p></li><li class="step"><p>Select the Sysdig components to be installed by checking the appropriate "Tags" buttons.</p><p>Descriptions in the table below:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows" style="text-align: left;"><colgroup><col></col><col></col><col></col></colgroup><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Name</strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong>Tag</strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong>Role Description</strong></span> </p></td></tr><tr><td class="td"><p>api</p></td><td class="td"><p>api</p></td><td class="td"><p>Application Programming Interface server</p></td></tr><tr><td class="td"><p>cassandradb</p></td><td class="td"><p>cassandra</p></td><td class="td"><p>Cassandra database server</p></td></tr><tr><td class="td"><p>elasticsearch</p></td><td class="td"><p>elasticsearch</p></td><td class="td"><p>Elasticsearch server for events storage/search</p></td></tr><tr><td class="td"><p>collector</p></td><td class="td"><p>collector</p></td><td class="td"><p>Agent metrics collector</p></td></tr><tr><td class="td"><p>lb_collector</p></td><td class="td"><p>lb_collector</p></td><td class="td"><p>Load balancer for collector service; handles connections from the agents</p></td></tr><tr><td class="td"><p>lb_api</p></td><td class="td"><p>lb_api</p></td><td class="td"><p>Load balancer for API service; handles user connection requests to the Sysdig application.</p><p>Use the address for this node as the DNS entry for the cluster.</p></td></tr><tr><td class="td"><p>mysql, redis</p></td><td class="td"><p>mysql &amp; redis</p></td><td class="td"><p>MySQL &amp; Redis databases</p></td></tr><tr><td class="td"><p>worker</p></td><td class="td"><p>worker</p></td><td class="td"><p>Metrics history processor</p></td></tr><tr><td class="td"><p>emailrenderer</p></td><td class="td"><p>emailrenderer</p></td><td class="td"><p>Email renderer</p></td></tr><tr><td class="td"><p>nginxfrontend</p></td><td class="td"><p>nginxfrontend</p></td><td class="td"><p>Frontend static server</p></td></tr></tbody></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>When setting up a DNS entry for the cluster, use the address for the '<code class="code">lb_api'</code> node.</p></div></li><li class="step"><p>At the bottom of the page, a <code class="code">curl</code> script or Docker run command is compiled for you.</p><p>Copy the command and issue it on the targeted host.</p></li></ol></li><li class="step"><p>Repeat this procedure on all desired hosts.</p></li><li class="step"><p>Restart the Sysdig application from the Replicated console.</p><p>The dashboard will be in “Starting” mode for several minutes while software is downloaded and installed onto each server component (depending on your internet connection bandwidth).</p><p>You should see green check marks for each host next to the Provisioned and Connected columns, as the software is installed and the node connects successfully to the Replicated Admin server.</p><p>Once the installation is fully completed, the infrastructure admin dashboard will be in “Started” mode and will also show the “Open” link that will bring you to Sysdig Monitor web interface login screen.</p></li><li class="step"><p>At the login screen, use the credentials configured earlier (Default User) to log in and start using the Sysdig application on-premises solution.</p><p>To start, stop, and update the application or retrieve support information use the Replicated Admin dashboard: <a class="link" href="https://server_address:8800/" target="_blank">https://server_address:8800</a> </p><p>To log in as a user and see metrics about hosts where Sysdig agents are installed, use the Sysdig Monitor UI: <a class="link" href="http://server_address/" target="_blank">https://server_address:80</a> </p></li></ol></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-13479411-1a59-59be-86c1-fb65322ff6ff" data-publication-date="" id="UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579"><div class="titlepage"><div><div class="title"><h6 class="title">Post-Install Configuration</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579_id_Post-InstallConfiguration-ReplaceaSelf-SignedCertwithCustomCert" title="Replace a Self-Signed Cert with Custom Cert">Replace a Self-Signed Cert with Custom Cert </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579_id_Post-InstallConfiguration-OptionalCustomSelf-SignedCertificate" title="Optional: Custom Self-Signed Certificate">Optional: Custom Self-Signed Certificate</a> </p></li></ul></div><h8 id="UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579_id_Post-InstallConfiguration-ReplaceaSelf-SignedCertwithCustomCert" class="bridgehead">Replace a Self-Signed Cert with Custom Cert</h8><p>If you accepted the self-signed certificate for SSL/TLS communication when installing the Sysdig components (see <a class="link" href="">Define Basic Settings</a>), you can exchange for a custom certificate as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Log in to the Replicated Management Console and select the <code class="code">Gear icon &gt; Console Settings.</code> </p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f3775b6.png" style="max-height: 250px; " alt="373573487.png"></img></td></tr></table></div></li><li class="listitem"><p>Click <code class="code">Upload certificate</code> and it will automatically replace the original self-signed certificate.</p></li></ul></div><h8 id="UUID-2e0e8c9f-6e86-2fe2-c406-2826d58aa579_id_Post-InstallConfiguration-OptionalCustomSelf-SignedCertificate" class="bridgehead">Optional: Custom Self-Signed Certificate</h8><p>Sysdig Monitor/Cloud/etc uses a self-signed SSL/TLS security certificate, unless a custom certificate is provided.</p><p>The example command below creates a custom, unsigned certificate called <code class="code">MyCert.pem</code>; the certificate has a private key called <code class="code">MyCert.key</code>, and is valid for five years:</p><pre class="programlisting">sudo openssl req -new -x509 -sha256 -days 1825 -nodes -out ./MyCert.pem -keyout ./MyCert.key</pre></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-42933760-6085-53e2-abf8-bcfc531f888c" data-publication-date="" id="UUID-4bf322c0-7559-53af-30d5-f4feaf3c5730"><div class="titlepage"><div><div class="title"><h6 class="title">Uninstall Replicated Installations</h6></div></div></div><p>To uninstall the Sysdig application and the Replicated infrastructure manger:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the Replicated Management Console and <code class="code">Stop</code> the Sysdig application.</p></li><li class="step"><p>Perform the steps shown at the bottom of the <a class="link" href="">Replicated Installation Guide</a>. (<a class="link" href="https://help.replicated.com/docs/native/customer-installations/installing-via-script/" target="_blank">https://help.replicated.com/docs/native/customer-installations/installing-via-script/</a>)</p></li></ol></div><p>Once all containers are stopped and removed, you should rename, archive, or remove any Sysdig Cassandra/Elasicsearch/MySQL databases (default location is <code class="code">/opt)</code> before re-installing a completely new instance of Sysdig Monitor.</p><p>To remove <span class="italic italic">all </span>unused containers and images on your host, use <code class="code">docker system prune -a -f </code> </p></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-8405d8cd-b38e-c8fb-1eb5-99bfec58234f" data-publication-date="" id="UUID-4c38ba2f-226c-ad3e-88e7-12b9ba3bd2f0"><div class="titlepage"><div><div class="title"><h6 class="title">**Quick Install: Replicated **</h6></div></div></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-c8ee69b8-14e8-88da-79cc-bd2af9e9f31f" data-publication-date="" id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d"><div class="titlepage"><div><div class="title"><h6 class="title">Troubleshooting On-Premises Installation</h6></div></div></div><p>See also <span class="bold bold"><strong> Get Help | Using Sysdig Support (On-Prem) </strong></span> </p><h6 id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-DockerConnectivityIssuesIPv4IPv6" class="bridgehead">Docker Connectivity Issues (IPv4/IPv6)</h6><p>Some issues with IPv4 and IPv6 interconnectivity between on-premises containers and the outside world have been detected.</p><p>IP packet forwarding is governed by the <code class="code">ip_forward</code> system parameter. Packets can only pass between containers if this parameter is <code class="code">1</code>. Usually, you will simply leave the Docker server at its default setting <code class="code">--ip-forward=true</code>and Docker will go set <code class="code">ip_forward</code> to <code class="code">1</code> for you when the server starts up. If you set <code class="code">--ip-forward=false</code> and your system’s kernel has it enabled, the <code class="code">--ip-forward=false</code> option has no effect.</p><p>To check the setting on your kernel use:</p><pre class="programlisting"><code class="code">sysctl net.ipv4.conf.all.forwarding</code></pre><p>To turn it on use:</p><pre class="programlisting"><code class="code">sysctl net.ipv4.conf.all.forwarding=1</code></pre><p>Please see this <a class="link" href="">article from docker </a>for more details on Docker Connectivity.</p><h6 id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-ProxyFirewallIssues" class="bridgehead">Proxy/Firewall Issues</h6><p>Prior to installing ensure your proxy settings are valid for the session. You can use <code class="code">curl</code>, <code class="code">lynx</code>, or <code class="code">wget</code> to test internet connectivity:</p><pre class="programlisting"><code class="code">export http_proxy="http://user:password@proxy_server:port" 
export https_proxy="https://user:password@proxy_server:port"
echo $http_proxy</code></pre><p>You can then attempt a curl or docker hub call to ensure outside connectivity.</p><h6 id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-Firewall" class="bridgehead">Firewall</h6><p>Prior to installation, you may want to disable local firewall (iptables) to rule out local connectivity issues.</p><p>However here are some details around Sysdig connectivity and backend connectivity requirements.</p><p> <span class="bold bold"><strong>Sysdig Connectivity:</strong></span> </p><p>6443 Agent communication</p><p>443 Sysdig Monitor UI access</p><p>8800 Management console access</p><p>Here are specifics around what is used for connectivity for the Sysdig backend for on-premises solution:</p><p> <a class="link" href="https://www.replicated.com/docs/kb/supporting-your-customers/firewalls/" target="_blank">https://www.replicated.com/docs/kb/supporting-your-customers/firewalls/</a> </p><h6 id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-FileWritePermissionsIssuesSELINUXorAPPARMOR" class="bridgehead">File Write Permissions Issues (SELINUX or APP ARMOR)</h6><p>During the install, you may see errors writing to volumes such as (<code class="code">/var</code> or <code class="code">/opt</code>) from either the onprem install scripts or Docker. You should disable <code class="code">SELINUX</code> (CENTOS/RHEL) or <code class="code">Apparmor</code> (UBUNTU/DEBIAN) during the course of the install so the valid directories can be created. This can be accomplished by:</p><p> <span class="bold bold"><strong>Centos (</strong></span>SELINUX<span class="bold bold"><strong>)</strong></span> </p><p>From the command line, edit the <code class="code">/etc/sysconfig/selinux</code> file. This file is a symlink to <code class="code">/etc/selinux/config</code>. The configuration file is self-explanatory. Changing the value of <span class="italic italic"> <code class="code">SELINUX</code> </span> or <span class="italic italic"> <code class="code">SELINUXTYPE</code> </span>changes the state of SELinux and the name of the policy to be used the next time the system boots.</p><pre class="programlisting">[root@host2a ~]# cat /etc/sysconfig/selinux
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - SELinux is fully disabled.
SELINUX=permissive
# SELINUXTYPE= type of policy in use. Possible values are:
#       targeted - Only targeted network daemons are protected.
#       strict - Full SELinux protection.
SELINUXTYPE=targeted

# SETLOCALDEFS= Check local definition changes
SETLOCALDEFS=0</pre><p>More info is available <a class="link" href="https://www.centos.org/docs/5/html/5.2/Deployment_Guide/sec-sel-enable-disable.html" target="_blank">here.</a> </p><p> <span class="bold bold"><strong>UBUNTU/Debian (AppArmor)</strong></span> </p><p>AppArmor can be disabled, and the kernel module unloaded by entering the following:</p><pre class="programlisting"><code class="code">sudo systemctl stop apparmor.service
sudo update-rc.d -f apparmor remove</code></pre><p>To re-enable AppArmor enter:</p><pre class="programlisting"><code class="code">sudo systemctl start apparmor.service
sudo update-rc.d apparmor defaults</code></pre><h6 id="UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-AdvancedTroubleshooting-FirewallIPtablesIPforwarding" class="bridgehead">Advanced Troubleshooting - Firewall, IPtables, IP forwarding</h6><p>In the preflight check step with Replicated, if you come across the error:</p><pre class="programlisting">getsockopt: no route to host</pre><p>Please do the following:</p><p> <span class="bold bold"><strong>For CentOS 7/RedHat:</strong></span> </p><p>Log in as root or run these commands via sudo:</p><pre class="programlisting"><code class="code">service firewalld stop 
systemctl disable firewalld
sysctl -w net.ipv4.ip_forward=1
iptables -F
setenforce 0
service docker restart</code></pre><p> <span class="bold bold"><strong>For Ubuntu:</strong></span> </p><p>Log in as root or run these commands via sudo:</p><pre class="programlisting"><code class="code">sysctl -w net.ipv4.ip_forward=1
systemctl stop apparmor.service
update-rc.d -f apparmor remove
ufw disable
iptables -F
service docker restart

</code></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Docker Connectivity Issues (IPv4/IPv6) </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-ProxyFirewallIssues" title="Proxy/Firewall Issues">Proxy/Firewall Issues</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-Firewall" title="Firewall">Firewall</a> </p></li><li class="listitem"><p> File Write Permissions Issues (SELINUX or APP ARMOR) </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d_id_TroubleshootingOn-PremisesInstallation-AdvancedTroubleshooting-FirewallIPtablesIPforwarding" title="Advanced Troubleshooting - Firewall, IPtables, IP forwarding">Advanced Troubleshooting - Firewall, IPtables, IP forwarding</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-56e8e98a-2ab4-6b39-ba6e-35eee1e169cc" data-publication-date="" id="UUID-b551e78a-d231-357e-a672-9c8787019250"><div class="titlepage"><div><div class="title"><h5 class="title">On-Premises Upgrades</h5></div></div></div><p>This section describes how to upgrade an on-premise installation, depending on whether it was <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204669163/On-Premises+Installation" target="_blank">installed</a> using a Kubernetes or a Replicated orchestrator.</p><p>As needed, version-specific upgrade or migration instructions will be added to this section.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is recommended to follow upgrade best practices:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Keep upgrades current</p></li><li class="listitem"><p>Test upgrades in a non-mission-critical or staging environment before rolling into production.</p></li></ul></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-SupportedMigrationPaths" title="Supported Migration Paths">Supported Migration Paths </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForKubernetesUpgrades" title="For Kubernetes Upgrades">For Kubernetes Upgrades </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-Example" title="Example">Example</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForReplicatedUpgrades" title="For Replicated Upgrades">For Replicated Upgrades</a> </p></li></ul></div></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-SupportedMigrationPaths"><div class="titlepage"><div><div class="title"><h6 class="title">Supported Migration Paths</h6></div></div></div><p>In general, Sysdig tests and supports direct upgrade from <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases" target="_blank"> <span class="bold bold"><strong>five</strong></span> releases</a> back to the current version.</p><p> <span class="bold bold"><strong>However, </strong></span> in the case of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Required migration tools and/or</p></li><li class="listitem"><p>Significant architecture changes</p></li></ul></div><p> <span class="bold bold"><strong>it is required to apply</strong></span> <span class="bold bold"><strong>significant interim releases.</strong></span> </p><p>(Significant interim releases shaded green in the tables.)</p><h6 id="UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForKubernetesUpgrades" class="bridgehead">For Kubernetes Upgrades</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>Install Version</p></th><th class="th"><p>Incl. Hotfixes</p></th><th class="th"><p>Notes</p></th><th class="th"><p>Baseline Documentation</p></th></tr></thead><tbody><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/2.3.0" target="_blank">2.3.0</a> </p></td><td class="td"></td><td class="td"><p>Ability to secure Elasticsearch and the Cassandra DB with password authentication or SSL/TLS protection.</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367165531/Expanded+Upgrade+Kubernetes+Installations+version+2.3.0" target="_blank">Expanded Upgrade</a> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Mandatory Install</strong></span> </p></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v2435" target="_blank">2435</a> </p></td><td class="td"><p>(2304) (2266) (2172)</p></td><td class="td"><p>Architecture changes to Dashboards</p><p>&amp; API pods.</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367886409/Expanded+Upgrade+Kubernetes+Installations+version+2304+2266+2172" target="_blank">Expanded Upgrade </a> </p><p>Note that this replaces 2172, 2266, and 2304.</p></td></tr><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1929" target="_blank">1929</a> </p></td><td class="td"></td><td class="td"></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Mandatory Install</strong></span> </p></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1765" target="_blank">1765</a> </p></td><td class="td"></td><td class="td"><p>Migration Tool (MySQL Connector)</p><p>Architecture &amp; Port 443 change</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/319782952/Migration+Tool+for+Upgrading+to+Sysdig+Platform+v.+1765+Kubernetes" target="_blank">Migration Tool for Connector</a> +</p><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/316768295/Expanded+Upgrade+Kubernetes+Installations+for+Sysdig+Platform+v.+1765" target="_blank">Expanded Upgrade</a> </p></td></tr><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1630" target="_blank">1630</a> </p></td><td class="td"><p>(<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1586" target="_blank">1586</a>)</p></td><td class="td"></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1511" target="_blank">1511</a> </p></td><td class="td"><p>(<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1472" target="_blank">1472</a>) (<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1402" target="_blank">1402</a>)</p></td><td class="td"></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1245" target="_blank">1245</a> </p></td><td class="td"></td><td class="td"></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Mandatory Install</strong></span> </p></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1149" target="_blank">1149</a> </p></td><td class="td"></td><td class="td"><p>Migration Tool (Unified Events)</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/261652612/Migration+Tool+for+Unified+Events+Platform+v.+1149+" target="_blank">Migration Tool for Unified Events</a> +</p><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr><tr><td class="td"></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1091" target="_blank">1091</a> </p></td><td class="td"></td><td class="td"></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> </p></td></tr></tbody></table></div><h7 id="UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-Example" class="bridgehead">Example</h7><p> <span class="bold bold"><strong>To upgrade from v. 1091 &gt; v. 2435, you would:</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Upgrade to v. 1149, using the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/261652612/Migration+Tool+for+Unified+Events+Platform+v.+1149+" target="_blank">Migration Tool for Unified Events</a> and the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> instructions.</p></li><li class="listitem"><p>Then upgrade to v. 1765, using the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/319782952/Migration+Tool+for+Upgrading+to+Sysdig+Platform+v.+1765+Kubernetes" target="_blank">Migration Tool for Connector</a> and the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/316768295/Expanded+Upgrade+Kubernetes+Installations+for+Sysdig+Platform+v.+1765" target="_blank">Expanded Upgrade</a> instructions.</p></li><li class="listitem"><p>Finally upgrade to v. 2435, using the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Basic+Upgrade+Kubernetes+Installations" target="_blank">Basic Upgrade</a> (including the note about Dashboard migration on that page)</p></li></ul></div><h6 id="UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForReplicatedUpgrades" class="bridgehead">For Replicated Upgrades</h6><p>Most Replicated environments can be upgraded directly to the current version.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"></th><th class="th"><p>Install Version</p></th><th class="th"><p>Incl. Hotfixes</p></th><th class="th"><p>Notes</p></th><th class="th"><p>Documentation</p></th></tr></thead><tbody><tr><td class="td"><p>Current</p></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v2435" target="_blank">2435</a> </p></td><td class="td"><p>(2304) (2266)(2172)</p></td><td class="td"><p>Architecture changes to Dashboards</p><p>and API pods.</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/224591877/Upgrade+Replicated+Installations" target="_blank">Upgrade Replicated</a> (with note)</p><p>(Note that this replaces 2172, 2266, and 2304.)</p></td></tr><tr><td colspan="5" class="td"><p>(Can be installed or skipped) <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1929" target="_blank">1929</a>, <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1765" target="_blank">1765</a>, <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1630" target="_blank">1630</a>, (<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1586" target="_blank">1586</a>), <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1511" target="_blank">1511</a>, (<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1472" target="_blank">1472</a>) (<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1402" target="_blank">1402</a>), <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1245" target="_blank">1245</a> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Mandatory</strong></span> <span class="bold bold"><strong>Install</strong></span> </p></td><td class="td"><p> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1149" target="_blank">1149</a> </p></td><td class="td"></td><td class="td"><p>Migration Tool (Unified Events</p></td><td class="td"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/261652612/Migration+Tool+for+Unified+Events+Platform+v.+1149+" target="_blank">Migration Tool for Unified Events</a> +</p><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/224591877/Upgrade+Replicated+Installations" target="_blank">Upgrade Replicated</a> </p></td></tr></tbody></table></div><p>This section includes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d" title="Migration Tool for Unified Events (Platform v. 1149+)">Migration Tool for Unified Events (Platform v. 1149+)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9" title="Migration Tool for Upgrading to Sysdig Platform v. 1765 (Kubernetes)">Migration Tool for Upgrading to Sysdig Platform v. 1765 (Kubernetes)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0" title="Basic Upgrade Kubernetes Installations">Basic Upgrade Kubernetes Installations</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda" title="Expanded Upgrade Kubernetes Installations version 2.3.0">Expanded Upgrade Kubernetes Installations version 2.3.0</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff" title="Expanded Upgrade Kubernetes Installations for Sysdig Platform v. 1765">Expanded Upgrade Kubernetes Installations for Sysdig Platform v. 1765</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3ae24886-975b-76f7-f7f7-a7b865907119" title="Expanded Upgrade Kubernetes Installations version 2304 (2266, 2172)">Expanded Upgrade Kubernetes Installations version 2304 (2266, 2172)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f" title="Upgrade Replicated Installations">Upgrade Replicated Installations</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61" title="**Add a Cassandra Node**">**Add a Cassandra Node**</a> </p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-SupportedMigrationPaths" title="Supported Migration Paths">Supported Migration Paths </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForKubernetesUpgrades" title="For Kubernetes Upgrades">For Kubernetes Upgrades </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-Example" title="Example">Example</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-ForReplicatedUpgrades" title="For Replicated Upgrades">For Replicated Upgrades</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-1827cae7-7590-765c-604e-9331ba41a740" data-publication-date="" id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d"><div class="titlepage"><div><div class="title"><h6 class="title">Migration Tool for Unified Events (Platform v. 1149+)</h6></div></div></div><p> <span class="bold bold"><strong>A</strong></span> <span class="bold bold"><strong>change was introduced in how events are indexed and stored</strong></span> in <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1149" target="_blank">version 1149</a> of the Sysdig platform.</p><p>Prior to this version, the three types of events were stored in three separate indexes, based on their different sources:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Alert events</strong></span>: stored in MySQL (<code class="code">alert_notifications</code> table)</p></li><li class="listitem"><p> <span class="bold bold"><strong>Custom events</strong></span> (from both the infrastructure components and any custom event integrations): stored in ElasticSearch (<code class="code">events_v1</code> index)</p></li><li class="listitem"><p> <span class="bold bold"><strong>Policy events</strong></span> (from Sysdig Secure): stored in ElasticSearch (<code class="code">policy_event_v1</code> index)</p></li></ul></div><p>With version 1149 , they will be combined in one index.</p><p>The <span class="bold bold"><strong>Unified Events migration tool</strong></span> is delivered as a Docker container and is used to migrate events from multiple sources to a single source. When the migration and upgrade are complete, you manually terminate the migration tool.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is highly recommended to run the migration tool BEFORE launching the upgrade to version 1149.</p><p>If you do not migrate before upgrading, you will lose visibility to old custom events in the Sysdig Monitor UI.</p></div><h6 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-Prerequisites" class="bridgehead">Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>You must be running Sysdig platform</strong></span> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/tag/v1091" target="_blank"> <span class="bold bold"><strong>version</strong></span> <span class="bold bold"><strong>1091</strong></span> </a>. If your on-premises version is less than 1091, upgrade appropriately before running the migration tool.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is highly recommended to follow upgrade best practices:</p><div class="itemizedlist"><ul style="list-style-type: circle; " class="itemizedlist"><li class="listitem"><p>Keep upgrades current</p></li><li class="listitem"><p>Upgrade progressively without skipping versions, and</p></li><li class="listitem"><p>Test upgrades in a non-mission-critical or staging environment before rolling in to production.</p></li></ul></div></div></li><li class="listitem"><p> <span class="bold bold"><strong>The migration tool container must have network visibility</strong></span> to the data sources used for re-indexing: MySQL and ElasticSearch.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Launch migration before upgrading to version 1149. </strong></span> </p></li></ul></div><h6 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-WheretoFindtheTool" class="bridgehead">Where to Find the Tool</h6><p>The migration tool is provided as a containerized JavaApp on a public Quay repository. The Kubernetes and Replicated steps below give the precise location.</p><h6 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-RunningtheMigration" class="bridgehead">Running the Migration</h6><p>Since events are constantly being generated, the migration tool executes the migration in batches. After each batch is indexed, the tool will try to fetch the next one, with a predefined cutoff.</p><p>When the tool finishes indexing old events and has begun to wait for new ones, the Sysdig application upgrade can be launched. In the background, during the upgrade, the tool ensures that incoming events in old indexes are properly reindexed to the new unified table.</p><p>The migration steps are:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Run the container image.</p></li><li class="step"><p>Monitor the logs to see when old events have finished migrating.</p></li><li class="step"><p>Launch the upgrade.</p></li><li class="step"><p>Terminate the migration tool manually.</p></li></ol></div><p>Depending on your environment, follow the:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Kubernetes Steps </p></li><li class="listitem"><p> Replicated Steps </p></li></ul></div><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-KubernetesSteps" class="bridgehead">Kubernetes Steps</h7><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-1RuntheContainerImageK8s" class="bridgehead">1. Run the Container Image (K8s)</h7><p>Run the following command:</p><pre class="programlisting">kubectl -n sysdigcloud create -f MIGRATION_TOOL_SPECS.yaml</pre><p>Where <code class="code">MIGRATION_TOOL_SPECS</code> is defined as follows.</p><p>(You can obtain the <code class="code">.yaml</code> template from <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/scripts/events/migration_1091-1149/event-migration-tool_1091-1149.yaml" target="_blank">GitHub repository</a> or copy/paste it from this document. )</p><pre class="programlisting">---
apiVersion: v1
kind: Pod
metadata:
  labels:
    app: sysdigcloud
    role: event-migration
  name: sysdig-event-migration
spec:
  containers:
    - name: event-migration
      image: quay.io/sysdig/onprem_migration:combined-events_0.1.0_1091-1149
      env:
        - name: DB_ENDPOINT
          valueFrom:
            configMapKeyRef:
              name: sysdigcloud-config
              key: mysql.endpoint
        - name: DB_CONNECTION_TIMEOUT
          value: "4000" # Tweak parameter if necessary
        - name: DB_SOCKET_TIMEOUT
          value: "14000" # Tweak parameter if necessary
        - name: DB_USER
          valueFrom:
            configMapKeyRef:
              name: sysdigcloud-config
              key: mysql.user
        - name: DB_PASSWORD
          valueFrom:
            configMapKeyRef:
              name: sysdigcloud-config
              key: mysql.password
        - name: ES_ENDPOINT
          valueFrom:
            configMapKeyRef:
              name: sysdigcloud-config
              key: elasticsearch.url
        - name: ES_PORT
          value: "9200" # Change this param if different
        - name: BATCH_SIZE
          value: "500"
        - name: ALERT_EVENTS
          value: "true"
        - name: CUSTOM_EVENTS
          value: "true"
        - name: POLICY_EVENTS
          value: "true"
        - name: ONPREM
          value: "true"
        - name: REPAIR_MODE
          value: "false"</pre><p>Sample logger output:</p><pre class="programlisting">2018-07-26 10:42:49.129  INFO 8 --- [           main] com.sysdig.EventMigration                : Started EventMigration in 21.956 seconds (JVM running for 23.097)
2018-07-26 10:42:49.130  INFO 8 --- [           main] com.sysdig.EventMigration                : ====================== Onprem ======================
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * DB Settings
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Connection Endpoint: mysql-master.staging.sysdigcloud.com
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Connection Timeout: 4000
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Socket Timeout: 15000
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Username: admin
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Password: *********
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * ES Settings
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Endpoint Url: http://localhost
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Endpoint Port: 9200
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * Migration Settings
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Batch Size: 250
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * Active Migrations
2018-07-26 10:42:49.140  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- custom-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- alert-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- policy-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * Migration is running in NORMAL mode
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : ==================================================
2018-07-26 10:42:49.158  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing alertEventMigration ---
2018-07-26 10:42:51.499  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Starting from id 0
2018-07-26 10:42:51.681  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Event count to be migrated: 8251</pre><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-2WatchtheMigrationLogsK8s" class="bridgehead">2. Watch the Migration Logs (K8s)</h7><p>Run a command to tail the logs so you can see when old events have finished migrating:</p><pre class="programlisting">kubectl -n sysdigcloud logs -f sysdig-event-migration</pre><p>The tool will begin to migrate old events:</p><pre class="programlisting">2018-07-25 09:58:50.806  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 133932
2018-07-25 09:58:52.343  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134182
2018-07-25 09:58:54.091  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134432
2018-07-25 09:58:56.114  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134682
2018-07-25 09:58:57.776  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134932
2018-07-25 09:58:59.161  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135182
2018-07-25 09:59:00.649  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135432
2018-07-25 09:59:01.994  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135682</pre><p>When complete, it will be begin to check for new events in 1-minute intervals:</p><pre class="programlisting">2018-07-25 09:59:44.206  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : No more alert_event to migrate...
2018-07-25 09:59:48.293  INFO 7 --- [           main] com.sysdig.services.MigrationService     : Let's sleep for 1 minute before continue</pre><p>At this point you can launch the upgrade to version 1149. The migration tool continues to run.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-3UpgradetheSysdigPlatformK8s" class="bridgehead">3. Upgrade the Sysdig Platform (K8s)</h7><p>Check the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115002168966" target="_blank">Release Notes</a>.</p><p>Follow the process to <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0" title="Basic Upgrade Kubernetes Installations">Basic Upgrade Kubernetes Installations</a>.</p><p>During upgrade, the tool will check periodically for new events.</p><p>Logger output:</p><pre class="programlisting">2018-07-25 10:00:48.294  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Checking for new events ---
2018-07-25 10:00:48.295  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Executing alertEventMigration ---
2018-07-25 10:00:48.422  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Starting from id 141933
2018-07-25 10:00:48.606  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Event count to be migrated: 0
2018-07-25 10:00:48.731  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : No more alert_event to migrate...
2018-07-25 10:00:48.731  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Executing policyEventMigration ---
2018-07-25 10:00:48.860  INFO 7 --- [           main] c.s.m.events.PolicyEventMigration        : Starting from id 567685605761232896
2018-07-25 10:00:49.168  INFO 7 --- [           main] c.s.m.events.PolicyEventMigration        : Event count to be migrated: 0
2018-07-25 10:00:49.484  INFO 7 --- [           main] c.s.m.events.PolicyEventMigration        : No more policy_event to migrate...
2018-07-25 10:00:49.484  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Executing customEventMigration ---
2018-07-25 10:00:49.607  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Starting from id 0
2018-07-25 10:00:49.882  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Event count to be migrated: 0
2018-07-25 10:00:50.148  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : No more custom_event to migrate...
2018-07-25 10:00:50.148  INFO 7 --- [           main] com.sysdig.services.MigrationService     : Let's sleep for 1 minute before continue</pre><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-4TerminatetheMigrationToolK8s" class="bridgehead">4. Terminate the Migration Tool (K8s)</h7><p>When the Sysdig platform update is complete, <span class="bold bold"><strong>leave the migration tool running for at least 3 minutes.</strong></span> </p><p>To verify that the process is complete, check in the logs that custom events are no longer migrating. Sample output:</p><pre class="programlisting">2018-07-25 10:00:49.484  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Executing customEventMigration ---
2018-07-25 10:00:49.607  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Starting from id 0
2018-07-25 10:00:49.882  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Event count to be migrated: 0
2018-07-25 10:00:50.148  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : No more custom_event to migrate...</pre><p>Then terminate the migration tool by running the following command:</p><pre class="programlisting">kubectl -n sysdigcloud delete -f {migration_tool_specs}.yaml</pre><p> <span class="bold bold"><strong>Migration and upgrade are complete.</strong></span> </p><p>If necessary, check the Troubleshooting tips.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-ReplicatedSteps" class="bridgehead">Replicated Steps</h7><p>If your environment is airgapped, you need to create an "image" of the migration tool that can be used on an airgapped install. Otherwise, proceed with 1. Run the Container Image.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-PrerequisiteforAirgappedEnvironments" class="bridgehead">Prerequisite for Airgapped Environments</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Pull the image onto a host that has access to the Internet:</p><pre class="programlisting">docker pull quay.io/sysdig/onprem_migration:combined-events_0.1.0_1091-1149</pre></li><li class="step"><p>Save the downloaded image to a TAR file:</p><pre class="programlisting">docker save -o migrate.tar quay.io/sysdig/onprem_migration</pre></li><li class="step"><p>Move the image TAR to the airgapped machine and deploy the image:</p><pre class="programlisting">docker load -i migrate.tar</pre></li></ol></div><p>Continue with the Replicated steps, below.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-1RuntheContainerImageReplicated" class="bridgehead">1. Run the Container Image (Replicated)</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Ensure that the container has network visibility to the MySQL and ElasticSearch components.</p></li><li class="listitem"><p>Run the migration tool container on a Coordinating Replicated Node, and run the container using the private addresses of data source endpoints.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The data source endpoints can be found on the Replicated Dashboard, in <span class="bold bold"><strong>Cluster</strong></span> settings.</p><p>Other parameters, such as DB usernames, can be found in the <span class="bold bold"><strong>Settings</strong></span> section of the Replicated Dashboard console.</p><p> <span class="bold bold"><strong> NOTE:</strong></span> The MySQL password was set when the Sysdig back end was <a class="link" href="">installed using Replicated</a>. The administrator needed to save and remember the DB passwords that were set, as they are not visible in the Replicated console.</p><div class="mediaobject"><table style="border: 0; width: 600px; cellpadding: 0; cellspacing: 0;" class="image-viewport"><tr><td><img style="max-width: 600px; " src="image/15d5af4f37e816.png" alt="373573554.png"></img></td></tr></table></div></div></li></ul></div><p>Execute the following Docker run command, providing the values described in the Appendix - Migration Tool Container Parameters.</p><p>In Docker command format:</p><pre class="programlisting">docker run -d --name sysdig-event-migration -e DB_ENDPOINT=10.111.0.1 -e DB_CONNECTION_TIMEOUT=4000 -e DB_SOCKET_TIMEOUT=12000 -e DB_USER=root -e DB_PASSWORD=&lt;password&gt; -e BATCH_SIZE=350 -e ES_ENDPOINT=http://10.111.0.1 -e ALERT_EVENTS=true -e CUSTOM_EVENTS=true -e POLICY_EVENTS=true -e REPAIR_MODE=false -e ONPREM=true quay.io/sysdig/onprem_migration:combined-events_0.1.0_1091-1149</pre><p>With annotations for</p><pre class="programlisting">docker run -d --name sysdig-event-migration \
    -e DB_ENDPOINT=&lt;mysql_url&gt; \                                                                    # &lt;mysql_url&gt; should be address without protocol defined (e.g. without 'http://')
    -e DB_CONNECTION_TIMEOUT=&lt;connection_timeout&gt; \
    -e DB_SOCKET_TIMEOUT=&lt;socket_timeout&gt; \
    -e DB_USER=&lt;user_name&gt; \
    -e DB_PASSWORD=&lt;password&gt; \
    -e BATCH_SIZE=&lt;batch_size&gt; \
    -e ES_ENDPOINT=&lt;elasticsearch_endpoint&gt; \                                                # &lt;elasticsearch_endpoint&gt; should be address with protocol defined (e.g.with 'http://')
    -e ES_PORT=&lt;elasticsearch_port&gt; \                                                                # Default port is 9200, needs to be changed in case of custom value
    -e ALERT_EVENTS=true \
    -e CUSTOM_EVENTS=true \
    -e POLICY_EVENTS=true \
    -e REPAIR_MODE=false \
    -e ONPREM=true \
    quay.io/sysdig/onprem_migration:combined-events_0.1.0_1091-1149     </pre><p>Sample logger output:</p><pre class="programlisting">2018-07-26 10:42:49.129  INFO 8 --- [           main] com.sysdig.EventMigration                : Started EventMigration in 21.956 seconds (JVM running for 23.097)
2018-07-26 10:42:49.130  INFO 8 --- [           main] com.sysdig.EventMigration                : ====================== Onprem ======================
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * DB Settings
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Connection Endpoint: mysql-master.staging.sysdigcloud.com
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Connection Timeout: 4000
2018-07-26 10:42:49.131  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Socket Timeout: 15000
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Username: admin
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Password: *********
2018-07-26 10:42:49.132  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * ES Settings
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Endpoint Url: http://localhost
2018-07-26 10:42:49.134  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Endpoint Port: 9200
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * Migration Settings
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- Batch Size: 250
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.139  INFO 8 --- [           main] com.sysdig.EventMigration                : * Active Migrations
2018-07-26 10:42:49.140  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- custom-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- alert-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * -- policy-events
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : *
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : * Migration is running in NORMAL mode
2018-07-26 10:42:49.141  INFO 8 --- [           main] com.sysdig.EventMigration                : ==================================================
2018-07-26 10:42:49.158  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing alertEventMigration ---
2018-07-26 10:42:51.499  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Starting from id 0
2018-07-26 10:42:51.681  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Event count to be migrated: 8251</pre><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-2WatchtheMigrationLogsReplicated" class="bridgehead">2. Watch the Migration Logs (Replicated)</h7><p>Run a command to tail the logs so you can see when old events have finished migrating:</p><pre class="programlisting">docker logs -f sysdig-event-migration</pre><p>The tool will begin to migrate old events:</p><pre class="programlisting">2018-07-25 09:58:50.806  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 133932
2018-07-25 09:58:52.343  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134182
2018-07-25 09:58:54.091  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134432
2018-07-25 09:58:56.114  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134682
2018-07-25 09:58:57.776  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 134932
2018-07-25 09:58:59.161  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135182
2018-07-25 09:59:00.649  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135432
2018-07-25 09:59:01.994  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 250 events; latest id is 135682</pre><p>When complete, it will be begin to check for new events in 1-minute intervals:</p><pre class="programlisting">2018-07-25 09:59:44.206  INFO 7 --- [           main] c.s.m.events.AlertEventMigration         : No more alert_event to migrate...
2018-07-25 09:59:48.293  INFO 7 --- [           main] com.sysdig.services.MigrationService     : Let's sleep for 1 minute before continue</pre><p>At this point you can launch the upgrade to version 1149. The migration tool continues to run.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-3UpgradetheSysdigPlatformReplicated" class="bridgehead">3. Upgrade the Sysdig Platform (Replicated)</h7><p>Check the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115002168966" target="_blank">Release Notes</a>.</p><p>Follow the process to <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f" title="Upgrade Replicated Installations">Upgrade Replicated Installations</a>.</p><p>During upgrade, the tool will check periodically for new events.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>In Replicated, the upgrade requires ElasticSearch and MySQL servers to be restarted, so you will experience connection loss during upgrade. The migration tool is designed to handle this gracefully, so connection loss <code class="code">WARN</code> messages in logs are expected and not a problem with the migration.</p></div><p>Replicated logger output (note the WARN messages):</p><pre class="programlisting">...
2018-08-07 12:24:19.659  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 300 events; latest id is 1600306
2018-08-07 12:24:34.703  INFO 8 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [org/springframework/jdbc/support/sql-error-codes.xml]
2018-08-07 12:24:34.813  INFO 8 --- [           main] o.s.jdbc.support.SQLErrorCodesFactory    : SQLErrorCodes loaded: [DB2, Derby, H2, HDB, HSQL, Informix, MS-SQL, MySQL, Oracle, PostgreSQL, Sybase]
2018-08-07 12:24:39.182  WARN 8 --- [           main] com.sysdig.services.MigrationService     : Connection with MySQL has been lost: Communications link failure
2018-08-07 12:24:40.803  INFO 8 --- [           main] com.sysdig.services.MigrationService     : Let's sleep for 1 minute before continue
2018-08-07 12:25:40.734  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Checking for events to migrate ---
2018-08-07 12:25:40.736  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing alertEventMigration ---
2018-08-07 12:25:41.000  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Starting from id 1600306
2018-08-07 12:25:41.363  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Event count to be migrated: 455573
2018-08-07 12:25:42.106  WARN 8 --- [           main] com.sysdig.services.MigrationService     : Connection with ES has been lost: Could not connect to http://host.docker.internal:9200
2018-08-07 12:25:42.107  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing policyEventMigration ---
2018-08-07 12:25:42.240  INFO 8 --- [           main] c.s.m.events.PolicyEventMigration        : Starting from id 0
2018-08-07 12:25:42.243  WARN 8 --- [           main] c.s.m.events.PolicyEventMigration        : Error during data fetch from ES, due to: Could not connect to http://host.docker.internal:9200
2018-08-07 12:25:42.246  WARN 8 --- [           main] com.sysdig.services.MigrationService     : Connection with ES has been lost: Could not connect to http://host.docker.internal:9200
2018-08-07 12:25:42.247  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing customEventMigration ---
2018-08-07 12:25:42.384  INFO 8 --- [           main] c.s.m.events.CustomEventMigration        : Starting from id 569942131465043968
2018-08-07 12:25:42.386  WARN 8 --- [           main] c.s.m.events.CustomEventMigration        : Error during data fetch from ES, due to: Could not connect to http://host.docker.internal:9200
2018-08-07 12:25:42.389  WARN 8 --- [           main] com.sysdig.services.MigrationService     : Connection with ES has been lost: Could not connect to http://host.docker.internal:9200
2018-08-07 12:25:42.389  INFO 8 --- [           main] com.sysdig.services.MigrationService     : Let's sleep for 1 minute before continue   
2018-08-07 12:26:42.320  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Checking for events to migrate ---
2018-08-07 12:26:42.321  INFO 8 --- [           main] com.sysdig.services.MigrationService     : --- Executing alertEventMigration ---
2018-08-07 12:26:42.584  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Starting from id 1600306
2018-08-07 12:26:42.923  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Event count to be migrated: 455578
2018-08-07 12:26:44.404  INFO 8 --- [           main] c.s.m.events.AlertEventMigration         : Indexed 300 events; latest id is 1600606
</pre><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-4TerminatetheMigrationToolReplicated" class="bridgehead">4. Terminate the Migration Tool (Replicated)</h7><p>When the Sysdig platform update is complete, <span class="bold bold"><strong>leave the migration tool running for at least 3 minutes.</strong></span> </p><p>To verify that the process is complete, check in the logs that custom events are no longer migrating.</p><p>Sample output:</p><pre class="programlisting">2018-07-25 10:00:49.484  INFO 7 --- [           main] com.sysdig.services.MigrationService     : --- Executing customEventMigration ---
2018-07-25 10:00:49.607  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Starting from id 0
2018-07-25 10:00:49.882  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : Event count to be migrated: 0
2018-07-25 10:00:50.148  INFO 7 --- [           main] c.s.m.events.CustomEventMigration        : No more custom_event to migrate...</pre><p>Then terminate the migration tool, by running the following command:</p><pre class="programlisting">docker stop sysdig-event-migration
docker rm sysdig-event-migration</pre><p> <span class="bold bold"><strong>Migration and upgrade are complete.</strong></span> </p><p>If necessary, check the Troubleshooting tips.</p><h6 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-Troubleshooting" class="bridgehead">Troubleshooting</h6><p>In rare cases, migration errors can occur due to incorrect container configuration, network latency, or temporary cluster overload.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Temporary connection-loss errors in Replicated are expected and are not migration errors, as described in Upgrade the Sysdig Platform (Replicated) </p></div><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-MigrationStartupErrors" class="bridgehead">Migration Startup Errors</h7><p>Startup errors are normally due to incorrect environment variable settings.</p><p>Check URL endpoints, passed credentials, flags, etc.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-MigrationProcessErrors" class="bridgehead">Migration Process Errors</h7><p>If you were able to run migration successfully, it functioned for a while, and then began to experience errors, this is most likely caused by network latency or cluster overload. In these cases, the migration tool will try to reduce the pressure on the cluster by reducing batch size exponentially, with a predefined backoff wait time.</p><p>Ultimately, if events cannot be indexed, the migration tool will skip the issued batch and try to index the next batch. Information about the failed batch will be stored in the MySQL table <code class="code">utility_metadata</code>.</p><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-TemporaryErrors" class="bridgehead">Temporary Errors</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If errors are only temporary, simply proceed with Running the Migration Steps.</p></li><li class="listitem"><p>When migration is complete, run the migration container again with the <code class="code"> -e REPAIR_MODE=true</code> parameter. This will index all failed migrations stored in the MySQL table <code class="code">utility_metadata</code>.</p></li></ul></div><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-ContinuousErrors" class="bridgehead">Continuous Errors</h7><p>At this point, abort the migration attempt. Check the number of errors to decide how to proceed.</p><p>To do so, check the MySQL table with:</p><pre class="programlisting">SELECT COUNT(*) FROM utility_metadata WHERE metadata_id LIKE 'failure-%';</pre><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-LOWErrorCount0-1000" class="bridgehead">LOW Error Count (0 - 1000)</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Try to identify why errors started (i.e. temporary cluster overload), resolve the problem and re-run the migration.</p></li><li class="listitem"><p>When migration is complete, run the migration container again with the <code class="code"> -e REPAIR_MODE=true</code> parameter. This will index all failed migrations stored in the MySQL table <code class="code">utility_metadata.</code> </p></li></ul></div><h7 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-HIGHErrorCount10000" class="bridgehead">HIGH Error Count (10,000+)</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Try to identify why errors started (i.e. temporary cluster overload), resolve the problem, and <span class="bold bold"><strong>RESET</strong></span> the migration progress completely by clearing all content from the MySQL table <code class="code">utility_metadata</code>.</p><p>(e.g. <code class="code">DELETE FROM utility_metadata;</code>)</p></li><li class="listitem"><p>Repeat Running the Migration Steps.</p></li></ul></div><h6 id="UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d_id_MigrationToolforUnifiedEventsPlatformv1149-Appendix-MigrationToolContainerParameters" class="bridgehead">Appendix - Migration Tool Container Parameters</h6><p>All parameters are defined as environment variables.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Env Param</p></th><th class="th"><p>Required</p></th><th class="th"><p>Type</p></th><th class="th"><p>Description</p></th><th class="th"><p>Example</p></th><th class="th"><p>Recommended values</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>DB_ENDPOINT</strong></span> </p></td><td class="td"><p>true</p></td><td class="td"><p>string</p></td><td class="td"><p>Defined database connection endpoint</p></td><td class="td"><p> <a class="link" href="http://MYSQLURL.com" target="_blank">MYSQLURL.com</a> </p></td><td class="td"><p>Do NOT include the protocol (e.g. <span class="bold bold"><strong>https://</strong></span>) in the endpoint entry</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>DB_CONNECTION_TIMEOUT</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>int</p></td><td class="td"><p>Defined connection timeout period</p></td><td class="td"><p>5000</p></td><td class="td"><p>Default value if not set is <code class="code">5000</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>DB_SOCKET_TIMEOUT</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>int</p></td><td class="td"><p>Defined socket timeout period</p></td><td class="td"><p>300000</p></td><td class="td"><p>Default value if not set is <code class="code">30000</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>DB_USER</strong></span> </p></td><td class="td"><p>true</p></td><td class="td"><p>string</p></td><td class="td"><p>Defined database username</p></td><td class="td"><p>root</p></td><td class="td"><p>/</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>DB_PASSWORD</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>string</p></td><td class="td"><p>Defined database password</p></td><td class="td"><p>pass</p></td><td class="td"><p>/</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>ES_ENDPOINT</strong></span> </p></td><td class="td"><p>true</p></td><td class="td"><p>string</p></td><td class="td"><p>ElasticSearch endpoint</p></td><td class="td"><p> <a class="link" href="http://MYELASTICSEARCHURL.com" target="_blank">http://MYELASTICSEARCHURL.com</a> </p></td><td class="td"><p>Include the protocol (e.g <span class="bold bold"><strong>http://</strong></span>) in the endpoint entry</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>ES_PORT</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>int</p></td><td class="td"><p>ElasticSearch port</p></td><td class="td"><p>9200</p></td><td class="td"><p>If there is no LB in front of the cluster it should be <code class="code">9200</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>BATCH_SIZE</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>int</p></td><td class="td"><p>Size of indexing event batch</p></td><td class="td"><p>500</p></td><td class="td"><p>Default value if not set is <code class="code">500</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>ALERT_EVENTS</strong></span> </p></td><td class="td"><p>one of</p></td><td class="td"><p>boolean</p></td><td rowspan="3" class="td"><p>Simple options that specify which migrations should be executed.</p><p> <span class="bold bold"><strong>At least one of them must be provided</strong></span> </p></td><td rowspan="3" class="td"><p>/</p></td><td rowspan="3" class="td"><p>Default value if not set is <code class="code">false</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>CUSTOM_EVENTS</strong></span> </p></td><td class="td"><p>one of</p></td><td class="td"><p>boolean</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>POLICY_EVENTS</strong></span> </p></td><td class="td"><p>one of</p></td><td class="td"><p>boolean</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>ONPREM</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>boolean</p></td><td class="td"><p>Specify whether this is migration executed in on-premise environment</p></td><td class="td"><p>true</p></td><td class="td"><p>All onpremise migrations should have this option set to <span class="bold bold"><strong> <code class="code">true</code>;</strong></span> default <code class="code">false</code> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>REPAIR_MODE</strong></span> </p></td><td class="td"><p>false</p></td><td class="td"><p>boolean</p></td><td class="td"><p>Specify that migration will be running repair mode</p></td><td class="td"><p>true</p></td><td class="td"><p>This should be only used in case of errors during migrations (explained in following sections), default <code class="code">false</code> </p></td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Prerequisites  </p></li><li class="listitem"><p> Where to Find the Tool </p></li><li class="listitem"><p> Running the Migration  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Kubernetes Steps  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> 1. Run the Container Image (K8s) </p></li><li class="listitem"><p> 2. Watch the Migration Logs (K8s) </p></li><li class="listitem"><p> 3. Upgrade the Sysdig Platform (K8s) </p></li><li class="listitem"><p> 4. Terminate the Migration Tool (K8s) </p></li></ul></div></li><li class="listitem"><p> Replicated Steps  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Prerequisite for Airgapped Environments  </p></li><li class="listitem"><p> 1. Run the Container Image (Replicated) </p></li><li class="listitem"><p> 2. Watch the Migration Logs (Replicated) </p></li><li class="listitem"><p> 3. Upgrade the Sysdig Platform (Replicated) </p></li><li class="listitem"><p> 4. Terminate the Migration Tool (Replicated) </p></li></ul></div></li></ul></div></li><li class="listitem"><p> Troubleshooting  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Migration Startup Errors  </p></li><li class="listitem"><p> Migration Process Errors </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Temporary Errors </p></li><li class="listitem"><p> Continuous Errors </p></li></ul></div></li></ul></div></li><li class="listitem"><p> Appendix - Migration Tool Container Parameters  </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-f8cce52f-aa2d-65a4-c7fb-3c40f65f15c6" data-publication-date="" id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9"><div class="titlepage"><div><div class="title"><h6 class="title">Migration Tool for Upgrading to Sysdig Platform v. 1765 (Kubernetes)</h6></div></div></div><p>When upgrading to Sysdig platform version 1765 on Kubernetes, it is necessary first to apply a migration tool, due to a change which transitions from MySQL Connector to Maria DB Connector.</p><p>The migration tool sets the MySQL server authentication plugin for Sysdig admin user to <code class="code">mysql_native_password.</code> </p><p>Run the tool even if you are unsure whether the authentication plugin setting requirement matches your environment. If the tool detects that your setting is already compatible with MariaDB Connector, no changes will be made.</p><p>After running the migration script, you will be ready to upgrade.</p><h6 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-RuntheMigration" class="bridgehead">Run the Migration</h6><h7 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-Prerequisite" class="bridgehead">Prerequisite</h7><p>The migration tool script must be run on a computer with access to Sysdig Kubernetes namespace (default name "<code class="code">sysdigcloud</code>")</p><h7 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-Steps" class="bridgehead">Steps</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Download the migration tool script from <a class="link" href="https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/migrations/mysql/mysql8-mariadb-conj-auth-migration/mysql8-mariadb-conj-auth-migration.sh" target="_blank">https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/master/migrations/mysql/mysql8-mariadb-conj-auth-migration/mysql8-mariadb-conj-auth-migration.sh</a>, by running:</p><pre class="programlisting">curl -O https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/v1765/migrations/mysql/mysql8-mariadb-conj-auth-migration/mysql8-mariadb-conj-auth-migration.sh</pre><p>or</p><pre class="programlisting">wget https://raw.githubusercontent.com/draios/sysdigcloud-kubernetes/v1765/migrations/mysql/mysql8-mariadb-conj-auth-migration/mysql8-mariadb-conj-auth-migration.sh</pre></li><li class="step"><p>Add "execute" permission and run the script:</p><pre class="programlisting">chmod u+x mysql8-mariadb-conj-auth-migration.sh
./mysql8-mariadb-conj-auth-migration.sh</pre></li><li class="step"><p>You will be prompted to enter values:</p><ol type="a" class="substeps"><li class="step"><p> <span class="italic italic">Kubernetes context</span>: By default, the script uses the current Kubernetes context for the migration. Enter a different context if required.</p></li><li class="step"><p> <span class="italic italic">Kubernetes namespace</span>: By default, the script assumes the default name for Sysdig Kubernetes namespace "<code class="code">sysdigcloud</code>". Enter a different namespace if required.</p></li><li class="step"><p> <span class="italic italic">(optional) MySQL port, root username, and root password</span> <span class="bold bold"><strong>: </strong></span>The script attempts to run the migration with the default values for MySQL port, root user, and root password. If custom values are required, the script will prompt you to enter them.</p></li></ol></li><li class="step"><p>Review the output. Note that the script cleans up after itself when the migration is complete.</p></li><li class="step"><p>Proceed with the Upgrade to version 1765.</p><ol type="a" class="substeps"><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Upgrade+Kubernetes+Installations" target="_blank">Kubernetes Basic Upgrade</a> (if running Sysdig Monitor only)</p></li><li class="step"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/316768295/Upgrade+Kubernetes+Installations+scanning+option+included" target="_blank">Kubernetes Expanded Upgrade</a> (for Sysdig Platform-- i.e. Sysdig Monitor + Sysdig Secure with Scanning)</p></li></ol></li></ol></div><h6 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-SampleOutput" class="bridgehead">Sample Output</h6><h7 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-UsingDefaultParameters" class="bridgehead">Using Default Parameters</h7><pre class="programlisting">Sysdig MySQL to MariaDB Connector Migration Tool
Please enter the required values (press Enter for default).
Sysdig Kubernetes context (default current-context):
Sysdig Kubernetes namespace (default sysdigcloud):

Running the migration script with default parameters.
pod/sysdig-mysql8-mariadb-conj-auth-migration created

Before:
+-------+------+-----------------------+
| User  | Host | plugin                |
+-------+------+-----------------------+
| admin | %    | caching_sha2_password |
+-------+------+-----------------------+

After:
+-------+------+-----------------------+
| User  | Host | plugin                |
+-------+------+-----------------------+
| admin | %    | mysql_native_password |
+-------+------+-----------------------+

Migration successful.
Your Sysdig installation is ready to be upgraded.

pod "sysdig-mysql8-mariadb-conj-auth-migration" deleted
Untagged: quay.io/sysdig/onprem_migration:mysql8-mariadb-conj-auth-migration-1.0.0
Untagged: quay.io/sysdig/onprem_migration@sha256:c07e8f0265afc82a24f9c3f440e4d14665ca91d3a2e7d11b4271012dc120e39e
Deleted: sha256:0409ae7b6604522e0dc48cafcacd2668545e2f2de861eee2a6e49c56acf42a8a</pre><h7 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-UsingCustomParameters" class="bridgehead">Using Custom Parameters</h7><pre class="programlisting">Sysdig MySQL to MariaDB Connector Migration Tool
Please enter the required values (press Enter for default).
Sysdig Kubernetes context (default current-context):
Sysdig Kubernetes namespace (default sysdigcloud):

Running the migration script with default parameters.
pod/sysdig-mysql8-mariadb-conj-auth-migration created
pod "sysdig-mysql8-mariadb-conj-auth-migration" deleted

Custom parameters required, please enter the values in the following prompts.
MySQL port (default 3306):
MySQL root username (default root):
MySQL root password:

Running the migration script with custom parameters.
secret/mysql8-mariadb-conj-auth-migration-secret created
pod/sysdig-mysql8-mariadb-conj-auth-migration created

Before:
+-------+------+-----------------------+
| User  | Host | plugin                |
+-------+------+-----------------------+
| admin | %    | caching_sha2_password |
+-------+------+-----------------------+

After:
+-------+------+-----------------------+
| User  | Host | plugin                |
+-------+------+-----------------------+
| admin | %    | mysql_native_password |
+-------+------+-----------------------+

Migration successful.
Your Sysdig installation is ready to be upgraded.

pod "sysdig-mysql8-mariadb-conj-auth-migration" deleted
secret "mysql8-mariadb-conj-auth-migration-secret" deleted
Untagged: quay.io/sysdig/onprem_migration:mysql8-mariadb-conj-auth-migration-1.0.0
Untagged: quay.io/sysdig/onprem_migration@sha256:c07e8f0265afc82a24f9c3f440e4d14665ca91d3a2e7d11b4271012dc120e39e
Deleted: sha256:0409ae7b6604522e0dc48cafcacd2668545e2f2de861eee2a6e49c56acf42a8a</pre><h7 id="UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9_id_MigrationToolforUpgradingtoSysdigPlatformv1765Kubernetes-WhenNoChangeIsNeeded" class="bridgehead">When No Change Is Needed</h7><p>If the tool detects that no changes are required, the output will be similar to the cases above, but instead of printing the <code class="code">Before</code> and <code class="code">After</code> tables and "<code class="code">Migration successful.</code>", it will output "<code class="code">Nothing to be done: Sysdig admin user password already encoded with mysql_native_password encoder.</code>".</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Run the Migration </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Prerequisite </p></li><li class="listitem"><p> Steps </p></li></ul></div></li><li class="listitem"><p> Sample Output </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Using Default Parameters </p></li><li class="listitem"><p> Using Custom Parameters  </p></li><li class="listitem"><p> When No Change Is Needed </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-bfd356c4-24f1-0923-0773-0235fe74c8fe" data-publication-date="" id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0"><div class="titlepage"><div><div class="title"><h6 class="title">Basic Upgrade Kubernetes Installations</h6></div></div></div><p>Sysdig platform on-premise releases are listed <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases" target="_blank">here</a>. Each release has a version number (e.g. 1929) and specific <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SRN/pages/256606211/Sysdig+On-Premises+Release+Notes" target="_blank">release notes</a>.</p><div dir="ltr" class="tip tip"><h3 class="title">Tip</h3><p>Review the <a class="link" href="">Supported Migration Path</a> and associated documents before you begin</p></div><p>If you have licensed and will run only Sysdig Monitor, then you upgrade fewer components than if you also use Sysdig Secure, as described below.</p><h6 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-DownloadtheNewVersion" class="bridgehead">Download the New Version</h6><p>Use <code class="code">get</code> to download the new version from Sysdig's GitHub and unzip it.</p><p>For example (replace <code class="code">v1929</code> with the appropriate version number):</p><pre class="programlisting"> wget https://github.com/draios/sysdigcloud-kubernetes/archive/v1929.tar.gz &amp;&amp; tar xvf v1929.tar.gz</pre><h6 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-EditNewFilestoMatchYourCustomizedFiles" class="bridgehead">Edit New Files to Match Your Customized Files</h6><p>Edit the following files within the <code class="code">sysdigcloud</code> directory to match any customizations you may have made in your existing production system.</p><h7 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-configyaml" class="bridgehead">config.yaml</h7><p>Edit the Sysdig user name, default user, API URL, Sysdig license, collector endpoint, from your <span class="bold bold"><strong> <code class="code">config.yaml</code> </strong></span> to the new <span class="bold bold"><strong> <code class="code">config.yaml</code> </strong></span>.</p><pre class="programlisting">sysdigcloud.default.user: test@sysdig.com
collector.endpoint: onprem.sysdigcloud.com
collector.port: "6443"
api.url: https://onprem.sysdigcloud.com:443</pre><h7 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-deploymentyamls" class="bridgehead">deployment yamls</h7><p>Edit the CPU limits and replicas in the deployment yamls: <code class="code">api-deployment.yaml, collector-deployment.yaml, worker-deployment.yaml </code> </p><pre class="programlisting">resources:
  limits:
    cpu: "4"
    memory: 4Gi
  requests:
    cpu: "1"
    memory: 1G</pre><h6 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-ApplytheFiles" class="bridgehead">Apply the Files</h6><p>Run the <code class="code">kubctl</code> commands to apply the relevant files to the environment.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p> <span class="bold bold"><strong>For version 2266</strong></span> </p><p>This upgrade updates dashboards from v1 to v2. The process requires 20-30 minutes on large systems, and the environment remains live throughout the rolling upgrade.</p><p>DO NOT create or delete dashboards during the upgrade.</p><p>After upgrading, if you have saved v1 dashboards previously and need to upload them to the v2 environment, see Migrate Saved Dashboards from V1 to V2.</p></div><h7 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-RollingUpgradeforSysdigMonitorOnly" class="bridgehead">Rolling Upgrade for Sysdig Monitor Only</h7><pre class="programlisting">kubectl -n sysdigcloud apply -f api-deployment.yaml
kubectl -n sysdigcloud apply -f collector-deployment.yaml
kubectl -n sysdigcloud apply -f worker-deployment.yaml</pre><h7 id="UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-RollingUpgradeforSysdigMonitorSysdigSecure" class="bridgehead">Rolling Upgrade for Sysdig Monitor + Sysdig Secure</h7><pre class="programlisting">kubectl -n sysdigcloud apply -f api-deployment.yaml
kubectl -n sysdigcloud apply -f collector-deployment.yaml
kubectl -n sysdigcloud apply -f worker-deployment.yaml
kubectl -n sysdigcloud apply -f scanning-api-deployment.yaml
kubectl -n sysdigcloud apply -f scanning-alertmgr.yaml</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-DownloadtheNewVersion" title="Download the New Version">Download the New Version </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-EditNewFilestoMatchYourCustomizedFiles" title="Edit New Files to Match Your Customized Files">Edit New Files to Match Your Customized Files</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-configyaml" title="config.yaml">config.yaml</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-deploymentyamls" title="deployment yamls">deployment yamls </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-ApplytheFiles" title="Apply the Files">Apply the Files</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-RollingUpgradeforSysdigMonitorOnly" title="Rolling Upgrade for Sysdig Monitor Only">Rolling Upgrade for Sysdig Monitor Only </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0_id_BasicUpgradeKubernetesInstallations-RollingUpgradeforSysdigMonitorSysdigSecure" title="Rolling Upgrade for Sysdig Monitor + Sysdig Secure">Rolling Upgrade for Sysdig Monitor + Sysdig Secure</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-117f3f0a-19ee-6020-661c-d7b2c08690b6" data-publication-date="" id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda"><div class="titlepage"><div><div class="title"><h6 class="title">Expanded Upgrade Kubernetes Installations version 2.3.0</h6></div></div></div><p>Sysdig platform on-premise releases are listed <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases" target="_blank">here</a>. Each release has a version number and specific<a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SRN/pages/256606211/Sysdig+On-Premises+Release+Notes" target="_blank">release notes</a>.</p><div dir="ltr" class="tip tip"><h3 class="title">Tip</h3><p>Review the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SP/pages/373573515/On-Premises+Upgrades" target="_blank">Supported Migration Path</a> and associated documents before you begin</p></div><p> <span class="bold bold"><strong>This release has the following significant component changes:</strong></span> </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Includes the option of securing Elasticsearch and/or Cassandra with username/password authentication and TLS-encrypted data in transit. This prevents both unauthorized access to the clusters and network eavesdropping. The upgrade instructions below incorporate this new capability when using the Sysdig-provided Cassandra and Elasticsearch components.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If you are running your own Cassandra or Elasticsearch clusters, you can skip the sections: <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ElasticsearchandCassandraFiles" title="Elasticsearch and Cassandra Files">Elasticsearch and Cassandra Files</a> and Replace Existing Elasticsearch and Cassandra Pods.</p></div></li><li class="step"><p>Updates of the Postgres database and Anchore engine (if you are running Sysdig Secure).</p></li><li class="step"><p>The following parameter has been renamed in config.yaml: <span class="bold bold"><strong> <code class="code">elasticsearch.url</code> </strong></span> to <span class="bold bold"><strong> <code class="code">elasticsearch.hostname</code> </strong></span> </p><p>The value of <code class="code">elasticsearch.hostname</code> does not include the protocol (e.g.http://); just use the hostname itself. For example, if you had <code class="code">elasticsearch.url: </code> <code class="code"> <a class="link" href="http://sysdigcloud-elasticsearch" target="_blank">http://sysdigcloud-elasticsearch</a> </code>, it would now be <code class="code">elasticsearch.hostname: sysdigcloud-elasticsearch</code>.</p></li></ol></div><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ContentsContents" class="bridgehead">Contents</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-DownloadtheNewVersion" title="Download the New Version">Download the New Version </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-EditNewFilestoMatchYourCustomizedFiles" title="Edit New Files to Match Your Customized Files">Edit New Files to Match Your Customized Files</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-SysdigCloudFiles" title="Sysdig Cloud Files">Sysdig Cloud Files</a> </p></li><li class="listitem"><p> Postgres File (if running Sysdig Secure) </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ElasticsearchandCassandraFiles" title="Elasticsearch and Cassandra Files">Elasticsearch and Cassandra Files </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ApplytheFiles" title="Apply the Files">Apply the Files</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-UpgradeforSysdigMonitor" title="Upgrade for Sysdig Monitor">Upgrade for Sysdig Monitor</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-UpgradeforSysdigSecure" title="Upgrade for Sysdig Secure">Upgrade for Sysdig Secure</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-StatefulsetDeletionandCreation" title="Statefulset Deletion and Creation">Statefulset Deletion and Creation</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ReplaceExistingStatefulsetPods" title="Replace Existing Statefulset Pods">Replace Existing Statefulset Pods</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-NextSteps" title="Next Steps">Next Steps </a> </p></li></ul></div><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-DownloadtheNewVersion" class="bridgehead">Download the New Version</h6><p>Download the new version from Sysdig's GitHub and unzip it.</p><p>Note that as of this release, versioning standards have changed from a single build number (e.g. v1929) to semantic versioning (e.g. 2.3.0)</p><pre class="programlisting"> wget https://github.com/draios/sysdigcloud-kubernetes/archive/&lt;version_number&gt;.tar.gz &amp;&amp;  tar xvf &lt;version_number&gt;.tar.gz</pre><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-EditNewFilestoMatchYourCustomizedFiles" class="bridgehead">Edit New Files to Match Your Customized Files</h6><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is important to use the latest (2.3.0) YAML files for a successful upgrade.</p><p>Edit the following files within the <code class="code">sysdigcloud</code> directory to match any customizations you may have made in your existing production system.</p></div><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-SysdigCloudFiles" class="bridgehead">Sysdig Cloud Files</h7><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Customization involves copying the existing settings from your environment and modifying the files listed in this section.</p></div><p>Update the following files with customizations from your existing environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">sysdigcloud/config.yaml:</code> Pull configurations from your <span class="bold bold"><strong> <code class="code">sysdigcloud-config configmap</code> </strong></span> to the downloaded <span class="bold bold"><strong> <code class="code">sysdigcloud/config.yaml</code> </strong></span>.</p><p>The following variables are mandatory for Sysdig installations:</p><pre class="programlisting">api.url
collector.endpoint
sysdigcloud.license</pre><p>The following variables are optional but commonly modified for Sysdig installations:</p><pre class="programlisting">cassandra.jvm.options
elasticsearch.jvm.options
sysdigcloud.jvm.api.options
sysdigcloud.jvm.collector.options
sysdigcloud.jvm.worker.options</pre><p>If you have modified the previous <code class="code">config.yaml</code>, copy the modified options such as the external endpoints. You must also check deployment YAML files for CPU/memory settings.</p></li><li class="listitem"><p>Copy configurations from your existing deployment and update the <code class="code">spec.replicas</code> definition in the following files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <code class="code">sysdigcloud/api-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/collector-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/worker-deployment.yaml</code> </p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If running Sysdig Secure:</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Please do not edit the <code class="code">image:</code> property.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <code class="code">sysdigcloud/anchore-core-config.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/anchore-worker-config.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/anchore-core-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/a</code> <code class="code">nchore-worker-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/scanning-api-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/scanning-alertmgr-deployment.yaml</code> </p></li></ul></div></li></ul></div><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-PostgresFileifrunningSysdigSecure" class="bridgehead">Postgres File (if running Sysdig Secure)</h7><p>Update the following file with customizations from your existing environment:</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Please do not edit the <code class="code">image:</code> property.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Modify the storage class name, <code class="code">spec.volumeClaimTemplates[].spec.storageClassName </code>in the <code class="code">datastores/as_ku</code> <code class="code">bernetes_p</code> <code class="code">ods/manifests/postgres/postgres-statefulset.yaml</code> file.</p></li></ul></div><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ElasticsearchandCassandraFiles" class="bridgehead">Elasticsearch and Cassandra Files</h7><p>In version 2.3.0, Elasticsearch and Cassandra yaml configurations have been updated. Update the new files with customizations from your existing environment.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Please do not edit the <code class="code">image:</code> property.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">elasticsearch-statefulset.yaml</code> - For example, your environment may have customized the values for the number of replicas, resource constraints, amount of storage, and the storage class name:</p><pre class="programlisting">spec.replicas and spec.template.spec.containers[elasticsearch].env[ELASTICSEARCH_GOSSIP_NODES_NUM].value
spec.template.spec.containers[].resources
spec.volumeClaimTemplates[].spec.resources.requests.storage
spec.volumeClaimTemplates[].spec.storageClassName</pre></li><li class="listitem"><p> <code class="code">cassandra-statefulset.yaml</code> - As with Elasticsearch, your environment may have customized the values for the number of replicas, resource constraints, amount of storage, and the storage class name:</p><pre class="programlisting">spec.replicas
spec.template.spec.containers[].resources
spec.volumeClaimTemplates[].spec.resources.requests.storage
spec.volumeClaimTemplates[].spec.storageClassName</pre></li></ul></div><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ApplytheFiles" class="bridgehead">Apply the Files</h6><p>Run the <code class="code">kubectl</code> commands to apply the relevant files to your cluster.</p><p>Note: if you run into an error replacing the statefulsets, you may need to delete the existing one before applying the new configuration. See the <span class="bold bold"><strong>Statefulset Deletion and Creation</strong></span> section below.</p><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-UpgradeforSysdigMonitor" class="bridgehead">Upgrade for Sysdig Monitor</h7><pre class="programlisting">NAMESPACE=sysdigcloud
kubectl -n $NAMESPACE apply -f sysdigcloud/config.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/api-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/collector-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/worker-deployment.yaml
kubectl -n $NAMESPACE replace -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml
kubectl -n $NAMESPACE replace -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml</pre><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-UpgradeforSysdigSecure" class="bridgehead">Upgrade for Sysdig Secure</h7><pre class="programlisting">kubectl -n $NAMESPACE apply -f sysdigcloud/anchore-core-config.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/anchore-worker-config.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/anchore-core-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/anchore-worker-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/scanning-alertmgr-service.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/scanning-api-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/scanning-alertmgr-deployment.yaml
kubectl -n $NAMESPACE apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre><h7 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-StatefulsetDeletionandCreation" class="bridgehead">Statefulset Deletion and Creation</h7><p>If you are unable to update the existing statefulsets with the commands above, you may need to delete them before applying the new configuration.</p><pre class="programlisting"># Elasticsearch
kubectl -n $NAMESPACE delete statefulset sysdigcloud-elasticsearch
kubectl -n $NAMESPACE apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml

# Cassandra
kubectl -n $NAMESPACE delete statefulset sysdigcloud-cassandra
kubectl -n $NAMESPACE apply -f datastores/as_kubernetes_pods/manifests/cassandra/cassandra-statefulset.yaml

# Postgres (if running Sysdig Secure)
kubectl -n $NAMESPACE delete statefulset sysdigcloud-postgresql
kubectl -n $NAMESPACE apply -f datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</pre><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-ReplaceExistingStatefulsetPods" class="bridgehead">Replace Existing Statefulset Pods</h6><p>The <code class="code">replace</code> command above only replaces the Kubernetes configuration, but not the running pods themselves. For the changes to take effect, perform the following steps:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>For Elasticsearch, run:</p><pre class="programlisting">kubectl -n $NAMESPACE delete pod -l role=elasticsearch
kubectl -n $NAMESPACE delete pod -l role=cassandra
# If running Sysdig Secure
kubectl -n $NAMESPACE delete pod -l role=postgresql</pre></li><li class="step"><p>Check that all the new pods come up <code class="code">Ready</code> by running the commands below separately:</p><pre class="programlisting">kubectl -n $NAMESPACE get pod -l role=elasticsearch
kubectl -n $NAMESPACE get pod -l role=cassandra
# If running Sysdig Secure
kubectl -n $NAMESPACE get pod -l role=postgresql</pre><p>This may take a few minutes.</p></li></ol></div><h6 id="UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda_id_ExpandedUpgradeKubernetesInstallationsversion230-NextSteps" class="bridgehead">Next Steps</h6><p>To secure Elasticsearch and Cassandra (using both authentication and SSL/TLS), follow the instructions below:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367099985/Securing+Elasticsearch" target="_blank">Securing Elasticsearch</a> </p></li><li class="listitem"><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367099989/Securing+Cassandra" target="_blank">Securing Cassandra</a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-103bf8ff-053a-66d5-34fc-b79463c50c72" data-publication-date="" id="UUID-06ebb487-d368-384d-836b-17682b6295ff"><div class="titlepage"><div><div class="title"><h6 class="title">Expanded Upgrade Kubernetes Installations for Sysdig Platform v. 1765</h6></div></div></div><p>Sysdig platform on-premises releases are listed <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases" target="_blank">here</a>. Each release has a version number and specific release notes.</p><p>The v. 1765 release of Sysdig Platform includes a scanning feature in Sysdig Secure which requires some additional upgrade steps.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>If you are running only Sysdig Monitor, and do not want to use Sysdig Secure, you can perform a simpler upgrade.</strong></span> </p><p>In this case, you would:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Apply at minimum the mandatory releases, as listed here: <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250" title="On-Premises Upgrades">On-Premises Upgrades</a>.</p></li><li class="step"><p>Run the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/319782952/Migration+Tool+for+MySQL+to+MariaDB+Connector+Switch+prereq+for+upgrading+to+3+1+19" target="_blank">Migration Tool</a>.</p></li><li class="step"><p>Run the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/236421227/Upgrade+Kubernetes+Installations" target="_blank">basic Kubernetes Upgrade</a>.</p></li></ol></div></div><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p> <span class="bold bold"><strong>If you are running Sysdig Secure on OpenShift,</strong></span> contact Sysdig Support for assistance upgrading to v. 1765.</p></div><p>If you are running both Sysdig Monitor and Sysdig Secure (aka Sysdig Platform), use the instructions on this page.</p><h6 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Overview" class="bridgehead">Overview</h6><p>The 1765 release of the Sysdig Platform supports the Sysdig Secure image scanning feature. Upgrading to this release requires adding components and changing existing components in your current Sysdig Platform implementation.</p><p>These are the major changes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>All ingress now uses an ingress controller.</p></li><li class="listitem"><p>An additional database on the existing mysql deployment is required if you are using Sysdig Secure.</p></li><li class="listitem"><p>There are additional Kubernetes services, deployments, and statefulsets.</p></li><li class="listitem"><p>The “<code class="code">sysdigcloud-config</code>” configmap has added many new key/values.</p></li><li class="listitem"><p>There are new Kubernetes secrets that are referenced by some components.</p></li></ul></div><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-BeforeYouUpgrade" class="bridgehead">Before You Upgrade</h7><p>Before upgrading to v. 1765, you must:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Apply at minimum the mandatory releases, as listed here: <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250" title="On-Premises Upgrades">On-Premises Upgrades</a>.</p></li><li class="step"><p>Run a <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/319782952/Migration+Tool+for+MySQL+to+MariaDB+Connector+Switch+prereq+for+upgrading+to+3+1+19" target="_blank">Migration Tool</a>.</p></li><li class="step"><p>Complete all the installation steps on this page.</p></li></ol></div><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is highly recommended to follow upgrade best practices:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Keep upgrades current</p></li><li class="listitem"><p>Upgrade progressively without skipping versions, and</p></li><li class="listitem"><p>Test upgrades in a non-mission-critical or staging environment before rolling into production.</p></li></ul></div></div><h6 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Steps" class="bridgehead">Steps</h6><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step1Downloadthesysdigcloud-kubernetesrelease" class="bridgehead">Step 1 Download the sysdigcloud-kubernetes release</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Download the latest release of the sysdigcloud-kubernetes repo from<a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases/latest" target="_blank">https://github.com/draios/sysdigcloud-kubernetes/releases/latest</a> </p></li><li class="listitem"><p>Unpack the .<code class="code">tar</code> file.</p></li></ul></div><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step2Updateexistingconfigmapsandaddsecrets" class="bridgehead">Step 2 Update existing configmaps and add secrets</h7><p>Edit the <code class="code">sysdigcloud-config </code>configmap and copy in the new <code class="code">Scanning and Anchore</code> section from <code class="code">sysdigcloud/config.yaml: </code> </p><pre class="programlisting">kubectl -n sysdigcloud edit configmap sysdigcloud-config</pre><p>Create the scanning and anchore secrets:</p><pre class="programlisting">kubectl -n sysdigcloud apply -f ./sysdigcloud/scanning-secrets.yaml
kubectl -n sysdigcloud apply -f ./sysdigcloud/anchore-secrets.yaml</pre><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step3AddadatabasetoMySQLdeployment" class="bridgehead">Step 3 Add a database to MySQL deployment</h7><p>You must manually create a new database on your existing MySQL endpoint and create a user and password for it. This database will be used by the scanning feature.</p><p>Log in to your existing MySQL RDBMS and connect via the <code class="code">mysql cli</code> program with the <code class="code">root</code> user:</p><pre class="programlisting">kubectl -n sysdigcloud get pods
kubectl -n sysdigcloud exec -it &lt;any-mysql-pod&gt; bash
mysql --user=root --password=change_me
   CREATE DATABASE IF NOT EXISTS `sysdig_scanning` ;
   CREATE USER 'scanninguser'@'%' IDENTIFIED BY 'change_me' ;
   GRANT ALL ON `sysdig_scanning`.* TO 'scanninguser'@'%' ;
   FLUSH PRIVILEGES ;
</pre><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step4AddPostgresstatefulsetandservice" class="bridgehead">Step 4 Add Postgres statefulset and service</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Define the storage class that Postgres will use by editing the<code class="code">./datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml</code>file, and changing the <code class="code">storageClassName</code>” setting to the desired storage class.</p></li><li class="step"><p>Create the Postgres statefulset and service:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./datastores/as_kubernetes_pods/manifests/postgres/postgres-statefulset.yaml
kubectl -n sysdigcloud create -f ./datastores/as_kubernetes_pods/manifests/postgres/postgres-service.yaml</pre></li><li class="step"><p>Wait for the Postgres statefulset to be running before proceeding.</p></li></ol></div><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step5Addanchorecoreandworkerdeploymentsandservices" class="bridgehead">Step 5 Add anchore core and worker deployments and services</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the anchore configmaps:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/anchore-core-config.yaml
kubectl -n sysdigcloud create -f ./sysdigcloud/anchore-worker-config.yaml</pre></li><li class="step"><p>Create the anchore core deployment:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/anchore-core-deployment.yaml</pre><p>Wait for the anchore core pod to be running before proceeding.</p></li><li class="step"><p>Create the remaining anchore kubernetes objects:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/anchore-worker-deployment.yaml
kubectl -n sysdigcloud create -f ./sysdigcloud/anchore-service.yaml</pre></li></ol></div><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step6Addthescanningdeploymentsandservice" class="bridgehead">Step 6 Add the scanning deployments and service</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the scanning api deployment:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/scanning-api-deployment.yaml</pre><p>Wait for the <code class="code">scanning-api</code> pod to be running before proceeding.</p></li><li class="step"><p>Create the remaining scanning kubernetes objects:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/scanning-alertmgr-deployment.yaml
kubectl -n sysdigcloud create -f ./sysdigcloud/scanning-service.yaml</pre></li></ol></div><h7 id="UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step7AddtheingresscontrollerandredirectincomingAPIUItraffictoit" class="bridgehead">Step 7 Add the ingress controller and redirect incoming API/ UI traffic to it</h7><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>There will be a disruption in running agents during this upgrade while services are modified.</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Remove the following services:</p><pre class="programlisting">kubectl -n sysdigcloud delete service sysdigcloud-api
kubectl -n sysdigcloud delete service sysdigcloud-collector</pre></li><li class="step"><p>Create the <code class="code"> <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/blob/onprem-2019-02/sysdigcloud/api-headless-service.yaml" target="_blank">api-headless-service</a> </code> service:</p><pre class="programlisting">kubectl -n sysdigcloud create -f ./sysdigcloud/api-headless-service.yaml</pre></li><li class="step"><p>Create the ingress controller:</p><ol type="a" class="substeps"><li class="step"><p>Define <code class="code">&lt;namespace&gt;</code> in <code class="code">ingress-clusterrolebinding.yaml</code>. (In this document, we use <code class="code">sysdigcloud</code>).</p><pre class="programlisting">subjects:  
- kind: ServiceAccount    
  name: ingress-controller    
  namespace: &lt;namespace&gt;</pre></li><li class="step"><p>Edit the DNS entries in <code class="code">api-ingress-with-secure.yaml</code> for your environment:</p><pre class="programlisting">spec:
  rules:
    - host: &lt;EXTERNAL-DNS-NAME&gt;
      http:
        paths:
          - backend:
              serviceName: sysdigcloud-api
              servicePort: 8080 
            path: /
  tls:
    - hosts:
        - &lt;EXTERNAL-DNS-NAME&gt;</pre></li><li class="step"><p>Deploy the ingress yaml files:</p><pre class="programlisting">kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-clusterrole.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-clusterrolebinding.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-role.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-rolebinding.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-serviceaccount.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/default-backend-service.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/default-backend-deployment.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-configmap.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-tcp-services-configmap.yaml
kubectl -n sysdigcloud create -f sysdigcloud/ingress_controller/ingress-daemonset.yaml
kubectl -n sysdigcloud create -f sysdigcloud/api-ingress-with-secure.yaml</pre></li></ol></li></ol></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Overview" title="Overview">Overview</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-BeforeYouUpgrade" title="Before You Upgrade">Before You Upgrade </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Steps" title="Steps">Steps</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step1Downloadthesysdigcloud-kubernetesrelease" title="Step 1 Download the sysdigcloud-kubernetes release">Step 1 Download the sysdigcloud-kubernetes release</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step2Updateexistingconfigmapsandaddsecrets" title="Step 2 Update existing configmaps and add secrets">Step 2 Update existing configmaps and add secrets</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step3AddadatabasetoMySQLdeployment" title="Step 3 Add a database to MySQL deployment">Step 3 Add a database to MySQL deployment</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step4AddPostgresstatefulsetandservice" title="Step 4 Add Postgres statefulset and service">Step 4 Add Postgres statefulset and service</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step5Addanchorecoreandworkerdeploymentsandservices" title="Step 5 Add anchore core and worker deployments and services">Step 5 Add anchore core and worker deployments and services</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step6Addthescanningdeploymentsandservice" title="Step 6 Add the scanning deployments and service">Step 6 Add the scanning deployments and service</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-06ebb487-d368-384d-836b-17682b6295ff_id_ExpandedUpgradeKubernetesInstallationsforSysdigPlatformv1765-Step7AddtheingresscontrollerandredirectincomingAPIUItraffictoit" title="Step 7 Add the ingress controller and redirect incoming API/ UI traffic to it">Step 7 Add the ingress controller and redirect incoming API/ UI traffic to it</a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-6b66126f-7532-74e1-b30f-1bfc8ee23ed7" data-publication-date="" id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119"><div class="titlepage"><div><div class="title"><h6 class="title">Expanded Upgrade Kubernetes Installations version 2304 (2266, 2172)</h6></div></div></div><p>Sysdig platform on-premise releases are listed <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/releases" target="_blank">here</a>. Each release has a version number and specific <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/SRN/pages/256606211/Sysdig+On-Premises+Release+Notes" target="_blank">release notes</a>.</p><p>Sysdig On-Premise version 2304 (which replaces v 2266 and 2172) includes the following changes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Dashboards upgraded from v1 to v2:</strong></span> <span class="bold bold"><strong>This update happens automatically.</strong></span> </p><p>However, if you have saved v1 dashboards and need to reapply them, follow these instructions: Migrate Saved Dashboards from V1 to V2.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Architecture Change in the Containers</strong></span>In previous releases, there was a single backend container which ran several processes.</p><p>As of version 2304, the processes have been divided into unique containers, following container best practices.</p><p>As a result, it is necessary to apply the entire configuration, not simply change the image version. Follow the instructions below.</p></li></ul></div><div dir="ltr" class="tip tip"><h3 class="title">Tip</h3><p>Review the <a class="link" href="">Supported Migration Path</a> and associated documents before you begin</p></div><p>If you have licensed and will run only Sysdig Monitor, then you upgrade fewer components than if you also use Sysdig Secure, as described below.</p><h6 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-DownloadtheNewVersion" class="bridgehead">Download the New Version</h6><p>Use <code class="code">get</code> to download the new version from Sysdig's GitHub and unzip it.</p><p>For example:</p><pre class="programlisting"> wget https://github.com/draios/sysdigcloud-kubernetes/archive/v2304.tar.gz &amp;&amp; tar xvf v1929.tar.gz</pre><h6 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-EditNewFilestoMatchYourCustomizedFiles" class="bridgehead">Edit New Files to Match Your Customized Files</h6><p>Edit the following files within the <code class="code">sysdigcloud</code> directory to match any customizations you may have made in your existing production system.</p><h7 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-configyaml" class="bridgehead">config.yaml</h7><p>Edit the Sysdig user name, default user, API URL, Sysdig license, collector endpoint, from your <span class="bold bold"><strong> <code class="code">config.yaml</code> </strong></span> to the new <span class="bold bold"><strong> <code class="code">config.yaml</code> </strong></span>.</p><pre class="programlisting">sysdigcloud.default.user: test@sysdig.com
collector.endpoint: onprem.sysdigcloud.com
collector.port: "6443"
api.url: https://onprem.sysdigcloud.com:443</pre><h7 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-deploymentyamls" class="bridgehead">deployment yamls</h7><p>Edit the CPU limits and replicas in the deployment yamls: <code class="code">api-deployment.yaml, collector-deployment.yaml, worker-deployment.yaml </code> </p><p> <code class="code">Note that the values in the sample below are examples only; edit them to match the requirements of your deployment. </code> </p><pre class="programlisting">spec:
 replicas: 1

....

resources:
  limits:
    cpu: "4"
    memory: 4Gi
  requests:
    cpu: "1"
    memory: 1G</pre><h6 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-ApplytheFiles" class="bridgehead">Apply the Files</h6><p>Run the <code class="code">kubctl</code> commands to apply the relevant files to the environment.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>This upgrade updates dashboards from v1 to v2. The process requires 20-30 minutes on large systems, and the environment remains live throughout the rolling upgrade.</p><p>DO NOT create or delete dashboards during the upgrade.</p><p>After upgrading, if you have saved v1 dashboards previously and need to upload them to the v2 environment, see Migrate Saved Dashboards from V1 to V2.</p></div><h7 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-RollingUpgradeforSysdigMonitorOnly" class="bridgehead">Rolling Upgrade for Sysdig Monitor Only</h7><pre class="programlisting">kubectl -n sysdigcloud apply -f config.yaml
kubectl -n sysdigcloud apply -f api-deployment.yaml
kubectl -n sysdigcloud apply -f collector-deployment.yaml
kubectl -n sysdigcloud apply -f worker-deployment.yaml</pre><h7 id="UUID-3ae24886-975b-76f7-f7f7-a7b865907119_id_ExpandedUpgradeKubernetesInstallationsversion230422662172-RollingUpgradeforSysdigMonitorSysdigSecure" class="bridgehead">Rolling Upgrade for Sysdig Monitor + Sysdig Secure</h7><pre class="programlisting">kubectl -n sysdigcloud apply -f config.yaml
kubectl -n sysdigcloud apply -f api-deployment.yaml
kubectl -n sysdigcloud apply -f collector-deployment.yaml
kubectl -n sysdigcloud apply -f worker-deployment.yaml
kubectl -n sysdigcloud apply -f scanning-api-deployment.yaml
kubectl -n sysdigcloud apply -f scanning-alertmgr.yaml</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Download the New Version  </p></li><li class="listitem"><p> Edit New Files to Match Your Customized Files </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> config.yaml </p></li><li class="listitem"><p> deployment yamls  </p></li></ul></div></li><li class="listitem"><p> Apply the Files </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Rolling Upgrade for Sysdig Monitor Only  </p></li><li class="listitem"><p> Rolling Upgrade for Sysdig Monitor + Sysdig Secure </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-2962d668-58d0-e765-7c1a-8a9403c9cb88" data-publication-date="" id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f"><div class="titlepage"><div><div class="title"><h6 class="title">Upgrade Replicated Installations</h6></div></div></div><h6 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-Non-AirgappedInstallation" class="bridgehead">Non-Airgapped Installation</h6><p>Upgrading is very simple when your environment has access to the Internet during the installation process (non-airgapped).</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>It is highly recommended to follow upgrade best practices:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Keep upgrades current</p></li><li class="listitem"><p>Upgrade progressively without skipping versions, and</p></li><li class="listitem"><p>Test upgrades in a non-mission-critical or staging environment before rolling in to production.</p></li></ul></div></div><p>Review the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-b551e78a-d231-357e-a672-9c8787019250" title="On-Premises Upgrades">On-Premises Upgrades</a> for supported upgrade paths.</p><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedComponents" class="bridgehead">Upgrade Replicated Components</h7><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-CheckCurrentVersion" class="bridgehead">Check Current Version</h7><p>The Replicated infrastructure installs its own container based agents that deploy and manage the various Sysdig back-end components. To confirm the currently running version of the Replicated agent, perform <code class="code">replicated --version</code> at the command line on each host. [<a class="link" href="https://help.replicated.com/docs/distributing-an-application/upgrading/" target="_blank">Reference Replicated.com]</a> </p><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedClient" class="bridgehead">Upgrade Replicated Client</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the Replicated Management Console and stop the Sysdig application (Sysdig Monitor and Sysdig Secure, if applicable) before upgrading the Replicated client.</p></li><li class="step"><p>Run the following command on the <span class="italic italic">management</span> host to upgrade the replicated infrastructure:</p><pre class="programlisting">sudo curl -sSL https://get.replicated.com/docker | sudo bash</pre></li><li class="step"><p>Run the following command on the<span class="italic italic"> remaining</span> nodes in the cluster:</p><pre class="programlisting">sudo curl -sSL https://get.replicated.com/operator | sudo bash</pre></li></ol></div><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeSysdigApplication" class="bridgehead">Upgrade Sysdig Application</h7><p> <span class="bold bold"><strong>Installation Sequence:</strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Pre-Version 860:</strong></span> Install upgrades sequentially, one version at a time.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Version 860 - 1091:</strong></span> You can directly install the version you want.*</p></li><li class="listitem"><p> <span class="bold bold"><strong>Version 1091 - Sept 2018 release: </strong></span>All users must upgrade from 1091 - Sept 2018 and run the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/261652612/Unified+Events+Migration+Tool" target="_blank">Unified Events migration tool</a>.</p></li><li class="listitem"><p> <span class="bold bold"><strong>Version 2266:</strong></span> See Note, below.</p></li></ul></div><p>*Sequential installs (even when not strictly required) ensure consistent database migrations and allow for easier troubleshooting, should problems occur. Sysdig recommends staying fairly up-to-date on the release cycle to avoid "stacking up" upgrades.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the <code class="code">Replicated Management Console &gt; Dashboards</code>.</p></li><li class="step"><p>Click <code class="code">View Update</code>.</p><p>The release history is listed, and "New" for any new releases.</p></li><li class="step"><p>Click <code class="code">Install</code> for the desired release.</p></li></ol></div><div dir="ltr" class="note note"><h3 class="title">Upgrades to version 2304</h3><p>After upgrading to version 2304, you must add a node for <code class="code">emailrenderer</code> and <code class="code">nginxfrontend</code> to the replicated cluster, and then run a command on the node.</p><div class="mediaobject"><table style="border: 0; width: 300px; cellpadding: 0; cellspacing: 0;" class="image-viewport"><tr><td><img style="max-width: 300px; " src="image/15d5af4f385edd.png" alt="373573653.png"></img></td></tr></table></div><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Private and Public IP Addresses: Provide the IPs where the containers will run.</p></li><li class="listitem"><p>Select emailrenderer and nginxfrontend.</p></li><li class="listitem"><p>Run the <code class="code">curl</code> command as noted in the image above, including the optional parameters as needed for your environment.</p></li></ul></div></div><h6 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-AirgappedInstallation" class="bridgehead">Airgapped Installation</h6><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedComponents1" class="bridgehead">Upgrade Replicated Components</h7><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-CheckCurrentVersion1" class="bridgehead">Check Current Version</h7><p>The Replicated infrastructure installs its own container based agents that deploy and manage the various Sysdig back-end components. To confirm the currently running version of the Replicated agent, perform <code class="code">replicated --version</code> at the command line on each host. <a class="link" href="https://help.replicated.com/docs/distributing-an-application/upgrading/" target="_blank">See also Replicated.com</a>.</p><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedClient1" class="bridgehead">Upgrade Replicated Client</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Download the latest Replicated agent installation package:</p><pre class="programlisting">curl https://s3.amazonaws.com/replicated-airgap-work/replicated.tar.gz &gt; replicated.tar.gz</pre></li><li class="step"><p>In a command shell, extract the Replicated installer:</p><pre class="programlisting">sudo tar xzvf replicated.tar.gz</pre></li><li class="step"><p>Run the 'install.sh' script <span class="italic italic">on the management host:</span> </p><pre class="programlisting">sudo cat ./install.sh | sudo bash -s airgap</pre></li><li class="step"><p>Run the 'operator_install.sh' script on all <span class="italic italic">remaining nodes</span>:</p><pre class="programlisting">sudo cat ./operator_install.sh | sudo bash -s airgap</pre></li></ol></div><h7 id="UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeSysdigApplication1" class="bridgehead">Upgrade Sysdig Application</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Download the new Sysdig application .<code class="code">airgap</code> installer, using the link and password supplied for the initial installation.</p></li><li class="step"><p>Copy the .<code class="code">airgap</code> file to the update directory on the management host.</p><p>To check or configure the update path, log in to the Replicated Management Console and click <code class="code">Console Settings &gt; Airgapped Settings</code> section under the gear icon.</p></li><li class="step"><p>In the Replicated Management Console, select the <code class="code">Dashboard</code> tab and click <code class="code">Check Now</code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr><td><img src="image/15d5af4f38def6.png" style="max-width: 400px; " alt="373573659.png"></img></td></tr></table></div></li><li class="step"><p>Click <code class="code">Install</code> for the desired version.</p></li></ol></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-Non-AirgappedInstallation" title="Non-Airgapped Installation">Non-Airgapped Installation </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedComponents" title="Upgrade Replicated Components">Upgrade Replicated Components </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-CheckCurrentVersion" title="Check Current Version">Check Current Version </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedClient" title="Upgrade Replicated Client">Upgrade Replicated Client </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeSysdigApplication" title="Upgrade Sysdig Application">Upgrade Sysdig Application </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-AirgappedInstallation" title="Airgapped Installation">Airgapped Installation </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedComponents1" title="Upgrade Replicated Components">Upgrade Replicated Components </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-CheckCurrentVersion1" title="Check Current Version">Check Current Version </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeReplicatedClient1" title="Upgrade Replicated Client">Upgrade Replicated Client </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f_id_UpgradeReplicatedInstallations-UpgradeSysdigApplication1" title="Upgrade Sysdig Application">Upgrade Sysdig Application </a> </p></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-00baa038-e31a-a728-8353-61e4c4187817" data-publication-date="" id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61"><div class="titlepage"><div><div class="title"><h6 class="title">**Add a Cassandra Node**</h6></div></div></div><p>&lt;Add intro&gt;</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-ReplicatedInstructions" title="Replicated Instructions">Replicated Instructions </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-AddaNodetotheCluster" title="Add a Node to the Cluster">Add a Node to the Cluster</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-RestarttheSysdigApplication" title="Restart the Sysdig Application">Restart the Sysdig Application </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-MonitortheNewNodeJoiningtheCluster" title="Monitor the New Node Joining the Cluster">Monitor the New Node Joining the Cluster </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-CleanUptheOldNodes" title="Clean Up the Old Nodes">Clean Up the Old Nodes </a> </p></li><li class="listitem"><p> Optional: Change the Data Replication Factor (??)  </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-KubernetesInstructions" title="Kubernetes Instructions">Kubernetes Instructions </a> </p></li></ul></div><h6 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-ReplicatedInstructions" class="bridgehead">Replicated Instructions</h6><h7 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-AddaNodetotheCluster" class="bridgehead">Add a Node to the Cluster</h7><h7 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-RestarttheSysdigApplication" class="bridgehead">Restart the Sysdig Application</h7><h7 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-MonitortheNewNodeJoiningtheCluster" class="bridgehead">Monitor the New Node Joining the Cluster</h7><h7 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-CleanUptheOldNodes" class="bridgehead">Clean Up the Old Nodes</h7><h7 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-OptionalChangetheDataReplicationFactor" class="bridgehead">Optional: Change the Data Replication Factor (??)</h7><p>&lt;When/why do you do it and is it required? Background info on Cassandra data replication: <a class="link" href="https://docs.datastax.com/en/archived/cassandra/2.1/cassandra/architecture/architectureDataDistributeReplication_c.html" target="_blank">https://docs.datastax.com/en/archived/cassandra/2.1/cassandra/architecture/architectureDataDistributeReplication_c.html</a> </p><h6 id="UUID-7627235e-9d7a-d34a-982b-c1adc191eb61_id_id-AddaCassandraNode-KubernetesInstructions" class="bridgehead">Kubernetes Instructions</h6><p>TBD</p><p> <span class="bold bold"><strong>From Zendesk: Adding a New Cassandra Node (Replicated) </strong></span> </p><div class="blockquote"><blockquote class="blockquote"><p>&lt;Original Zendesk (with images): <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115000269603-Adding-a-New-Cassandra-Node" target="_blank">https://support.sysdig.com/hc/en-us/articles/115000269603-Adding-a-New-Cassandra-Node</a> </p><p>NOTE: The relationship between these instructions and the internal SaaS notes is not at all clear.</p><p>See <a class="link" href="https://sysdig.atlassian.net/wiki/spaces/EN/pages/159875149/Adding+a+Cassandra+Node+SAAS" target="_blank">https://sysdig.atlassian.net/wiki/spaces/EN/pages/159875149/Adding+a+Cassandra+Node+SAAS</a> &gt;</p></blockquote></div><p>This guide will explain how to expand the Cassandra cluster in a Sysdig Monitor multi-server, distributed on-premise installation.</p><p>These steps were first tested with Sysdig Monitor on-premise release 439 and should work with all newer releases.</p><p> <span class="bold bold"><strong>H2: Expanding the Cluster</strong></span> </p><p>Expanding the cluster is performed through the same management server interface that was used for the initial on-premise install procedure.</p><p>Our example environment consists of 6 nodes (hosts/VMs) as seen in the <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span> tab. The Tags reflect which component(s) are currently configured to run on each node.</p><div class="mediaobject"><img src="image/image-missing.png" style="" alt=""></img></div><p>Assume we’ve provisioned an additional Linux host to be our new Cassandra node. Now click on the <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span> button.</p><div class="mediaobject"><img src="image/image-missing.png" style="" alt=""></img></div><p>Insert the new host’s Private IP address, Public IP Address (if it has one), and check the box to add the Cassandra Tag. Then login to the new host and execute the provided <span class="bold bold"><strong>curl </strong></span>command line.</p><p>The additional node will now appear in the list.</p><div class="mediaobject"><img src="image/image-missing.png" style="" alt=""></img></div><p>The new node is now initialized, but the Sysdig Monitor application must be restarted in order for Cassandra to begin running on it. To restart, click to the <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span> tab and click <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span>. Status messages will indicate services are stopping. Then click <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span>.</p><div class="mediaobject"><img src="image/image-missing.png" style="" alt=""></img></div><p>As part of the restart, a new Cassandra container is started on the newly-added node and it will join the cluster. The joining operation can be monitored using the <span class="bold bold"><strong>nodetool status</strong></span> command:</p><p> <span class="bold bold"><strong>H3: Status during joining (UJ)</strong></span> </p><p> <code class="code"># docker exec -it &lt;CONTAINER_ID&gt; nodetool status draiosDatacenter: datacenter1 ======================= Status=Up/Down |/ State=Normal/Leaving/Joining/Moving -- Address Load Tokens Owns Host ID Rack UN 10.10.0.117 41.8 MB 256 ? 3c495d49-f311-43f3-9fef-0055f5943f8a rack1 UJ 10.10.0.123 177.32 KB 256 ? 8199bfb4-92b3-4b74-a1ce-90310769d8b8 rack1</code> </p><p> <span class="bold bold"><strong>H3: Status when joined (UN)</strong></span> </p><p> <code class="code"># docker exec -it &lt;CONTAINER_ID&gt; nodetool status draios Datacenter: datacenter1 ======================= Status=Up/Down |/ State=Normal/Leaving/Joining/Moving -- Address Load Tokens Owns (effective) Host ID Rack UN 10.10.0.117 40.39 MB 256 51.2% 3c495d49-f311-43f3-9fef-0055f5943f8a rack1 UN 10.10.0.123 20.12 MB 256 48.8% 8199bfb4-92b3-4b74-a1ce-90310769d8b8 rack1</code> </p><p>Adding a new node to a Cassandra cluster can take a long time depending on how much data is currently stored in the cluster. <span class="bold bold"><strong>Do not stop the application until the new node has finished joining the cluster.</strong></span> </p><p>H3: Cleanup</p><p>Once the joining operation is finished, it is mandatory to perform a cleanup operation on all the old nodes of the cluster. This is performed using <span class="bold bold"><strong>nodetool cleanup</strong></span>:</p><p> <code class="code"># docker exec -it &lt;CONTAINER_ID&gt; bash root@&lt;&gt;:/# nohup nodetool cleanup draios &amp; [1] 470 root@&lt;&gt;:/# nohup: ignoring input and appending output to 'nohup.out' root@&lt;&gt;:/# exit</code> </p><p> <span class="bold bold"><strong>H2: Data Replication Factor</strong></span> </p><p>&lt;Is this required or optional? When/why do you do it?&gt;</p><p>The default Cassandra <a class="link" href="https://docs.datastax.com/en/cassandra/2.1/cassandra/architecture/architectureDataDistributeReplication_c.html" target="_blank">replication factor</a> used by Sysdig Monitor is 1. This was first set under Advanced Settings within the <span class="inlinemediaobject"><img src="image/image-missing.png" alt=""></img></span> tab of the management server interface.</p><div class="mediaobject"><img src="image/image-missing.png" style="" alt=""></img></div><p>It should be noted that changing the replication factor on a running cluster is a rather costly procedure and therefore should be carefully planned. These steps should only be executed by those who understand the underlying Cassandra operations and are comfortable with executing them on your data within appropriately-sized change windows.</p><p> <span class="bold bold"><strong>Always first backup your data by copying the entire contents of the Cassandra data folder </strong></span> <span class="bold bold"><strong>/opt/cassandra-data-volume.</strong></span> </p><p>If you want to increase the replication factor, you need to manually modify the replication factor setting of the <span class="bold bold"><strong>draios</strong></span> Keyspace in the Cassandra cluster. To do so, pick any node in the Cassandra cluster and execute the following commands to review and then change the replication factor setting (from 1 to 2 in this example):</p><p> <code class="code"># docker exec -it &lt;CONTAINER_ID&gt; bash root@&lt;&gt;:/# cqlsh cqlsh&gt; DESCRIBE KEYSPACE draios ; CREATE KEYSPACE draios WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '1'} AND durable_writes = true; …. cqlsh&gt; ALTER KEYSPACE draios WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 2 }; cqlsh&gt; quit</code> </p><p>Modify the Cassandra replication factor in the Advanced Settings of the Sysdig Monitor management server interface to match this new setting (2 in this case). Saving the new setting will trigger a restart of the application.</p><p>Once restart has completed, perform the Cassandra repair operation on the cluster, one node at a time:</p><p> <code class="code">root@&lt;&gt;:/# nodetool repair [2017-01-05 14:55:03,614] Starting repair command #1, repairing 512 ranges for keyspace draios (parallelism=SEQUENTIAL, full=true) </code> </p><p> <span class="bold bold"><strong>Perform the repair operation on all the nodes of the cluster. Wait until repair completes on a node, then move on to the next one.</strong></span> </p><p>Note the change in the <span class="bold bold"><strong>Owns </strong></span>column for the <span class="bold bold"><strong>nodetool status</strong></span> output. In our example with two nodes and replication factor of 2, the 100% values are expected.</p><p> <code class="code"># docker exec -it &lt;CONTAINER_ID&gt; nodetool status draios Datacenter: datacenter1 ======================= Status=Up/Down |/ State=Normal/Leaving/Joining/Moving -- Address Load Tokens Owns (effective) Host ID Rack UN 192.168.15.5 12.92 MB 256 100.0% dca3e7f8-fa0b-4de1-8562-c4150121f8c7 rack1 UN 192.168.15.6 12.92 MB 256 100.0% d8ea6d81-c7aa-4d49-8ea0-1fac2e136a5c rack1</code> </p></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cb40fc4f-b85a-8739-4a4e-0a9009419723" data-publication-date="" id="UUID-529c0b1e-1b39-96e9-858c-affd619f2964"><div class="titlepage"><div><div class="title"><h5 class="title">Find the Super Admin Credentials and API Token</h5></div></div></div><p>Sysdig on-premises installations contain several configuration options only available to the initial admin user, or "super" admin user. This section outlines the steps for locating the super admin user (if you do not know who it is) and using the super user login token.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The Sysdig Monitor web interface does not currently provide a way to identify the super user. If you are trying to use the API to make a configuration change and it fails due to insufficient privileges, you can use the API to locate the super user.</p></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-529c0b1e-1b39-96e9-858c-affd619f2964_id_FindtheSuperAdminCredentialsandAPIToken-FindSuperAdminCredentials"><div class="titlepage"><div><div class="title"><h6 class="title">Find Super Admin Credentials</h6></div></div></div><p>Two approaches:</p><p>1. Access the API endpoint to list users directly via curl and parse the JSON output to locate the user with "ROLE_ADMIN" listed in the "roles" section.</p><pre class="programlisting"># curl -k \
    -H 'Authorization: Bearer xxxxxxxx-yyyy-zzzz-aaaa-bbbbbbbbbbbb' \
    https://&lt;your-sysdig-monitor-hostname&gt;/api/users \
    | python -m json.tool</pre><p>Output:</p><pre class="programlisting">{
    "users": [
        {
        ....
            "roles": [
                "ROLE_ADMIN",
                "ROLE_CUSTOMER",
                "ROLE_USER"
             ],
             "username": "your-super-admin@example.com"
        },
        ...
    ]
}</pre><p>2. Use <a class="link" href="https://raw.githubusercontent.com/draios/python-sdc-client/master/examples/list_admins.py" target="_blank">this example Python script</a> that leverages the Sysdig Monitor API.</p><pre class="programlisting">export SDC_SSL_VERIFY="false"
export SDC_URL="https://&lt;your-sysdig-monitor-hostname&gt;"
# python list_admins.py xxxxxxxx-yyyy-zzzz-aaaa-bbbbbbbbbbbb</pre><pre class="programlisting"></pre><p>Output:</p><pre class="programlisting">Admin users
-----------
your-super-admin@example.com
regular-admin@example.com

Super Admins
------------
your-super-admin@example.com</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-529c0b1e-1b39-96e9-858c-affd619f2964_id_FindtheSuperAdminCredentialsandAPIToken-FindSysdigAPIToken"><div class="titlepage"><div><div class="title"><h6 class="title">Find Sysdig API Token</h6></div></div></div><p>As with any user, you can then obtain the API token by logging in as the "super" admin to the Sysdig UI.</p><p>When using the Sysdig API with custom scripts or applications, an API security token (specific to each team) must be supplied.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to Sysdig Monitor or Sysdig Secure and select <code class="code">Settings. <div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr style="height: 60px"><td><img src="image/15d5af4f3980b7.png" style="max-width: 250px; max-height: 60px; " alt="373575156.png"></img></td></tr></table></div></code> </p></li><li class="step"><p>Select <code class="code">User Profile.</code>The Sysdig Monitor or Sysdig Secure API token is displayed (depending on which interface and team you logged in to).</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f39e379.jpg" style="max-width: 600px; " alt="373575150.jpg"></img></td></tr></table></div></li><li class="step"><p>You can <code class="code">Copy</code> the token for use, or click the <code class="code">Reset Token</code> button to generate a new one.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>When reset, the previous token issued will immediately become invalid and you will need to make appropriate changes to your programs or scripts.</p></div></li></ol></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ec730506-5804-f830-4a75-644e44406dff" data-publication-date="" id="UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644"><div class="titlepage"><div><div class="title"><h5 class="title">Upgrade an On-Premises License</h5></div></div></div><p>On-premises environments may require a license upgrade to renew, extend an expiration date, enable new features, add a service (Sysdig Secure), or change the number of licensed agents.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForReplicatedOn-PremInstallations"><div class="titlepage"><div><div class="title"><h6 class="title">For Replicated On-Prem Installations</h6></div></div></div><h6 id="UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-UpgradeanAirgappedLicense" class="bridgehead">Upgrade an Airgapped License</h6><p>If you are running an airgapped environment, you must download the license file to a local directory, then follow the steps below.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the Replicated Management Console and choose <span class="bold bold"><strong>Console Settings</strong></span> from the gear icon drop-down menu.</p><p>Review the current airgapped settings and note the pathname to the license file.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="300px"><tr><td><img src="image/15d5af4f3a4f5c.png" style="max-width: 300px; " alt="5d4d587e82eba.png"></img></td></tr></table></div><p>If you followed the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7f8181d0-96f7-fdea-17bc-c4d921598527" title="Airgapped Installation">Airgapped Installation</a> instructions, your current .<code class="code">rli</code> license file will be in the<code class="code">/var/tmp/sysdig</code>directory as shown below.</p><p>(The name of your .rli file will vary.)</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr><td><img src="image/15d5af4f3ada8d.png" style="max-width: 400px; " alt="5d4d58804ecab.png"></img></td></tr></table></div></li><li class="step"><p>From the Linux shell, <code class="code">cd </code>to the directory shown as the <span class="bold bold"><strong>Update Path </strong></span>and replace your prior RLI license file with the new one, saving the prior one to a backup filename.</p><p> <span class="bold bold"><strong>NOTE:</strong></span> the new license file may have a different name than the prior one, and may have a non-RLI extension if it was sent to you as an email attachment (to avoid being removed by firewalls).</p><p>The steps below are an example of renaming the license as necessary for the environment shown above (your filenames will vary).</p><pre class="programlisting">/var/tmp/sysdig# mv my-replicated-license.rli prior-replicated-license-1.rli
/var/tmp/sysdig# mv newer-license.allow my-replicated-license.rli</pre></li><li class="step"><p>Continue in the Replicated Management Console to sync the license and restart the Sysdig application, as described in the non-airgapped instructions below.</p></li></ol></div><h6 id="UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-UpgradeaNon-AirgappedLicense" class="bridgehead">Upgrade a Non-Airgapped License</h6><p>If your environment can access the Internet, upgrading the license is a simple sync and restart.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the Replicated Management Console.</p></li><li class="step"><p>Select <span class="bold bold"><strong>View License</strong></span> from the <span class="bold bold"><strong>Gear</strong></span> drop-down menu.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="300px"><tr><td><img src="image/15d5af4f3b707c.png" style="max-width: 300px; " alt="5d4d588229eac.png"></img></td></tr></table></div></li><li class="step"><p>Click <span class="bold bold"><strong>Sync License. </strong></span> </p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr><td><img src="image/15d5af4f3bee9f.png" style="max-width: 250px; " alt="5d4d5883ed56e.png"></img></td></tr></table></div></li><li class="step"><p>For license terms to take effect, restart the Sysdig application from the Replicated Management Console.</p><p>Navigate to the<span class="bold bold"><strong>Dashboard</strong></span> on the pull-down menu and click the<span class="bold bold"><strong>Stop Now</strong></span>button, followed by the<span class="bold bold"><strong>Start Now</strong></span>button.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="100px"><tr><td><img src="image/15d5af4f3c5154.png" style="max-width: 100px; " alt="5d4d5885f10d7.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="100px"><tr><td><img src="image/15d5af4f3cb4a8.png" style="max-width: 100px; " alt="5d4d5887c1135.png"></img></td></tr></table></div></li></ol></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForKubernetesOn-PremInstallations"><div class="titlepage"><div><div class="title"><h6 class="title">For Kubernetes On-Prem Installations</h6></div></div></div><p>As described in the <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes" target="_blank">Kubernetes installation instructions</a>, the license file is simply entered as one of many configuration user settings in the ConfigMap (<a class="link" href="">config.yaml</a>).</p><p>The relevant parameter is:</p><pre class="programlisting"> # Required: Sysdig Cloud license
  sysdigcloud.license: ""</pre><p>To apply the new license, update the configmap with the new license and then restart all Sysdig API, Worker, and Collector pods.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForReplicatedOn-PremInstallations" title="For Replicated On-Prem Installations">For Replicated On-Prem Installations </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-UpgradeanAirgappedLicense" title="Upgrade an Airgapped License">Upgrade an Airgapped License </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-UpgradeaNon-AirgappedLicense" title="Upgrade a Non-Airgapped License">Upgrade a Non-Airgapped License </a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForKubernetesOn-PremInstallations" title="For Kubernetes On-Prem Installations">For Kubernetes On-Prem Installations </a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e5a2a6fa-12cf-e145-8643-4d17b5e5e809" data-publication-date="" id="UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac"><div class="titlepage"><div><div class="title"><h5 class="title">Securing Elasticsearch</h5></div></div></div><p>Use these instructions to enable <span class="bold bold"><strong>authentication</strong></span> and <span class="bold bold"><strong>TLS</strong></span> on Elasticsearch.</p><div dir="ltr" class="tip tip"><h3 class="title">Tip</h3><p>This feature is available for Sysdig on-prem v2.3.0 or later.</p></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-Prerequisite"><div class="titlepage"><div><div class="title"><h6 class="title">Prerequisite</h6></div></div></div><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204669178/Sysdig+Install+with+Kubernetes+1.9+" target="_blank">Install the Sysdig Platform</a> following the Kubernetes installation steps, version 2.3.0 or later, OR <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367165531/Expanded+Upgrade+Kubernetes+Installations+version+July+2019" target="_blank">upgrade to version 2.3.0 </a>or later.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>If your Sysdig installation is in production, enabling Elasticsearch authentication and TLS will require downtime. Be sure to schedule a maintenance window in advance.</p></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-EnableAuthenticationandTLS"><div class="titlepage"><div><div class="title"><h6 class="title">Enable Authentication and TLS</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Please have the unpackaged release handy. All paths in this document assume the user is at the root of the unpackaged release directory.</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Run the following docker command to generate the root/admin certs for Elasticsearch to a directory within the current working directory.</p><pre class="programlisting">docker run -d -v "$(pwd)"/generated_elasticsearch_certs:/tools/out quay.io/sysdig/elasticsearch:1.0.1-es-certs</pre></li><li class="step"><p>Create a Kubernetes secret from these root/admin certs</p><pre class="programlisting">NAMESPACE=sysdigcloud
kubectl -n $NAMESPACE create secret generic ca-certs --from-file=generated_elasticsearch_certs</pre><pre class="programlisting"></pre></li><li class="step"><p>Create Kubernetes secrets from generated passwords for the admin/readonly Searchguard roles.</p><pre class="programlisting">SG_ADMIN_PASSWORD=$(LC_CTYPE=C tr -dc A-Za-z0-9 &lt; /dev/urandom | head -c 32)
SG_READONLY_PASSWORD=$(LC_CTYPE=C tr -dc A-Za-z0-9 &lt; /dev/urandom | head -c 32)
kubectl -n $NAMESPACE create secret generic sg-admin-secret --from-literal=password=$SG_ADMIN_PASSWORD
kubectl -n $NAMESPACE create secret generic sg-readonly-secret --from-literal=password=$SG_READONLY_PASSWORD</pre><pre class="programlisting"></pre></li><li class="step"><p>Create a Kubernetes secret containing the Searchguard config files.</p><pre class="programlisting">kubectl -n $NAMESPACE create secret generic sg-config-files --from-file=datastores/as_kubernetes_pods/manifests/elasticsearch/sgconfig</pre></li><li class="step"><p>If you are monitoring the Elasticsearch cluster with <code class="code">sysdig-agent</code>, ensure the <code class="code">sysdig-agent </code> <code class="code">configmap </code>has the following Elasticsearch configuration in the <code class="code">data.dragent.yaml.app_checks </code>section:</p><pre class="programlisting">data:
   dragent.yaml: |
     app_checks:
       - name: elasticsearch
         check_module: elastic
         pattern:
           port: 9200
           comm: java
         conf:
           url: https://sysdigcloud-elasticsearch:9200
           username: readonly
           password: &lt;SG_READONLY_PASSWORD from step 3&gt;
           ssl_verify: false</pre><p>And restart the agent to apply the new configs.</p><pre class="programlisting">AGENT_NAMESPACE=change_me
kubectl -n $AGENT_NAMESPACE delete pod -l app=sysdig-agent</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>You may come across an error stating Unverified HTTPS request is being made in the sysdig-agent logs. You may safely ignore this for now.</p></div></li><li class="step"><p>Update your <code class="code">sysdigcloud-config configmap</code> </p><ol type="a" class="substeps"><li class="step"><p>Write the current configmap configuration to a local file so you can edit it and subsequently apply the changes in a later step</p><pre class="programlisting">kubectl -n $NAMESPACE get configmap sysdigcloud-config -o yaml &gt; sysdigcloud-configmap.yaml</pre></li><li class="step"><p>In sysdigcloud-configmap<code class="code">.yaml</code>, set <span class="bold bold"><strong> <code class="code">elasticsearch.searchguard.enabled: "true"</code> </strong></span> and <span class="bold bold"><strong> <code class="code">elasticsearch.user: "admin"</code> </strong></span> </p></li><li class="step"><p>Apply the configuration changes</p><pre class="programlisting">kubectl -n $NAMESPACE apply -f sysdigcloud-configmap.yaml</pre></li></ol></li><li class="step"><p>In <code class="code">datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml</code>, uncomment the sections that have the header <code class="code">## If enabling elasticsearch auth, uncomment</code> </p><p>Then <span class="bold bold"><strong>edit this file to match any customizations that may have been made in your production system,</strong></span> as you will be applying these files to your production system in a later step. Please pay special attention to these fields when modifying the files to accommodate the existing environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">spec.replicas</code> and <code class="code">spec.template.spec.containers[elasticsearch].env[ELASTICSEARCH_GOSSIP_NODES_NUM].value</code> </p></li><li class="listitem"><p> <code class="code">spec.template.spec.containers[].resources</code> </p></li><li class="listitem"><p> <code class="code">spec.volumeClaimTemplates[].spec.resources.requests.storage</code> </p></li><li class="listitem"><p> <code class="code">spec.volumeClaimTemplates[].spec.storageClassName </code> </p></li></ul></div></li><li class="step"><p>The existing api, collector, and worker deployments will need to be updated. Please modify the following files to accommodate the existing environment, and uncomment the sections that have <code class="code">## If enabling elasticsearch auth, uncomment</code> above it:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">sysdigcloud/api-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/collector-deployment.yaml</code> </p></li><li class="listitem"><p> <code class="code">sysdigcloud/worker-deployment.yaml </code> </p></li></ul></div><p>Then <span class="bold bold"><strong>edit these file to match any customizations that may have been made in your production system,</strong></span> as you will be applying these files to your production system in a later step. Please pay special attention to these fields when modifying the files to accommodate the existing environment</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">spec.replicas</code> </p></li><li class="listitem"><p> <code class="code">spec.template.spec.containers[].resources</code> </p></li><li class="listitem"><p> <code class="code">spec.template.spec.containers[].volumeMounts</code> </p></li><li class="listitem"><p> <code class="code">spec.template.spec.volumes </code> </p></li></ul></div></li><li class="step"><p>Apply new configurations for Elasticsearch</p><pre class="programlisting"><code class="code"> kubectl -n $NAMESPACE apply -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-service.yaml
 kubectl -n $NAMESPACE replace -f datastores/as_kubernetes_pods/manifests/elasticsearch/elasticsearch-statefulset.yaml</code></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Note:</strong></span> If you get an error similar to <code class="code">updates to statefulset spec for fields other than 'replicas', 'template', and 'updateStrategy' are forbidden, </code>check that the <code class="code">volumeClaimTemplates</code>in the yaml file matches the existing configuration.</p></li></ul></div></li><li class="step"><p>Delete existing Elasticsearch pods so the new ones pull from the updated configurations</p><pre class="programlisting">kubectl -n $NAMESPACE delete pod -l role=elasticsearch</pre></li><li class="step"><p>Apply new configurations for api, collector, and worker:</p><pre class="programlisting">kubectl -n $NAMESPACE apply -f sysdigcloud/api-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/collector-deployment.yaml
kubectl -n $NAMESPACE apply -f sysdigcloud/worker-deployment.yaml</pre></li></ol></div><h6 id="UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-SearchGuardRoles" class="bridgehead">Search Guard Roles</h6><p>We have included two Searchguard roles with this setup:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">admin</code> has access to everything in the cluster and all indices</p></li><li class="listitem"><p> <code class="code">readonly</code> can only read indices and access monitoring endpoints for the cluster (e.g. <code class="code">/_cat/health</code>)</p></li></ul></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-EnablingauthenticationagainstacustomElasticsearchsetup"><div class="titlepage"><div><div class="title"><h6 class="title">Enabling authentication against a custom Elasticsearch setup</h6></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p> <a class="link" href="https://docs.search-guard.com/latest/search-guard-installation" target="_blank">Install Searchguard</a> on your Elasticsearch cluster. <span class="bold bold"><strong>Be sure to install the same version of Searchguard as your Elasticsearch cluster</strong></span>.</p></li><li class="step"><p>Add the Elasticsearch cluster's root certificate authority as a secret. The name of the cert file must be <code class="code">root-ca.pem</code>.</p><pre class="programlisting"> NAMESPACE=sysdigcloud
 kubectl -n $NAMESPACE create secret generic ca-certs --from-file=&lt;path to root-ca.pem&gt;</pre></li><li class="step"><p>Follow step 6 from <a class="link" href="">Enable Authentication and TLS</a>, but depending on your Searchguard installation:</p><ol type="a" class="substeps"><li class="step"><p> <code class="code">elasticsearch.user</code> will need to be set to the user with the <code class="code">sg_admin</code> role. This may or may not be <span class="bold bold"><strong> <code class="code">admin</code> </strong></span> </p></li><li class="step"><p> <span class="bold bold"><strong> <code class="code">elasticsearch.verifySSL</code> </strong></span> can be set to <code class="code">"true"</code> if your TLS certs have hostname verification</p></li></ol></li><li class="step"><p>Follow steps 5, 6, 8, and 11 from <a class="link" href="">Enable Authentication and TLS</a>.</p></li></ol></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-e0ca8e47-108a-cdd2-9661-7a7a53b9da47" data-publication-date="" id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e"><div class="titlepage"><div><div class="title"><h5 class="title">Securing Cassandra</h5></div></div></div><p>Use these instructions to enable <span class="bold bold"><strong>authentication</strong></span> and <span class="bold bold"><strong>TLS</strong></span> on Cassandra.</p><div dir="ltr" class="tip tip"><h3 class="title">Tip</h3><p>This feature is available for Sysdig on-prem v2.3.0 or later.</p></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Contents"><div class="titlepage"><div><div class="title"><h6 class="title">Contents</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Prerequisite" title="Prerequisite">Prerequisite</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-EnableAuthenticationandTLS" title="Enable Authentication and TLS">Enable Authentication and TLS</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step1Createalocalcopyofthecurrentsysdigcloud-configconfigmap" title="Step 1: Create a local copy of the current sysdigcloud-config configmap">Step 1: Create a local copy of the current sysdigcloud-config configmap</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step2SetauthenticationandSSLparameterstotrue" title="Step 2: Set authentication and SSL parameters to true">Step 2: Set authentication and SSL parameters to true</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step3Provideauthenticationcredentials" title="Step 3: Provide authentication credentials">Step 3: Provide authentication credentials</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step4Applytheconfigurationchanges" title="Step 4: Apply the configuration changes">Step 4: Apply the configuration changes</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step5Restartcomponents" title="Step 5: Restart components">Step 5: Restart components</a> </p></li></ul></div></li></ul></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Prerequisite"><div class="titlepage"><div><div class="title"><h6 class="title">Prerequisite</h6></div></div></div><p> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204669178/Sysdig+Install+with+Kubernetes+1.9+" target="_blank">Install the Sysdig Platform</a> following the Kubernetes installation steps, version 2.3.0 or later, OR <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/367165531/Expanded+Upgrade+Kubernetes+Installations+version+July+2019" target="_blank">upgrade to version 2.3.0 </a>or later.</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><p>If your Sysdig installation is in production, enabling Cassandra authentication and SSL will require downtime. Be sure to schedule a maintenance window in advance.</p></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-EnableAuthenticationandTLS"><div class="titlepage"><div><div class="title"><h6 class="title">Enable Authentication and TLS</h6></div></div></div><h6 id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step1Createalocalcopyofthecurrentsysdigcloud-configconfigmap" class="bridgehead">Step 1: Create a local copy of the current sysdigcloud-config configmap</h6><p>Write the current configmap configuration to a local file so you can edit it and subsequently apply the changes (step 4).</p><pre class="programlisting">NAMESPACE=sysdigcloud
kubectl -n $NAMESPACE get configmap sysdigcloud-config -o yaml &gt; sysdigcloud-configmap.yaml</pre><h6 id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step2SetauthenticationandSSLparameterstotrue" class="bridgehead">Step 2: Set authentication and SSL parameters to true</h6><p>In <code class="code">sysdigcloud-configmap.yaml</code>, set BOTH <span class="bold bold"><strong> <code class="code">cassandra.secure</code> </strong></span> and <span class="bold bold"><strong> <code class="code">cassandra.ssl.enabled</code> </strong></span> to <span class="bold bold"><strong> <code class="code">true</code> </strong></span> <code class="code">. </code>The default values are <code class="code">false</code>.(For this release, setting either to <code class="code">false</code> will not enable auth or SSL).</p><pre class="programlisting">cassandra.secure: "true"
cassandra.ssl.enabled: "true"</pre><h6 id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step3Provideauthenticationcredentials" class="bridgehead">Step 3: Provide authentication credentials</h6><p>In <code class="code">sysdigcloud-configmap</code> <code class="code">.yaml</code>, provide BOTH <code class="code">cassandra.user</code> and <code class="code">cassandra.password.</code> </p><pre class="programlisting">cassandra.user: &lt;username&gt;
cassandra.password: &lt;password&gt;</pre><h6 id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step4Applytheconfigurationchanges" class="bridgehead">Step 4: Apply the configuration changes</h6><pre class="programlisting">kubectl -n $NAMESPACE apply -f sysdigcloud-configmap.yaml</pre><h6 id="UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Step5Restartcomponents" class="bridgehead">Step 5: Restart components</h6><p>Restart Cassandra, API, collector, and worker pods:</p><pre class="programlisting">kubectl -n $NAMESPACE delete pod -l role=cassandra
kubectl -n $NAMESPACE delete pod -l role=collector
kubectl -n $NAMESPACE delete pod -l role=api
kubectl -n $NAMESPACE delete pod -l role=worker</pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-059259c5-41cc-52f1-27db-8692bce591a4" data-publication-date="" id="UUID-a6838af5-084b-2767-1990-f0fcc15fa720"><div class="titlepage"><div><div class="title"><h5 class="title">Authentication and Authorization (On-Prem Options)</h5></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This section is for the Sysdig On-Premises software platform only. If you are using SaaS (cloud-based) Sysdig applications, see <a class="link" href="33836-17746-administration-settings.html#UUID-00273e7d-d633-d601-c674-81315dedffb8" title="Authentication and Authorization (SaaS)">Authentication and Authorization (SaaS)</a> instead.</p></div><p>Sysdig Monitor and Sysdig Secure are designed to work with several user authentication/authorization methods:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Type</p></th><th class="th"><p>Enabled by Default</p></th><th class="th"><p>Integration Steps Required</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>User email/password</strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>No</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Google OAuth</strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Yes</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>SAML</strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Yes</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>OpenID Connect</strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Yes</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>LDAP</strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Yes</p></td></tr></tbody></table></div><p>A sample user's view:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="200px"><tr><td><img src="image/15d5af4f3d2163.png" style="max-width: 200px; " alt="373573734.png"></img></td></tr></table></div><p>The pages in this section describe the integration and enablement steps required for SAML or OpenID Connect, and the <a class="link" href="https://blog.gemalto.com/security/2017/08/29/identity-provider-idp-need-one/" target="_blank">Identity Provider (IdP) services</a> that support these protocols, such as Okta, OneLogin, Keycloak.</p><p>In the SaaS environment, <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206536738/Google+OAuth+SaaS" target="_blank">Google</a> login can be enabled with a simple drop-down selection; the integration has already been performed.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>To enable a third-party authentication method for both Sysdig Monitor and Sysdig Secure, you must configure the SSO settings separately for each.</p><p>For Sysdig Monitor, you can enter the settings either from the UI or using scripts. For Sysdig Secure, you must use the scripts.</p></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a6838af5-084b-2767-1990-f0fcc15fa720_id_AuthenticationandAuthorizationOn-PremOptions-Workflow"><div class="titlepage"><div><div class="title"><h6 class="title">Workflow</h6></div></div></div><p>With the new Authorization UI, the basic process of enabling a Single Sign-On (SSO) option is:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Determine which SSO option (GoogleOAuth, SAML, OpenID, LDAP) your enterprise uses, and which IdP service (Okta, OneLogin, etc.) is used, if any.</p></li><li class="step"><p>Configure any associated IdP settings on the IdP side.</p></li><li class="step"><p>Enter the required connection settings for the chosen SSO on the appropriate <code class="code">Authentication</code> tab in Sysdig Settings.</p><p>You can also configure the settings using a script, if preferred.</p></li><li class="step"><p>Select the SSO option from the <code class="code">Enabled Single Sign-On</code> drop-down and click <code class="code">Save Authentication</code>.</p></li><li class="step"><p>If enabling for both Sysdig Monitor and Sysdig Secure, perform the necessary steps on the second application.</p></li></ol></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="800px"><tr><td><img src="image/15d5af4f3e1148.jpg" style="max-width: 800px; " alt="373573718.jpg"></img></td></tr></table></div><p> <span class="italic italic">View of the Authentication page for Google OAuth in the on-prem environment. </span> </p><p>Topics in this section:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-75a13b23-2396-d5df-9111-385ec8054322" title="Google OAuth (On-Prem)">Google OAuth (On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314" title="SAML (On-Prem)">SAML (On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-583ee504-4257-5b8c-b333-20cdc51c4086" title="LDAP">LDAP</a> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-b09e99a9-9741-3a9f-4624-e0f9845a6731" data-publication-date="" id="UUID-75a13b23-2396-d5df-9111-385ec8054322"><div class="titlepage"><div><div class="title"><h6 class="title">Google OAuth (On-Prem)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>These instructions are specific to <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> of the Sysdig platform. If you are using the cloud-based (SaaS) Sysdig platform, refer to <a class="link" href="33836-17746-administration-settings.html#UUID-d6353154-fac4-003e-a8bb-bb3f32282310" title="Google OAuth (SaaS)">Google OAuth (SaaS)</a> instead.</p></div><p>Google supports OAuth 2.0, which allows users to log in to third-party applications such as Sysdig using Google credentials. By default, the created user will not have Admin rights within the Sysdig application, though these rights can be subsequently assigned.</p><h6 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Prerequisites" class="bridgehead">Prerequisites</h6><p>The Sysdig platform on-premises installation must have a DNS name associated with it. Google does not support applications that do not have an associated DNS name.</p><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-DNSName" class="bridgehead">DNS Name</h7><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Replicated" class="bridgehead">Replicated</h7><p>For <a class="link" href="33836-17626-on-premises-deployments.html#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04" title="Sysdig Install with Replicated">Replicated-based installations</a>, enter your <code class="code">Hostname</code> in the <code class="code">Settings</code> tab.</p><div class="mediaobject"><img src="image/15d5af4f3e8c03.png" style="" alt="373573858.png"></img></div><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Kubernetes" class="bridgehead">Kubernetes</h7><p>For <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes" target="_blank">Kubernetes-based installations</a>, ensure the <a class="link" href=""> <span class="bold bold"><strong> <code class="code">api.url</code> </strong></span> ConfigMap element</a> contains your hostname.</p><p>For the examples that follow, <code class="code">DNS_NAME</code> refers to this hostname you configured in your platform settings.</p><h6 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-InGoogleConsoleObtainOAuthClientCredentials" class="bridgehead">In Google Console: Obtain OAuth Client Credentials</h6><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the <a class="link" href="https://console.developers.google.com/" target="_blank">Google API Console</a>.</p></li><li class="step"><p>Select <span class="bold bold"><strong> <code class="code">Credentials</code> </strong></span>from the left-hand navigation, and choose the <code class="code">OAuth consent screen</code> tab.</p><p>Enter the required <span class="bold bold"><strong>Email address</strong></span> and <span class="bold bold"><strong>Product name</strong></span>, as well as other additional optional information, then click <code class="code">Save</code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f3f0860.png" style="max-width: 600px; " alt="373573851.png"></img></td></tr></table></div></li><li class="step"><p>From the <code class="code">Credentials</code> tab, click the <code class="code">Create Credentials</code> drop-down and select <code class="code">OAuth client ID</code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="800px"><tr style="height: 319px"><td><img src="image/15d5af4f405595.png" style="max-width: 800px; max-height: 319px; " alt="373573844.png"></img></td></tr></table></div></li><li class="step"><p>When prompted for <span class="bold bold"><strong>Application type</strong></span>, select <span class="bold bold"><strong>Web application</strong></span>, then enter the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong>Name: </strong></span>Use a meaningful name, such as "Sysdig".</p></li><li class="listitem"><p> <span class="bold bold"><strong>Authorized Javascript Origins:</strong></span> Enter <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://DNS_NAMEAPI_PORT" target="_blank">https://DNS_NAME:API_PORT</a> </code> </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong>Authorized Redirect URLs:</strong></span> Enter one or more of the following values:</p><p>If configuring Sysdig Monitor, enter: <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://DNS_NAMEAPI_PORT" target="_blank">https://DNS_NAME:API_PORT/api/oauth/google/auth</a> </code> </strong></span> </p><p>If configuring Sysdig Secure, enter: <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://DNS_NAMEAPI_PORT" target="_blank">https://DNS_NAME:API_PORT/api/oauth/google/secureAuth</a> </code> </strong></span> </p><p> <code class="code"></code> </p></li></ul></div></li><li class="step"><p>Click <code class="code">Create</code>.</p><p>A success message with client ID and client secret will be displayed. Copy these to a safe place, as you will need them in the next step.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="511px"><tr style="height: 222px"><td><img src="image/15d5af4f40bcf2.png" style="max-width: 511px; max-height: 222px; " alt="373573830.png"></img></td></tr></table></div></li></ol></div><p>Configure Settings in Sysdig</p><p>There are three options for configuring OAuth settings on the Sysdig side: a UI page (for Monitor only), scripts (both products), or entries in your Replicated or Kubernetes orchestrator (both products).</p><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Option1UI-BasedConfigureGoogleOAuthinSettingsMonitorOnly" class="bridgehead">Option 1 UI-Based: Configure Google OAuth in Settings (Monitor Only)</h7><p>At this time, the Authorization UI is available only for Sysdig Monitor.</p><p>To enable baseline Google Oauth functionality:</p><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-EnterGoogleOAuthBasicSettings" class="bridgehead">Enter Google OAuth Basic Settings</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to Sysdig Monitor or Sysdig Secure as <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206569685/Find+the+Super+Admin+Credentials+and+User+Token" target="_blank">"super" Admin</a> and select <code class="code">Settings. <div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr style="height: 60px"><td><img src="image/15d5af4f412a18.png" style="max-width: 250px; max-height: 60px; " alt="373573812.png"></img></td></tr></table></div></code> </p></li><li class="step"><p>Select <code class="code">Authentication</code>.</p></li><li class="step"><p>Select the <code class="code">Google OAuth</code> tab.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="700px"><tr><td><img src="image/15d5af4f419223.png" style="max-width: 700px; " alt="373573787.png"></img></td></tr></table></div></li><li class="step"><p>Enter the relevant parameters and click <code class="code">Save</code>.</p><p> <span class="bold bold"><strong>Application ID:</strong></span> the Client ID you were sent.</p><p> <span class="bold bold"><strong>Application Secret:</strong></span> the Client Secret you were sent</p><p> <span class="bold bold"><strong>URL Redirect: </strong></span> </p><p>If configuring Sysdig Monitor, enter: <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://DNS_NAMEAPI_PORT" target="_blank">https://DNS_NAME:API_PORT/api/oauth/google/auth</a> </code> </strong></span> </p><p>If configuring Sysdig Secure, enter: <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://DNS_NAMEAPI_PORT" target="_blank">https://DNS_NAME:API_PORT/api/oauth/google/secureAuth</a> </code> </strong></span> <span class="bold bold"><strong>Allowed Domains:</strong></span> Comma-separated list of domains permitted to log in. For example, <span class="italic italic"> <a class="link" href="http://mycompany.com" target="_blank">mycompany.com</a>, <a class="link" href="http://myxompanyalias.com" target="_blank">myxompanyalias.com</a>.</span> </p></li></ol></div><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-SelectGoogleOAuthforSSO" class="bridgehead">Select Google OAuth for SSO</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <code class="code">Google Oauth </code>from the <span class="bold bold"><strong> <code class="code">Enabled Single Sign-On </code> </strong></span>dropdown</p></li><li class="step"><p>Click <code class="code">Save Authentication</code>.</p></li><li class="step"><p>Repeat for Sysdig Monitor or Sysdig Secure, if you want to enable on both applications.</p></li></ol></div><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Option2Script-BasedConfigureOAuthUsingScriptsMonitororSecure" class="bridgehead">Option 2 Script-Based: Configure OAuth Using Scripts (Monitor or Secure)</h7><p>The configuration of the Google OAuth feature can be viewed, updated, and deleted by the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206569685/Find+the+Super+Admin+Credentials+and+User+Token" target="_blank">"super" Admin</a>. A <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/Google_Oauth/google_oauth_config.sh" target="_blank">google_oauth_config.sh</a> </code> </strong></span> helper script is available in the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/SSO" target="_blank"> <span class="bold bold"><strong>SSO</strong></span> </a> folder at <span class="bold bold"><strong> <code class="code">sysdig-cloud-scripts</code> </strong></span> repository to assist in completing this configuration. Invoking the script with no options will display help text.</p><pre class="programlisting"># ./google_oauth_config.sh -h
Usage: ./google_oauth_config.sh [OPTIONS]

Affect Google Oauth login settings for your Sysdig software platform installation
</pre><p>To use the helper script, modify <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> of the "super" Admin user and the <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for accessing the Sysdig platform API (which will be the same URL that your users access for the Sysdig Monitor application).</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Depending if the API_TOKEN has been obtained from the Sysdig Monitor or Sysdig Secure application UI, the settings will be applied to the consequent product.</p></div><p>Initially no Google Oauth settings are set. A initial run of the script would confirm that:</p><pre class="programlisting"># ./google_oauth_config.sh
No google-oauth settings are set
Run for further info: ./google_oauth_config.sh -h</pre><p>Add the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option to set the Google Oauth configuration for a particular Sysdig application. When setting the config, you'll use additional options to provide the config details you saved in the earlier Google Oauth step.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>Config Detail</p></th><th class="th"><p>Option</p></th></tr></thead><tbody><tr><td class="td"><p>Client ID</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-i</code> </strong></span> </p></td></tr><tr><td class="td"><p>Client Secret</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-e</code> </strong></span> </p></td></tr><tr><td class="td"><p>Allowed Domains</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-a</code> </strong></span> </p></td></tr><tr><td class="td"><p>Redirect URL</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-r</code> </strong></span> </p></td></tr></tbody></table></div><p>If the configuration is successfully posted to the Sysdig platform, the new configuration will be echoed back.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Depending if the API_TOKEN has been obtained from the Sysdig Monitor or Sysdig Secure application UI, the settings will be applied to the relevant product.</p></div><pre class="programlisting"># ./google_oauth_config.sh -s -i "t2em0alq7l13n1hevua48ehieenkb06q.apps.googleusercontent.com" -e "ucP_WY908-k" -r "https://sysdigtest.com:443/api/oauth/google/auth" -a "[\"sysdig.com\"]"
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547709552000,
    "type": "google-oauth",
    "scope": "SYSTEM",
    "settings": {
      "clientId": "t2em0alq7l13n1hevua48ehieenkb06q.apps.googleusercontent.com",
      "clientSecret": "ucP_WY908-k",
      "redirectUrl": "https://sysdigtest.com:443/api/oauth/google/auth",
      "allowedDomains": [
        "sysdig.com"
      ]
    }
  }
}</pre><p>Once you've completed this configuration, clicking the Google Login button at the login screen of the appropriate Sysdig application(s) should redirect to Google Oauth login page.</p><p>If you wish to delete your Google Oauth configuration, invoke the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. If successful, the disabled configuration will be printed.</p><pre class="programlisting"># ./google_oauth_config.sh -d
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547709552000,
    "type": "google-oauth",
    "scope": "SYSTEM",
    "settings": {
      "clientId": "t2em0alq7l13n1hevua48ehieenkb06q.apps.googleusercontent.com",
      "clientSecret": "ucP_WY908-k",
      "redirectUrl": "https://sysdigtest.com:443/api/oauth/google/auth",
      "allowedDomains": [
        "sysdig.com"
      ]
    }
  }
}</pre><p>Option 3 Orchestrator-Based: Enter Settings Using Orchestrator (Monitor or Secure)</p><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Replicated1" class="bridgehead">Replicated</h7><p>If you used the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204767355/Replicated+Installation+Guide" target="_blank">Replicated</a> infrastructure manager to install the Sysdig platform:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to the Replicated Management Console, click to the <code class="code">Settings</code> tab, then check the box to expand the<code class="code">Advanced Settings</code>.</p></li><li class="step"><p>Enter the <code class="code">Google OAuth client ID </code>and <code class="code">Google OAuth client Secret</code> in the appropriate fields.</p></li><li class="step"><p>(Optional) In a comma-separated list, enter the <code class="code">OAuth-allowed email domains</code> that should be permitted to authenticate. If set, only Google users whose email addresses are in these domains will be able to login to your Sysdig installation. If this setting is left blank, any user that successfully authenticates via Google will be permitted to login to your Sysdig installation.</p><div class="mediaobject"><img src="image/15d5af4f41fbd4.png" style="" alt="373573824.png"></img></div></li><li class="step"><p>Click <code class="code">Save</code>.The Sysdig platform will then restart to enable the settings.</p></li></ol></div><h7 id="UUID-75a13b23-2396-d5df-9111-385ec8054322_id_GoogleOAuthOn-Prem-Kubernetes1" class="bridgehead">Kubernetes</h7><p>Enter the <span class="bold bold"><strong>OAuth allowed domains, Client ID</strong></span>, and <span class="bold bold"><strong>Client Secret</strong></span> into the <a class="link" href="">appropriate elements of the Kubernetes ConfigMap</a>. Use appropriate Kubernetes methods to push the updated settings and restart the backend containers to make the changes take effect.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows" style="text-align: left;"><colgroup><col></col></colgroup><tbody><tr><td class="td"><p> <code class="code"># Optional: OAuth allowed domains (comma separated list of domains)</code> <code class="code">sysdigcloud.oauth.allowed.domains.list: </code> <code class="code">""</code> <code class="code"># Optional: Sysdig Cloud Google OAuth Client ID</code> <code class="code"> <a class="link" href="http://sysdigcloud.google.oauth.client.id" target="_blank">sysdigcloud.google.oauth.client.id</a>: </code> <code class="code">""</code> <code class="code"># Optional: Sysdig Cloud Google OAuth Client Secret</code> <code class="code">sysdigcloud.google.oauth.client.secret: </code> <code class="code">""</code> </p></td></tr></tbody></table></div><p>User Experience</p><p>Note the following requirements for successful Google OAuth login:</p><div dir="ltr" class="warning warning"><h3 class="title">Warning</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>The user must have already logged in successfully at least once to your environment (such as via email-based Invitation and having set an initial password)</p></li><li class="listitem"><p>The user's login username in the Sysdig platform must precisely match the user's Google email address (that is, it cannot be a shortened/altered Google email alias)</p></li></ul></div></div><p>For such a user to log in via Google OAuth, click the <code class="code">Log in with Google</code> button.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="200px"><tr><td><img src="image/15d5af4f427801.png" style="max-width: 200px; " alt="373573818.png"></img></td></tr></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If the user's browser has not already successfully authenticated via Google and/or has multiple Google profiles known by their browser, they will be presented a Google page to select a profile and enter a password (if necessary) before being redirected back to your Sysdig environment.</p></div><p>See also <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206307381/User+and+Team+Administration" target="_blank">User and Team Administration</a> for information on creating users.</p><pre class="programlisting"></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Prerequisites </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> DNS Name </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Replicated </p></li><li class="listitem"><p> Kubernetes </p></li></ul></div></li></ul></div></li><li class="listitem"><p> In Google Console: Obtain OAuth Client Credentials  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Option 1 UI-Based: Configure Google OAuth in Settings (Monitor Only) </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Enter Google OAuth Basic Settings </p></li><li class="listitem"><p> Select Google OAuth for SSO  </p></li></ul></div></li><li class="listitem"><p> Option 2 Script-Based: Configure OAuth Using Scripts (Monitor or Secure)  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Replicated  </p></li><li class="listitem"><p> Kubernetes </p></li></ul></div></li></ul></div></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-930373d2-8411-1d19-583d-88d89f44d6eb" data-publication-date="" id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314"><div class="titlepage"><div><div class="title"><h6 class="title">SAML (On-Prem)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This guide is specific to cloud-based (SaaS) Sysdig environments. If you are configuring an On-Premises Sysdig environment, refer to <a class="link" href="https://sysdigdocs.atlassian.net/wiki/pages/resumedraft.action?draftId=206569527" target="_blank">SAML (On-Prem)</a> instead.</p></div><p> <span class="bold bold"><strong> <a class="link" href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language" target="_blank">SAML</a> </strong></span> support in the Sysdig platform allows authentication via your choice of <a class="link" href="https://en.wikipedia.org/wiki/Identity_provider" target="_blank">Identity Provider (IdP)</a>.</p><p>The Sysdig platform ordinarily maintains its own user database to hold a username and password hash. SAML instead allows for redirection to your organization's IdP to validate username/password and other policies necessary to grant access to Sysdig application(s). Upon successful authentication via SAML, a corresponding user record in the Sysdig platform’s user database is automatically created, though the password that was sent to the IdP is never seen nor stored by the Sysdig platform.</p><p>This section describes how to integrate and enable SAML with both Sysdig Monitor and Sysdig Secure.</p><p>For specific IdP integration information, refer to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277" title="Okta (SAML On-Prem)">Okta (SAML On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a" title="OneLogin (SAML On-Prem)">OneLogin (SAML On-Prem)</a> </p></li></ul></div><p>See also <a class="link" href="">Caveats</a>.</p><h6 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-BasicEnablementWorkflow" class="bridgehead">Basic Enablement Workflow</h6><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Step</p></th><th class="th"><p>Options</p></th><th class="th"><p>Notes</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>1. Know which IdP your company uses and will be configuring.</strong></span> </p></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277" title="Okta (SAML On-Prem)">Okta (SAML On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a" title="OneLogin (SAML On-Prem)">OneLogin (SAML On-Prem)</a> </p></li></ul></div></td><td class="td"><p>These are the IdPs for which Sysdig has performed detailed interoperability testing and confirmed how to integrate using their standard docs.</p><p>If your IDP is not listed, it may still work with the Sysdig platform. Contact Sysdig Support for help.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>2. Decide the login flow you want users to experience (choose from three options):</strong></span> </p></td><td class="td"><p>Click SAML button</p></td><td class="td"><p>From <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/</a> </code> </strong></span> </strong></span> or <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/secure</a> </code> </strong></span> </strong></span> </p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="60px"><tr><td><img src="image/15d5af4f42f71b.png" style="max-width: 60px; " alt="373573955.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="57px"><tr><td><img src="image/15d5af4f435ee9.png" style="max-width: 57px; " alt="373573949.png"></img></td></tr></table></div></td></tr><tr><td class="td"></td><td class="td"><p>Type/bookmark a URL in browser</p></td><td class="td"><p> <span class="bold bold"><strong>Monitor:</strong></span> <code class="code"> <a class="link" href="https://HOSTNAME/api/saml" target="_blank">https://HOSTNAME/api/saml</a> </code> <code class="code"></code> <span class="bold bold"><strong>Secure: </strong></span> <code class="code"> <a class="link" href="https://HOSTNAME/api/saml?product=SDS" target="_blank">https://HOSTNAME/api/saml?product=SDS</a> </code> <code class="code"></code> </p></td></tr><tr><td class="td"></td><td class="td"><p>Log in from an IdP interface</p></td><td class="td"><p>The individual IdP integration pages describe how to add Sysdig to the IdP interface.</p><p>You will need your <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/208994483/Find+Your+Customer+Number" target="_blank">Sysdig customer number</a> on hand. Normally <span class="bold bold"><strong>1 </strong></span>for on-premises.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>3. Perform the configuration steps in your IdP interface and collect the resulting config attributes.</strong></span> </p></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277" title="Okta (SAML On-Prem)">Okta (SAML On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a" title="OneLogin (SAML On-Prem)">OneLogin (SAML On-Prem)</a> </p></li></ul></div></td><td class="td"><p>Collect metadata URL (or XML) and test it.</p><p>If you intend to configure IDP-initiated login flow, have your <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/208994483/Find+Your+Customer+Number" target="_blank">Sysdig customer number</a> on hand. It will be referenced in later configuration steps as <code class="code">CUSTOMER_ID_NUMBER</code>. Normally <span class="bold bold"><strong>1. </strong></span> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>4 a. Log in to Sysdig Monitor (as "super" admin) and enter the necessary configuration information in the UI. Enable SAML as your SSO. </strong></span> </p><p> <span class="bold bold"><strong>4b. Log in to Sysdig Secure (as "super" admin) and enter configuration information using scripts. </strong></span> </p></td><td class="td"></td><td class="td"><p>4a. Sysdig Monitor only</p><p>4b. Sysdig Monitor (optional) or Sysdig Secure</p></td></tr></tbody></table></div><h6 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-AdministratorSteps" class="bridgehead">Administrator Steps</h6><h7 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-ConfigureIdP" class="bridgehead">Configure IdP</h7><p>Select the appropriate IdP from the list below, and follow the instructions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277" title="Okta (SAML On-Prem)">Okta (SAML On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a" title="OneLogin (SAML On-Prem)">OneLogin (SAML On-Prem)</a> </p></li></ul></div><h7 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-UI-BasedConfigureSAMLinSettingsMonitorOnly" class="bridgehead">UI-Based: Configure SAML in Settings (Monitor Only)</h7><p>At this time, the Authorization UI is available only for Sysdig Monitor.</p><p>To enable baseline SAML functionality:</p><h7 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-EnterSAMLConnectionSettings" class="bridgehead">Enter SAML Connection Settings</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to Sysdig Monitor or Sysdig Secure as administrator and select <code class="code">Settings. <div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr style="height: 60px"><td><img src="image/15d5af4f43cf7e.png" style="max-width: 250px; max-height: 60px; " alt="373573943.png"></img></td></tr></table></div></code> </p></li><li class="step"><p>Select <code class="code">Authentication</code>.</p></li><li class="step"><p>Select the <code class="code">SAML</code> tab.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f443138.png" style="max-width: 600px; " alt="373573937.png"></img></td></tr></table></div></li><li class="step"><p>Enter the relevant parameters (see table below) and click <code class="code">Save</code>.</p></li></ol></div><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Connection Setting</p></th><th class="th"><p>Options</p></th><th class="th"><p>Description</p></th><th class="th"><p>Sample Entry</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Metadata</strong></span> </p></td><td class="td"><p>URL</p></td><td class="td"><p>The URL provided at the end of the IdP configuration steps.</p></td><td class="td"></td></tr><tr><td class="td"></td><td class="td"><p>XML</p></td><td class="td"><p>An option that can be used for an IdP that doesn't support extracting metadata XML via URL.</p></td><td class="td"></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Signed Assertion</strong></span> </p></td><td class="td"><p>off/on</p></td><td class="td"><p>Should Sysdig check for assertions signed in responses (to assist in validating correct IdP).</p></td><td class="td"><p>ON</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Email Parameter</strong></span> </p></td><td class="td"><p>email</p></td><td class="td"><p>Name of parameter in the SAML response for user email ID. Sysdig uses this to extract the user's email from the response.</p></td><td class="td"><p>email</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Validate Signature</strong></span> </p></td><td class="td"><p>off/on</p></td><td class="td"><p>Sysdig backend should verify that the response is signed.</p></td><td class="td"><p>ON</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Verify Destination</strong></span> </p></td><td class="td"><p>off/on</p></td><td class="td"><p>Flag to control whether Sysdig should check the "destination" field in the SAMLResponse. Recommend ON, as a security measure. May be OFF in special cases, such as a proxy in front of the Sysdig back end.</p></td><td class="td"><p>ON</p></td></tr></tbody></table></div><h7 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-SelectSAMLforSSO" class="bridgehead">Select SAML for SSO</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <code class="code">SAML </code>from the <span class="bold bold"><strong> <code class="code">Enabled Single Sign-On </code> </strong></span>dropdown</p></li><li class="step"><p>Click <code class="code">Save Authentication</code>.</p></li><li class="step"><p>Repeat entire enablement process for Sysdig Monitor or Sysdig Secure, if you want to enable on both applications.</p></li></ol></div><h7 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-Script-BasedConfigureSAMLUsingScriptsMonitororSecure" class="bridgehead">Script-Based: Configure SAML Using Scripts (Monitor or Secure)</h7><p>The configuration of the SAML feature can be viewed, updated, and deleted by the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">"super" Admin</a>. A <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/SAML/saml_config.sh" target="_blank">saml_config.sh</a> </code> helper script is available in the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/SSO" target="_blank"> <span class="bold bold"><strong>SSO</strong></span> </a> folder at <span class="bold bold"><strong> <code class="code">sysdig-cloud-scripts</code> </strong></span> repository to assist in completing this configuration. Invoking the script with no options will display help text.</p><pre class="programlisting"># ./saml_config.sh
Must specify the Sysdig App whose SAML configuration will be viewed/set

Usage: ./saml_config.sh [OPTIONS]

Affect SAML login settings for your Sysdig software platform installation

If no OPTIONS are specified, only the help output is displayed. </pre><p>To use the helper script, modify <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> of the "super" Admin user and the <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for accessing the Sysdig platform API (which will be the same URL that your users access for the Sysdig Monitor application).</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Depending if the API_TOKEN has been obtained from the Sysdig Monitor or Sysdig Secure application UI, the settings will be applied to the relevant product.</p></div><p>Initially no SAML settings are set. A initial run of the script would confirm that:</p><pre class="programlisting"># ./saml_config.sh
No saml settings are set
Run for further info: ./saml_config.sh -h
</pre><p>Add the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option to set the SAML configuration for a particular Sysdig application. When setting the config, you'll also include the metadata URL you saved in the earlier IDP configuration step (<span class="bold bold"><strong> <code class="code">-m</code> </strong></span> option) and specify the name of a supported IDP configuration (<span class="bold bold"><strong> <code class="code">-i</code> </strong></span> option), which will tailor other details of your SAML configuration to the specifics of that IDP. If the configuration is successfully posted to the Sysdig platform, the new configuration will be echoed back.</p><p>An example of creating the two separate SAML configurations for both Monitor and Secure, each using Okta IDP settings:</p><pre class="programlisting"># ./saml_config.sh -s -m 'https://dev-824158.oktapreview.com/app/exkfpgqiskSoGZrjE0h7/sso/saml/metadata' -i okta
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547539750000,
    "type": "saml",
    "scope": "SYSTEM",
    "settings": {
      "metadataUrl": "https://dev-824158.oktapreview.com/app/exkfpgqiskSoGZrjE0h7/sso/saml/metadata",
      "metadata": null,
      "validateSignature": true,
      "emailParameter": "email",
      "signedAssertion": true,
      "verifyDestination": true,
      "createUserOnLogin": true
    }
  }
}</pre><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>If you are using an IDP other than those available with the <span class="bold bold"><strong> <code class="code">-i</code> </strong></span> option, contact Sysdig Support for assistance with determining the correct settings.</p></div><p>Once you've completed this configuration, clicking the SAML button at the login screen of the appropriate Sysdig application(s) should redirect to your IDP for authentication.</p><p>If you wish to delete your SAML configuration, invoke the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. If successful, the disabled configuration will be printed.</p><pre class="programlisting"># ./saml_config.sh -a monitor -d
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547539750000,
    "type": "saml",
    "scope": "SYSTEM",
    "settings": {
      "metadataUrl": "https://dev-824158.oktapreview.com/app/exkfpgqiskSoGZrjE0h7/sso/saml/metadata",
      "metadata": null,
      "validateSignature": true,
      "emailParameter": "email",
      "signedAssertion": true,
      "verifyDestination": true,
      "createUserOnLogin": true
    }
  }
}</pre><h6 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-OptionalAuto-creationofuserrecords" class="bridgehead">Optional: Auto-creation of user records</h6><p>When a user successfully authenticates via SAML, if a user record does not yet exist in the Sysdig platform database for their email address, one will be created at that time (default behavior). Some environments may not like this approach and may instead only want to permit logins for users whose records already exist (such as may have been already created via <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206405831/Manage+Users" target="_blank">email invite</a> or <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/user_creation" target="_blank">creation via the API</a>).</p><p>To disable the auto-creation of user records after SAML authentication, add the <span class="bold bold"><strong> <code class="code">-n</code> </strong></span> option to your command line when applying your settings. This will set <span class="bold bold"><strong> <code class="code">createUserOnLogin</code> </strong></span> to <span class="bold bold"><strong> <code class="code">false</code> </strong></span>.</p><pre class="programlisting"># ./saml_config.sh -s -n -m 'https://dev-824158.oktapreview.com/app/exkfpgqiskSoGZrjE0h7/sso/saml/metadata' -i okta
{
  "authenticationSettings": {
    "id": 2,
    "version": 1,
    "createdOn": 1547539856000,
    "type": "saml",
    "scope": "SYSTEM",
    "settings": {
      "metadataUrl": "https://dev-824158.oktapreview.com/app/exkfpgqiskSoGZrjE0h7/sso/saml/metadata",
      "metadata": null,
      "validateSignature": true,
      "emailParameter": "email",
      "signedAssertion": true,
      "verifyDestination": true,
      "createUserOnLogin": false
    }
  }
}</pre><h6 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-UserExperience" class="bridgehead">User Experience</h6><p>As noted in the <a class="link" href="">SAML (On-Prem)#Basic Enablement Workflow</a> above, you can offer users three ways to log in with a SAML configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>They can begin at the Sysdig SaaS URL and click the SAML button.</p><p>Monitor: <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/</a> </code> </strong></span> </strong></span> or Secure: <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/secure</a> </code> </strong></span> </strong></span>.</p><p>They will be prompted to enter a Company Name, so the Sysdig platform can redirect the browser to your IdP for authentication.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="150px"><tr><td><img src="image/15d5af4f42f71b.png" style="max-width: 150px; " alt="373573955.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="143px"><tr><td><img src="image/15d5af4f435ee9.png" style="max-width: 143px; " alt="373573949.png"></img></td></tr></table></div></li><li class="listitem"><p>You can provide an alternative URL to avoid the user having to enter a company name, in the format:</p><p>Sysdig Monitor: <code class="code"> <a class="link" href="https://HOSTNAME/api/saml" target="_blank">https://HOSTNAME/api/saml</a> </code> </p><p>Sysdig Secure: <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/api/saml?product=SDS" target="_blank">https://HOSTNAME/api/saml?product=SDS</a> </code> </strong></span> </p></li><li class="listitem"><p>You can configure an IdP-initiated login flow when configuring your IdP. The users then select the Sysdig application from your IDP's app directory and do not browse directly to a Sysdig application URL at all.</p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Users that complete their first successful SAML login to Sysdig Secure may receive the error message "User doesn't have permission to login in Sysdig Secure". This is because only members of the <span class="bold bold"><strong>Secure Operations</strong></span> team are permitted access to Sysdig Secure, and newly-created logins are not in this team by default. Such a user should contact an Administrator for the Sysdig environment to be added to the <span class="bold bold"><strong>Secure Operations</strong></span> team.</p><p>Environments that wish to have <span class="italic italic">all</span> users access Secure by default could use <a class="link" href="https://raw.githubusercontent.com/draios/python-sdc-client/master/examples/add_users_to_secure.py" target="_blank">this example script</a> to frequently "sync" the team memberships.</p></div><p>See also <a class="link" href="33836-17746-administration-settings.html#UUID-af0f76c8-bafd-4c22-2eba-ba3fcc26187d" title="User and Team Administration">User and Team Administration</a> for information on creating users.</p><h6 id="UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314_id_SAMLOn-Prem-Caveats" class="bridgehead">Caveats</h6><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SAML Assertion Encryption/Decryption is not currently supported.</p></li><li class="listitem"><p> <a class="link" href="https://www.portalguard.com/blog/2016/06/20/saml-single-logout-need-to-know/" target="_blank">SAML Single Logout</a> is not supported. Therefore, users should take care to log out directly from Sysdig application(s).</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Basic Enablement Workflow </p></li><li class="listitem"><p> Administrator Steps  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Configure IdP  </p></li><li class="listitem"><p> UI-Based: Configure SAML in Settings (Monitor Only)  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Enter SAML Connection Settings </p></li><li class="listitem"><p> Select SAML for SSO  </p></li></ul></div></li><li class="listitem"><p> Script-Based: Configure SAML Using Scripts (Monitor or Secure)  </p></li></ul></div></li><li class="listitem"><p> Optional: Auto-creation of user records </p></li><li class="listitem"><p> User Experience </p></li><li class="listitem"><p> Caveats  </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-880a263e-8327-2b0f-d210-15687c4a84d5" data-publication-date="" id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277"><div class="titlepage"><div><div class="title"><h6 class="title">Okta (SAML On-Prem)</h6></div></div></div><p>Review <a class="link" href="33836-17626-on-premises-deployments.html#UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314" title="SAML (On-Prem)">SAML (On-Prem)</a> before you begin.</p><p>Configure Sysdig Monitor and/or Sysdig Secure as a SAML application using Okta's documentation for <a class="link" href="https://developer.okta.com/standards/SAML/setting_up_a_saml_application_in_okta" target="_blank">Setting Up a SAML Application in Okta</a>. The notes below call out specific steps that require additional action.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Sysdig-Specific Steps for Okta Configuration  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Okta Step 6 </p></li><li class="listitem"><p> Okta Step 7 </p></li><li class="listitem"><p> Okta Step 10 </p></li></ul></div></li><li class="listitem"><p> Test Metadata (Optional)  </p></li></ul></div><h8 id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277_id_OktaSAMLOn-Prem-Sysdig-SpecificStepsforOktaConfiguration" class="bridgehead">Sysdig-Specific Steps for Okta Configuration</h8><h8 id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277_id_OktaSAMLOn-Prem-OktaStep6" class="bridgehead">Okta Step 6</h8><p>At step #6, if you don't intend to configure IDP-initiated login flow, check the boxes for "Do not display application icon to users" and "Do not display application icon in the Okta Mobile app".</p><h8 id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277_id_OktaSAMLOn-Prem-OktaStep7" class="bridgehead">Okta Step 7</h8><p>At step #7, enter the values shown in the table below, replacing <span class="bold bold"><strong> <code class="code">HOSTNAME</code> </strong></span> with the hostname through which your users access the Sysdig application(s) and <span class="bold bold"><strong> <code class="code">PORT</code> </strong></span> with the TCP port # (typically 443).</p><p>To configure IDP-initiated login flow, replace <span class="bold bold"><strong> <code class="code">CUSTOMER-ID-NUMBER</code> </strong></span> with the number retrieved as described in <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/208994483/Find+Your+Customer+Number" target="_blank">Find Your Customer Number</a>. (Normally the Customer ID will be <span class="bold bold"><strong> <code class="code">1</code> </strong></span> in on-prem installations.)</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p> <span class="bold bold"><strong>Setting</strong></span> </p></th><th class="th"><p> <span class="bold bold"><strong>Value for Sysdig Monitor</strong></span> </p></th><th class="th"><p>Value for Sysdig Secure</p></th></tr></thead><tbody><tr><td class="td"><p>Single sign on URL</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/auth</a> </code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/secureAuth</a> </code> </strong></span> </p></td></tr><tr><td class="td"><p>Audience URI (SP Entity ID)</p></td><td class="td"><p> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/metadata</a> </code> </p></td><td class="td"><p> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/metadata</a> </code> </p></td></tr><tr><td class="td"><p>Default RelayState</p><p>(optional - only configure if you intend to use IDP-initiated login flow)</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">#/&amp;customer=CUSTOMER-ID-NUMBER</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">#/&amp;customer=CUSTOMER-ID-NUMBER</code> </strong></span> </p></td></tr></tbody></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>You <span class="bold bold"><strong> <span class="underline underline">must </span> </strong></span>include the port number in the IDP-side configuration, even though port 443 is the typical default for <code class="code">https://</code> URLs.</p></div><p>Okta Step 8</p><p>At step #8, instead of those shown in the Okta example, add the values:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p> <span class="bold bold"><strong>Name</strong></span> </p></th><th class="th"><p> <span class="bold bold"><strong>Value</strong></span> </p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">email</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">user.email</code> </strong></span> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">first name</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">user.firstName</code> </strong></span> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">last name</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">user.lastName</code> </strong></span> </p></td></tr></tbody></table></div><p>Note that the attributes are <span class="bold bold"><strong> <span class="underline underline">case sensitive</span> </strong></span>, so use caution when entering them.</p><p>Only <span class="bold bold"><strong> <code class="code">email</code> </strong></span> is required. However, including first/last name is recommended, since these values will now be included in the records created in the Sysdig platform's database when new users successfully login via SAML for the first time.</p><h8 id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277_id_OktaSAMLOn-Prem-OktaStep10" class="bridgehead">Okta Step 10</h8><p>At step #10, copy the <span class="bold bold"><strong>URL</strong></span> and paste in the <span class="bold bold"><strong>Metadata</strong></span> entry on the SAML Configuration page in the <a class="link" href="">SAML connection settings</a>.</p><h8 id="UUID-0c122f4e-dcae-dc0c-3187-095ed52f3277_id_OktaSAMLOn-Prem-TestMetadataOptional" class="bridgehead">Test Metadata (Optional)</h8><p>To ensure the metadata URL you copy at the end of the IDP configuration procedure is correct, you can test it by directly accessing it via your browser.</p><p>When accessing the URL, your browser should immediately download an XML file that begins similarly to the example shown below. No entry of credentials or other security measures should be required to successfully download it. If this is not the case, revisit the IDP configuration steps.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows" style="text-align: left;"><tbody><tr><td class="td"><p> <code class="code">&lt;?xml version=</code> <code class="code">"1.0"</code> <code class="code">?&gt;</code> <code class="code">&lt;EntityDescriptor xmlns=</code> <code class="code">"urn:oasis:names:tc:SAML:2.0:metadata"</code> <code class="code">entityID=</code> <code class="code">"<a class="link" href="https://app.onelogin.com/saml/metadata/680358%22" target="_blank">https://app.onelogin.com/saml/metadata/680358"</a> </code> <code class="code">&gt;</code> <code class="code"></code> <code class="code">&lt;IDPSSODescriptor xmlns:ds=</code> <code class="code">"<a class="link" href="">http://www.w3.org/2000/09/xmldsig#"</a> </code> <code class="code">protocolSupportEnumeration=</code> <code class="code">"urn:oasis:names:tc:SAML:2.0:protocol"</code> <code class="code">&gt;names:tc:SAML:</code> <code class="code">2.0</code> <code class="code">:metadata</code> <code class="code">" entityID="</code> <code class="code"> <a class="link" href="https://app.onelogin.com/saml/metadata/" target="_blank">https://app.onelogin.com/saml/metadata/</a> </code> <code class="code">680358</code> <code class="code">"&gt;</code> <code class="code"></code> <code class="code">...</code> </p></td></tr></tbody></table></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-5ce8d5ca-d98f-a689-8418-ea92a6fc4fbf" data-publication-date="" id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a"><div class="titlepage"><div><div class="title"><h6 class="title">OneLogin (SAML On-Prem)</h6></div></div></div><p>Review <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206569527" target="_blank">SAML (On-Prem)</a> before you begin.</p><p>Configure Sysdig Monitor and/or Sysdig Secure as a SAML application using OneLogin's article titled <a class="link" href="https://onelogin.service-now.com/support?id=kb_article&amp;sys_id=93f95543db109700d5505eea4b96198f" target="_blank">Use the OneLogin SAML Test Connector</a>. The notes below call out specific steps that require additional action.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Sysdig-Specific Steps for OneLogin Configuration  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Adding the SAML Test Connector </p></li><li class="listitem"><p> Test Connector Configuration Page Settings </p></li><li class="listitem"><p> Issuer URL  </p></li></ul></div></li><li class="listitem"><p> Test Metadata (Optional)  </p></li></ul></div><h8 id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a_id_OneLoginSAMLOn-Prem-Sysdig-SpecificStepsforOneLoginConfiguration" class="bridgehead">Sysdig-Specific Steps for OneLogin Configuration</h8><h8 id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a_id_OneLoginSAMLOn-Prem-AddingtheSAMLTestConnector" class="bridgehead">Adding the SAML Test Connector</h8><p>At the step for "Adding the SAML Test Connector", select <span class="bold bold"><strong>SAML Test Connector (IdP w/ attr w/ sign response)</strong></span>. If you don't intend to configure IDP-initiated login flow, uncheck the slider so it will no longer be "Visible in portal".</p><h8 id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a_id_OneLoginSAMLOn-Prem-TestConnectorConfigurationPageSettings" class="bridgehead">Test Connector Configuration Page Settings</h8><p>At the "Test Connector Configuration Page", enter the values shown in the table below. If you wish to configure IDP-initiated login flow, replace <span class="bold bold"><strong> <code class="code">CUSTOMER-ID-NUMBER</code> </strong></span> with the number retrieved as described in the <a class="link" href="33836-17746-administration-settings.html#UUID-710e4057-01bf-ab3a-457d-8bf32ebad2c6" title="Find Your Customer Number">Find Your Customer Number</a> article.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p> <span class="bold bold"><strong>Field</strong></span> </p></th><th class="th"><p> <span class="bold bold"><strong>Value for Sysdig Monitor</strong></span> </p></th><th class="th"><p>Value for Sysdig Secure</p></th></tr></thead><tbody><tr><td class="td"><p>RelayState</p><p>(optional - only configure if you intend to use IDP-initiated login flow)</p></td><td class="td"><p> <code class="code">#/&amp;customer=CUSTOMER-ID-NUMBER</code> </p></td><td class="td"><p> <code class="code">#/&amp;customer=CUSTOMER-ID-NUMBER</code> </p></td></tr><tr><td class="td"><p>Recipient</p></td><td class="td"><p> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/auth</a> </code> </p></td><td class="td"><p> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/secureAuth</a> </code> </p></td></tr><tr><td class="td"><p>ACS (Consumer) URL Validator</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT</a> </code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT</a> </code> </strong></span> </p></td></tr><tr><td class="td"><p>ACS (Consumer) URL</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAMEPORT" target="_blank">https://HOSTNAME:PORT/api/saml/auth</a> </code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">https://<code class="code">HOSTNAME:PORT</code>/api/saml/secureAuth</code> </strong></span> </p></td></tr></tbody></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>You <span class="bold bold"><strong> <span class="underline underline">must</span> </strong></span> include the port number in the IDP-side configuration, even though port 443 is the typical default for https:// URLs.</p></div><p>(Optional) If you want the user's First Name and Last Name to be included in the records created in the Sysdig platform's database when new users successfully login via SAML for the first time, click to the <span class="bold bold"><strong>Parameters</strong></span> tab. Click <span class="bold bold"><strong>Add parameter</strong></span> and create each of two New Fields, checking the box each time to <span class="bold bold"><strong>Include in SAML assertion</strong></span>. Then click to <span class="bold bold"><strong>Edit</strong></span> each field and select the <span class="bold bold"><strong>Value</strong></span> shown from the drop-down menu before clicking <span class="bold bold"><strong>Save</strong></span>.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p> <span class="bold bold"><strong>Field Name</strong></span> </p></th><th class="th"><p> <span class="bold bold"><strong>Value</strong></span> </p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">first name</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">First Name</code> </strong></span> </p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">last name</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">Last Name</code> </strong></span> </p></td></tr></tbody></table></div><p>Note that the Field Names are <span class="bold bold"><strong> <span class="underline underline">case sensitive</span> </strong></span>, so be careful to enter them as all lowercase.</p><p>The following shows an example of a correctly-configured field for First Name:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr style="height: 296px"><td><img src="image/15d5af4f449c79.png" style="max-width: 400px; max-height: 296px; " alt="373574008.png"></img></td></tr></table></div><h8 id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a_id_OneLoginSAMLOn-Prem-IssuerURL" class="bridgehead">Issuer URL</h8><p>Click to the <span class="bold bold"><strong>SSO</strong></span> tab, copy the <span class="bold bold"><strong>Issuer URL</strong></span>, and paste in the <span class="bold bold"><strong>Metadata</strong></span> entry on the SAML Configuration page in the <a class="link" href="">SAML connection settings</a>.</p><h8 id="UUID-9be86006-6bc2-6747-bea0-22a3ffa8c69a_id_OneLoginSAMLOn-Prem-TestMetadataOptional" class="bridgehead">Test Metadata (Optional)</h8><p>To ensure the metadata URL you copy at the end of the IDP configuration procedure is correct, you can test it by directly accessing it via your browser.</p><p>When accessing the URL, your browser should immediately download an XML file that begins similarly to the example shown below. No entry of credentials or other security measures should be required to successfully download it. If this is not the case, revisit the IDP configuration steps.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows" style="text-align: left;"><tbody><tr><td class="td"><p> <code class="code">&lt;?xml version=</code> <code class="code">"1.0"</code> <code class="code">?&gt;</code> <code class="code">&lt;EntityDescriptor xmlns=</code> <code class="code">"urn:oasis:names:tc:SAML:2.0:metadata"</code> <code class="code">entityID=</code> <code class="code">"<a class="link" href="https://app.onelogin.com/saml/metadata/680358%22" target="_blank">https://app.onelogin.com/saml/metadata/680358"</a> </code> <code class="code">&gt;</code> <code class="code"></code> <code class="code">&lt;IDPSSODescriptor xmlns:ds=</code> <code class="code">"<a class="link" href="">http://www.w3.org/2000/09/xmldsig#"</a> </code> <code class="code">protocolSupportEnumeration=</code> <code class="code">"urn:oasis:names:tc:SAML:2.0:protocol"</code> <code class="code">&gt;names:tc:SAML:</code> <code class="code">2.0</code> <code class="code">:metadata</code> <code class="code">" entityID="</code> <code class="code"> <a class="link" href="https://app.onelogin.com/saml/metadata/" target="_blank">https://app.onelogin.com/saml/metadata/</a> </code> <code class="code">680358</code> <code class="code">"&gt;</code> <code class="code"></code> <code class="code">...</code> </p></td></tr></tbody></table></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-ccc88095-7bef-ab80-7cb4-01fdf353b2a7" data-publication-date="" id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678"><div class="titlepage"><div><div class="title"><h6 class="title">OpenID Connect (On-Prem)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>These instructions are specific to <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> of the Sysdig platform. If you are using the cloud-based (SaaS) Sysdig platform, refer to <a class="link" href="33836-17746-administration-settings.html#UUID-ed9f5b57-5fcd-0e11-5ddf-f2ec44fc224e" title="OpenID Connect (SaaS)">OpenID Connect (SaaS)</a> instead.</p></div><p> <a class="link" href="https://openid.net/what-is-openid/" target="_blank">OpenID</a> support in the Sysdig platform allows authentication via your choice of <a class="link" href="https://en.wikipedia.org/wiki/Identity_provider" target="_blank">Identity Provider (IdP)</a>.</p><p>This section describes how to integrate and enable OpenID Connect with both Sysdig Monitor and Sysdig Secure.</p><h6 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-Overview" class="bridgehead">Overview</h6><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-SummaryofOpenIDFunctionalityinSysdig" class="bridgehead">Summary of OpenID Functionality in Sysdig</h7><p>The Sysdig platform ordinarily maintains its own user database to hold a username and password hash. OpenID instead allows for redirection to your organization's IdP to validate username/password and other policies necessary to grant access to Sysdig application(s). Upon successful authentication via OpenID, a corresponding user record in the Sysdig platform’s user database is automatically created, though the password that was sent to the IdP is never seen nor stored by the Sysdig platform.</p><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-BasicEnablementWorkflow" class="bridgehead">Basic Enablement Workflow</h7><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Step</p></th><th class="th"><p>Options</p></th><th class="th"><p>Notes</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>1. Know which IdP your company uses and will be configuring.</strong></span> </p></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c60c8f6a-b90f-f15f-cee6-b7ef4c5016a1" title="Okta (OpenID On-Prem)">Okta (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-58a9eeef-3179-7557-4c43-9f2bbd098b42" title="OneLogin (OpenID On-Prem)">OneLogin (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-81582041-969c-8dcf-fc6b-9a029d48d02c" title="Keycloak (OpenID On-Prem)">Keycloak (OpenID On-Prem)</a> </p></li></ul></div></td><td class="td"><p>These are the OpenID Providers for which Sysdig has performed detailed interoperability testing and confirmed how to integrate using their standard docs. If your OpenID Provider is not listed (including ones that do not support <a class="link" href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank">OpenID Connect Discovery</a>), it may still work with the Sysdig platform. Contact Sysdig Support for help.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>2. Decide the login flow you want users to experience: 3 options</strong></span> </p></td><td class="td"><p>Click OpenID button</p></td><td class="td"><p>From <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/</a> </code> </strong></span> </strong></span> or <span class="bold bold"><strong> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/secure</a> </code> </strong></span> </strong></span> </p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="70px"><tr><td><img src="image/15d5af4f451620.png" style="max-width: 70px; " alt="373574065.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="74px"><tr><td><img src="image/15d5af4f45a24a.png" style="max-width: 74px; " alt="373574059.png"></img></td></tr></table></div></td></tr><tr><td class="td"></td><td class="td"><p>Type/bookmark a URL in browser</p></td><td class="td"><p> <span class="bold bold"><strong>Monitor:</strong></span> <code class="code"> <a class="link" href="https://HOSTNAME/api/oauth/openid" target="_blank">https://HOSTNAME/api/oauth/openid</a> </code> <code class="code"></code> <span class="bold bold"><strong>Secure: </strong></span> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/api/oauth/openid" target="_blank">https://HOSTNAME/api/oauth/openid</a>?product=SDS</code> </strong></span> <code class="code"></code> </p></td></tr><tr><td class="td"></td><td class="td"><p>Log in from an IdP interface</p></td><td class="td"><p>The individual IdP integration pages describe how to add Sysdig to the IdP interface.</p><p>You will need your <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/208994483/Find+Your+Customer+Number" target="_blank">Sysdig customer number</a> on hand.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>3. Perform the configuration steps in your IdP interface and collect the resulting config attributes.</strong></span> </p></td><td class="td"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c60c8f6a-b90f-f15f-cee6-b7ef4c5016a1" title="Okta (OpenID On-Prem)">Okta (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-58a9eeef-3179-7557-4c43-9f2bbd098b42" title="OneLogin (OpenID On-Prem)">OneLogin (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-81582041-969c-8dcf-fc6b-9a029d48d02c" title="Keycloak (OpenID On-Prem)">Keycloak (OpenID On-Prem)</a> </p></li></ul></div></td><td class="td"><p>Collect metadata URL (or XML) and test it.</p><p>If you intend to configure IDP-initiated login flow, <a class="link" href="33836-17746-administration-settings.html#UUID-710e4057-01bf-ab3a-457d-8bf32ebad2c6" title="Find Your Customer Number">Find Your Customer Number</a> and have it on hand. It will be referenced in later configuration steps as <code class="code">CUSTOMER_ID_NUMBER</code>.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>4a. Log in to Sysdig Monitor <code class="code">Settings</code> <a class="link" href="">(as super admin)</a> and enter the necessary configuration information in the UI. <code class="code">Save</code> and <code class="code">Enable OpenID</code> as your SSO.</strong></span> </p><p> <span class="bold bold"><strong>4b. Configure settings for Sysdig Secure using scripts.</strong></span> </p></td><td class="td"></td><td class="td"><p>4a. Sysdig Monitor only</p><p>4b. Sysdig Monitor (optional) or Sysdig Secure</p></td></tr></tbody></table></div><h6 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-AdministratorSteps" class="bridgehead">Administrator Steps</h6><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-ConfigureIdP" class="bridgehead">Configure IdP</h7><p>Select the appropriate IdP link below, and follow the instructions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-c60c8f6a-b90f-f15f-cee6-b7ef4c5016a1" title="Okta (OpenID On-Prem)">Okta (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-58a9eeef-3179-7557-4c43-9f2bbd098b42" title="OneLogin (OpenID On-Prem)">OneLogin (OpenID On-Prem)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-81582041-969c-8dcf-fc6b-9a029d48d02c" title="Keycloak (OpenID On-Prem)">Keycloak (OpenID On-Prem)</a> </p></li></ul></div><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-UI-BasedConfigureOpenIDinSettingsMonitorOnly" class="bridgehead">UI-Based: Configure OpenID in Settings (Monitor Only)</h7><p>At this time, the Authorization UI is available only for Sysdig Monitor.</p><p>To enable baseline OpenID functionality:</p><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-EnterOpenIDBasicConnectionSettings" class="bridgehead">Enter OpenID Basic Connection Settings</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to Sysdig Monitor or Sysdig Secure as administrator and select <code class="code">Settings. <div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr style="height: 60px"><td><img src="image/15d5af4f4618b7.png" style="max-width: 250px; max-height: 60px; " alt="373574053.png"></img></td></tr></table></div></code> </p></li><li class="step"><p>Select <code class="code">Authentication</code>.</p></li><li class="step"><p>Select the <code class="code">OpenID</code> tab.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="800px"><tr><td><img src="image/15d5af4f467b6f.png" style="max-width: 800px; " alt="373574047.png"></img></td></tr></table></div></li><li class="step"><p>Enter the relevant parameters (see table below) and click <code class="code">Save</code>.</p></li></ol></div><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>Connection Setting</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Client ID</strong></span> </p></td><td class="td"><p>ID provided by your IdP</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Client Secret</strong></span> </p></td><td class="td"><p>Secret provided by your IdP</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Issuer URL </strong></span> </p></td><td class="td"><p>URL provided by your IdP. Example:<code class="code"> <a class="link" href="https://YOUR-ONELOGIN-DOMAIN.onelogin.com/oidc" target="_blank">https://YOUR-ONELOGIN-DOMAIN.onelogin.com/oidc</a> </code> </p></td></tr></tbody></table></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Okta, OneLogin, and Keycloak support metadata auto-discovery, so these settings should be sufficient for those IdPs.</p></div><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-EnterOpenIDAdditionalSettingsifneeded" class="bridgehead">Enter OpenID Additional Settings (if needed)</h7><p>In some cases, an OpenID IdP may not support metadata auto-discovery, and additional configuration settings must be entered manually.</p><p>In this case:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>On the OpenID tab, toggle the <code class="code">Metadata Discovery</code> button to <code class="code">OFF</code> to display additional entries on the page.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="550px"><tr><td><img src="image/15d5af4f46e50b.png" style="max-width: 550px; " alt="373574041.png"></img></td></tr></table></div></li><li class="step"><p>Enter the relevant parameters derived from your IdP (see table below) and click <code class="code">Save</code>.</p></li></ol></div><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>Connection Setting</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong>Base Issuer</strong></span> </p></td><td class="td"><p>Required. Often the same <span class="bold bold"><strong>Issuer URL</strong></span>, but can be different for providers that have a separate general domain and user-specific domain</p><p>(for example, general domain: <a class="link" href="https://openid-connect.onelogin.com/oidc" target="_blank">https://openid-connect.onelogin.com/oidc</a>, user-specific domain: <a class="link" href="https://sysdig-phil-dev.onelogin.com/oidc" target="_blank">https://sysdig-phil-dev.onelogin.com/oidc</a>)f</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Authorization Endpoint</strong></span> </p></td><td class="td"><p>Required. Authorization request endpoint</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Token Endpoint</strong></span> </p></td><td class="td"><p>Required. Token exchange endpoint</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>JSON Web Key Set Endpoint</strong></span> </p></td><td class="td"><p>Required. Endpoint that contains key credentials for token signature verification</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong>Token Auth Method</strong></span> </p></td><td class="td"><p>Authentication method.</p><p>Supported values:</p><p> <span class="bold bold"><strong> <code class="code">client_secret_basic</code> </strong></span>,</p><p> <span class="bold bold"><strong> <code class="code">client_secret_post</code> </strong></span>. (case insensitive)</p></td></tr></tbody></table></div><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-SelectOpenIDforSSO" class="bridgehead">Select OpenID for SSO</h7><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <code class="code">OpenID</code>from the <span class="bold bold"><strong> <code class="code">Enabled Single Sign-On </code> </strong></span>dropdown.</p></li><li class="step"><p>Click <code class="code">Save </code> <span class="bold bold"><strong>Authentication</strong></span>.</p></li></ol></div><h7 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-Script-BasedConfigureOpenIDUsingScriptsMonitororSecure" class="bridgehead">Script-Based: Configure OpenID Using Scripts (Monitor or Secure)</h7><p>The configuration of the OpenID Connect feature can be viewed, updated, and deleted by the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">"super" Admin</a>. An <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/OpenID_Connect/oidc_config.sh" target="_blank">oidc_config.sh</a> </code> </strong></span> helper script is available in the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/SSO" target="_blank"> <span class="bold bold"><strong>SSO</strong></span> </a> folder at <span class="bold bold"><strong> <code class="code">sysdig-cloud-scripts</code> </strong></span> repository to assist in completing this configuration. Invoking the script with no options will display help text.</p><pre class="programlisting"># ./oidc_config.sh
Must specify the Sysdig App whose OpenID Connect configuration will be viewed/set

Usage: ./oidc_config.sh [OPTIONS]

Affect OpenID Connect login settings for your Sysdig software platform installation
</pre><p>To use the helper script, modify <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> of the "super" Admin user and the <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for accessing the Sysdig platform API (which will be the same URL that your users access for the Sysdig Monitor application).</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Depending if the API_TOKEN has been obtained from the Sysdig Monitor or Sysdig Secure application UI, the settings will be applied to the consequent product.</p></div><p>Initially no OpenID settings are set. A initial run of the script would confirm that:</p><pre class="programlisting"># ./oidc_config.sh
No openid settings are set
Run for further info: ./oidc_config.sh -h

</pre><p>Add the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option to set the OpenID Connect configuration for a particular Sysdig application. When setting the config, you'll use additional options to provide the config details you saved in the earlier OpenID Provider configuration step.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th"><p>Config Detail</p></th><th class="th"><p>Option</p></th></tr></thead><tbody><tr><td class="td"><p>Issuer URL</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-u</code> </strong></span> </p></td></tr><tr><td class="td"><p>Client ID</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-i</code> </strong></span> </p></td></tr><tr><td class="td"><p>Client Secret</p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">-e</code> </strong></span> </p></td></tr></tbody></table></div><p>If the configuration is successfully posted to the Sysdig platform, the new configuration will be echoed back.</p><p>An example of creating the two separate OpenID Connect configurations for both Monitor and Secure, each using Okta as an OpenID Provider:</p><pre class="programlisting"># ./oidc_config.sh -s -u https://dev-824158.oktapreview.com -i 0oafpykpv7JMS4gMe0h7 -e ZctTGJMNJmuseEJHJGhvnb0pniZvz9Gf6RStxhHn
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547541009000,
    "type": "openid",
    "scope": "SYSTEM",
    "settings": {
      "issuer": "https://dev-824158.oktapreview.com",
      "clientId": "0oafpykpv7JMS4gMe0h7",
      "clientSecret": "ZctTGJMNJmuseEJHJGhvnb0pniZvz9Gf6RStxhHn",
      "metadataDiscovery": true
    }
  }
}</pre><p>Once you've completed this configuration, clicking the OpenID button at the login screen of the appropriate Sysdig application(s) should redirect to your OpenID Provider for authentication.</p><p>If you wish to delete your OpenID Connect configuration, invoke the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. If successful, the disabled configuration will be printed.</p><pre class="programlisting">./oidc_config.sh -d
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547541009000,
    "type": "openid",
    "scope": "SYSTEM",
    "settings": {
      "issuer": "https://dev-824158.oktapreview.com",
      "clientId": "0oafpykpv7JMS4gMe0h7",
      "clientSecret": "ZctTGJMNJmuseEJHJGhvnb0pniZvz9Gf6RStxhHn",
      "metadataDiscovery": true
    }
  }
}</pre><h6 id="UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678_id_OpenIDConnectOn-Prem-UserExperience" class="bridgehead">User Experience</h6><p>As noted in the <a class="link" href="">OpenID Connect (On-Prem)#Basic Enablement Workflow</a> above, you can offer users three ways to log in with a OpenID configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>They can begin at the Sysdig SaaS URL and click the OpenID button.</p><p>Monitor: <a class="link" href="https://app.sysdigcloud.com/" target="_blank">https://HOSTNAME/</a> or Secure: <a class="link" href="https://secure.sysdig.com" target="_blank">https://HOSTNAME/secure</a> .</p><p>They will be prompted to enter a Company Name, so the Sysdig platform can redirect the browser to your IdP for authentication.</p><p>=</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f451620.png" style="max-height: 250px; " alt="373574065.png"></img></td></tr></table></div><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f45a24a.png" style="max-height: 250px; " alt="373574059.png"></img></td></tr></table></div></li><li class="listitem"><p>You can provide an alternative URL to avoid the user having to enter a company name, in the format:</p><p> <span class="bold bold"><strong>Monitor:</strong></span> <code class="code"> <a class="link" href="https://HOSTNAME/api/oauth/openid" target="_blank">https://HOSTNAME/api/oauth/openid</a> </code> <code class="code"></code> <span class="bold bold"><strong>Secure: </strong></span> <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://HOSTNAME/api/oauth/openid" target="_blank">https://HOSTNAME/api/oauth/openid</a>?product=SDS</code> </strong></span> </p></li><li class="listitem"><p>You can configure an IdP-initiated login flow when configuring your IdP. The users then select the Sysdig application from your IDP's app directory and do not browse directly to a Sysdig application URL at all.</p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>See also <a class="link" href="33836-17746-administration-settings.html#UUID-af0f76c8-bafd-4c22-2eba-ba3fcc26187d" title="User and Team Administration">User and Team Administration</a> for information on creating users.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Overview </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Summary of OpenID Functionality in Sysdig </p></li><li class="listitem"><p> Basic Enablement Workflow </p></li></ul></div></li><li class="listitem"><p> Administrator Steps  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Configure IdP  </p></li><li class="listitem"><p> UI-Based: Configure OpenID in Settings (Monitor Only) </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Enter OpenID Basic Connection Settings </p></li><li class="listitem"><p> Enter OpenID Additional Settings (if needed)  </p></li><li class="listitem"><p> Select OpenID for SSO  </p></li></ul></div></li><li class="listitem"><p> Script-Based: Configure OpenID Using Scripts (Monitor or Secure)  </p></li></ul></div></li><li class="listitem"><p> User Experience </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-07481b1c-bdf0-b973-fc03-05abe10ac8bd" data-publication-date="" id="UUID-c60c8f6a-b90f-f15f-cee6-b7ef4c5016a1"><div class="titlepage"><div><div class="title"><h6 class="title">Okta (OpenID On-Prem)</h6></div></div></div><p>Review <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> before you begin.</p><p>The notes below describe minimal steps to be taken in Okta. You may need to adjust the steps based on the specifics of your environment.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Login to your Okta organization as a user with administrative privileges and click to the <code class="code">Admin</code> page</p></li><li class="step"><p>Click on the <code class="code">Add Applications </code>shortcut, then click the <code class="code">Create New App</code> button</p></li><li class="step"><p>Select <span class="bold bold"><strong>W<code class="code">e</code>b</strong></span> as the Platform type, then click <code class="code">OpenID Connect</code> as the Sign-on method, then click <span class="bold bold"><strong> <code class="code">Create.</code> </strong></span> </p></li><li class="step"><p>Create a new application</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Enter your choice of General Settings</p></li><li class="listitem"><p>For <code class="code">Login redirect URIs</code>, enter one of the following values, replacing <span class="bold bold"><strong> <code class="code">HOSTNAME</code> </strong></span> with the hostname through which your users access the Sysdig application(s) and <span class="bold bold"><strong> <code class="code">PORT</code> </strong></span> with the TCP port # (typically 443):</p><p>If configuring Sysdig Monitor, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/auth</code> </strong></span> </p><p>If configuring Sysdig Secure, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/secureAuth</code> </strong></span> </p></li><li class="listitem"><p>Click the <span class="bold bold"><strong>Save</strong></span> button</p></li></ul></div></li><li class="step"><p>You should next be placed in a <code class="code">General</code> tab. Take note of the <span class="bold bold"><strong>Client ID</strong></span> and <span class="bold bold"><strong>Client secret</strong></span> that are shown, as you will need them to complete the configuration in the Sysdig platform.</p></li><li class="step"><p>Click to the <code class="code">Sign On</code> tab. Take note of the <span class="bold bold"><strong>Issuer </strong></span>URL that is shown, as you will need it to complete the configuration in the Sysdig platform.</p></li><li class="step"><p>Return to the bottom section of the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> article for instructions on using the helper script to complete the configuration in the Sysdig platform.</p></li></ol></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-2c614994-1a0e-6617-609a-95af9e17f4a1" data-publication-date="" id="UUID-58a9eeef-3179-7557-4c43-9f2bbd098b42"><div class="titlepage"><div><div class="title"><h6 class="title">OneLogin (OpenID On-Prem)</h6></div></div></div><p>Review <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> before you begin.</p><p>The notes below describe minimal steps to be taken in OneLogin. You may need to adjust the steps based on the specifics of your environment.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Login to your OneLogin organization as a user with administrative privileges and click to <code class="code">Apps &gt; Custom Connectors</code>, then click the <code class="code">New Connector</code> button.</p></li><li class="step"><p>Create a new Connector</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Enter your choice of connector name</p></li><li class="listitem"><p>Select a <code class="code">Sign on Method </code>of <code class="code">OpenID Connect</code> </p></li><li class="listitem"><p>For <span class="bold bold"><strong> <code class="code">Redirect URI</code> </strong></span>to, enter one of the following values, replacing <span class="bold bold"><strong> <code class="code">HOSTNAME</code> </strong></span> with the hostname through which your users access the Sysdig application(s) and <span class="bold bold"><strong> <code class="code">PORT</code> </strong></span> with the TCP port # (typically 443):</p><p>If configuring Sysdig Monitor, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/auth</code> </strong></span> </p><p>If configuring Sysdig Secure, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/secureAuth</code> </strong></span> </p></li><li class="listitem"><p>Click the <code class="code">Save</code> button</p></li></ul></div></li><li class="step"><p>From the <code class="code">More Actions </code>pull-down menu, select <span class="bold bold"><strong> <code class="code">Add App to Connector.</code> </strong></span> </p></li><li class="step"><p>Click <code class="code">Save</code> to add the app to your catalog. Once clicked, additional tabs will appear.</p></li><li class="step"><p>Click to the <code class="code">SSO</code> tab. Change the setting in the <code class="code">Token Endpoint</code> drop-down to <span class="bold bold"><strong>POST</strong></span>, then click <code class="code">Save</code>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="517px"><tr style="height: 112px"><td><img src="image/15d5af4f475b0c.png" style="max-width: 517px; max-height: 112px; " alt="373574110.png"></img></td></tr></table></div></li><li class="step"><p>While still on the <code class="code">SSO</code> tab, take note of the <span class="bold bold"><strong>Client ID</strong></span> and <span class="bold bold"><strong>Client Secret</strong></span> that are shown (click <code class="code">Show client secret</code> to reveal it), as you will need them to complete the configuration in the Sysdig platform.</p></li><li class="step"><p>Note that the <span class="bold bold"><strong>Issuer URL</strong></span> you will need to complete the Sysdig platform configuration will consist of <code class="code">https://YOUR-ONELOGIN-DOMAIN.onelogin.com/oidc</code> </p></li><li class="step"><p>Return to the bottom section of the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> article for instructions on using the helper script to complete the configuration in the Sysdig platform.</p></li></ol></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-35ac9ed5-8d84-c367-252f-1855ecba655a" data-publication-date="" id="UUID-81582041-969c-8dcf-fc6b-9a029d48d02c"><div class="titlepage"><div><div class="title"><h6 class="title">Keycloak (OpenID On-Prem)</h6></div></div></div><p>Review <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> before you begin.</p><p>The notes below describe minimal steps to be taken in Keycloak. You may need to adjust the steps based on the specifics of your environment.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Login to your Keycloak server's Administrative Console.</p></li><li class="step"><p>Select a realm or create a new one.</p></li><li class="step"><p>Click <code class="code">Clients</code>, then click the <span class="bold bold"><strong> <code class="code">Create</code> </strong></span>button.</p></li><li class="step"><p>Enter the <span class="bold bold"><strong>Client ID</strong></span> of your choosing (e.g. "SysdigMonitor") and take note of it, as you will need it later to complete the configuration in the Sysdig platform.</p></li><li class="step"><p>Make sure the <code class="code">Client Protocol</code> drop-down has <span class="bold bold"><strong>openid-connect</strong></span> selected. Click the <code class="code">Save</code> button.</p></li><li class="step"><p>Configure OpenID Connect client</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Click the toggle for <code class="code">Authorization Enabled</code> to <span class="bold bold"><strong>ON</strong></span> </p></li><li class="listitem"><p>For <code class="code">Valid Redirect URI</code>, enter one of the following values, replacing <span class="bold bold"><strong> <code class="code">HOSTNAME</code> </strong></span> with the hostname through which your users access the Sysdig application(s) and <span class="bold bold"><strong> <code class="code">PORT</code> </strong></span> with the TCP port # (typically 443):</p><p>If configuring Sysdig Monitor, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/auth</code> </strong></span> </p><p>If configuring Sysdig Secure, enter: <span class="bold bold"><strong> <code class="code">https://HOSTNAME:PORT/api/oauth/openid/secureAuth</code> </strong></span> </p></li><li class="listitem"><p>Click the <code class="code">Save</code> button</p></li></ul></div></li><li class="step"><p>Click to the <code class="code">Credentials</code> tab. Take note of the <span class="bold bold"><strong>Secret</strong></span> that is shown, as you will need it to complete the configuration in the Sysdig platform.</p></li><li class="step"><p>Note that the <span class="bold bold"><strong>Issuer URL</strong></span> you will need to configure in the Sysdig platform will consist of <span class="bold bold"><strong> <code class="code">https://{KEYCLOAK-SERVER-ADDRESS}/auth/realms/{REALM_NAME}</code>,</strong></span> where <code class="code"> <span class="italic italic">{KEYCLOAK-SERVER-ADDRESS}</span> </code> and <code class="code"> <span class="bold bold"><strong>{REALM-NAME}</strong></span> </code> are derived from your environment where you just created the configuration.</p></li><li class="step"><p>Return to the bottom section of the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678" title="OpenID Connect (On-Prem)">OpenID Connect (On-Prem)</a> article for instructions on using the helper script to complete the configuration in the Sysdig platform.</p></li></ol></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-d9e56f1b-fc7d-4e01-4346-6ecdb362b0e2" data-publication-date="" id="UUID-583ee504-4257-5b8c-b333-20cdc51c4086"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP</h6></div></div></div><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig software platform allows user authentication using credentials in a customer’s own directory server. LDAP support is not currently available the cloud-based (SaaS) Sysdig platform.</p><p>The configuration and functionality of LDAP has changed significantly in recent releases of the platform. It is recommended to upgrade to the newest on-prem release to take advantage of improvements. However, if you are running an older release and cannot yet upgrade, select the relevant documentation from the list below and contact Sysdig Support if you need further assistance.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-8c5f22bb-b603-1739-5e09-672cc04715e0" title="LDAP Authentication Configuration (for Platform v.1586)">LDAP Authentication Configuration (for Platform v.1586)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8" title="LDAP Authentication Configuration (for Platform v.1149 - 1511)">LDAP Authentication Configuration (for Platform v.1149 - 1511)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-03acfb71-84c8-1630-ba2a-33a97846daa2" title="LDAP Authentication Configuration (for Platform v. 963 - 1091)">LDAP Authentication Configuration (for Platform v. 963 - 1091)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0" title="LDAP Authentication Configuration (for Platform v. 890 - 925)">LDAP Authentication Configuration (for Platform v. 890 - 925)</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00" title="LDAP Authentication Configuration (for Platform v. 858-)">LDAP Authentication Configuration (for Platform v. 858-)</a> </p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-745f4637-3db4-7de9-ebeb-c9e01ba102f9" data-publication-date="" id="UUID-269b5cad-7d46-efdc-deff-e6af8c044208"><div class="titlepage"><div><div class="title"><h6 class="title">General LDAP Tips</h6></div></div></div><h8 id="UUID-269b5cad-7d46-efdc-deff-e6af8c044208_id_GeneralLDAPTips-Introduction" class="bridgehead">Introduction</h8><p>The <a class="link" href="33836-17626-on-premises-deployments.html#UUID-03acfb71-84c8-1630-ba2a-33a97846daa2" title="LDAP Authentication Configuration (for Platform v. 963 - 1091)">LDAP Authentication Configuration (for Platform v. 963 - 1091)</a> article describes LDAP functionality that's specific to the Sysdig software platform. However, the platform ultimately leverages common libraries that adhere to standards, such as in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> search filters. Therefore, many tips and best practices you can find online will apply to effective use of the LDAP features of the Sysdig platform. While it would not be feasible to capture all such available knowledge in one place, in this article we present pointers to some general LDAP tips you may find most useful.</p><p>If you find additional LDAP techniques that have proven particularly useful in your Sysdig environment, we'd appreciate if you could share them with Sysdig Support so we can add them to this article.</p><h8 id="UUID-269b5cad-7d46-efdc-deff-e6af8c044208_id_GeneralLDAPTips-TestingConfigurationsWithldapsearch" class="bridgehead">Testing Configurations With ldapsearch</h8><p>Small typos in fields such as search filters can cause failures that are difficult to debug. You may want to perfect your more complex configurations before applying them via the helper scripts. This will help "divide &amp; conquer" as to whether an issue is generic to LDAP syntax and/or the directory vs. a possible bug in the Sysdig platform.</p><p>If you have an Ubuntu Linux host at your disposal that can access your directory server via LDAP, install the <span class="bold bold"><strong> <code class="code">ldap-utils</code> </strong></span> package:</p><pre class="programlisting"># sudo apt install ldap-utils</pre><p>If accessing LDAP over SSL/TLS, edit the file <span class="bold bold"><strong> <code class="code">/etc/ldap/ldap.conf</code> </strong></span> and add the following line:</p><pre class="programlisting">TLS_REQCERT allow</pre><p>Then copy the <span class="bold bold"><strong>CA certificate</strong></span> (the same one that was uploaded in the <code class="code">Settings</code> of the Replicated console) to a location on the host, such as <span class="bold bold"><strong> <code class="code">/tmp/cert.pem</code> </strong></span>.</p><p>Now you can run arbitrary queries via generic LDAP and study their success or failure. For instance, the following command-line uses some of the settings from <a class="link" href="33836-17626-on-premises-deployments.html#UUID-03acfb71-84c8-1630-ba2a-33a97846daa2" title="LDAP Authentication Configuration (for Platform v. 963 - 1091)">LDAP Authentication Configuration (for Platform v. 963 - 1091)</a> examples:</p><pre class="programlisting"># LDAPTLS_CACERT=/tmp/cert.pem ldapsearch -H ldaps://172.16.0.1:636 -M -b "DC=example,DC=local" -D "cn=Administrator,cn=Users,dc=example,dc=local" -w "myMgrPassword" "(&amp;(objectClass=organizationalPerson)(sAMAccountName=jdoe))"

...
# John Doe, Users, example.local
dn: CN=John Doe,CN=Users,DC=example,DC=local
...</pre><h8 id="UUID-269b5cad-7d46-efdc-deff-e6af8c044208_id_GeneralLDAPTips-ExcludingClassesofUsersegDisabledAccounts" class="bridgehead">Excluding Classes of Users (e.g. Disabled Accounts)</h8><p>Per <a class="link" href="https://stackoverflow.com/questions/9509222/retrieving-only-enabled-accounts-on-active-directory" target="_blank">this post</a>, Active Directory admins may leverage certain queries to easily exclude certain classes of users from being able to authenticate to the Sysdig platform. For example, the following will filter out users whose accounts have been disabled in Active Directory.</p><pre class="programlisting">(!(userAccountControl:1.2.840.113556.1.4.803:=2))</pre><p>This can be combined with other config via AND logic, such as by extending one of our <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> examples:</p><pre class="programlisting">"searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0})(!(userAccountControl:1.2.840.113556.1.4.803:=2)))"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208_id_GeneralLDAPTips-Introduction" title="Introduction">Introduction</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208_id_GeneralLDAPTips-TestingConfigurationsWithldapsearch" title="Testing Configurations With ldapsearch">Testing Configurations With ldapsearch</a> </p></li><li class="listitem"><p> Excluding Classes of Users (e.g. Disabled Accounts) </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cadf3266-c1bd-0f5a-dace-94e379c0b613" data-publication-date="" id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP Authentication Configuration (for Platform v.1586)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This article is specific to LDAP support of <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> version 1586.</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>If you are running version 858 or older, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206274634/LDAP+Authentication+Configuration+for+Platform+v.+858-" target="_blank">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running versions 890 through 925, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/283148296/LDAP+Authentication+Configuration+for+Platform+v.+890+-+925" target="_blank">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running GA releases 963 - 1091, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/282853386/LDAP+Authentication+Configuration+for+Platform+v.+963+" target="_blank">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running GA Releases 1149-1511, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/287211606/LDAP+Authentication+Configuration+for+Platform+v.1149" target="_blank">this other article</a> </span> instead.</p></li></ul></div></div><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig software platform is used to allow user authentication using credentials in an enterprise's own directory server.</p><p>This document describes how to configure base LDAP settings, as well as the <a class="link" href="">LDAP Authentication Configuration (for Platform v.1586)#limitations</a> of the LDAP support.</p><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Overview" class="bridgehead">Overview</h8><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Functionality" class="bridgehead">Functionality</h8><p>The Sysdig platform ordinarily maintains its own user database to hold a username and password hash, as well as settings for Admin privileges, Sysdig team membership, and a user’s configured dashboards and alerts. Sysdig's LDAP authentication feature provides a means to allow the Sysdig platform to query your separate directory server to validate username/password. Upon successful authentication, a corresponding user record in the Sysdig platform’s user database is automatically created. When the LDAP feature is in use, the user’s directory password is not stored in the Sysdig user database.</p><p>Once LDAP authentication is enabled, <span class="italic italic">all</span> normal user authentication will be performed against your configured directory server. Other local, non-LDAP users that were created before LDAP was enabled can still authenticate via LDAP as long as their username in your directory matches with the username of their pre-existing record in the Sysdig user database. For example, consider a user <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> who had been a user in the Sysdig environment before LDAP was enabled. Once LDAP authentication is enabled, if a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> exists in the directory server and is able to authenticate successfully via LDAP, they will be permitted to log in to the Sysdig platform as the pre-existing <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> user. Any user-specific configuration (Alerts, Dashboards, etc.) that were attached to <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> will still be visible to this user. Any password previously set for such a pre-existing user record will <span class="italic italic">not</span> be used for authentication to the Sysdig platform unless LDAP authentication is disabled.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>LDAP can be complex to configure. Sysdig strongly recommends that you first refine your LDAP configuration in a separate test setup before applying the LDAP settings in your production environment.</p></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-PrerequisiteHavetheSuperAdminUserCredentialsandToken" class="bridgehead">Prerequisite: Have the "Super" Admin User Credentials and Token</h8><p>In an environment enabled for LDAP authentication, the one user still subject to direct email+password authentication is the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a>.</p><p>Creation of this user is a required initial install step.</p><p>You can find the credentials either in the Replicated console (screenshot below) or your Kubernetes <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/blob/master/sysdigcloud/config.yaml" target="_blank">ConfigMap</a> element <span class="bold bold"><strong> <code class="code">sysdigcloud.default.user</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="550px"><tr style="height: 184px"><td><img src="image/15d5af4f47c185.png" style="max-width: 550px; max-height: 184px; " alt="373574185.png"></img></td></tr></table></div><p>This user is required and cannot be deleted. This login provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A way to access the Sysdig platform when LDAP connectivity is severed.</p></li><li class="listitem"><p>The first Admin user in the install, essential for assigning Admin rights to other users once they’ve authenticated via your directory and their user records have been added to the Sysdig user database.</p></li><li class="listitem"><p>The user whose token can be used to perform further LDAP configurations.</p><p>See <a class="link" href="">Retrieve the Sysdig API Security Token</a> for details.</p></li></ul></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-ConfigureBasicLDAPSettings" class="bridgehead">Configure Basic LDAP Settings</h8><p>There are two ways to configure the basic LDAP settings for Sysdig: via the Sysdig UI, or via the API endpoint using scripts and HTTP methods.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Whichever method is used, it will apply LDAP settings globally, to both Sysdig Monitor and Sysdig Secure.</p></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-UI-BasedConfigureLDAPinSettings" class="bridgehead">UI-Based: Configure LDAP in Settings</h8><p>At this time, the Authorization UI is available only for Sysdig Monitor.</p><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-EnterLDAPConnectionSettings" class="bridgehead">Enter LDAP Connection Settings</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to Sysdig Monitor or Sysdig Secure as the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> and select <code class="code">Settings. <div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr style="height: 60px"><td><img src="image/15d5af4f482b7f.png" style="max-width: 250px; max-height: 60px; " alt="373574179.png"></img></td></tr></table></div></code> </p></li><li class="step"><p>Select <code class="code">Authentication</code>.</p></li><li class="step"><p>Select the <code class="code">LDAP</code> tab.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="700px"><tr><td><img src="image/image-missing.png" style="max-width: 700px; " alt=""></img></td></tr></table></div></li><li class="step"><p>Enter the relevant parameters (see tables below) and click <code class="code">Save</code>.</p></li></ol></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Table_loginConnectionSettings" class="bridgehead">Table_loginConnectionSettings</h8><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">server</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>URL of the directory server for the Sysdig platform to query. An example for LDAP over SSL:</p><p>ldaps://172.16.0.1:636</p><p>For cleartext LDAP:</p><p>ldap://176.16.0.1</p><p>Note that to use LDAPS, you'll also need to use the Replicated console (or <a class="link" href="">equivalent approach in Kubernetes-based installs</a>) to upload a Certificate Authority (CA) PEM-format certificate that the Sysdig platform will use to validate its SSL connection to the server. If you have a host with OpenSSL tools installed that can reach the directory server, you can obtain the certificate by running:</p><pre class="programlisting"># openssl s_client -showcerts -connect &lt;server-ip&gt;:636</pre><p>The command output will typically show the server certificate first and the CA certificate second, both in PEM format. Into a text file, paste the CA certificate portion of the output that looks like:</p><pre class="programlisting">-----BEGIN CERTIFICATE-----
[random text...]
-----END CERTIFICATE-----</pre><p>Under <span class="bold bold"><strong>LDAP CA certificate in the PEM format</strong></span> in the Replicated console, click the "Choose File" button and browse to the file you just created to select and upload it. Note that when you click <span class="bold bold"><strong>Save</strong></span>, the Sysdig platform will restart. This is the only setting related to LDAP that requires a platform restart.</p><p>Note: For environments using self-signed certificates, the <span class="bold bold"><strong> <code class="code">openssl </code> </strong></span>command shown above will return only one certificate.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The distinguished name of a user that the Sysdig platform can authenticate as via LDAP in order to perform further queries about the users attempting to login to the Sysdig platform. Example:</p><pre class="programlisting">cn=Administrator,cn=Users,dc=example,dc=local</pre><p>This setting is required, as the Sysdig platform does not support connection to servers via anonymous bind.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The password for the <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span>.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>The distinguished name for the point in the LDAP tree below which all search queries will begin. Example:</p><pre class="programlisting">dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Defines whether the Sysdig platform will <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">chase referrals</a> found in LDAP query responses. If not specified, this will be set to <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span> in your configuration and referrals will not be chased. See the section below on <a class="link" href="">Multi-Server Directories</a> for more details on this option.</p></td></tr></tbody></table></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Table_loginFilter" class="bridgehead">Table_loginFilter</h8><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about users should be performed. Example:</p><pre class="programlisting">cn=Users</pre><p>If specified as an empty string (<span class="bold bold"><strong> <code class="code">""</code> </strong></span>), the search will be performed across everything below the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>, in which case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting must be configured.</p><p>Note that if the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting was not specified, the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> setting must provide a full distinguished name. Example:</p><pre class="programlisting">cn=Users,dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify the user record. The marker token <span class="bold bold"><strong> <code class="code">{0}</code> </strong></span> represents where the username will appear when LDAP queries are constructed. An example that targets the attribute <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in Active Directory:</p><pre class="programlisting">(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))</pre><p>While this setting is optional, if not specified, no users will be able to authenticate via LDAP.</p></td></tr></tbody></table></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-SelectLDAPforSSO" class="bridgehead">Select LDAP for SSO</h8><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <code class="code">LDAP </code>from the <span class="bold bold"><strong> <code class="code">Enabled Single Sign-On </code> </strong></span>dropdown</p></li><li class="step"><p>Click <code class="code">Save Authentication</code>.</p></li><li class="step"><p>Repeat entire enablement process for Sysdig Monitor or Sysdig Secure, if you want to enable on both applications.</p></li></ol></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Script-BasedConfigureLDAPUsingScripts" class="bridgehead">Script-Based: Configure LDAP Using Scripts</h8><p>The configuration of the LDAP feature can be viewed, updated, and deleted by the "super" Admin via the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings</code> </strong></span> using HTTP methods for <span class="bold bold"><strong> <code class="code">GET</code> </strong></span>, <span class="bold bold"><strong> <code class="code">POST</code> </strong></span>, and <span class="bold bold"><strong> <code class="code">DELETE</code> </strong></span>, respectively.</p><p>The workflow is as follows:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in as super admin (prerequisite ).</p></li><li class="step"><p> <a class="link" href="">Retrieve the Sysdig API Security Token</a> (prerequisite)</p></li><li class="step"><p>Access <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/login_config.sh" target="_blank">login_config.sh</a> </code> and <span class="bold bold"><strong> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/verify_user.sh" target="_blank">verify_user.sh</a> </strong></span> helper scripts is available in the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/SSO" target="_blank"> <span class="bold bold"><strong>SSO</strong></span> </a> folder at <span class="bold bold"><strong> <code class="code">sysdig-cloud-scripts</code> </strong></span> repository, to assist in completing this configuration.</p></li><li class="step"><p>Modify <span class="bold bold"><strong> <code class="code"> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/env.sh" target="_blank">env.sh</a> </code> </code> </strong></span> to enter the API_TOKEN and the URL of your environment.</p></li><li class="step"><p>Modify <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> file with <a class="link" href="">LDAP Authentication Configuration (for Platform v.1586)#Table_LoginConnectionSettings</a> and <a class="link" href="">LDAP Authentication Configuration (for Platform v.1586)#Table_loginFilter Settings</a> </p></li><li class="step"><p>Execute various scripts</p><pre class="programlisting"># get current settings: initially empty
./login_config.sh

# set settings we have detailed above
./login_config.sh -s settings_login_simple.json

# verify an existing user information is retrieved
./verify_user.sh -u jdoe

# verify a non existing user information is not retrieved
./verify_user.sh -u nothere

# optionally delete the settings
# ./login_config.sh -d</pre></li><li class="step"><p>Consult <a class="link" href="">LDAP Authentication Configuration (for Platform v.1586)#Advanced Use Cases</a> if you have a multi-server environment, or want to create LDAP users before they log in.</p></li></ol></div><p>Details of this workflow are as follows:</p><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Configureenvsh" class="bridgehead">Configure env.sh</h8><p>To use the helper script, modify the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/env.sh" target="_blank">env.sh</a> </code> </strong></span> </p><p>to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> and <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for your environment. Once set, invoking <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/login_config.sh" target="_blank">login_config.sh</a> </code> </strong></span> (at the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/SSO" target="_blank">sysdig-cloud-scripts repository</a> in GitHub) helper script with no options will print the current configuration. Initially empty.</p><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-RetrieveCurrentLDAPSettings" class="bridgehead">Retrieve Current LDAP Settings</h8><pre class="programlisting"># ./login_config.sh
No ldap settings are set
Run for further info: ./login_config.sh -h</pre><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Configuresettings_login_simplejsonandsetwithlogin_configsh" class="bridgehead">Configure settings_login_simple.json and set withlogin_config.sh</h8><p>In the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/updated-ldap-settings" target="_blank">sysdig-cloud-scripts repository</a> in GitHub, find the example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> and modify it for your environment, following the <span class="bold bold"><strong>Tables</strong></span> above.</p><p>To apply the new LDAP settings invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option and specify the filename containing the JSON config:</p><pre class="programlisting"># ./login_config.sh -s settings_login_simple.json
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547542447000,
    "type": "ldap",
    "scope": "SYSTEM",
    "settings": {
      "loginConnectionSettings": {
        "server": "ldap://172.16.0.1",
        "rootDn": "dc=example,dc=local",
        "managerDn": "cn=Administrator,cn=Users,dc=example,dc=local",
        "managerPassword": "myMgrPassword",
        "referral": "IGNORE"
      },
      "loginFilter": {
        "searchBase": "cn=Users",
        "searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"
      }
    }
  }
}</pre><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-SampleresultinActiveDirectory" class="bridgehead">Sample result in Active Directory</h8><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/SSO/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would now be permitted for a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> that has the following <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=John Doe,CN=Users,DC=example,DC=local</pre><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr><td><img src="image/15d5af4f48a143.png" style="max-width: 1024px; " alt="5d4d58a7ca2e0.png"></img></td></tr></table></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-TestUserLogin" class="bridgehead">Test User Login</h8><p>To test the login configuration, the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> can confirm if a particular user would be permitted to login given current LDAP login connection settings. To do this, perform an HTTP <span class="bold bold"><strong> <code class="code">GET</code> </strong></span> to the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings/verify/USERNAME</code> </strong></span>. A <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/verify_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">verify_user.sh</code> </strong></span> </a> helper script is provided to easily perform this. If invoked with the <span class="bold bold"><strong> <code class="code">-u</code> </strong></span> option and a username, and the user's login would be successful, it will return the user's information from the directory.</p><pre class="programlisting"># ./verify_user.sh -u jdoe
{"element":"uSNCreated=12799, countryCode=0, badPwdCount=0, whenChanged=20180406232737.0Z, objectClass=top, primaryGroupID=513, givenName=John, objectGUID=..., objectSid=..., instanceType=4, whenCreated=20180406220651.0Z, dSCorePropagationData=16010101000000.0Z, sn=Doe, userAccountControl=66048, lastLogonTimestamp=131675308573317669, cn=John Doe, codePage=0, accountExpires=9223372036854775807, sAMAccountName=jdoe, sAMAccountType=805306368, userPrincipalName=jdoe@example.local, displayName=John Doe, pwdLastSet=131675260113435098, lastLogon=131682933890462204, name=John Doe, objectCategory=CN=Person,CN=Schema,CN=Configuration,DC=example,DC=local, distinguishedName=CN=John Doe,CN=Users,DC=example,DC=local, lastLogoff=0, memberOf=CN=Sysdig Viewers,CN=Users,DC=example,DC=local, logonCount=0, uSNChanged=12986"}</pre><p>If the user would not be able to login, an error message will be returned.</p><pre class="programlisting"># ./verify_user.sh -u nothere
Could not verify user "nothere". Check LDAP login config settings and/or system log.</pre><p>Note that if LDAP authentication is disabled this method for testing user login is not available.</p><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-OptionalDeleteLDAPsettings" class="bridgehead">Optional: Delete LDAP settings</h8><p>To delete LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. After running the following command all LDAP users will not be able to login to the Sysdig platform.</p><pre class="programlisting"># ./login_config.sh -d
{
  "authenticationSettings": {
    "id": 1,
    "version": 1,
    "createdOn": 1547542447000,
    "type": "ldap",
    "scope": "SYSTEM",
    "settings": {
      "loginConnectionSettings": {
        "server": "ldap://172.16.0.1",
        "rootDn": "dc=example,dc=local",
        "managerDn": "cn=Administrator,cn=Users,dc=example,dc=local",
        "managerPassword": "myMgrPassword",
        "referral": "IGNORE"
      },
      "loginFilter": {
        "searchBase": "cn=Users",
        "searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"
      }
    }
  }
}</pre><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-UserExperience" class="bridgehead">User Experience</h8><p>When a user accesses the Sysdig interface, they are prompted to enter their LDAP credentials (in the fields normally used for email/password).</p><p>Monitor: <code class="code"> <a class="link" href="https://HOSTNAME/" target="_blank">https://HOSTNAME/</a> </code> or Secure: <code class="code"> <a class="link" href="https://HOSTNAME/secure" target="_blank">https://HOSTNAME/secure</a> </code> </p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="250px"><tr><td><img src="image/15d5af4f490e13.jpg" style="max-width: 250px; " alt="373574173.jpg"></img></td></tr></table></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-AdvancedUseCases" class="bridgehead">Advanced Use Cases</h8><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-Multi-ServerDirectories" class="bridgehead">Multi-Server Directories</h8><p>Data about your users that need to access the Sysdig platform may be stored across many directory servers in your environment. As the Sysdig platform is only able to query one LDAP server endpoint, you would need to take extra steps to ensure successful authentication for such users.</p><p>The simplest approach to achieve this is to query against a <a class="link" href="https://technet.microsoft.com/pt-pt/library/cc728188(v=ws.10).aspx" target="_blank">Global Catalog</a>. As the Global Catalog stores a copy of all Active Directory objects in a forest, this provides a fast and convenient target for the Sysdig platform to find all users that may need to authenticate. Since queries against the Global Catalog are also performed via LDAP, you simply need to ensure your LDAP configuration specifies the appropriate address and TCP port for the Global Catalog, e.g. ldap://176.16.0.1:3268 for cleartext LDAP or ldaps://172.16.0.1:3269 for LDAP over SSL. If querying against a Global Catalog, the <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> option of the Sysdig platform's LDAP configuration can remain at its default setting of <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span>.</p><p>If a Global Catalog is not available, another approach is to leverage <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">referral chasing</a>. Such chasing depends on complex interplay of configuration settings, DNS resolution, and network connectivity to multiple servers. If you require this option, carefully read the tips in this section and validate your configuration in a test environment before attempting its use in production. Contact Sysdig support for assistance as necessary.</p><p>For our example configuration, we've added another Domain Controller to our environment that holds users a separate set of users for the child domain <span class="bold bold"><strong> <code class="code">eu.example.local</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f497d3a.png" style="max-width: 600px; " alt="5d4d58ab6fd93.png"></img></td></tr></table></div><p>We'd like to permit login for a user "<span class="bold bold"><strong> <code class="code">eurodude</code> </strong></span>" in the child domain. This user has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=Euro Dude,CN=Users,DC=eu,DC=example,DC=local</pre><p>In the example configuration <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/settings_login_referral_follow.json" target="_blank">settings_login_referral_follow.json</a> </code> </strong></span> shown below, the Sysdig platform still begins its LDAP queries at the same top-level server target. However, the <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> option is set to <span class="bold bold"><strong> <code class="code">"FOLLOW"</code> </strong></span>, which will cause the Sysdig platform to perform subsequent queries if a query returns one or more referrals.</p><pre class="programlisting">{
  "authenticationSettings": {
    "settings": {
      "loginConnectionSettings": {
        "server": "ldap://172.16.0.1",
        "managerDn": "cn=Administrator,cn=Users,dc=example,dc=local",
        "managerPassword": "myMgrPassword",
        "referral": "FOLLOW"
      },
      "loginFilter": {
        "searchBase": "dc=example,dc=local",
        "searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"
      }
    },
    "version": 1,
    "type": "ldap"
  }
}</pre><p>Note also how in this case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> option is left unspecified and the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> is set to the distinguished name of the top-level domain. This is necessary to ensure the scope of the chased referral queries will include the child domain. If <span class="bold bold"><strong> <code class="code">rootDn </code> </strong></span>and <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> had been left as they were set in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/SSO/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> example, the initial query would have been targeted only within <span class="bold bold"><strong> <code class="code">cn=Users,dc=example,dc=local</code> </strong></span> and hence the referral would never have been returned by the top-level server.</p><p>Note these other caveats of referral chasing in the Sysdig platform:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Referrals may only be successfully chased to child domains. If referrals point to parallel domains (e.g. for our example, <span class="bold bold"><strong> <code class="code">dc=adjacent,dc=local</code> </strong></span>) the queries will not succeed and users stored in the directory servers for such domains will not be able to authenticate.</p></li><li class="listitem"><p>The LDAP library used by the Sysdig platform does not log information about each referral it attempts to chase. Therefore, if you enable referral chasing, it is important that you understand the server targets that may be chased in your environment and ensure the network connectivity (routing/firewalls) will permit the Sysdig platform to query these server targets. If LDAP queries are failing due to a network connectivity issue, this will typically be accompanied by delays during Sysdig user logins of approximately 30 seconds followed by a login failure with an <span class="bold bold"><strong> <code class="code">HTTP 504</code> </strong></span> error message shown in the login screen. If this occurs, contact Sysdig support for assistance.</p></li></ul></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-CreatingLDAPUsersBeforeTheyLogin" class="bridgehead">Creating LDAP Users Before They Login</h8><p>The default behavior of the LDAP feature is to create a new record in the Sysdig user database when a user authenticates successfully via LDAP for the first time. However, it may be desirable to add such user records in advance of their first login, such as if you wish to use automation to change user permissions, assign team membership, or pre-populate Dashboard/Alert configurations. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/user_creation/create_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">create_user.sh</code> </strong></span> </a> helper script is available in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/updated-ldap-settings/user_creation" target="_blank">sysdig-cloud-scripts</a> </code> </strong></span> repository to create such user records via the API. This script can also be used to enable/disable this functionality in the Sysdig platform. See the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/user_creation/README.md" target="_blank">README</a> for details.</p><p>Additional details regarding this type of user creation in conjunction with LDAP authentication:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method allows creation of <span class="italic italic">any</span> username, even if it doesn't currently exist in the directory that is queried via LDAP.</p></li><li class="listitem"><p>When LDAP authentication is enabled, such users can be created with a simple username (e.g. <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) or with an email-style postfix (as is typical for non-LDAP Sysdig user, e.g. <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span>). In this latter case only the username portion (<span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) is used when the Sysdig platform is performing an LDAP query during attempted login.</p></li><li class="listitem"><p>While the <span class="bold bold"><strong> <code class="code">password</code> </strong></span> must be included in the config you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to create the user, it is not used by the Sysdig platform when LDAP is enabled, as authentication will always be performed via LDAP. For this same reason, if a user has been created in this way, they will not be able to login unless there is a matching user in the directory that is queried via LDAP.</p></li><li class="listitem"><p>The <span class="bold bold"><strong> <code class="code">firstName</code> </strong></span> and <span class="bold bold"><strong> <code class="code">lastName</code> </strong></span> values as specified in the example are optional and independent from any equivalent name settings in the directory that is queried via LDAP.</p></li></ul></div><h8 id="UUID-8c5f22bb-b603-1739-5e09-672cc04715e0_id_LDAPAuthenticationConfigurationforPlatformv1586-LimitationsandCaveats" class="bridgehead">Limitations and Caveats</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP support has been tested with Active Directory in Windows Server 2012 R2. It may work with AD versions that ship with other versions of Windows, or other directory servers that use the LDAP protocol. If you are intending to use LDAP with something other than Active Directory, please contact Sysdig Support.</p></li><li class="listitem"><p>The LDAP feature is only present in Sysdig software platform installs (not the SaaS version).</p></li><li class="listitem"><p>Only one LDAP config can exist per deployment (i.e. the platform can only query one directory server endpoint).</p></li><li class="listitem"><p>Because the Sysdig software platform is based on the same technology as the SaaS-based Sysdig service, it theoretically supports the configuration of multiple “customers” using the same install. However, the multi-customer option is not supported when the LDAP feature is enabled.</p></li><li class="listitem"><p>When LDAP authentication is enabled, adding users via email "invites" is not possible.</p></li><li class="listitem"><p>LDAP authentication for directory usernames that begin or end with a space character (e.g. <span class="bold bold"><strong> <code class="code">" jdoe"</code> </strong></span> or <span class="bold bold"><strong> <code class="code">"jdoe "</code> </strong></span>) are not supported.</p></li><li class="listitem"><p>Configuration entries that contain special characters (for instance, a <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> that contains a backslash character) are supported, but note that you will need to perform proper JSON escaping in the configuration you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to the API. If you attempt to post invalid JSON, the helper scripts will return an error message. If this occurs, you can use tools such as <a class="link" href="https://jsonlint.com/" target="_blank">JSONLint</a> to narrow down the source of the problem and/or <a class="link" href="https://www.freeformatter.com/json-escape.html" target="_blank">JSON String Escape</a> to learn how to properly escape your text.</p></li><li class="listitem"><p>The LDAP feature does not attempt any ongoing “sync” back from the Sysdig platform user database to the directory server. Note how this impacts the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If a user is deleted from the directory server, their user record will remain in the Sysdig user database until a Sysdig Admin deletes it. Of course, that user will not be able to login since they will no longer be able to authenticate successfully via LDAP.</p></li><li class="listitem"><p>If an Admin deletes a user from the Sysdig user database, but the user can still authenticate successfully via LDAP, their Sysdig user record will be recreated if they login again via LDAP.</p></li><li class="listitem"><p>If a person’s username should change in the directory server (e.g. the value for <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in our examples above), the next time they login, a new user record will be created for them in the Sysdig user database. Settings they previously had in the Sysdig platform such as Admin rights and Alerts/Dashboard configurations will not be present for this recreated user.</p></li></ul></div></li><li class="listitem"><p>Other LDAP-centric functionality that is not currently supported (not an exhaustive list):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Mapping a user in the directory server to the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Sysdig "super" Admin</a> (such as to avoid the need to configure the this "super" Admin user).</p></li><li class="listitem"><p>Session expiry based on configuration in the directory server (such as to set a user account to only be valid until a certain date).</p></li><li class="listitem"><p>Login policies based on configuration in the directory server (such as to restrict login to certain hours).</p></li><li class="listitem"><p>User timeout functionality (such as to remove a user from the Sysdig user database if they have not logged in for a certain amount of time).</p></li></ul></div></li><li class="listitem"><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> for more guidance to assist with debugging or perfecting your LDAP configuration.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Overview  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Functionality  </p></li><li class="listitem"><p> Prerequisite: Have the "Super" Admin User Credentials and Token </p></li></ul></div></li><li class="listitem"><p> Configure Basic LDAP Settings </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> UI-Based: Configure LDAP in Settings  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Enter LDAP Connection Settings </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Table_loginConnectionSettings </p></li><li class="listitem"><p> Table_loginFilter </p></li></ul></div></li><li class="listitem"><p> Select LDAP for SSO  </p></li></ul></div></li><li class="listitem"><p> Script-Based: Configure LDAP Using Scripts  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p> Configure env.sh </p></li><li class="listitem"><p> Retrieve Current LDAP Settings </p></li><li class="listitem"><p> Configure settings_login_simple.json and set with login_config.sh </p></li><li class="listitem"><p> Sample result in Active Directory </p></li><li class="listitem"><p> Test User Login </p></li><li class="listitem"><p> Optional: Delete LDAP settings </p></li></ul></div></li></ul></div></li><li class="listitem"><p> User Experience </p></li><li class="listitem"><p> Advanced Use Cases  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> Multi-Server Directories </p></li><li class="listitem"><p> Creating LDAP Users Before They Login </p></li></ul></div></li><li class="listitem"><p> Limitations and Caveats </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-0b54ccdd-62b3-c2c8-34d3-cdab225a43a4" data-publication-date="" id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP Authentication Configuration (for Platform v.1149 - 1511)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This article is specific to LDAP support of <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> version 1149.</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>If you are running version 858 or older, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206274634/LDAP+Authentication+Configuration+for+Platform+v.+858-" target="_blank">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running versions 890 through 925, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/283148296/LDAP+Authentication+Configuration+for+Platform+v.+890+-+925" target="_blank">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running GA releases 963 - 1091, refer to <span class="underline underline"> <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/282853386/LDAP+Authentication+Configuration+for+Platform+v.+963+" target="_blank">this other article</a> </span> instead.</p></li></ul></div></div><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-Introduction" class="bridgehead">Introduction</h8><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig software platform is often leveraged to allow user authentication using credentials in a customer’s own directory server.</p><p>This document describes how to configure base LDAP settings, as well as the <a class="link" href="">LDAP Authentication Configuration (for Platform v.1149 - 1511)#limitations</a> of the LDAP support.</p><p>LDAP can be complex to configure. Sysdig strongly recommends that you first refine your LDAP configuration in a separate test setup before applying the LDAP settings in your production environment. If you do not have a "development license" for test purposes or have misplaced your license information, contact <a class="link" href="mailto:billing@sysdig.com." target="_blank">billing@sysdig.com.</a> </p><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-SummaryofFunctionality" class="bridgehead">Summary of Functionality</h8><p>Independent of the LDAP feature, the Sysdig platform ordinarily maintains its own user database to hold not only a username and password hash but also settings for Admin privileges, Sysdig team membership, and a user’s configured Dashboards and Alerts. Sysdig's LDAP authentication feature provides a means to allow the Sysdig platform to query your separate directory server to validate username/password. Upon successful authentication, a corresponding user record in the Sysdig platform’s user database is automatically created. When the LDAP feature is in use, the user’s directory password is not stored in the Sysdig user database.</p><p>Once LDAP authentication is enabled, <span class="italic italic">all</span> normal user authentication will be performed against your configured directory server. Other local, non-LDAP users that were created before LDAP was enabled can still authenticate via LDAP as long as their username in your directory matches with the the username of their pre-existing record in the Sysdig user database. For example, consider a user <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> who had been a user in the Sysdig environment before LDAP was enabled. Once LDAP authentication is enabled, if a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> exists in the directory server and is able to authenticate successfully via LDAP, they will be permitted to log in to the Sysdig platform as the pre-existing <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> user. Any user-specific configuration (Alerts, Dashboards, etc.) that were attached to <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span> will still be visible to this user. Any password previously set for such a pre-existing user record will <span class="italic italic">not</span> be used for authentication to the Sysdig platform unless LDAP authentication is disabled.</p><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-Upgrades-MigrationofSettings" class="bridgehead">Upgrades - Migration of Settings</h8><p> <span class="bold bold"><strong>Note: This section is only relevant if you have already been using LDAP support as it existed in Sysdig platform version 858 and earlier and are upgrading to version 1149 or newer. If you are configuring LDAP for the first time and are running version 1149 or newer, skip this section.</strong></span> </p><p>LDAP support in <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/206274634/LDAP+Authentication+Configuration+for+Platform+v.+858-" target="_blank">version 858 and older</a> was configured exclusively via the Replicated console or <a class="link" href="">Kubernetes ConfigMap</a>, depending on your installation type. This required the Sysdig platform to be restarted after any changes to the LDAP settings. When you upgrade your environment to version 1149 or newer, your existing settings will be migrated to a new API-based configuration described below. The only LDAP-related setting that remains in the Replicated console is the optional <span class="bold bold"><strong>CA certificate</strong></span> for LDAPS connectivity.</p><p>For <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204669178/Sysdig+Install+with+Kubernetes+1.9+" target="_blank">Kubernetes-based installs</a>, you should leave the prior LDAP settings intact to ensure successful migration upon upgrade. But once you are successfully running version 1149 or newer, all elements that begin with <span class="bold bold"><strong> <code class="code">sysdigcloud.ldap</code> </strong></span> can be removed from your ConfigMap.</p><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-PrerequisiteTheSuperAdminuser" class="bridgehead">Prerequisite: The "Super" Admin user</h8><p>In an environment enabled for LDAP authentication, the one user still subject to direct email+password authentication is the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a>. Creation of this user is a required initial install step either via the Replicated console (see screenshot below) or <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/blob/master/sysdigcloud/config.yaml" target="_blank">Kubernetes ConfigMap</a> element <span class="bold bold"><strong> <code class="code">sysdigcloud.default.user</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="550px"><tr style="height: 184px"><td><img src="image/15d5af4f49ea6a.png" style="max-width: 550px; max-height: 184px; " alt="373574240.png"></img></td></tr></table></div><p>This user is required and cannot be deleted. This login provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A way to access the Sysdig platform when LDAP connectivity is severed.</p></li><li class="listitem"><p>The first Admin user in the install, essential for assigning Admin rights to other users once they’ve authenticated via your directory and their user records have been added to the Sysdig user database.</p></li><li class="listitem"><p>The user whose <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> Token can be used to perform further LDAP configurations via the Sysdig platform API (see <a class="link" href="">below</a>).</p></li></ul></div><p>Once other directory-authenticated users have been promoted to Admins, those Admins can promote other directory-authenticated users to Admin, and so on.</p><p>Configuration of Base LDAP Settings</p><p>The configuration of the LDAP feature can be viewed, updated, and deleted by the "super" Admin via the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings</code> </strong></span> using HTTP methods for <span class="bold bold"><strong> <code class="code">GET</code> </strong></span>, <span class="bold bold"><strong> <code class="code">POST</code> </strong></span>, and <span class="bold bold"><strong> <code class="code">DELETE</code> </strong></span>, respectively.</p><p> <span class="bold bold"><strong>NOTE</strong></span>: See the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> page for general info on the API, and the the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Locating the "Super" Admin User</a> page for guidance on finding the token for the appropriate "super" Admin user.</p><p>A version of a <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/updated-ldap-settings/LDAP/login_config.sh" target="_blank">login_config.sh</a> </code> </strong></span> helper script is available in <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/updated-ldap-settings" target="_blank">a beta branch of the sysdig-cloud-scripts repository</a> for your use along with an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/updated-ldap-settings/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> that can be modified for your environment. Refer to the tables below for details on config options. Example command-lines below the table describe how to enable LDAP with these settings.</p><p>The follow settings are in the required <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> section.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">server</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>URL of the directory server for the Sysdig platform to query. An example for LDAP over SSL:</p><p>ldaps://172.16.0.1:636</p><p>For cleartext LDAP:</p><p>ldap://176.16.0.1</p><p>Note that to use LDAPS, you'll also need to use the Replicated console (or <a class="link" href="">equivalent approach in Kubernetes-based installs</a>) to upload a Certificate Authority (CA) PEM-format certificate that the Sysdig platform will use to validate its SSL connection to the server. If you have a host with OpenSSL tools installed that can reach the directory server, you can obtain the certificate by running:</p><pre class="programlisting"># openssl s_client -showcerts -connect &lt;server-ip&gt;:636</pre><p>The command output will typically show the server certificate first and the CA certificate second, both in PEM format. Into a text file, paste the CA certificate portion of the output that looks like:</p><pre class="programlisting">-----BEGIN CERTIFICATE-----
[random text...]
-----END CERTIFICATE-----</pre><p>Under <span class="bold bold"><strong>LDAP CA certificate in the PEM format</strong></span> in the Replicated console, click the "Choose File" button and browse to the file you just created to select and upload it. Note that when you click <span class="bold bold"><strong>Save</strong></span>, the Sysdig platform will restart. This is the only setting related to LDAP that requires a platform restart.</p><p>Note: For environments using self-signed certificates, the <span class="bold bold"><strong> <code class="code">openssl </code> </strong></span>command shown above will return only one certificate.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The distinguished name of a user that the Sysdig platform can authenticate as via LDAP in order to perform further queries about the users attempting to login to the Sysdig platform. Example:</p><pre class="programlisting">cn=Administrator,cn=Users,dc=example,dc=local</pre><p>This setting is required, as the Sysdig platform does not support connection to servers via anonymous bind.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The password for the <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span>.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>The distinguished name for the point in the LDAP tree below which all search queries will begin. Example:</p><pre class="programlisting">dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Defines whether the Sysdig platform will <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">chase referrals</a> found in LDAP query responses. If not specified, this will be set to <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span> in your configuration and referrals will not be chased. See the section below on <a class="link" href="">Multi-Server Directories</a> for more details on this option.</p></td></tr></tbody></table></div><p>The following settings are in the optional <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> section:s</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about users should be performed. Example:</p><pre class="programlisting">cn=Users</pre><p>If specified as an empty string (<span class="bold bold"><strong> <code class="code">""</code> </strong></span>), the search will be performed across everything below the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>, in which case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting must be configured.</p><p>Note that if the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting was not specified, the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> setting must provide a full distinguished name. Example:</p><pre class="programlisting">cn=Users,dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify the user record. The marker token <span class="bold bold"><strong> <code class="code">{0}</code> </strong></span> represents where the username will appear when LDAP queries are constructed. An example that targets the attribute <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in Active Directory:</p><pre class="programlisting">(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))</pre><p>While this setting is optional, if not specified, no users will be able to authenticate via LDAP.</p></td></tr></tbody></table></div><p>To use the helper script, modify the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> and <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for your environment. Once set, invoking <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with no options will print the current configuration. If you were running Sysdig platform version 858 or older and have just upgraded to version 1149 or newer, you will see your migrated settings. Otherwise, the LDAP feature will start out disabled (<span class="bold bold"><strong> <code class="code">"enableLdapAuthentication": false</code> </strong></span>) and other configuration settings will not be shown.</p><pre class="programlisting"># ./login_config.sh
{
    "ldapSettings": {
        "enableLdapAuthentication": false,
        "version": 1
    }
}</pre><p>Using the guidance in the settings table above, modify the <span class="bold bold"><strong> <code class="code">settings_login_simple.json</code> </strong></span> as necessary to allow for connectivity and querying of users in your directory server. To apply the new LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option and specify the filename containing the JSON config, . If successful, the applied configuration will be echoed back by the API.</p><pre class="programlisting"># ./login_config.sh -s settings_login_simple.json
{"ldapSettings":{"version":2,"loginConnectionSettings":{"server":"ldap://172.16.0.1","rootDn":"dc=example,dc=local","managerDn":"cn=Administrator,cn=Users,dc=example,dc=local","managerPassword":"myMgrPassword","referral":"IGNORE"},"loginFilter":{"searchBase":"cn=Users","searchFilter":"(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"},"enableLdapAuthentication":true}}</pre><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would now be permitted for a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> that has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=John Doe,CN=Users,DC=example,DC=local</pre><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr><td><img src="image/15d5af4f48a143.png" style="max-width: 1024px; " alt="5d4d58a7ca2e0.png"></img></td></tr></table></div><p>To delete LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. <span class="bold bold"><strong>This should be used with caution, as this will prevent all LDAP users from being able to login to the Sysdig platform!</strong></span> </p><pre class="programlisting"># ./login_config.sh -d
{"ldapSettings":{"version":3,"enableLdapAuthentication":false}}</pre><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-GroupMembershipConfigurationdeprecated" class="bridgehead">Group Membership Configuration (deprecated)</h8><p>The LDAP feature as it existed in version 858 and earlier included optional additional settings that, when specified, ensured that authenticated users were also members of one or more groups before permitting them to login to the Sysdig platform. These settings are documented here for the benefit of those who used these settings in the past and have had their settings migrated to the newer API-based configuration, where they become part of the <span class="bold bold"><strong> <code class="code">loginFilter </code> </strong></span>section. See below for details on how to use the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> instead to achieve equivalent functionality.</p><p>For use with the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/login_config.sh" target="_blank">login_config.sh</a> </code> </strong></span> helper script, an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> is provided that can be modified for your environment based on the table below. Example command-lines are shown below the table.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchBase</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about groups should be performed. Example:</p><pre class="programlisting">ou=Planets</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify a group to which the user must belong. An example that only permits users that are in the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group in Active Directory:</p><pre class="programlisting">(&amp;(cn=Mars)(objectclass=group))</pre><p>If this setting is left blank, group membership is not required, and hence any user that successfully authenticates via LDAP using only username/password will be permitted to login to the Sysdig platform.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupMembershipFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use to determine group membership. If no setting is specified, the following default filter is applied, which should work for most environments:</p><pre class="programlisting">(| (member={0}) (uniqueMember={0}) (memberUid={1}))</pre></td></tr></tbody></table></div><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would be permitted for this user who belongs to the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr><td><img src="image/15d5af4f4a56a7.png" style="max-width: 1024px; " alt="5d4d58afe695a.png"></img></td></tr></table></div><p>But our <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> user who is not a member would be prevented from logging in.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr><td><img src="image/15d5af4f4ac3ea.png" style="max-width: 400px; " alt="5d4d58b290083.png"></img></td></tr></table></div><p>To simplify your configuration and avoid use of these deprecated options, an equivalent configuration can be achieved by making the group membership part of the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span>:</p><pre class="programlisting">"searchFilter": "(&amp;(memberOf=CN=Mars,OU=Planets,DC=example,DC=local)(objectClass=organizationalPerson)(sAMAccountName={0}))"</pre><p>See the example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_group.json" target="_blank">settings_login_group.json</a> </code> </strong></span> for an updated configuration that can be compared side-by-side with <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/updated-ldap-settings/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span>.</p><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-multiserverMulti-ServerDirectories" class="bridgehead">Multi-Server Directories</h8><p>Data about your users that need to access the Sysdig platform may be stored across many directory servers in your environment. As the Sysdig platform is only able to query one LDAP server endpoint, you would need to take extra steps to ensure successful authentication for such users.</p><p>The simplest approach to achieve this is to query against a <a class="link" href="https://technet.microsoft.com/pt-pt/library/cc728188(v=ws.10).aspx" target="_blank">Global Catalog</a>. As the Global Catalog stores a copy of all Active Directory objects in a forest, this provides a fast and convenient target for the Sysdig platform to find all users that may need to authenticate. Since queries against the Global Catalog are also performed via LDAP, you simply need to ensure your LDAP configuration specifies the appropriate address and TCP port for the Global Catalog, e.g. ldap://176.16.0.1:3268 for cleartext LDAP or ldaps://172.16.0.1:3269 for LDAP over SSL. If querying against a Global Catalog, the <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> option of the Sysdig platform's LDAP configuration can remain at its default setting of <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span>.</p><p>If a Global Catalog is not available, another approach is to leverage <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">referral chasing</a>. Such chasing depends on complex interplay of configuration settings, DNS resolution, and network connectivity to multiple servers. If you require this option, carefully read the tips in this section and validate your configuration in a test environment before attempting its use in production. Contact Sysdig support for assistance as necessary.</p><p>For our example configuration, we've added another Domain Controller to our environment that holds users a separate set of users for the child domain <span class="bold bold"><strong> <code class="code">eu.example.local</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f497d3a.png" style="max-width: 600px; " alt="5d4d58ab6fd93.png"></img></td></tr></table></div><p>We'd like to permit login for a user "<span class="bold bold"><strong> <code class="code">eurodude</code> </strong></span>" in the child domain. This user has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=Euro Dude,CN=Users,DC=eu,DC=example,DC=local</pre><p>In the example configuration <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_referral_follow.json" target="_blank">settings_login_referral_follow.json</a> </code> </strong></span> shown below, the Sysdig platform still begins its LDAP queries at the same top-level server target. However, the <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> option is set to <span class="bold bold"><strong> <code class="code">"FOLLOW"</code> </strong></span>, which will cause the Sysdig platform to perform subsequent queries if a query returns one or more referrals.</p><pre class="programlisting">{
  "loginConnectionSettings": {
    "server": "ldap://172.16.0.1",
    "managerDn": "cn=Administrator,cn=Users,dc=example,dc=local",
    "managerPassword": "myMgrPassword",
    "referral": "FOLLOW"
  },
  "loginFilter": {
    "searchBase": "dc=example,dc=local",
    "searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"
  },
  "enableLdapAuthentication": true
}</pre><p>Note also how in this case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> option is left unspecified and the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> is set to the distinguished name of the top-level domain. This is necessary to ensure the scope of the chased referral queries will include the child domain. If <span class="bold bold"><strong> <code class="code">rootDn </code> </strong></span>and <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> had been left as they were set in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> example, the initial query would have been targeted only within <span class="bold bold"><strong> <code class="code">cn=Users,dc=example,dc=local</code> </strong></span> and hence the referral would never have been returned by the top-level server.</p><p>Note these other caveats of referral chasing in the Sysdig platform:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Referrals may only be successfully chased to child domains. If referrals point to parallel domains (e.g. for our example, <span class="bold bold"><strong> <code class="code">dc=adjacent,dc=local</code> </strong></span>) the queries will not succeed and users stored in the directory servers for such domains will not be able to authenticate.</p></li><li class="listitem"><p>The LDAP library used by the Sysdig platform does not log information about each referral it attempts to chase. Therefore, if you enable referral chasing, it is important that you understand the server targets that may be chased in your environment and ensure the network connectivity (routing/firewalls) will permit the Sysdig platform to query these server targets. If LDAP queries are failing due to a network connectivity issue, this will typically be accompanied by delays during Sysdig user logins of approximately 30 seconds followed by a login failure with an <span class="bold bold"><strong> <code class="code">HTTP 504</code> </strong></span> error message shown in the login screen. If this occurs, contact Sysdig support for assistance.</p></li></ul></div><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-TestingUserLogin" class="bridgehead">Testing User Login</h8><p>To test the login configuration, the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> can confirm if a particular user would be permitted to login given current LDAP login connection settings. To do this, perform an HTTP <span class="bold bold"><strong> <code class="code">GET</code> </strong></span> to the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings/verify/USERNAME</code> </strong></span>. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/LDAP/verify_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">verify_user.sh</code> </strong></span> </a> helper script is provided to easily perform this. If invoked with the <span class="bold bold"><strong> <code class="code">-u</code> </strong></span> option and a username, and the user's login would be successful, it will return the user's information from the directory.</p><pre class="programlisting"># ./verify_user.sh -u jdoe
{"element":"uSNCreated=12799, countryCode=0, badPwdCount=0, whenChanged=20180406232737.0Z, objectClass=top, primaryGroupID=513, givenName=John, objectGUID=..., objectSid=..., instanceType=4, whenCreated=20180406220651.0Z, dSCorePropagationData=16010101000000.0Z, sn=Doe, userAccountControl=66048, lastLogonTimestamp=131675308573317669, cn=John Doe, codePage=0, accountExpires=9223372036854775807, sAMAccountName=jdoe, sAMAccountType=805306368, userPrincipalName=jdoe@example.local, displayName=John Doe, pwdLastSet=131675260113435098, lastLogon=131682933890462204, name=John Doe, objectCategory=CN=Person,CN=Schema,CN=Configuration,DC=example,DC=local, distinguishedName=CN=John Doe,CN=Users,DC=example,DC=local, lastLogoff=0, memberOf=CN=Sysdig Viewers,CN=Users,DC=example,DC=local, logonCount=0, uSNChanged=12986"}</pre><p>If the user would not be able to login, an error message will be returned.</p><pre class="programlisting"># ./verify_user.sh -u nothere
Could not verify user "nothere". Check LDAP login config settings and/or system log.</pre><p>Note that if LDAP authentication is disabled this method for testing user login is not available.</p><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-creatingusersCreatingLDAPUsersBeforeTheyLogin" class="bridgehead">Creating LDAP Users Before They Login</h8><p>The default behavior of the LDAP feature is to create a new record in the Sysdig user database when a user authenticates successfully via LDAP for the first time. However, it may be desirable to add such user records in advance of their first login, such as if you wish to use automation to change user permissions, assign team membership, or pre-populate Dashboard/Alert configurations. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/updated-ldap-settings/user_creation/create_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">create_user.sh</code> </strong></span> </a> helper script is available in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/updated-ldap-settings/user_creation" target="_blank">sysdig-cloud-scripts</a> </code> </strong></span> repository to create such user records via the API. This script can also be used to enable/disable this functionality in the Sysdig platform. See the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/updated-ldap-settings/user_creation/README.md" target="_blank">README</a> for details.</p><p>Additional details regarding this type of user creation in conjunction with LDAP authentication:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method allows creation of <span class="italic italic">any</span> username, even if it doesn't currently exist in the directory that is queried via LDAP.</p></li><li class="listitem"><p>When LDAP authentication is enabled, such users can be created with a simple username (e.g. <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) or with an email-style postfix (as is typical for non-LDAP Sysdig user, e.g. <span class="bold bold"><strong> <code class="code"> <a class="link" href="mailto:jdoe@example.com" target="_blank">jdoe@example.com</a> </code> </strong></span>). In this latter case only the username portion (<span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) is used when the Sysdig platform is performing an LDAP query during attempted login.</p></li><li class="listitem"><p>While the <span class="bold bold"><strong> <code class="code">password</code> </strong></span> must be included in the config you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to create the user, it is not used by the Sysdig platform when LDAP is enabled, as authentication will always be performed via LDAP. For this same reason, if a user has been created in this way, they will not be able to login unless there is a matching user in the directory that is queried via LDAP.</p></li><li class="listitem"><p>The <span class="bold bold"><strong> <code class="code">firstName</code> </strong></span> and <span class="bold bold"><strong> <code class="code">lastName</code> </strong></span> values as specified in the example are optional and independent from any equivalent name settings in the directory that is queried via LDAP.</p></li></ul></div><h8 id="UUID-07980f6e-f70e-7f37-0e69-037a1fb718e8_id_LDAPAuthenticationConfigurationforPlatformv1149-1511-limitationsLimitationsandCaveats" class="bridgehead">Limitations and Caveats</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP support has been tested with Active Directory in Windows Server 2012 R2. It may work with AD versions that ship with other versions of Windows, or other directory servers that use the LDAP protocol. If you are intending to use LDAP with something other than Active Directory, please contact Sysdig Support.</p></li><li class="listitem"><p>The LDAP feature is only present in Sysdig software platform installs (not the SaaS version).</p></li><li class="listitem"><p>Only one LDAP config can exist per deployment (i.e. the platform can only query one directory server endpoint).</p></li><li class="listitem"><p>Because the Sysdig software platform is based on the same technology as the SaaS-based Sysdig service, it theoretically supports the configuration of multiple “customers” using the same install. However, the multi-customer option is not supported when the LDAP feature is enabled.</p></li><li class="listitem"><p>When LDAP authentication is enabled, adding users via email "invites" is not possible.</p></li><li class="listitem"><p>LDAP authentication for directory usernames that begin or end with a space character (e.g. <span class="bold bold"><strong> <code class="code">" jdoe"</code> </strong></span> or <span class="bold bold"><strong> <code class="code">"jdoe "</code> </strong></span>) are not supported.</p></li><li class="listitem"><p>Configuration entries that contain special characters (for instance, a <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> that contains a backslash character) are supported, but note that you will need to perform proper JSON escaping in the configuration you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to the API. If you attempt to post invalid JSON, the helper scripts will return an error message. If this occurs, you can use tools such as <a class="link" href="https://jsonlint.com/" target="_blank">JSONLint</a> to narrow down the source of the problem and/or <a class="link" href="https://www.freeformatter.com/json-escape.html" target="_blank">JSON String Escape</a> to learn how to properly escape your text.</p></li><li class="listitem"><p>The LDAP feature does not attempt any ongoing “sync” back from the Sysdig platform user database to the directory server. Note how this impacts the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If a user is deleted from the directory server, their user record will remain in the Sysdig user database until a Sysdig Admin deletes it. Of course, that user will not be able to login since they will no longer be able to authenticate successfully via LDAP.</p></li><li class="listitem"><p>If an Admin deletes a user from the Sysdig user database, but the user can still authenticate successfully via LDAP, their Sysdig user record will be recreated if they login again via LDAP.</p></li><li class="listitem"><p>If a person’s username should change in the directory server (e.g. the value for <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in our examples above), the next time they login, a new user record will be created for them in the Sysdig user database. Settings they previously had in the Sysdig platform such as Admin rights and Alerts/Dashboard configurations will not be present for this recreated user.</p></li></ul></div></li><li class="listitem"><p>Other LDAP-centric functionality that is not currently supported (not an exhaustive list):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Mapping a user in the directory server to the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Sysdig "super" Admin</a> (such as to avoid the need to configure the this "super" Admin user).</p></li><li class="listitem"><p>Session expiry based on configuration in the directory server (such as to set a user account to only be valid until a certain date).</p></li><li class="listitem"><p>Login policies based on configuration in the directory server (such as to restrict login to certain hours).</p></li><li class="listitem"><p>User timeout functionality (such as to remove a user from the Sysdig user database if they have not logged in for a certain amount of time).</p></li></ul></div></li><li class="listitem"><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> for more guidance to assist with debugging or perfecting your LDAP configuration.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong> Introduction </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Summary of Functionality </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Upgrades - Migration of Settings </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Prerequisite: The "Super" Admin user </strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <span class="bold bold"><strong> Group Membership Configuration (deprecated) </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Multi-Server Directories </strong></span> </p></li></ul></div></li><li class="listitem"><p> <span class="bold bold"><strong> Testing User Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Creating LDAP Users Before They Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Limitations and Caveats </strong></span> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-1887bd68-6aca-b11a-4e3b-b194fd30b7e1" data-publication-date="" id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP Authentication Configuration (for Platform v. 963 - 1091)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This article is specific to the LDAP support in the <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> of the Sysdig software platform version 963 and newer.</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>If you are running version 858 or older, refer to <span class="underline underline"> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00" title="LDAP Authentication Configuration (for Platform v. 858-)">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running versions 890 through 925, refer to <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0" title="LDAP Authentication Configuration (for Platform v. 890 - 925)">this other article</a> instead.</p></li></ul></div></div><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-Introduction" class="bridgehead">Introduction</h8><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig software platform allows user authentication using credentials in a customer’s own directory server.</p><p>This document describes how to configure LDAP authentication as well as its <a class="link" href="">LDAP Authentication Configuration (for Platform v. 963 - 1091)#limitations</a>.</p><p>LDAP can be complex to configure. Sysdig strongly recommends that you first refine your LDAP configuration in a separate test setup before applying the LDAP settings in your production environment. If you do not have a "development license" for test purposes or have misplaced your license information, contact <a class="link" href="mailto:billing@sysdig.com." target="_blank">billing@sysdig.com.</a> </p><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-SummaryofFunctionality" class="bridgehead">Summary of Functionality</h8><p>Independent of the LDAP feature, the Sysdig platform ordinarily maintains its own user database to hold not only a username and password hash but also settings for Admin privileges, Sysdig team membership, and a user’s configured Dashboards and Alerts. The LDAP feature provides a means to allow the Sysdig platform to query your separate directory server to validate username/password. Upon successful authentication, a corresponding user record in the Sysdig platform’s user database is automatically created. When the LDAP feature is in use, the user’s directory password is not stored in the Sysdig user database.</p><p>Once the LDAP feature is enabled, <span class="italic italic">all</span> normal user authentication will be performed against your configured directory server. Other local, non-LDAP users that were created before LDAP was enabled can still authenticate via LDAP as long as the username portion of their email address in the Sysdig user database matches their LDAP username. For example, consider a user <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> who had been a user in the Sysdig environment before LDAP was enabled. Once LDAP is enabled, if a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> exists in the directory server and is able to authenticate successfully via LDAP, they will be permitted to log in to the Sysdig platform as the pre-existing <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> user. Any user-specific configuration (Alerts, Dashboards, etc.) that were attached to <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> will still be visible to this user. Any password previously set for such a pre-existing user record will <span class="italic italic">not</span> be used for authentication to the Sysdig platform unless the LDAP feature is disabled.</p><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-Upgrades-MigrationofSettings" class="bridgehead">Upgrades - Migration of Settings</h8><p> <span class="bold bold"><strong>Note: This section is only relevant if you have already been using LDAP support as it existed in Sysdig platform version 858 and earlier and are upgrading to version 963 or newer. If you are configuring LDAP for the first time and are running version 963 or newer, skip this section.</strong></span> </p><p>LDAP support in version 858 and older (as described in <a class="link" href="https://support.sysdig.com/hc/en-us/search/click?data=BAh7CjoHaWRsKwiWWLPGGgA6CXR5cGVJIgxhcnRpY2xlBjoGRVQ6CHVybEkiNy9oYy9lbi11cy9hcnRpY2xlcy8xMTUwMDI3OTIwODYtTERBUC1Db25maWd1cmF0aW9uBjsHVDoOc2VhcmNoX2lkSSIpZDE1ZGQxMWItY2ZiZi00MDk1LWJjMDQtYjE0OTIwZDc2YTA4BjsHRjoJcmFua2kG--abaacfd06263f6a8465b51bccad120b14588ae85" target="_blank">this article</a>) was configured exclusively via the Replicated console or <a class="link" href="">Kubernetes ConfigMap</a>, depending on your installation type. This required the Sysdig platform to be restarted after any changes to the LDAP settings. When you upgrade your environment to version 963 or newer, your existing settings will be migrated to a new API-based configuration described below. The only LDAP-related setting that remains in the Replicated console is the optional <span class="bold bold"><strong>CA certificate</strong></span> for LDAPS connectivity.</p><p>For <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes" target="_blank">Kubernetes -based installs</a>, you should leave the prior LDAP settings intact to ensure successful migration upon upgrade. But once you are successfully running version 963 or newer, all elements that begin with <span class="bold bold"><strong> <code class="code">sysdigcloud.ldap</code> </strong></span> can be removed from your ConfigMap.</p><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-PrerequisiteTheSuperAdminuser" class="bridgehead">Prerequisite: The "Super" Admin user</h8><p>In an LDAP-enabled environment, the one user still subject to direct, non-LDAP authentication is the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a>. Creation of this user is a required initial install step either via the Replicated console (see screenshot below) or <a class="link" href="https://github.com/draios/sysdigcloud-kubernetes/blob/master/sysdigcloud/config.yaml" target="_blank">Kubernetes ConfigMap</a> element <span class="bold bold"><strong> <code class="code">sysdigcloud.default.user</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f4b2868.png" style="max-height: 250px; " alt="373574331.png"></img></td></tr></table></div><p>This user is required and cannot be deleted. This login provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A way to access the Sysdig platform when LDAP connectivity is severed.</p></li><li class="listitem"><p>The first Admin user in the install, essential for assigning Admin rights to other users once they’ve authenticated via LDAP and their user records have been added to the Sysdig user database.</p></li><li class="listitem"><p>The user whose <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> Token can be used to perform further LDAP configurations via the Sysdig platform API (see <a class="link" href="">below</a>).</p></li></ul></div><p>Once other LDAP-authenticated users have been promoted to Admins, those Admins can promote other LDAP-authenticated users to Admin, and so on.</p><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-enablingConfigurationofLDAPAuthentication" class="bridgehead">Configuration of LDAP Authentication</h8><p>The configuration of the LDAP feature can be viewed, updated, and deleted by the "super" Admin via the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings</code> </strong></span> using HTTP methods for <span class="bold bold"><strong> <code class="code">GET</code> </strong></span>, <span class="bold bold"><strong> <code class="code">POST</code> </strong></span>, and <span class="bold bold"><strong> <code class="code">DELETE</code> </strong></span>, respectively.</p><p> <span class="bold bold"><strong>NOTE</strong></span>: See the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> page for general info on the API, and the the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Locating the "Super" Admin User</a> page for guidance on finding the token for the appropriate "super" Admin user.</p><p>A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/login_config.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> </a> helper script is available in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/LDAP" target="_blank">sysdig-cloud-scripts</a> </code> </strong></span> repository for your use along with an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> that can be modified for your environment. Refer to the table below for details on config options. Example command-lines below the table describe how to enable LDAP with these settings.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Section</p></th><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">server</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>URL of the directory server for the Sysdig platform to query. An example for cleartext LDAP:</p><p>ldap://176.16.0.1</p><p>For LDAP over SSL/TLS:</p><p>ldaps://172.16.0.1:636</p><p>Note that to use LDAPS, you'll also need to use the Replicated console (or <a class="link" href="">equivalent approach in Kubernetes -based installs</a>) to upload a Certificate Authority (CA) PEM-format certificate that the Sysdig platform will use to validate its SSL/TLS connection to the server. If you have a host with OpenSSL tools installed that can reach the directory server, you can obtain the certificate by running:</p><pre class="programlisting"># openssl s_client -showcerts -connect &lt;server-ip&gt;:636</pre><p>The command output will typically show the server certificate first and the CA certificate second, both in PEM format. Into a text file, paste the CA certificate portion of the output that looks like:</p><pre class="programlisting">-----BEGIN CERTIFICATE-----
[random text...]
-----END CERTIFICATE-----</pre><p>Under <span class="bold bold"><strong>LDAP CA certificate in the PEM format</strong></span> in the Replicated console, click the "Choose File" button and browse to the file you just created to select and upload it. Note that when you click <span class="bold bold"><strong>Save</strong></span>, the Sysdig platform will restart. This is the only setting related to LDAP that requires a platform restart.</p><p>Note: For environments using self-signed certificates, the <span class="bold bold"><strong> <code class="code">openssl</code> </strong></span> command shown above will return only one certificate.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The distinguished name of a user that the Sysdig platform can authenticate as via LDAP in order to perform further queries about the users attempting to login to the Sysdig platform. Example:</p><pre class="programlisting">cn=Administrator,cn=Users,dc=example,dc=local</pre><p>This setting is required, as the Sysdig platform does not support connection to servers via anonymous bind.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The password for the <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span>.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>The distinguished name for the point in the LDAP tree below which all search queries will begin. Example:</p><pre class="programlisting">dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>Defines whether the Sysdig platform will <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">chase referrals</a> found in LDAP query responses. If not specified, this will be set to <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span> in your configuration and referrals will not be chased. See the section below on <a class="link" href="">Multi-Server Directories</a> for more details on this option.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about users will be performed. Example:</p><pre class="programlisting">cn=Users</pre><p>If specified as an empty string (<span class="bold bold"><strong> <code class="code">""</code> </strong></span>), the search will be performed across everything below the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>, in which case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting must be configured.</p><p>Note that if the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> setting was not specified, the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> setting must provide a full distinguished name. Example:</p><pre class="programlisting">cn=Users,dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify the user record. The marker token <span class="bold bold"><strong> <code class="code">{0}</code> </strong></span> represents where the provided username will be placed when LDAP queries are constructed. An example that targets the attribute <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in Active Directory:</p><pre class="programlisting">(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))</pre></td></tr></tbody></table></div><p>To use the helper script, modify the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/LDAP/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> and <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for your environment. Once set, invoking <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with no options will print the current configuration. If you were running Sysdig platform version 858 or older and have just upgraded to version 925 or newer, you will see your migrated settings. Otherwise, the LDAP feature will start out disabled (<span class="bold bold"><strong> <code class="code">"enableLdapAuthentication": false</code> </strong></span>) and other configuration settings will not be shown.</p><pre class="programlisting"># ./login_config.sh
{
    "ldapSettings": {
        "enableLdapAuthentication": false,
        "version": 1
    }
}</pre><p>Using the guidance in the settings table above, modify the <span class="bold bold"><strong> <code class="code">settings_login_simple.json</code> </strong></span> as necessary to allow for connectivity and querying of users in your directory server. To apply the new LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option and specify the filename containing the JSON config, . If successful, the applied configuration will be echoed back by the API.</p><pre class="programlisting"># ./login_config.sh -s settings_login_simple.json
{"ldapSettings":{"version":2,"loginConnectionSettings":{"server":"ldap://172.16.0.1","rootDn":"dc=example,dc=local","managerDn":"cn=Administrator,cn=Users,dc=example,dc=local","managerPassword":"myMgrPassword","referral":"IGNORE"},"loginFilter":{"searchBase":"cn=Users","searchFilter":"(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"},"enableLdapAuthentication":true,"allowApiUserCreation":false}}</pre><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would now be permitted for a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> that has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=John Doe,CN=Users,DC=example,DC=local</pre><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr style="height: 748px"><td><img src="image/15d5af4f4b967f.png" style="max-width: 1024px; max-height: 748px; " alt="373574315.png"></img></td></tr></table></div><p>To delete LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. <span class="bold bold"><strong>This should be used with caution, as this will prevent all LDAP users from being able to login to the Sysdig platform!</strong></span> </p><pre class="programlisting"># ./login_config.sh -d
{"ldapSettings":{"version":3,"enableLdapAuthentication":false}}</pre><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-GroupMembershipConfigurationdeprecated" class="bridgehead">Group Membership Configuration (deprecated)</h8><p>The LDAP feature as it existed in version 858 and earlier included optional additional settings that, when specified, ensured that authenticated users were also members of one or more groups before permitting them to login to the Sysdig platform. These settings are documented here for the benefit of those who used these settings in the past and have had their settings migrated to the newer API-based configuration. See below for details on how to use the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> instead to achieve equivalent functionality.</p><p>For use with the <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/login_config.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">login_config.sh</code> </strong></span> </a> helper script, an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> is provided that can be modified for your environment based on the table below. Example command-lines are shown below the table.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Section</p></th><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchBase</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about groups should be performed. Example:</p><pre class="programlisting">ou=Planets</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify a group to which the user must belong. An example that only permits users that are in the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group in Active Directory:</p><pre class="programlisting">(&amp;(cn=Mars)(objectclass=group))</pre><p>If this setting is left blank, group membership is not required, and hence any user that successfully authenticates via LDAP using only username/password will be permitted to login to the Sysdig platform.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupMembershipFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use to determine group membership. If no setting is specified, the following default filter is applied, which should work for most environments:</p><pre class="programlisting">(| (member={0}) (uniqueMember={0}) (memberUid={1}))</pre></td></tr></tbody></table></div><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would be permitted for this user who belongs to the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr style="height: 748px"><td><img src="image/15d5af4f4c1f4a.png" style="max-width: 1024px; max-height: 748px; " alt="373574321.png"></img></td></tr></table></div><p>But our previous <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> user who is not a member would be prevented from logging in.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="400px"><tr><td><img src="image/15d5af4f4c8dd8.png" style="max-width: 400px; " alt="373574337.png"></img></td></tr></table></div><p>To simplify your configuration and avoid use of these deprecated options, an equivalent configuration can be achieved by making the group membership part of the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span>:</p><pre class="programlisting">"searchFilter": "(&amp;(memberOf=CN=Mars,OU=Planets,DC=example,DC=local)(objectClass=organizationalPerson)(sAMAccountName={0}))"</pre><p>See the example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group.json" target="_blank">settings_login_group.json</a> </code> </strong></span> for an updated configuration that can be compared side-by-side with <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span>.</p><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-multiserverMutli-ServerDirectories" class="bridgehead">Mutli-Server Directories</h8><p>Data about your users that need to access the Sysdig platform may be stored across many directory servers in your environment. As the Sysdig platform is only able to query one LDAP server endpoint, you would need to take extra steps to ensure successful authentication for such users.</p><p>The simplest approach to achieve this is to query against a <a class="link" href="https://technet.microsoft.com/pt-pt/library/cc728188(v=ws.10).aspx" target="_blank">Global Catalog</a>. As the Global Catalog stores a copy of all Active Directory objects in a forest, this provides a fast and convenient target for the Sysdig platform to find all users that may need to authenticate. Since queries against the Global Catalog are also performed via LDAP, you simply need to ensure your LDAP configuration specifies the appropriate address and TCP port for the Global Catalog, e.g. ldap://176.16.0.1:3268 for cleartext LDAP or ldaps://172.16.0.1:3269 for LDAP over SSL/TLS. If querying against a Global Catalog, the <span class="bold bold"><strong> <code class="code">referral</code> </strong></span> option of the Sysdig platform's LDAP configuration can remain at its default setting of <span class="bold bold"><strong> <code class="code">"IGNORE"</code> </strong></span>.</p><p>If a Global Catalog is not available, another approach is to leverage <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">referral chasing</a>. Such chasing depends on complex interplay of configuration settings, DNS resolution, and network connectivity to multiple servers. If you require this option, carefully read the tips in this section and validate your configuration in a test environment before attempting its use in production. Contact Sysdig support for assistance as necessary.</p><p>For our example configuration, we've added another Domain Controller to our environment that holds users a separate set of users for the child domain <span class="bold bold"><strong> <code class="code">eu.example.local</code> </strong></span>.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/15d5af4f4cfd8d.png" style="max-width: 600px; " alt="373574343.png"></img></td></tr></table></div><p>We'd like to permit login for a user "<span class="bold bold"><strong> <code class="code">eurodude</code> </strong></span>" in the child domain. This user has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=Euro Dude,CN=Users,DC=eu,DC=example,DC=local</pre><p>In the example configuration <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_referral_follow.json" target="_blank">settings_login_referral_follow.json</a> </code> </strong></span> shown below, the Sysdig platform still begins its LDAP queries at the same top-level server target. However, the <span class="bold bold"><strong> <code class="code">referrral</code> </strong></span> option is set to <span class="bold bold"><strong> <code class="code">"FOLLOW"</code> </strong></span>, which will cause the Sysdig platform to perform subsequent queries if a query returns one or more referrals.</p><pre class="programlisting">{
  "loginConnectionSettings": {
    "server": "ldap://172.16.0.1",
    "managerDn": "cn=Administrator,cn=Users,dc=example,dc=local",
    "managerPassword": "myMgrPassword",
    "referral": "FOLLOW"
  },
  "loginFilter": {
    "searchBase": "dc=example,dc=local",
    "searchFilter": "(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))"
  },
  "enableLdapAuthentication": true
}</pre><p>Note also how in this case the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> option is left unspecified and the <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> is set to the distinguished name of the top-level domain. This is necessary to ensure the scope of the chased referral queries will include the child domain. If <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> and <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> had been left as they were set in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> example, the initial query would have been targeted only within <span class="bold bold"><strong> <code class="code">cn=Users,dc=example,dc=local</code> </strong></span> and hence the referral would never have been returned by the top-level server.</p><p>Note these other caveats of referral chasing in the Sysdig platform:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Referrals may only be successfully chased to child domains. If referrals point to parallel domains (e.g. for our example, <span class="bold bold"><strong> <code class="code">dc=adjacent,dc=local</code> </strong></span>) the queries will not succeed and users stored in the directory servers for such domains will not be able to authenticate.</p></li><li class="listitem"><p>The LDAP library used by the Sysdig platform does not log information about each referral it attempts to chase. Therefore, if you enable referral chasing, it is important that you understand the server targets that may be chased in your environment and ensure the network connectivity (routing/firewalls) will permit the Sysdig platform to query these server targets. If LDAP queries are failing due to a network connectivity issue, this will typically be accompanied by delays during Sysdig user logins of approximately 30 seconds followed by a login failure with an <span class="bold bold"><strong> <code class="code">HTTP 504</code> </strong></span> error message shown in the login screen. If this occurs, contact Sysdig support for assistance.</p></li></ul></div><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-verifyuserTestingUserLogin" class="bridgehead">Testing User Login</h8><p>To test the login configuration, the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> can confirm if a particular user would be permitted to login given current LDAP login connection settings. To do this, perform an HTTP <span class="bold bold"><strong> <code class="code">GET</code> </strong></span> to the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings/verify/USERNAME</code> </strong></span>. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/verify_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">verify_user.sh</code> </strong></span> </a> helper script is provided to easily perform this. If invoked with the <span class="bold bold"><strong> <code class="code">-u</code> </strong></span> option and a username, and the user's login would be successful, it will return the user's information from the directory.</p><pre class="programlisting"># ./verify_user.sh -u jdoe
{"element":"uSNCreated=12799, countryCode=0, badPwdCount=0, whenChanged=20180406232737.0Z, objectClass=top, primaryGroupID=513, givenName=John, objectGUID=..., objectSid=..., instanceType=4, whenCreated=20180406220651.0Z, dSCorePropagationData=16010101000000.0Z, sn=Doe, userAccountControl=66048, lastLogonTimestamp=131675308573317669, cn=John Doe, codePage=0, accountExpires=9223372036854775807, sAMAccountName=jdoe, sAMAccountType=805306368, userPrincipalName=jdoe@example.local, displayName=John Doe, pwdLastSet=131675260113435098, lastLogon=131682933890462204, name=John Doe, objectCategory=CN=Person,CN=Schema,CN=Configuration,DC=example,DC=local, distinguishedName=CN=John Doe,CN=Users,DC=example,DC=local, lastLogoff=0, memberOf=CN=Sysdig Viewers,CN=Users,DC=example,DC=local, logonCount=0, uSNChanged=12986"}</pre><p>If the user would not be able to login, an error message will be returned.</p><pre class="programlisting"># ./verify_user.sh -u nothere
Could not verify user "nothere". Check LDAP login config settings and/or system log.</pre><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-CreatingLDAPUsersBeforeTheyLogin" class="bridgehead">Creating LDAP Users Before They Login</h8><p>The default behavior of the LDAP feature is to create a new record in the Sysdig user database when a user authenticates successfully via LDAP for the first time. However, it may be desirable to add such user records in advance of their first login, such as if you wish to use automation to change user permissions, assign team membership, or pre-populate Dashboard/Alert configurations. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/user_creation/create_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">create_user.sh</code> </strong></span> </a> helper script is available in the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/user_creation" target="_blank">sysdig-cloud-scripts</a> </code> </strong></span> repository to create such user records via the API. This script can also be used to enable/disable this functionality in the Sysdig platform. See the <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/blob/master/user_creation/README.md" target="_blank">README</a> for details.</p><p>Additional details regarding this type of user creation in conjunction with LDAP authentication:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method allows creation of <span class="italic italic">any</span> username, even if it doesn't currently exist in the directory that is queried via LDAP.</p></li><li class="listitem"><p>When LDAP authentication is enabled, such users can be created with a simple username (e.g. <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) or with an email-style postfix (as is typical for non-LDAP Sysdig user, e.g. <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span>). In this latter case only the username portion (<span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) is used when the Sysdig platform is performing an LDAP query during attempted login.</p></li><li class="listitem"><p>While the <span class="bold bold"><strong> <code class="code">password</code> </strong></span> must be included in the config you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to create the user, it is not used by the Sysdig platform when LDAP is enabled, as authentication will always be performed via LDAP. For this same reason, if a user has been created in this way, they will not be able to login unless there is a matching user in the directory that is queried via LDAP.</p></li><li class="listitem"><p>The <span class="bold bold"><strong> <code class="code">firstName</code> </strong></span> and <span class="bold bold"><strong> <code class="code">lastName</code> </strong></span> values as specified in the example are optional and independent from any equivalent name settings in the directory that is queried via LDAP.</p></li></ul></div><h8 id="UUID-03acfb71-84c8-1630-ba2a-33a97846daa2_id_LDAPAuthenticationConfigurationforPlatformv963-1091-limitationsLimitationsandCaveats" class="bridgehead">Limitations and Caveats</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP support has been tested with Active Directory in Windows Server 2012 R2. It may work with AD versions that ship with other versions of Windows, or other directory servers that use the LDAP protocol. If you are intending to use LDAP with something other than Active Directory, please contact Sysdig Support.</p></li><li class="listitem"><p>The LDAP feature is only present in Sysdig software platform installs (not the SaaS version).</p></li><li class="listitem"><p>Only one LDAP config can exist per deployment (i.e. the platform can only query one directory server endpoint).</p></li><li class="listitem"><p>Because the Sysdig software platform is based on the same technology as the SaaS-based Sysdig service, it theoretically supports the configuration of multiple “customers” using the same install. However, the multi-customer option is not supported when the LDAP feature is enabled.</p></li><li class="listitem"><p>When LDAP support is enabled, adding users via email "invites" is not possible.</p></li><li class="listitem"><p>LDAP authentication for directory usernames that begin or end with a space character (e.g. <span class="bold bold"><strong> <code class="code">" jdoe"</code> </strong></span> or <span class="bold bold"><strong> <code class="code">"jdoe "</code> </strong></span>) are not supported.</p></li><li class="listitem"><p>Configuration entries that contain special characters (for instance, a <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> that contains a backslash character) are supported, but note that you will need to perform proper JSON escaping in the configuration you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to the API. If you attempt to post invalid JSON, the helper scripts will return an error message. If this occurs, you can use tools such as <a class="link" href="https://jsonlint.com/" target="_blank">JSONLint</a> to narrow down the source of the problem and/or <a class="link" href="https://www.freeformatter.com/json-escape.html" target="_blank">JSON String Escape</a> to learn how to properly escape your text.</p></li><li class="listitem"><p>The LDAP feature does not attempt any ongoing “sync” back from the Sysdig platform user database to the directory server. Note how this impacts the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If a user is deleted from the directory server, their user record will remain in the Sysdig user database until a Sysdig Admin deletes it. Of course, that user will not be able to login since they will no longer be able to authenticate successfully via LDAP.</p></li><li class="listitem"><p>If an Admin deletes a user from the Sysdig user database, but the user can still authenticate successfully via LDAP, their Sysdig user record will be recreated if they login again via LDAP.</p></li><li class="listitem"><p>If a person’s username should change in the directory server (e.g. the value for <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in our examples above), the next time they login, a new user record will be created for them in the Sysdig user database. Settings they previously had in the Sysdig platform such as Admin rights and Alerts/Dashboard configurations will not be present for this recreated user.</p></li></ul></div></li><li class="listitem"><p>Other LDAP-centric functionality that is not currently supported (not an exhaustive list):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Mapping a user in the directory server to the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Sysdig "super" Admin</a> (such as to avoid the need to configure the this "super" Admin user).</p></li><li class="listitem"><p>Session expiry based on configuration in the directory server (such as to set a user account to only be valid until a certain date).</p></li><li class="listitem"><p>Login policies based on configuration in the directory server (such as to restrict login to certain hours).</p></li><li class="listitem"><p>User timeout functionality (such as to remove a user from the Sysdig user database if they have not logged in for a certain amount of time).</p></li></ul></div></li><li class="listitem"><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> for more guidance to assist with debugging or perfecting your LDAP configuration.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong> Introduction </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Summary of Functionality </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Upgrades - Migration of Settings </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Prerequisite: The "Super" Admin user </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Configuration of LDAP Authentication </strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <span class="bold bold"><strong> Group Membership Configuration (deprecated) </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Mutli-Server Directories </strong></span> </p></li></ul></div></li><li class="listitem"><p> <span class="bold bold"><strong> Testing User Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Creating LDAP Users Before They Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Limitations and Caveats </strong></span> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-940413ea-5ee4-2b2a-6709-a0a389bb276b" data-publication-date="" id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP Authentication Configuration (for Platform v. 890 - 925)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This article is specific to the LDAP support in the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/13598894/On-Premises+Deployments" target="_blank">On-Premises Deployments</a> of the Sysdig software platform version 890 through 925.</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>If you are running version 858 or older, refer to<span class="underline underline"> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00" title="LDAP Authentication Configuration (for Platform v. 858-)">this other article</a> </span> instead.</p></li><li class="listitem"><p>If you are running version 963 or newer, refer to <a class="link" href="33836-17626-on-premises-deployments.html#UUID-03acfb71-84c8-1630-ba2a-33a97846daa2" title="LDAP Authentication Configuration (for Platform v. 963 - 1091)">this other article</a> instead.</p></li></ul></div></div><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-Introduction" class="bridgehead">Introduction</h8><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig software platform allows user authentication using credentials in a customer’s own directory server.</p><p>This document describes how to configure LDAP authentication as well as its limitations.</p><p>LDAP can be complex to configure. Sysdig strongly recommends that you first refine your LDAP configuration in a separate test setup before applying the LDAP settings in your production environment. If you do not have a "development license" for test purposes or have misplaced your license information, contact <a class="link" href="mailto:billing@sysdig.com." target="_blank">billing@sysdig.com.</a> </p><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-SummaryofFunctionality" class="bridgehead">Summary of Functionality</h8><p>Independent of the LDAP feature, the Sysdig platform ordinarily maintains its own user database to hold not only a username and password hash but also settings for Admin privileges, Sysdig team membership, and a user’s configured Dashboards and Alerts. The LDAP feature provides a means to allow the Sysdig platform to query your separate directory server to validate username/password. Upon successful authentication, a corresponding user record in the Sysdig platform’s user database is automatically created. When the LDAP feature is in use, the user’s directory password is not stored in the Sysdig user database.</p><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-Upgrades-MigrationofSettings" class="bridgehead">Upgrades - Migration of Settings</h8><p> <span class="bold bold"><strong>Note: This section is only relevant if you have already been using LDAP support as it existed in Sysdig platform version 858 and earlier and are upgrading to version 890 or newer. If you are configuring LDAP for the first time and are running version 890 or newer, skip this section.</strong></span> </p><p>LDAP support in version 858 and older (as described in <a class="link" href="https://support.sysdig.com/hc/en-us/search/click?data=BAh7CjoHaWRsKwiWWLPGGgA6CXR5cGVJIgxhcnRpY2xlBjoGRVQ6CHVybEkiNy9oYy9lbi11cy9hcnRpY2xlcy8xMTUwMDI3OTIwODYtTERBUC1Db25maWd1cmF0aW9uBjsHVDoOc2VhcmNoX2lkSSIpZDE1ZGQxMWItY2ZiZi00MDk1LWJjMDQtYjE0OTIwZDc2YTA4BjsHRjoJcmFua2kG--abaacfd06263f6a8465b51bccad120b14588ae85" target="_blank">this article</a>) was configured exclusively via the Replicated console or <a class="link" href="">K8S ConfigMap</a>, depending on your installation type. This required the Sysdig platform to be restarted after any changes to the LDAP settings. When you upgrade your environment to version 890 or newer, your existing settings will be migrated to a new API-based configuration described below. The only LDAP-related settings that remain in the Replicated console are those to <span class="bold bold"><strong>Enable LDAP</strong></span> and to upload the optional <span class="bold bold"><strong>CA certificate</strong></span> for LDAPS connectivity. For K8S-based installs, you should leave the LDAP settings intact to ensure successful migration upon upgrade, but once running version 890 or newer, only <span class="bold bold"><strong> <code class="code">sysdigcloud.ldap.enabled</code> </strong></span> will be used and the other settings can be removed from your ConfigMap.</p><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-ConfigurationofLDAPAuthentication" class="bridgehead">Configuration of LDAP Authentication</h8><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-enablingEnablingtheLDAPFeature" class="bridgehead">Enabling the LDAP Feature</h8><p>Depending on your type of software install, the LDAP feature is enabled through the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/206519903-On-Premises-Install-Guide-Replicated-" target="_blank">Replicated console</a> or <a class="link" href="">K8S configuration</a>. This article will focus on the Replicated option.</p><p>LDAP is disabled by default and <span class="bold bold"><strong>once LDAP is enabled, it cannot be disabled</strong></span>.</p><p>To enable LDAP, first click the checkbox at the bottom of the Settings tab to expand the <span class="bold bold"><strong>Advanced Settings</strong></span>.</p><div class="mediaobject"><img src="image/15d5af4f4d7553.png" style="" alt="373574446.png"></img></div><p>Then click the checkbox at the bottom of the newly-opened section to <span class="bold bold"><strong>Enable LDAP</strong></span>. The <span class="bold bold"><strong>CA certificate</strong></span> is optional and only needed if you intend to use LDAPS (see the section below on <span class="bold bold"><strong> <code class="code"> loginConnectionSettings → server </code> </strong></span>).</p><div class="mediaobject"><img src="image/15d5af4f4dde09.png" style="" alt="373574441.png"></img></div><p>At this point if you click <span class="bold bold"><strong>Save</strong></span>, the Sysdig platform will restart and further LDAP settings can be configured via the Sysdig Admin API (see below).</p><p>In addition to the LDAP-specific sections of the <span class="bold bold"><strong>Settings</strong></span> page, note that the <span class="bold bold"><strong>Default user</strong></span> settings near the top of the page are also still required.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;"><tr style="height: 250px"><td><img src="image/15d5af4f4e49df.png" style="max-height: 250px; " alt="373574435.png"></img></td></tr></table></div><p>This represents the The <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> that will still login using an email address, bypassing LDAP. This user is required and cannot be deleted. This login provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A way to access the Sysdig platform when LDAP connectivity is severed.</p></li><li class="listitem"><p>The first Admin user in the install, essential for assigning Admin rights to other users once they’ve authenticated via LDAP and their user records have been added to the Sysdig user database.</p></li><li class="listitem"><p>The user whose <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> Token can be used to perform further LDAP configurations via the Sysdig platform API (see below).</p></li></ul></div><p>Once other LDAP-authenticated users have been promoted to Admins, those Admins can promote other LDAP-authenticated users to Admin, and so on.</p><p>Other local, non-LDAP users that were created before LDAP was enabled can still authenticate via LDAP as long as the username portion of their email address in the Sysdig user database matches their LDAP username. For example, consider a user <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> who had been a user in the environment before LDAP was enabled. Once LDAP is enabled, if a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> exists in the directory server and is able to authenticate successfully via LDAP, they will be permitted to log in to the Sysdig platform as the pre-existing <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> user. Any user-specific configuration (Alerts, Dashboards, etc.) that were attached to <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span> will still be visible to this user.</p><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-apiconfigFurtherLDAPConfigurationViaAPI" class="bridgehead">Further LDAP Configuration Via API</h8><p>Once the LDAP feature is enabled, the "super" Admin user can view, update, and delete LDAP settings via the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings</code> </strong></span> using HTTP methods for <span class="bold bold"><strong> <code class="code">GET</code> </strong></span>, <span class="bold bold"><strong> <code class="code">POST</code> </strong></span>, and <span class="bold bold"><strong> <code class="code">DELETE</code> </strong></span>, respectively.</p><p> <span class="bold bold"><strong>NOTE</strong></span>: See the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/205233166" target="_blank">REST API</a> page for general info on the API, and the the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Locating the "Super" Admin User</a> page for guidance on finding the token for the appropriate "super" Admin user.</p><p>A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/login_config.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">login_config</code> </strong></span> </a> helper script is available in a branch of the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/LDAP" target="_blank">sysdig-cloud-scripts</a> </code> </strong></span> repository for your use along with an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> that can be modified for your environment. Refer to the table below for details on config options. Example command-lines are shown below the table.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Section</p></th><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">server</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>URL of the directory server for the Sysdig platform to query. An example for LDAP over SSL/TLS:</p><p>ldaps://172.16.0.1:636</p><p>For cleartext LDAP:</p><p>ldap://176.16.0.1</p><p>Note that to use LDAPS, you'll also need to use the Replicated console to upload a Certificate Authority (CA) PEM-format certificate that the Sysdig platform will use to validate its SSL/TLS connection to the server. If you have a host with OpenSSL tools installed that can reach the directory server, you can obtain the certificate by running:</p><pre class="programlisting"># openssl s_client -showcerts -connect &lt;server-ip&gt;:636</pre><p>The command output will typically show the server certificate first and the CA certificate second, both in PEM format. Into a text file, paste the CA certificate portion of the output that looks like:</p><pre class="programlisting">-----BEGIN CERTIFICATE-----
[random text...]
-----END CERTIFICATE-----</pre><p>Under <span class="bold bold"><strong>CA certificate in the PEM format</strong></span> in the Replicated console, click the "Choose File" button and browse to the file you just created to select and upload it. Note that when you click <span class="bold bold"><strong>Save</strong></span>, the Sysdig platform will restart.</p><p>Note: For environments using self-signed certificates, the <span class="bold bold"><strong> <code class="code">openssl</code> </strong></span> command shown above will return only one certificate.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The distinguished name of a user that the Sysdig platform can authenticate as via LDAP in order to perform further queries about the users attempting to login to the Sysdig platform. Example:</p><pre class="programlisting">cn=Administrator,cn=Users,dc=example,dc=local</pre><p>This setting is required, as the Sysdig platform does not support connection to servers via anonymous bind.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The password for the <span class="bold bold"><strong> <code class="code">managerDn</code> </strong></span>.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginConnectionSettings</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>The distinguished name for the point in the LDAP tree below which all search queries will begin. Example:</p><pre class="programlisting">dc=example,dc=local</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchBase</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about users should be performed. If not specified, the search will be performed across everything below the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>. Example:</p><pre class="programlisting">cn=Users</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> </p></td><td class="td"><p>Yes</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify the user record. The marker token <span class="bold bold"><strong> <code class="code">{0}</code> </strong></span> represents where the username will appear when LDAP queries are constructed. An example that targets the attribute <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in Active Directory:</p><pre class="programlisting">(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))</pre></td></tr></tbody></table></div><p>To use the helper script, modify the <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/env.sh" target="_blank">env.sh</a> </code> </strong></span> to set the required values for <span class="bold bold"><strong> <code class="code">API_TOKEN</code> </strong></span> and <span class="bold bold"><strong> <code class="code">URL</code> </strong></span> for your environment. Once set, invoking <span class="bold bold"><strong> <code class="code">login_config</code> </strong></span> with no options will print the current configuration. If you were running Sysdig platform version 858 or older and have just upgraded to version 890 or newer, you will see your migrated settings. Otherwise the config will start out empty:</p><pre class="programlisting"># ./login_config
{
    "ldapSettings": {
        "allowApiUserCreation": false,
        "version": 1
    }
}</pre><p>To apply new LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option and specify the filename containing the JSON config. If successful, the applied configuration will be echoed back by the API.</p><pre class="programlisting"># ./login_config -s settings_login_simple.json
{"ldapSettings":{"version":2,"loginConnectionSettings":{"server":"ldap://172.16.0.1","rootDn":"dc=example,dc=local","managerDn":"cn=Administrator,cn=Users,dc=example,dc=local","managerPassword":"myMgrPassword"},"loginFilter":{"searchBase":"cn=Users","searchFilter":"(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))","groupSearchBase":"","groupSearchFilter":"","groupMembershipFilter":""},"allowApiUserCreation":false}}</pre><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_simple.json" target="_blank">settings_login_simple.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would be permitted for a user <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> that has <span class="bold bold"><strong> <code class="code">distinguishedName</code> </strong></span>:</p><pre class="programlisting">CN=John Doe,CN=Users,DC=example,DC=local</pre><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr style="height: 748px"><td><img src="image/15d5af4f4ecbe4.png" style="max-width: 1024px; max-height: 748px; " alt="373574429.png"></img></td></tr></table></div><p>To delete LDAP settings, invoke <span class="bold bold"><strong> <code class="code">login_config</code> </strong></span> with the <span class="bold bold"><strong> <code class="code">-d</code> </strong></span> option. <span class="bold bold"><strong>This should be used with caution, as this will prevent all LDAP users from being able to login to the Sysdig platform!</strong></span> </p><pre class="programlisting"># ./login_config -d
{"ldapSettings":{"version":3,"allowApiUserCreation":false}}</pre><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-GroupMembershipConfigurationdeprecated" class="bridgehead">Group Membership Configuration (deprecated)</h8><p>The LDAP feature as it existed in version 858 and earlier included optional additional settings that, when specified, ensured that authenticated users were also members of one or more groups before permitting them to login to the Sysdig platform. These settings are documented here for the benefit of those who used these settings in the past and have had their settings migrated to the newer API-based configuration. See below for details on how to use the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span> instead to achieve equivalent functionality.</p><p>For use with the <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/login_config.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">login_config</code> </strong></span> </a> helper script, an example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> is provided that can be modified for your environment based on the table below. Example command-lines are shown below the table.</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Section</p></th><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchBase</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong> <code class="code">rootDn</code> </strong></span>) below which queries about groups should be performed. Example:</p><pre class="programlisting">ou=Planets</pre></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupSearchFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify a group to which the user must belong. An example that only permits users that are in the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group in Active Directory:</p><pre class="programlisting">(&amp;(cn=Mars)(objectclass=group))</pre><p>If this setting is left blank, group membership is not required, and hence any user that successfully authenticates via LDAP using only username/password will be permitted to login to the Sysdig platform.</p></td></tr><tr><td class="td"><p> <span class="bold bold"><strong> <code class="code">loginFilter</code> </strong></span> </p></td><td class="td"><p> <span class="bold bold"><strong> <code class="code">groupMembershipFilter</code> </strong></span> </p></td><td class="td"><p>No</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use to determine group membership. If no setting is specified, the following default filter is applied, which should work for most environments:</p><pre class="programlisting">(| (member={0}) (uniqueMember={0}) (memberUid={1}))</pre></td></tr></tbody></table></div><p>Using the specific example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span> and the minimal Active Directory configuration in the screenshot below, login to the Sysdig platform would be permitted for this user who belongs to the <span class="bold bold"><strong> <code class="code">Mars</code> </strong></span> group.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr style="height: 748px"><td><img src="image/15d5af4f501fd3.png" style="max-width: 1024px; max-height: 748px; " alt="373574423.png"></img></td></tr></table></div><p>But our previous <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span> user who is not a member would be prevented from logging in.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="800px"><tr style="height: 635px"><td><img src="image/15d5af4f50a3c8.png" style="max-width: 800px; max-height: 635px; " alt="373574417.png"></img></td></tr></table></div><p>To simplify your configuration and avoid use of these deprecated options, an equivalent configuration can be achieved by making the group membership part of the <span class="bold bold"><strong> <code class="code">searchFilter</code> </strong></span>:</p><pre class="programlisting">"searchFilter": "(&amp;(memberOf=CN=Mars,OU=Planets,DC=example,DC=local)(objectClass=organizationalPerson)(sAMAccountName={0}))"</pre><p>See the example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group.json" target="_blank">settings_login_group.json</a> </code> </strong></span> for an updated configuration that can be compared side-by-side with <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/settings_login_group_deprecated.json" target="_blank">settings_login_group_deprecated.json</a> </code> </strong></span>.</p><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-verifyuserTestingUserLogin" class="bridgehead">Testing User Login</h8><p>To test the login configuration, the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">"super" Admin user</a> can confirm if a particular user would be permitted to login given current LDAP login connection settings. To do this, perform an HTTP <span class="bold bold"><strong> <code class="code">GET</code> </strong></span> to the API endpoint <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings/verify/USERNAME</code> </strong></span>. A <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/master/LDAP/verify_user.sh" target="_blank"> <span class="bold bold"><strong> <code class="code">verify_user</code> </strong></span> </a> helper script is provided to easily perform this. If invoked with the <span class="bold bold"><strong> <code class="code">-u</code> </strong></span> option and a username, and the user's login would be successful, it will return the user's information from the directory.</p><pre class="programlisting"># ./verify_user -u jdoe
{"element":"uSNCreated=12799, countryCode=0, badPwdCount=0, whenChanged=20180406232737.0Z, objectClass=top, primaryGroupID=513, givenName=John, objectGUID=..., objectSid=..., instanceType=4, whenCreated=20180406220651.0Z, dSCorePropagationData=16010101000000.0Z, sn=Doe, userAccountControl=66048, lastLogonTimestamp=131675308573317669, cn=John Doe, codePage=0, accountExpires=9223372036854775807, sAMAccountName=jdoe, sAMAccountType=805306368, userPrincipalName=jdoe@example.local, displayName=John Doe, pwdLastSet=131675260113435098, lastLogon=131682933890462204, name=John Doe, objectCategory=CN=Person,CN=Schema,CN=Configuration,DC=example,DC=local, distinguishedName=CN=John Doe,CN=Users,DC=example,DC=local, lastLogoff=0, memberOf=CN=Sysdig Viewers,CN=Users,DC=example,DC=local, logonCount=0, uSNChanged=12986"}</pre><p>If the user would not be able to login, an error message will be returned.</p><pre class="programlisting"># ./verify_user -u nothere
Could not verify user "nothere". Check LDAP login config settings and/or system log.</pre><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-CreatingLDAPUsersBeforeTheyLogin" class="bridgehead">Creating LDAP Users Before They Login</h8><p>The default behavior of the LDAP feature is to create a new record in the Sysdig user database when a user authenticates successfully via LDAP for the first time. However, it may be desirable to add such user records in advance of their first login, such as if you wish to use automation to change user permissions, assign team membership, or pre-populate Dashboard/Alert configurations.</p><p>To enable this option, <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> the following top-level config element to <span class="bold bold"><strong> <code class="code">/api/admin/ldap/settings</code> </strong></span> with your other LDAP settings. A complete example config including this element is provided at <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/a2f6da32df3f99e72bac63df921e502d8d7c0d33/user_creation/create_user.sh" target="_blank">settings_login_with_user_create.json</a> </code> </strong></span>.</p><pre class="programlisting">"allowApiUserCreation": true</pre><p>Once this option is enabled, to create a user, invoke the provided helper script <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/a2f6da32df3f99e72bac63df921e502d8d7c0d33/user_creation/create_user.sh" target="_blank">create_user</a> </code> </strong></span>, with the <span class="bold bold"><strong> <code class="code">-s</code> </strong></span> option and specify a filename containing user information, such as the provided example <span class="bold bold"><strong> <code class="code"> <a class="link" href="https://raw.githubusercontent.com/draios/sysdig-cloud-scripts/a2f6da32df3f99e72bac63df921e502d8d7c0d33/user_creation/create_user.sh" target="_blank">settings_user_create.json</a> </code> </strong></span>. If successful, details about the created user record will be echoed back by the API.</p><pre class="programlisting"># ./create_user -s settings_user_create.json
{"user":{"id":7,"version":0,"username":"msmith","enabled":true,"firstName":"Mary","lastName":"Smith","status":"confirmed","termsAndConditions":true,"pictureUrl":"http://www.gravatar.com/avatar/6b17d2b356172c9966690ce93f66e8dd","dateActivated":1523405703283,"properties":{},"customerSettings":{"sysdig":{"enabled":false,"buckets":[]},"plan":{"maxAgents":1000,"onDemandAgents":0,"maxTeams":-1,"timelines":[{"from":null,"to":null,"sampling":10000000},{"from":null,"to":null,"sampling":60000000},{"from":null,"to":null,"sampling":600000000},{"from":null,"to":null,"sampling":3600000000},{"from":null,"to":null,"sampling":86400000000}],"metricsSettings":{"enforce":false,"limits":{"jmx":200,"statsd":200,"appCheck":200,"prometheus":200,"progAggregationCount":12}},"secureEnabled":false,"allocatedAgentsCount":1000,"paymentsIntegrationId":{"id":"not migrated","ttl":{"ttl":50}},"pricingPlan":"basic","overageAssessmentEligible":false}},"customer":{"id":1,"version":0,"name":"","accessKey":"1ca2a53d-e102-46a2-aec7-851426ce3c61","lastUpdated":1523391582000,"dateCreated":1523391582000},"timezone":"+00:00","systemRole":"ROLE_USER","agentInstallParams":{"collectorAddress":"172.31.6.227","accessKey":"1ca2a53d-e102-46a2-aec7-851426ce3c61","collectorPort":6443,"checkCertificate":true},"oauth":false,"resetPassword":false,"accessKey":"1ca2a53d-e102-46a2-aec7-851426ce3c61","dateCreated":1523405703311,"teamRoles":[{"userId":7,"teamId":1,"role":"ROLE_TEAM_EDIT"}]}}</pre><p>Additional details regarding this type of user creation:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="bold bold"><strong> <code class="code">customer id</code> </strong></span> of <span class="bold bold"><strong> <code class="code">1</code> </strong></span> specified in the example is typical for most Sysdig software platform installations, but may be different (rarely) in some enviornments. See <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115005848823-Your-Customer-Number" target="_blank">this article</a> for info on how to confirm.</p></li><li class="listitem"><p>This method allows creation of <span class="italic italic">any</span> user, even if it doesn't actually exist in the directory that is queried via LDAP.</p></li><li class="listitem"><p>Such users can be created with a simple username (e.g. <span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) or with an email-style postfix (as is typical for non-LDAP Sysdig user, e.g. <span class="bold bold"><strong> <code class="code">jdoe@example.com</code> </strong></span>). In this latter case only the username portion (<span class="bold bold"><strong> <code class="code">jdoe</code> </strong></span>) is used when the Sysdig platform is performing an LDAP query during attempted login.</p></li><li class="listitem"><p>While the <span class="bold bold"><strong> <code class="code">password</code> </strong></span> must be included in the config you <span class="bold bold"><strong> <code class="code">POST</code> </strong></span> to create the user, it is not used by the Sysdig platform, as authentication will always be performed via LDAP. For this same reason, if a user has been created in this way, they will not be able to login unless there is a matching user in the directory that is queried via LDAP.</p></li><li class="listitem"><p>The <span class="bold bold"><strong> <code class="code">firstName</code> </strong></span> and <span class="bold bold"><strong> <code class="code">lastName</code> </strong></span> values as specified in the example are optional and independent from any equivalent name settings in the directory that is queried via LDAP.</p></li></ul></div><h8 id="UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0_id_LDAPAuthenticationConfigurationforPlatformv890-925-limitationsLimitationsandCaveats" class="bridgehead">Limitations and Caveats</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP support has been tested with Active Directory in Windows Server 2012 R2. It may work with AD versions that ship with other versions of Windows, or other directory servers that use the LDAP protocol. If you are intending to use LDAP with something other than Active Directory, please contact Sysdig Support.</p></li><li class="listitem"><p>The LDAP feature is only present in Sysdig software platform installs (not the SaaS version).</p></li><li class="listitem"><p>LDAP support cannot be disabled once enabled.</p></li><li class="listitem"><p>Only one LDAP config can exist per deployment (i.e. the platform can only query one directory server endpoint).</p></li><li class="listitem"><p>Because the Sysdig software platform is based on the same technology as the SaaS-based Sysdig service, it theoretically supports the configuration of multiple “customers” using the same install. However, the multi-customer option is not supported when the LDAP feature is enabled.</p></li><li class="listitem"><p>When LDAP support is enabled, adding users via email "invites" is not possible.</p></li><li class="listitem"><p>LDAP authentication for directory usernames that begin or end with a space character (e.g. <span class="bold bold"><strong> <code class="code">" jdoe"</code> </strong></span> or <span class="bold bold"><strong> <code class="code">"jdoe "</code> </strong></span>) are not supported.</p></li><li class="listitem"><p>Configuration entries that contain special characters (for instance, a <span class="bold bold"><strong> <code class="code">managerPassword</code> </strong></span> that contains a backslash character) are supported, but note that you will need to perform proper JSON escaping. If you attempt to post invalid JSON, the helper scripts will return an error message, at which point you can use tools such as <a class="link" href="https://jsonlint.com/" target="_blank">JSONLint</a> to narrow down the source of the problem and/or <a class="link" href="https://www.freeformatter.com/json-escape.html" target="_blank">JSON String Escape</a> to learn how to properly escape your text.</p></li><li class="listitem"><p>The LDAP feature does not attempt any ongoing “sync” back from the Sysdig platform user database to the directory server. Note how this impacts the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If a user is deleted from the directory server, their user record will remain in the Sysdig user database until a Sysdig Admin deletes it. Of course, that user will not be able to login since they will no longer be able to authenticate successfully via LDAP.</p></li><li class="listitem"><p>If an Admin deletes a user from the Sysdig user database, but the user can still authenticate successfully via LDAP, their Sysdig user record will be recreated if they login again via LDAP.</p></li><li class="listitem"><p>If a person’s username should change in the directory server (e.g. the value for <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in our examples above), the next time they login, a new user record will be created for them in the Sysdig user database. Settings they previously had in the Sysdig platform such as Admin rights and Alerts/Dashboard configurations will not be present for this recreated user.</p></li></ul></div></li><li class="listitem"><p>Other LDAP-centric functionality that is not currently supported (not an exhaustive list):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>The Sysdig platform does not <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">chase referrals</a> found in LDAP query responses.</p></li><li class="listitem"><p>Mapping a user in the directory server to the <a class="link" href="https://support.sysdig.com/hc/en-us/articles/115004951443-Locating-the-Super-Admin-User" target="_blank">Sysdig "super" Admin</a> (such as to avoid the need to configure the this "super" Admin user).</p></li><li class="listitem"><p>Session expiry based on configuration in the directory server (such as to set a user account to only be valid until a certain date).</p></li><li class="listitem"><p>Login policies based on configuration in the directory server (such as to restrict login to certain hours).</p></li><li class="listitem"><p>User timeout functionality (such as to remove a user from the Sysdig user database if they have not logged in for a certain amount of time).</p></li></ul></div></li><li class="listitem"><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> for more guidance to assist with debugging or perfecting your LDAP configuration.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong> Introduction </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Summary of Functionality </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Upgrades - Migration of Settings </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Configuration of LDAP Authentication </strong></span> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <span class="bold bold"><strong> Enabling the LDAP Feature </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Further LDAP Configuration Via API </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Group Membership Configuration (deprecated) </strong></span> </p></li></ul></div></li><li class="listitem"><p> <span class="bold bold"><strong> Testing User Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Creating LDAP Users Before They Login </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Limitations and Caveats </strong></span> </p></li></ul></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-cb249e13-09ef-e1f0-92c2-f9c349d65dc4" data-publication-date="" id="UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00"><div class="titlepage"><div><div class="title"><h6 class="title">LDAP Authentication Configuration (for Platform v. 858-)</h6></div></div></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>This article is specific to LDAP support in <a class="link" href="33836-17626-on-premises-deployments.html" title="On-Premises Deployments">On-Premises Deployments</a> of the Sysdig software platform version 858 and earlier.</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>If you are running version 963 or newer, refer to <a class="link" href="33836-17626-on-premises-deployments.html#UUID-03acfb71-84c8-1630-ba2a-33a97846daa2" title="LDAP Authentication Configuration (for Platform v. 963 - 1091)">this other article</a> instead.</p></li><li class="listitem"><p>If you are running versions 890 through 925, refer to<span class="underline underline"> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-7213565c-fa4c-7bf1-dfa0-ff12f8ab2bb0" title="LDAP Authentication Configuration (for Platform v. 890 - 925)">this other article</a> </span> instead.</p></li></ul></div></div><h8 id="UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00_id_LDAPAuthenticationConfigurationforPlatformv858--Introduction" class="bridgehead">Introduction</h8><p> <a class="link" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank">LDAP</a> support in the Sysdig platform allows authentication to an on-premises install of Sysdig software using credentials in a customer’s own directory server. This document describes how to configure the feature as well as its limitations.</p><h8 id="UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00_id_LDAPAuthenticationConfigurationforPlatformv858--SummaryofFunctionality" class="bridgehead">Summary of Functionality</h8><p>Independent of the LDAP feature, the Sysdig platform ordinarily maintains its own user database to hold not only a username and password hash but also settings for Admin privileges, Team membership, and a user’s configured Dashboards and Alerts. The LDAP feature provides a means to allow the Sysdig platform to query the customer’s own directory server to validate username/password and (optionally) confirm that the user is a member of one or more groups. Upon successful authentication, a corresponding user record in the Sysdig platform's user database is automatically created. When the LDAP feature is in use, the user’s password is not stored in the Sysdig platform user database.</p><h8 id="UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00_id_LDAPAuthenticationConfigurationforPlatformv858--Configuration" class="bridgehead">Configuration</h8><p>The LDAP feature is configured through the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/204767355/Sysdig+and+Replicated+Client+Install" target="_blank">Replicated on-premise install option</a>. It is disabled by default and, <span class="underline underline"> <span class="bold bold"><strong>once LDAP is enabled, it cannot be disabled</strong></span> </span>.</p><p>To enable LDAP, first click the checkbox at the bottom of the Settings tab to expand the <span class="bold bold"><strong>Advanced Settings</strong></span>:</p><div class="mediaobject"><img src="image/15d5af4f511318.png" style="" alt="373574528.png"></img></div><p>Then click the checkbox at the bottom of the newly-opened section to <span class="bold bold"><strong>Enable LDAP</strong></span>:</p><div class="mediaobject"><img src="image/15d5af4f51807f.png" style="" alt="373574522.png"></img></div><p>When expanded, the following options are revealed:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="767px"><tr><td><img src="image/15d5af4f51ea5d.png" style="max-width: 767px; " alt="373574515.png"></img></td></tr></table></div><p>Configure the settings as follows:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Setting</p></th><th class="th"><p>Required</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p>Server endpoint</p></td><td class="td"><p>yes</p></td><td class="td"><p>URL of the directory server for the Sysdig platform to query.</p><p>An example for LDAP over SSL/TLS:</p><pre class="programlisting">ldaps://172.16.0.1:636</pre><p>For cleartext LDAP:</p><pre class="programlisting">ldap://176.16.0.1</pre></td></tr><tr><td class="td"><p>CA certificate in PEM format</p></td><td class="td"><p>for SSL/TLS</p></td><td class="td"><p>Click to upload a file containing the Certificate Authority (CA) <a class="link" href="https://en.wikipedia.org/wiki/Privacy-enhanced_Electronic_Mail" target="_blank">PEM-format certificate</a> that the Sysdig platform will use to validate its SSL/TLS connection to the server. If you have a host with OpenSSL tools installed that can reach the directory server, you can obtain the certificate by running:</p><pre class="programlisting"># openssl s_client -showcerts -connect &lt;server-ip&gt;:636</pre></td></tr><tr><td class="td"><p>DN manager</p></td><td class="td"><p>yes</p></td><td class="td"><p>The distinguished name of a user that the Sysdig platform can authenticate as via LDAP in order to perform further queries about the users attempting to login to Sysdig applications. Example:</p><pre class="programlisting">CN=servicer_acccount,OU=Service accounts,DC=demo,DC=com</pre><p>This setting is required, as the Sysdig platform does not support connection to servers via anonymous bind.</p></td></tr><tr><td class="td"><p>Manager password</p></td><td class="td"><p>yes</p></td><td class="td"><p>The password for the DN manager.</p></td></tr><tr><td class="td"><p>Root DN</p></td><td class="td"><p>yes</p></td><td class="td"><p>The distinguished name for the point in the LDAP tree below which all search queries will begin. Example:</p><pre class="programlisting">DC=demo,DC=com</pre></td></tr><tr><td class="td"><p>User search base</p></td><td class="td"><p>no</p></td><td class="td"><p>A relative distinguished name (from the Root DN) below which queries about users should be performed.</p><p>If not specified, the search will be performed across everything below the Root DN.</p><p>Example:</p><pre class="programlisting">CN=Users</pre></td></tr><tr><td class="td"><p>User search filter</p></td><td class="td"><p>yes</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use in constructing the query to identify the user record. The marker token <span class="bold bold"><strong> <code class="code">{0}</code> </strong></span> represents where the Sysdig platform will place the username when it constructs its LDAP queries. An example that targets the attribute <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in Active Directory:</p><pre class="programlisting">(&amp;(objectClass=organizationalPerson)(sAMAccountName={0}))</pre></td></tr><tr><td class="td"><p>Group search base</p></td><td class="td"><p>no</p></td><td class="td"><p>A relative distinguished name (from the <span class="bold bold"><strong>Root DN</strong></span>) below which queries about groups should be performed. Example:</p><pre class="programlisting">OU=Groups</pre></td></tr><tr><td class="td"><p>Group search filter</p></td><td class="td"><p>no</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform may use in constructing the query to identify a group to which the user must belong. An example that only permits users that are in the superusers group in Active Directory:</p><pre class="programlisting">(&amp;(cn=superusers)(objectclass=group))</pre><p>To permit users that are in the superusers group OR the devops group:</p><pre class="programlisting">(&amp;(|(cn=devops)(cn=superusers))(objectclass=group))</pre><p>However, AND logic to require membership in all of several groups is not currently supported</p><p>If this setting is left blank, group membership is not required, and hence any user that successfully authenticates via username/password will be permitted to login to your Sysdig application(s).</p></td></tr><tr><td class="td"><p>Group membership IP filter</p></td><td class="td"><p>no</p></td><td class="td"><p>An LDAP search filter (in <a class="link" href="https://www.ietf.org/rfc/rfc2254.txt" target="_blank">RFC2254</a> format) that the Sysdig platform will use to determine group membership. If no setting is specified, a default filter of <span class="bold bold"><strong> <code class="code">(| (member={0}) (uniqueMember={0}) (memberUid={1}))</code> </strong></span> is applied, which should work for most environments.</p></td></tr></tbody></table></div><p>In addition to the LDAP-specific sections of the <span class="bold bold"><strong>Settings</strong></span> page, note that the <span class="bold bold"><strong>Default user</strong></span> settings near the top of the page are also still required.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="554px"><tr><td><img src="image/15d5af4f52519e.png" style="max-width: 554px; " alt="373574508.png"></img></td></tr></table></div><p>This represents the only local user that will still login using an email address, bypassing LDAP, also known as the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">"super" Admin</a>. This user is required and cannot be deleted. This login provides a way to access your Sysdig application(s) when LDAP connectivity is severed. This user is also the first Admin user in the install and therefore essential for assigning Admin rights to other users once they’ve authenticated via LDAP and their user records have been added in the Sysdig platform user database. Once other LDAP-authenticated users have been promoted to Admins, those Admins can promote other LDAP-authenticated users to Admin, and so on.</p><p>Other local, non-LDAP users that were created before LDAP was enabled can still authenticate via LDAP as long as the username portion of their email address in the Sysdig platform user database matches their LDAP username. For example, consider a user <span class="bold bold"><strong> <code class="code">johndoe@example.com</code> </strong></span> who had been a user in the environment before LDAP was enabled. Once LDAP is enabled, if a user <span class="bold bold"><strong> <code class="code">johndoe</code> </strong></span> exists in the directory server and is able to authenticate successfully via LDAP, they will be permitted to log in to your Sysdig application(s) as the pre-existing <span class="bold bold"><strong> <code class="code">johndoe@example.com</code> </strong></span> user. Any user-specific configuration (Alerts, Dashboards, etc.) that were attached to <span class="bold bold"><strong> <code class="code">johndoe@example.com</code> </strong></span> will still be visible to this user.</p><h8 id="UUID-37d0430d-8daa-1cf9-1d0d-c9921b50ca00_id_LDAPAuthenticationConfigurationforPlatformv858--LimitationsandCaveats" class="bridgehead">Limitations and Caveats</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LDAP support has been tested with <a class="link" href="https://en.wikipedia.org/wiki/Active_Directory" target="_blank">Active Directory</a> in Windows Server 2012 R2. It may work with AD versions that ship with other versions of Windows, or other directory servers that use the LDAP protocol.</p></li><li class="listitem"><p>The LDAP feature as it exists in version version 858 and earlier of the Sysdig platform will always <a class="link" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc978014(v=technet.10)" target="_blank">chase referrals</a> found in LDAP query responses. If your directory is partitioned, ensure all necessary routing and/or firewall settings are present to permit the Sysdig platform backend to contact all directory servers that may be referral destinations.</p></li><li class="listitem"><p>The LDAP feature is only present in on-premise installs (not the SaaS versions of Sysdig Monitor/Sysdig Secure).</p></li><li class="listitem"><p>LDAP support cannot be disabled once enabled.</p></li><li class="listitem"><p>Only one LDAP config can exist per deployment (i.e. can only query one directory server endpoint).</p></li><li class="listitem"><p>Because the on-premise Sysdig platform is based on the same technology as the SaaS-based applications, it theoretically supports the configuration of multiple “customers” using the same install. However, the multi-customer option is not supported when the LDAP feature is enabled.</p></li><li class="listitem"><p>When LDAP support is enabled, other means of adding/validating users (e.g. sending “invites” to users, or e-mail verification) are not possible.</p></li><li class="listitem"><p>The LDAP feature does not attempt any ongoing “sync” back from the Sysdig platform user database to the directory server. Note how this impacts the following:</p></li><li class="listitem"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If a user is deleted from the directory server, their user record will remain in the Sysdig platform user database until a Sysdig Admin deletes it. Of course, that user will not be able to login since they will no longer be able to authenticate successfully via LDAP.</p></li><li class="listitem"><p>If a Sysdig Admin deletes a user from the Sysdig platform user database, but the user can still authenticate successfully via LDAP, their Sysdig platform user record will be recreated if they login again via LDAP.</p></li><li class="listitem"><p>If a person’s username should change in the directory server (e.g. the value for <span class="bold bold"><strong> <code class="code">sAMAccountName</code> </strong></span> in our example config table above), the next time they login, a new user record will be created for them in the Sysdig platform user database. In addition to user settings such as Admin rights, any Alerts or Dashboards attached to the prior username will not be visible.</p></li></ul></div></li><li class="listitem"><p>Other LDAP-centric functionality that is not currently supported (not an exhaustive list);</p></li><li class="listitem"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Mapping a user in the directory server the <a class="link" href="33836-17626-on-premises-deployments.html#UUID-529c0b1e-1b39-96e9-858c-affd619f2964" title="Find the Super Admin Credentials and API Token">"super" Admin</a> (such as to avoid the need to configure the one local <span class="bold bold"><strong>Default user</strong></span>).</p></li><li class="listitem"><p>Mapping groups in the directory server to Sysdig Teams.</p></li><li class="listitem"><p>Session expiry based on configuration in the directory server (such as to set a user account to only be valid until a certain date).</p></li><li class="listitem"><p>Login policies based on configuration in the directory server (such as to restrict login to certain hours).</p></li><li class="listitem"><p>User timeout functionality (such as to remove a user from the Sysdig platform user database if they have not logged in for a certain amount of time).</p></li></ul></div></li><li class="listitem"><p>See <a class="link" href="33836-17626-on-premises-deployments.html#UUID-269b5cad-7d46-efdc-deff-e6af8c044208" title="General LDAP Tips">General LDAP Tips</a> for more guidance to assist with debugging or perfecting your LDAP configuration.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold bold"><strong> Introduction </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Summary of Functionality </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Configuration </strong></span> </p></li><li class="listitem"><p> <span class="bold bold"><strong> Limitations and Caveats </strong></span> </p></li></ul></div></section></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-86ef3d03-037d-7aac-2390-c43096ed0cde" data-publication-date="" id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb"><div class="titlepage"><div><div class="title"><h5 class="title">**Backup and Restore Best Practices**</h5></div></div></div><p>See <a class="link" href="https://sysdig.atlassian.net/browse/DOC-84" target="_blank">https://sysdig.atlassian.net/browse/DOC-84</a> </p><p>Shixiong, Adam D, Benedetto</p><p>Reference docs:</p><p> <a class="link" href="https://sysdig.atlassian.net/wiki/spaces/~469113433/pages/741965895/Supported+backup+restore+process" target="_blank">https://sysdig.atlassian.net/wiki/spaces/~469113433/pages/741965895/Supported+backup+restore+process</a> </p><p> <a class="link" href="https://sysdig.atlassian.net/wiki/spaces/IB/pages/595625030/MySql+DB+dump+and+restore" target="_blank">https://sysdig.atlassian.net/wiki/spaces/IB/pages/595625030/MySql+DB+dump+and+restore</a> </p><p> <a class="link" href="https://sysdigcloud.slack.com/archives/GDV2ECHMK/p1544721035004800" target="_blank">https://sysdigcloud.slack.com/archives/GDV2ECHMK/p1544721035004800</a> </p><p>Overview</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-CassandraElasticsearch" title="Cassandra/Elasticsearch">Cassandra/Elasticsearch </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup" title="Backup">Backup</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore" title="Restore">Restore</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-MySQLCluster" title="MySQL Cluster">MySQL Cluster </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup1" title="Backup">Backup</a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore1" title="Restore">Restore</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-AWSCMD" title="AWS CMD">AWS CMD </a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup2" title="Backup">Backup </a> </p></li><li class="listitem"><p> <a class="link" href="33836-17626-on-premises-deployments.html#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore2" title="Restore">Restore</a> </p></li></ul></div></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-CassandraElasticsearch"><div class="titlepage"><div><div class="title"><h6 class="title">Cassandra/Elasticsearch</h6></div></div></div><p>Volume snapshots based backup/restore is strongly recommended Cassandra/Elasticsearch backend clusters. Snapshot should be taken for each Cassandra/Elasticsearch pod individually in each zones.</p><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup" class="bridgehead">Backup</h6><p>Step 1: Obtain a list of Cassandra/Elasticsearch pods</p><p>Step 2: Create a list of mounted/attached volumes for all Cassandra/Elasticsearch pods</p><p>Step 3: Identify the matching block storage volume for each pod</p><p>Step 4: Use existing tools to set up scheduled (incremental) snapshot for each block storage volume</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Hourly</p></li><li class="listitem"><p>Daily</p></li><li class="listitem"><p>Monthly</p></li></ul></div><p>Step 5: In addition, consider manual snapshot automated by scripts</p><p>Step 6: Delete or archive old snapshots if needed</p><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore" class="bridgehead">Restore</h6><p>Step 1: Check the list of available volume snapshots for a Cassandra/Elasticsearch pod</p><p>Step 2: Choose which snapshot should be used to restore the pod</p><p>Step 3: Use existing tools to create a new block volume based on the snapshot</p><p>Step 4: Create a new Kubernetes Persistent Volume (PV)</p><p>Step 5: Delete the existing Kubernetes PV</p><p>Step 6: Delete the existing Kubernetes Persistent Volume Claim</p><p>Step 7: Delete the existing pod</p><p>Step 8: Make sure the newly launched pod is bound to the new Kubernetes Persistent Volume</p><p>Step 9: Check logs to ensure the pod rejoins the cluster</p><p>Step 10: Use Cassandra/Elasticsearch commands to make sure the cluster is still healthy status</p><p>Step 11*: Repeat Step 1 to Step 9 if more than one pods need to be recovered</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p> <span class="bold bold"><strong>ONLY ONE POD SHOULD BE RECOVERED AT ANY GIVEN TIME</strong></span> </p></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-MySQLCluster"><div class="titlepage"><div><div class="title"><h6 class="title">MySQL Cluster</h6></div></div></div><p>Volume snapshot-based backup/restore may not be the best choice for the MySQL cluster used by Sysdig system. Recovering each pod individually based on snapshots may potentially cause data out-of-sync while MySQL is still being used by Sysdig applications.</p><p>However, It is quite common for a MySQL administrator to use native tools such as mysqldump to perform a full database backup at once. Mysqldump is also a powerful tool to restore the entire MySQL cluster. However, this approach may potentially lead to data loss during the switchover.</p><p>&lt;SO, WHAT SHOULD PEOPLE ACTUALLY DO TO BACKUP AND NOT LOSE DATA?&gt;</p><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup1" class="bridgehead">Backup</h6><p>Step 1: Obtain a list of MySQL pods</p><p>Step 2: Set up cron job to backup MySQL databases by mysqldump command</p><p>Step 3: Delete or archive old mysqldump files if needed</p><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore1" class="bridgehead">Restore</h6><p>Step 1: Create a NEW MySQL cluster with the same configuration as the existing one</p><p>Step 2: Check the list of available mysqldump files</p><p>Step 3: Determine which mysqldump files should be used to restore MySQL cluster</p><p>Step 4: Use mysqldump tool to restore MySQL data on the pod with Master (i.e. R/W) in the NEW cluster</p><p>Step 5: Use MySQL commands to make sure the new cluster is in healthy state</p><p>Step 6: Switch MySQL service from the OLD MySQL cluster to the NEW one</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-AWSCMD"><div class="titlepage"><div><div class="title"><h6 class="title">AWS CMD</h6></div></div></div><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Backup2" class="bridgehead">Backup</h6><h6 id="UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-Restore2" class="bridgehead">Restore</h6></section></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-6beb0149-6f48-f422-2293-f423ba246e92">On-Premises Deployments</a></li><li><a href="#UUID-6beb0149-6f48-f422-2293-f423ba246e92_id_On-PremisesDeployments-Contents">Contents</a></li><li><a href="#UUID-8faaeb82-7c97-a3ba-6744-f96ff4827430">Architecture &amp; System Requirements</a><ul class="nav"><li><a href="#UUID-497a9bf0-df44-a664-aa1f-09340e104bcd">Architecture</a></li><li><a href="#UUID-dcda5bd8-4506-5117-92d2-bc2abe1e056f">Supported Configurations</a></li><li><a href="#UUID-f4680579-0bb3-2f1f-dfc8-930b303f332a">Hardening and Securing User Passwords</a></li><li><a href="#UUID-9365be32-ac6f-00b4-a2ae-fcf35617e6a8">Software Sizing Tips</a></li><li><a href="#UUID-0209f6e2-369c-e1e1-8a29-d254a77fb071">Installation Options</a></li></ul></li><li><a href="#UUID-9765e37a-1be5-8950-2c73-a5c79fb7eed0">On-Premises Installation</a><ul class="nav"><li><a href="#UUID-dd93fb9d-c7a0-c09e-2a90-7989c76f872e">Sysdig Install on Kubernetes 1.9+</a><ul class="nav"></ul></li><li><a href="#UUID-aa1f141d-f8ab-05ca-061b-a1ceae945f23">Sysdig Install on OpenShift (v1929+)</a><ul class="nav"></ul></li><li><a href="#UUID-64c06625-9423-b8f3-fd57-dfeb73bc1d04">Sysdig Install with Replicated</a><ul class="nav"></ul></li><li><a href="#UUID-8fa282bc-4e47-4d6e-1b43-a05eb53cdc7d">Troubleshooting On-Premises Installation</a></li></ul></li><li><a href="#UUID-b551e78a-d231-357e-a672-9c8787019250">On-Premises Upgrades</a><ul class="nav"><li><a href="#UUID-b551e78a-d231-357e-a672-9c8787019250_id_On-PremisesUpgrades-SupportedMigrationPaths">Supported Migration Paths</a></li><li><a href="#UUID-c5e6aaa8-e1e8-463e-4f4d-243e9c1ea63d">Migration Tool for Unified Events (Platform v. 1149+)</a></li><li><a href="#UUID-f435a7da-f6be-741f-6e3a-ec5d504c63c9">Migration Tool for Upgrading to Sysdig Platform v. 1765 (Kubernetes)</a></li><li><a href="#UUID-dba3eba5-3e14-d651-c2ff-43d2f27daee0">Basic Upgrade Kubernetes Installations</a></li><li><a href="#UUID-eb26f657-9903-6ab0-bb2b-a7f522c65cda">Expanded Upgrade Kubernetes Installations version 2.3.0</a></li><li><a href="#UUID-06ebb487-d368-384d-836b-17682b6295ff">Expanded Upgrade Kubernetes Installations for Sysdig Platform v. 1765</a></li><li><a href="#UUID-3ae24886-975b-76f7-f7f7-a7b865907119">Expanded Upgrade Kubernetes Installations version 2304 (2266, 2172)</a></li><li><a href="#UUID-3535b398-d1c6-28f0-2aad-ddf3cb20e59f">Upgrade Replicated Installations</a></li><li><a href="#UUID-7627235e-9d7a-d34a-982b-c1adc191eb61">**Add a Cassandra Node**</a></li></ul></li><li><a href="#UUID-529c0b1e-1b39-96e9-858c-affd619f2964">Find the Super Admin Credentials and API Token</a><ul class="nav"><li><a href="#UUID-529c0b1e-1b39-96e9-858c-affd619f2964_id_FindtheSuperAdminCredentialsandAPIToken-FindSuperAdminCredentials">Find Super Admin Credentials</a></li><li><a href="#UUID-529c0b1e-1b39-96e9-858c-affd619f2964_id_FindtheSuperAdminCredentialsandAPIToken-FindSysdigAPIToken">Find Sysdig API Token</a></li></ul></li><li><a href="#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644">Upgrade an On-Premises License</a><ul class="nav"><li><a href="#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForReplicatedOn-PremInstallations">For Replicated On-Prem Installations</a></li><li><a href="#UUID-24d9c15d-4e77-8eba-ebe2-1581d74a6644_id_UpgradeanOn-PremisesLicense-ForKubernetesOn-PremInstallations">For Kubernetes On-Prem Installations</a></li></ul></li><li><a href="#UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac">Securing Elasticsearch</a><ul class="nav"><li><a href="#UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-Prerequisite">Prerequisite</a></li><li><a href="#UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-EnableAuthenticationandTLS">Enable Authentication and TLS</a></li><li><a href="#UUID-19cefa56-9dd6-69bc-5afb-70cf336f4aac_id_SecuringElasticsearch-EnablingauthenticationagainstacustomElasticsearchsetup">Enabling authentication against a custom Elasticsearch setup</a></li></ul></li><li><a href="#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e">Securing Cassandra</a><ul class="nav"><li><a href="#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Contents">Contents</a></li><li><a href="#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-Prerequisite">Prerequisite</a></li><li><a href="#UUID-c7a65f23-3488-967a-3b87-aa1876fe710e_id_SecuringCassandra-EnableAuthenticationandTLS">Enable Authentication and TLS</a></li></ul></li><li><a href="#UUID-a6838af5-084b-2767-1990-f0fcc15fa720">Authentication and Authorization (On-Prem Options)</a><ul class="nav"><li><a href="#UUID-a6838af5-084b-2767-1990-f0fcc15fa720_id_AuthenticationandAuthorizationOn-PremOptions-Workflow">Workflow</a></li><li><a href="#UUID-75a13b23-2396-d5df-9111-385ec8054322">Google OAuth (On-Prem)</a></li><li><a href="#UUID-1ab02a8d-ba97-4b54-4ae6-4a3d79bbc314">SAML (On-Prem)</a><ul class="nav"></ul></li><li><a href="#UUID-fa20089b-08b8-fd3c-ff36-2f1400d6e678">OpenID Connect (On-Prem)</a><ul class="nav"></ul></li><li><a href="#UUID-583ee504-4257-5b8c-b333-20cdc51c4086">LDAP</a><ul class="nav"></ul></li></ul></li><li><a href="#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb">**Backup and Restore Best Practices**</a><ul class="nav"><li><a href="#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-CassandraElasticsearch">Cassandra/Elasticsearch</a></li><li><a href="#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-MySQLCluster">MySQL Cluster</a></li><li><a href="#UUID-90542881-fd2a-500d-7a0a-08a8a3fc5dbb_id_id-BackupandRestoreBestPractices-AWSCMD">AWS CMD</a></li></ul></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div class="voting-title">Was this helpful?</div><div class="btn-group btn-group-toggle" data-toggle="buttons"><button id="feedback-yes-btn" class="btn toggle-yes">Yes</button><button id="feedback-no-btn" class="btn">No</button></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-17625-sysdig-platform.html#UUID-6da28333-1f8a-b8ac-b505-bec8415f5368_id_SysdigPlatform-AuthenticationAuthorization">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-17701-sysdig-agent.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
