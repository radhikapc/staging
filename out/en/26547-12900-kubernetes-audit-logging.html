<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Kubernetes Audit Logging</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="26547-12899-event-forwarding.html" title="Event Forwarding"></link><link rel="next" href="26547-12901-policies.html" title="Policies"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/themes/sysdig/assets/images/logo-sysdig-black.svg" target="_blank"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-12899-event-forwarding.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-12901-policies.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="26547-11020-sysdig-secure.html">Sysdig Secure</a></li><li class="breadcrumb-link"><a href="26547-12895-policy-events.html">Policy Events</a></li><li class="breadcrumb-node">Kubernetes Audit Logging</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-01478946-aa02-fe5b-d28e-68c71020aac1" data-permalink="26547-12900-kubernetes-audit-logging.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc"><div class="titlepage"><div><div class="title"><h4 class="title">Kubernetes Audit Logging</h4></div></div></div><p>Sysdig Secure allows users to create Falco security rules based on a stream of Kubernetes audit events, integrating Kubernetes audit logging with the Sysdig Agent. This allows users to track changes made to the cluster, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Creation and destruction of pods, services, deployments, daemonsets, etc.</p></li><li class="listitem"><p>Creating/updating/removing config maps or secrets</p></li><li class="listitem"><p>Attempts to subscribe to changes to any endpoint</p></li></ul></div><p>Sysdig supports Kubernetes audit logging for the following distributions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Minikube 0.33.1 and later, using the default Virtualbox driver</p></li><li class="listitem"><p>Kops 1.11.0 and later, using AWS</p></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Sysdig has tested and confirmed the Kubernetes audit logging processes for Minikube and Kops. Instructions for configuring audit logging for additional Kubernetes distributions will be added as those instructions are tested and verified.</p></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Contents"><div class="titlepage"><div><div class="title"><h5 class="title">Contents</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Prerequisites" title="Prerequisites">Prerequisites</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-EnableKubernetesAuditLogging" title="Enable Kubernetes Audit Logging">Enable Kubernetes Audit Logging</a> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Minikube" title="Minikube">Minikube</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Kops" title="Kops">Kops</a> </p></li></ul></div></li><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-AuditLoggingPolicies" title="Audit Logging Policies">Audit Logging Policies</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditLoggingRules" title="View Audit Logging Rules">View Audit Logging Rules</a> </p></li><li class="listitem"><p> <a class="link" href="26547-12900-kubernetes-audit-logging.html#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditEvents" title="View Audit Events">View Audit Events</a> </p></li></ul></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Prerequisites"><div class="titlepage"><div><div class="title"><h5 class="title">Prerequisites</h5></div></div></div><p>These instructions assume that the Sysdig Agent has already been deployed to the Kubernetes cluster. For detailed instructions, refer to the <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/192348345/Agent+Install%3A+Kubernetes+%7C+GKE+%7C+OpenShift+%7C+IBM" target="_blank">Agent Install</a> documentation.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-EnableKubernetesAuditLogging"><div class="titlepage"><div><div class="title"><h5 class="title">Enable Kubernetes Audit Logging</h5></div></div></div><p>The steps to enable audit logging depend on the Kubernetes distribution being used:</p><h6 id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Minikube" class="bridgehead">Minikube</h6><p>To enable audit logging:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Clone / download the repository:<a class="link" href="https://github.com/draios/sysdig-cloud-scripts" target="_blank">https://github.com/draios/sysdig-cloud-scripts</a>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The repository contains the following relevant files:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p> <code class="code">k8s_audit_config/audit-policy.yaml</code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>For more information on configuring the audit events passed to the agent, refer to the <a class="link" href="">Kubernetes</a> documentation.</p></div></li><li class="listitem"><p> <code class="code">k8s_audit_config/<a class="link" href="http://webhook-config.yaml.in" target="_blank">webhook-config.yaml.in</a> </code> </p></li><li class="listitem"><p> <code class="code">k8s_audit_config/enable-k8s-audit.sh</code> </p></li></ul></div></div></li><li class="step"><p>Run the following command in the <code class="code">sysdig-cloud-scripts/k8s_audit_config</code> directory to enter the necessary values to the <code class="code"> <a class="link" href="http://webhook-config.yaml.in" target="_blank">webhook-config.yaml.in</a> </code> file:</p><pre class="programlisting">
AGENT_SERVICE_CLUSTERIP=$(kubectl get service sysdig-agent -o=jsonpath={.spec.clusterIP}) envsubst &lt; webhook-config.yaml.in &gt; webhook-config.yaml</pre></li><li class="step"><p>Run the <code class="code">enable-k8s.sh</code> script to enable audit log support on the apiserver:</p><pre class="programlisting">bash ./enable-k8s-audit.sh minikube</pre></li></ol></div><h6 id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Kops" class="bridgehead">Kops</h6><p>To enable audit logging:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Clone / download the repository:<a class="link" href="https://github.com/draios/sysdig-cloud-scripts" target="_blank">https://github.com/draios/sysdig-cloud-scripts</a>.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The repository contains the following relevant files:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p> <code class="code">k8s_audit_config/audit-policy.yaml</code> </p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>For more information on configuring the audit events passed to the agent, refer to the <a class="link" href="">Kubernetes</a> documentation.</p></div></li><li class="listitem"><p> <code class="code">k8s_audit_config/webhook-config.yaml.in</code> </p></li><li class="listitem"><p> <code class="code">k8s_audit_config/enable-k8s-audit.sh</code> </p></li></ul></div></div></li><li class="step"><p>Run the following command in the <code class="code">sysdig-cloud-scripts/k8s_audit_config</code> directory to enter the necessary values to the <code class="code">webhook-config.yaml.in</code> file:</p><pre class="programlisting">
AGENT_SERVICE_CLUSTERIP=$(kubectl get service sysdig-agent -o=jsonpath={.spec.clusterIP}) envsubst &lt; webhook-config.yaml.in &gt; webhook-config.yaml</pre></li><li class="step"><p>Run the <code class="code">enable-k8s.sh</code> script to enable audit log support on the apiserver:</p><pre class="programlisting">
APISERVER_HOST=api.my-kops-cluster.com bash ./enable-k8s-audit.sh kops</pre></li></ol></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-AuditLoggingPolicies"><div class="titlepage"><div><div class="title"><h5 class="title">Audit Logging Policies</h5></div></div></div><p>Policies will need to be created to use the new Falco Rules for Kubernetes audit logging. For information on creating policies, refer to the <a class="link" href="26547-12901-policies.html" title="Policies">Policies</a> documentation.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditLoggingRules"><div class="titlepage"><div><div class="title"><h5 class="title">View Audit Logging Rules</h5></div></div></div><p>The Kubernetes audit logging rules can be viewed in the Sysdig Policies Rules Editor, found in the Policies module. To view the audit rules:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>From the Policies module, navigate to the Rules Editor tab.</p></li><li class="step"><p>Open the drop-down menu for the default rules, and select <code class="code">k8s_audit_rules.yaml</code>:</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="600px"><tr><td><img src="image/uuid-50c54ef5-3ebb-ed48-7a61-dc11006ed4cb-en.png" style="max-width: 600px; " alt="329875466.png"></img></td></tr></table></div></li></ol></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditEvents"><div class="titlepage"><div><div class="title"><h5 class="title">View Audit Events</h5></div></div></div><p>Kubernetes audit events will now be routed to the Sysdig Agent daemonset within the cluster. Once the policies are created, the audit events will be able to be observed via the Sysdig Secure <code class="code">Policy Events</code> module.</p></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc">Kubernetes Audit Logging</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Contents">Contents</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-Prerequisites">Prerequisites</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-EnableKubernetesAuditLogging">Enable Kubernetes Audit Logging</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-AuditLoggingPolicies">Audit Logging Policies</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditLoggingRules">View Audit Logging Rules</a></li><li><a href="#UUID-c8fe65ad-b91b-c7a4-1085-a474591d2ccc_id_KubernetesAuditLogging-ViewAuditEvents">View Audit Events</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="26547-12899-event-forwarding.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="26547-12901-policies.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
