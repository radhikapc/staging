<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta charset="UTF-8"></meta><meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="no"></meta><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700|Material+Icons" rel="stylesheet"></link><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Integrate Prometheus Metrics</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/5d40bfcded91c.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/fuse.min.js" type="text/javascript"></script><script src="../js/hilitor.js" type="text/javascript"></script><script src="../js/html5.fuse.search.js" type="text/javascript"></script><script src="js/fuzzydata.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta xmlns:xlink="http://www.w3.org/1999/xlink" name="generator" content="Paligo"></meta><link rel="prev" href="33836-3104-sysdig-integrations.html#UUID-9c0339a4-b266-fe6b-c308-daa15519cea2_id_SysdigIntegrations-KeyIntegrations" title="Key Integrations"></link><link rel="next" href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" title="Integrate JMX Metrics from Java Virtual Machines"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script>
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				$('.materialboxed').materialbox();
				});
			</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/googlecode.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script><script type="text/javascript">
				$(document).ready(function(){
				var lang = hljs.listLanguages();
				$('pre:not(.embedcode)').each(function(){
				if ($(this).data('language') && $.inArray($(this).data('language'), lang) > -1) {
					var code = hljs.highlight($(this).data('language'), $(this).text());
						$(this).empty().append(code.value).addClass("hljs").addClass(code.language);
					} else {
						hljs.highlightBlock(this);
					}
				});
			});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><ul class="toc nav nav-site-sidebar"><li><a href="33836-7424-mon--sysdig-monitor-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-069aba38-24df-cfe3-6295-806f95c1d6d3" data-permalink="33836-7424-mon--sysdig-monitor-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> MON (Sysdig Monitor)</a><ul><li><a href="33836-9744-sysdig-monitor.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-80c03485-8397-80ea-8f5f-fc2cae33cb49" data-permalink="33836-9744-sysdig-monitor.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Monitor</a><ul><li><a href="33836-9745-getting-started.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-f338dfdd-e52a-3369-fc78-7c91004d8538" data-permalink="33836-9745-getting-started.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started</a></li><li><a href="33836-9747-overview.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5cc77116-7dd1-a2a9-0b81-8302f36ce5a6" data-permalink="33836-9747-overview.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Overview</a></li><li><a href="33836-9753-explore.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9f1e2c9c-0fde-5a17-7d03-c6508d9a121c" data-permalink="33836-9753-explore.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Explore</a></li><li><a href="33836-9760-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9ecc347f-4d82-142f-f23f-eef54921905c" data-permalink="33836-9760-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics</a></li><li><a href="33836-9769-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3db0303c-3326-331c-b50e-43aee72438f5" data-permalink="33836-9769-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Dashboards</a></li><li><a href="33836-9784-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-0dd6f084-a8c7-47bd-60fd-99e6a6d32231" data-permalink="33836-9784-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Events</a></li><li><a href="33836-9795--doc-785--alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-2c45e57c-0a2c-7a96-4c9c-61ae662e4c78" data-permalink="33836-9795--doc-785--alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">[DOC-785] Alerts</a></li><li><a href="33836-9803-alerts.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-207f896d-385a-ef7f-6a49-006fa7cf0ac9" data-permalink="33836-9803-alerts.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Alerts</a></li><li><a href="33836-9804-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d8263ae-e350-e76b-b33c-a4a6ed9910c5" data-permalink="33836-9804-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li></ul></li></ul></li><li><a href="33836-31726-ss--sysdig-secure-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-9d238259-cba8-538a-45d2-7146377b7970" data-permalink="33836-31726-ss--sysdig-secure-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SS (Sysdig Secure)</a><ul><li><a href="33836-31918-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a4e13476-09e2-0efc-ae18-7955d3e4e07f" data-permalink="33836-31918-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Secure</a><ul><li><a href="33836-31919-getting-started-with-sysdig-secure.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-34b1cd4b-0b04-382d-958d-c37e8514fd79" data-permalink="33836-31919-getting-started-with-sysdig-secure.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Getting Started with Sysdig Secure</a></li><li><a href="33836-31920-policies.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a6f83873-7719-6a0c-4355-512ead6227e9" data-permalink="33836-31920-policies.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policies</a></li><li><a href="33836-31925-policy-events.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a0c9d18f-6753-34fe-5537-e841a0c7ebc7" data-permalink="33836-31925-policy-events.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Policy Events</a></li><li><a href="33836-31930-commands-audit.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-e607ad4e-4aff-6808-d2da-124d665c2935" data-permalink="33836-31930-commands-audit.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Commands Audit</a></li><li><a href="33836-31931-captures.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c330d73e-7372-4819-7660-e9c3ebe57377" data-permalink="33836-31931-captures.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Captures</a></li><li><a href="33836-31932-image-scanning.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-138616ae-4150-ab6a-92c5-cda4c1b29469" data-permalink="33836-31932-image-scanning.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Image Scanning</a></li><li><a href="33836-31943-compliance.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b790f1cd-3616-783f-4854-d3561cef37f0" data-permalink="33836-31943-compliance.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Compliance</a></li></ul></li></ul></li><li><a href="33836-14843-sp--sysdig-platform-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-5f790757-94c6-c118-c525-e894abac1da1" data-permalink="33836-14843-sp--sysdig-platform-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SP (Sysdig Platform)</a><ul><li><a href="33836-17625-sysdig-platform.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-d7f578b2-c960-970c-a969-10cebb31d199" data-permalink="33836-17625-sysdig-platform.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Platform</a><ul><li><a href="33836-17626-on-premises-deployments.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b0fbda15-008f-f5ef-e82b-44edcdbddf2f" data-permalink="33836-17626-on-premises-deployments.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">On-Premises Deployments</a></li><li><a href="33836-17701-sysdig-agent.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-ee770b85-3c82-28cf-48e0-a38a6f973bc1" data-permalink="33836-17701-sysdig-agent.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent</a></li><li><a href="33836-17746-administration-settings.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-79535d85-dcdb-4dfd-1b55-de1edacb346d" data-permalink="33836-17746-administration-settings.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Administration Settings</a></li><li><a href="33836-17794-get-help---using-sysdig-support.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-712b3b75-2584-30e3-5bd9-e1e57d3d8756" data-permalink="33836-17794-get-help---using-sysdig-support.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Get Help | Using Sysdig Support</a></li></ul></li></ul></li><li><a href="33836-1790-si--sysdig-integrations-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-a547c8f5-9ae9-1c4c-5e8c-8fe12da3bcb0" data-permalink="33836-1790-si--sysdig-integrations-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SI (Sysdig Integrations)</a><ul><li><a href="33836-3104-sysdig-integrations.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c9afbbe1-ebba-13d8-6b7e-280e11acba65" data-permalink="33836-3104-sysdig-integrations.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Integrations</a><ul><li><a href="33836-3105-integrate-prometheus-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-a9b82586-6669-653a-af4c-e3d71e6093b7" data-permalink="33836-3105-integrate-prometheus-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Prometheus Metrics</a></li><li><a href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-eb4a14da-a0d4-5d37-b74c-9c1d4fd24a76" data-permalink="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate JMX Metrics from Java Virtual Machines</a></li><li><a href="33836-3118-integrate-statsd-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6efe354e-5d0d-8dc2-d58c-103524dcb0cb" data-permalink="33836-3118-integrate-statsd-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate StatsD Metrics</a></li><li><a href="33836-3119-integrate-node-js-application-metrics.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fd238571-3246-4a22-59ae-18a993d11d70" data-permalink="33836-3119-integrate-node-js-application-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Node.js Application Metrics</a></li><li><a href="33836-3120-integrate-applications--default-app-checks-.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-771652e1-1419-993b-6a15-6ffb08f23cbe" data-permalink="33836-3120-integrate-applications--default-app-checks-.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Integrate Applications (Default App Checks)</a></li><li><a href="33836-3163-monitor-log-files.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-fab0e8c0-9a8b-6da1-72ed-1a6f78bcc819" data-permalink="33836-3163-monitor-log-files.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Monitor Log Files</a></li><li><a href="33836-3164-create-a-custom-app-check.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-87fda1aa-3729-5b0b-0e6d-3826c07008b2" data-permalink="33836-3164-create-a-custom-app-check.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create a Custom App Check</a></li><li><a href="33836-3165-create-per-container-custom-app-checks.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-be3c8a46-1153-ae68-9ffa-a743b9f4c5c7" data-permalink="33836-3165-create-per-container-custom-app-checks.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Create Per-Container Custom App Checks</a></li><li><a href="33836-3167---copy-of-integrate-statsd-metrics--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-62916008-0afc-b3b9-9a57-0619ffd7162c" data-permalink="33836-3167---copy-of-integrate-statsd-metrics--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Copy of Integrate StatsD Metrics**</a></li></ul></li></ul></li><li><a href="33836-321-sd--sysdig-developer-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-02c2a850-5ddd-8c69-e72e-a6c25dd77bd6" data-permalink="33836-321-sd--sysdig-developer-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SD (Sysdig Developer)</a><ul><li><a href="33836-407-sysdig-developer.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-c6f9da21-9261-0143-c7bf-cc1911bfd830" data-permalink="33836-407-sysdig-developer.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Developer</a><ul><li><a href="33836-408-sysdig-python-client.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-3221c4bb-2722-3923-2318-fface3c5a7dc" data-permalink="33836-408-sysdig-python-client.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Python Client</a></li><li><a href="33836-411-sysdig-rest-api-conventions.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-cd967606-7ed2-3987-4ae5-ebe61c5c63b3" data-permalink="33836-411-sysdig-rest-api-conventions.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig REST API Conventions</a></li><li><a href="33836-412-working-with-dashboards.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-dab3ac7a-75a7-ca54-b757-48eb6c152382" data-permalink="33836-412-working-with-dashboards.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Working with Dashboards</a></li><li><a href="33836-415-metrics-dictionary.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb8f1cb0-689d-02b1-685e-ce078d15458d" data-permalink="33836-415-metrics-dictionary.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Metrics Dictionary</a></li><li><a href="33836-486---sample-use-cases--.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-9560c9cf-68e1-76fb-d9d1-8bc20520c9e9" data-permalink="33836-486---sample-use-cases--.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">**Sample Use Cases**</a></li></ul></li></ul></li><li><a href="33836-29920-srn--sysdig-release-notes-.html" class="topic-link section reused-publication lang-en reused-publication" data-origin-id="UUID-3347f819-20ba-fc5a-b851-ef9c9b052358" data-permalink="33836-29920-srn--sysdig-release-notes-.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> SRN (Sysdig Release Notes)</a><ul><li><a href="33836-30013-sysdig-release-notes-home.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5a6ffc5f-ac34-9a7b-dadd-93a6660c0797" data-permalink="33836-30013-sysdig-release-notes-home.html" data-topic-level="1" data-relative-prefix="" data-publication-date=""><span class="glyphicon"></span> Sysdig Release Notes Home</a><ul><li><a href="33836-30014-sysdig-agent-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-5d6e3387-7f79-746c-f6dc-307df42de9b6" data-permalink="33836-30014-sysdig-agent-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig Agent Release Notes</a></li><li><a href="33836-30015-saas--sysdig-monitor-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-6f9142b1-da9d-e39a-a544-b636187d1f1c" data-permalink="33836-30015-saas--sysdig-monitor-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Monitor Release Notes</a></li><li><a href="33836-30016-saas--sysdig-secure-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-bb47596c-e097-c65e-7b1f-aea99cbe7e6d" data-permalink="33836-30016-saas--sysdig-secure-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">SaaS: Sysdig Secure Release Notes</a></li><li><a href="33836-30017-sysdig-on-premises-release-notes.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-b883612b-b2eb-205b-e04d-5108476566f9" data-permalink="33836-30017-sysdig-on-premises-release-notes.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Sysdig On-Premises Release Notes</a></li><li><a href="33836-30018-terms-of-use.html" class="topic-link section original-topic lang-en original-topic" data-origin-id="UUID-005c4ff8-26e9-cd84-5f78-729f0870b46f" data-permalink="33836-30018-terms-of-use.html" data-topic-level="1" data-relative-prefix="" data-publication-date="">Terms of Use</a></li></ul></li></ul></li></ul></aside><div class="site-content"><h1 class="publication-title">Sysdig Documentation</h1><div class="toolbar top-nav-on"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"><ul class="top-nav-menu sm sm-simple"></ul></div><div class="tool-print"><i class="fa fa-print" aria-hidden="true">print</i></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-3104-sysdig-integrations.html#UUID-9c0339a4-b266-fe6b-c308-daa15519cea2_id_SysdigIntegrations-KeyIntegrations">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link">Â <span class="current-category">Sysdig Documentation</span></li><li class="breadcrumb-link"><a href="33836-1790-si--sysdig-integrations-.html">SI (Sysdig Integrations)</a></li><li class="breadcrumb-link"><a href="33836-3104-sysdig-integrations.html">Sysdig Integrations</a></li><li class="breadcrumb-node">Integrate Prometheus Metrics</li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-a9b82586-6669-653a-af4c-e3d71e6093b7" data-permalink="33836-3105-integrate-prometheus-metrics.html" data-topic-level="1" data-relative-prefix="" data-publication-date="" id="UUID-0b1882da-ba8f-f931-69ea-3aa0745dce46"><div class="titlepage"><div><div class="title"><h4 class="title">Integrate Prometheus Metrics</h4></div></div></div><p>Starting with version 0.70.0, the Sysdig Monitor Agent provides rich support for automatically collecting metrics from <a class="link" href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank">Prometheus exporters</a>. Note that these exporters include "libraries and servers which help in exporting existing metrics from third-party systems as Prometheus metrics." The <a class="link" href="https://github.com/prometheus/prometheus" target="_blank">Prometheus</a> product itself does not necessarily have to be installed for Prometheus metrics to be collected.</p><p>This article describes default behaviors and how to further configure the feature to specify which processes and ports should be targeted for scraping. See our <a class="link" href="https://sysdig.com/blog/prometheus-metrics/" target="_blank">blog post</a> for additional context on the Prometheus metric format and how such metrics are typically used.</p><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>The Sysdig Monitor Agent also had rudimentary Prometheus support in versions older than 0.70.0. If you were using this functionality, see the section below on the<a class="xref" href="33836-3105-integrate-prometheus-metrics.html#UUID-11a81234-9117-3163-f6e4-2c374afbc53e" title="Legacy Prometheus Application Check"><span class="xreftitle">Legacy Prometheus Application Check</span></a> for important upgrade information.</p></div><p>Learn more:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-abe1f333-29ec-3a81-16d7-7abd7403ee67" title="Working with Prometheus Metrics">Working with Prometheus Metrics</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4" title="Setting up the Environment">Setting up the Environment</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-f447e6fa-032a-15a6-b276-9391b8c89815" title="Configuring Sysdig Agent">Configuring Sysdig Agent</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f" title="Example Configuration">Example Configuration</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-da55674a-f9da-039c-8601-bb8dc6d16dfe" title="Enabling Histogram Metrics">Enabling Histogram Metrics</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140" title="Logging and Troubleshooting">Logging and Troubleshooting</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195" title="Collecting Prometheus Metrics from Remote Hosts">Collecting Prometheus Metrics from Remote Hosts</a></p></li><li class="listitem"><p><a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-11a81234-9117-3163-f6e4-2c374afbc53e" title="Legacy Prometheus Application Check">Legacy Prometheus Application Check</a></p></li></ul></div><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-8bd65a70-2435-d187-5a82-5051cd0fb446" data-publication-date="" id="UUID-abe1f333-29ec-3a81-16d7-7abd7403ee67"><div class="titlepage"><div><div class="title"><h5 class="title">Working with Prometheus Metrics</h5></div></div></div><p>The Sysdig Monitor Agent uses its visibility to all running processes (at both the host and container levels) to find eligible targets for scraping Prometheus metrics. By default, no scraping is attempted. Once the feature is enabled, the Agent assembles a list of eligible targets in two steps:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>A process is determined to be eligible for possible scraping if it positively matches against a series of <span class="bold bold"><strong>Process Filter</strong></span> include/exclude rules.</p></li><li class="step"><p>The Agent will then attempt to scrape an eligible process at a <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span> endpoint on all of its listening TCP ports, unless the additional configuration is present to restrict scraping to a subset of ports and/or another endpoint name.</p></li></ol></div><p>The metrics ultimately appear in the Sysdig Monitor Explore interface in the Prometheus section.</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="300px"><tr><td><img src="image/15d5af4f878b07.png" style="max-width: 300px; " alt="373654583.png"></img></td></tr></table></div><p>Within the set of eligible processes/ports/endpoints, the Agent uses an auto-discover approach to scrape only ports that are exporting Prometheus metrics, and will stop attempting to scrape or retry on ports based on how they respond to attempts to connect and scrape them. It is therefore strongly recommended that you create a configuration that restricts the process and ports for attempted scraping to the minimum expected range for your exporters. This minimizes the potential for unintended side-effects in both the Agent and your applications due to repeated failed connection attempts.</p></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-a4adb3dc-dd6b-c699-083c-2af49c3c0c72" data-publication-date="" id="UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4"><div class="titlepage"><div><div class="title"><h5 class="title">Setting up the Environment</h5></div></div></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-quickstartQuickStartForKubernetesEnvironments"><div class="titlepage"><div><div class="title"><h6 class="title">Quick Start For Kubernetes Environments</h6></div></div></div><p>Prometheus users who are already leveraging <a class="link" href="">Kubernetes Service Discovery</a> (specifically the approach in <a class="link" href="">this sample prometheus-kubernetes.yml</a>) may already have Annotations attached to their Pods that mark them as eligible for scraping. Such environments can quickly begin scraping the same metrics using the Sysdig Agent in a couple easy steps.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Enable the Prometheus metrics feature in the Sysdig Agent. Assuming you are <a class="link" href="https://github.com/draios/sysdig-cloud-scripts/tree/master/agent_deploy/kubernetes" target="_blank">deploying using DaemonSets</a>, the needed config can be added to the Agent's <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span> by including the following in your DaemonSet YAML (placing it in the <span class="bold bold"><strong> <code class="code">env</code> </strong></span> section for the <span class="bold bold"><strong> <code class="code">sysdig-agent</code> </strong></span> container):</p><pre class="programlisting">- name: ADDITIONAL_CONF
  value: "prometheus:\n  enabled: true"

</pre></li><li class="step"><p>Ensure the Kubernetes Pods that contain your Prometheus exporters have been deployed with the following Annotations to enable scraping (substituting the listening <span class="italic italic"> <span class="bold bold"><strong> <code class="code">exporter-TCP-port)</code> </strong></span> </span> <code class="code">: </code> </p><pre class="programlisting">spec:
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "exporter-TCP-port"</pre><p>The configuration above assumes your exporters use the typical endpoint called <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span>. If an exporter is using a different endpoint, this can also be specified by adding the following additional optional Annotation, substituting the <span class="italic italic"> <span class="bold bold"><strong> <code class="code">exporter-endpoint-name</code> </strong></span> </span>:</p><pre class="programlisting">prometheus.io/path: "/exporter-endpoint-name"</pre></li></ol></div><p>If you try this<a class="link" href="https://raw.githubusercontent.com/luca3m/app-examples/master/prometheus-java/prometheus-java-app.yaml" target="_blank"> Kubernetes Deployment of a simple exporter</a>, you will quickly see auto-discovered Prometheus metrics being displayed in Sysdig Monitor. You can use this working example as a basis to similarly Annotate your own exporters.</p><p>If you have Prometheus exporters not deployed in annotated Kubernetes Pods that you would like to scrape, the following sections describe the full set of options to configure the Agent to find and scrape your metrics.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-QuickStartforContainerEnvironments"><div class="titlepage"><div><div class="title"><h6 class="title">Quick Start for Container Environments</h6></div></div></div><p>In order for Prometheus scraping to work in a Docker-based container environment, set the following labels to the application containers, substituting &lt;<code class="code">exporter-port</code>&gt; and &lt;<code class="code">exporter-path</code>&gt; with the correct port and path where metrics are exported by your application:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">io.prometheus.scrape=true</code> </p></li><li class="listitem"><p> <code class="code">io.prometheus.port=&lt;exporter-port&gt;</code> </p></li><li class="listitem"><p> <code class="code">io.prometheus.path=&lt;exporter-path&gt;</code> </p></li></ul></div><p>For example, if <code class="code">mysqld-exporter</code> is to be scraped, spin up the container as follows:</p><pre class="programlisting">docker -d -l io.prometheus.scrape=true -l io.prometheus.port=9104 -l io.prometheus.path=/metrics mysqld-exporter</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-quickstartQuickStartForKubernetesEnvironments" title="Quick Start For Kubernetes Environments">Quick Start For Kubernetes Environments</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-QuickStartforContainerEnvironments" title="Quick Start for Container Environments">Quick Start for Container Environments</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-6cbe659b-9319-7b62-a86d-55323e3ea7ff" data-publication-date="" id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815"><div class="titlepage"><div><div class="title"><h5 class="title">Configuring Sysdig Agent</h5></div></div></div><p>As is typical for the Agent, the default configuration for the feature is specified in <span class="bold bold"><strong> <code class="code">dragent.default.yaml</code> </strong></span>, and you can override the defaults by <a class="link" href="https://sysdigdocs.atlassian.net/wiki/spaces/Platform/pages/198934553/Understanding+the+Agent+Config+Files" target="_blank">configuring parameters</a> in the <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span>. For each parameter you do not set in <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span>, the defaults in <span class="bold bold"><strong> <code class="code">dragent.default.yaml</code> </strong></span> will remain in effect.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-MainConfigParameters"><div class="titlepage"><div><div class="title"><h6 class="title">Main Config Parameters</h6></div></div></div><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Parameter</p></th><th class="th"><p>Default</p></th><th class="th"><p>Description</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">enabled</code> </p></td><td class="td"><p> <code class="code">false</code> </p></td><td class="td"><p>Turns Prometheus scraping on/off.</p></td></tr><tr><td class="td"><p> <code class="code">interval</code> </p></td><td class="td"><p> <code class="code">10</code> </p></td><td class="td"><p>How often (in seconds) the Agent will scrape a port for Prometheus metrics</p></td></tr><tr><td class="td"><p> <code class="code">log_errors</code> </p></td><td class="td"><p> <code class="code">true</code> </p></td><td class="td"><p>Whether the Agent should log details on failed attempts to scrape eligible targets</p></td></tr><tr><td class="td"><p> <code class="code">max_metrics</code> </p></td><td class="td"><p> <code class="code">1000</code> </p></td><td class="td"><p>The maximum number of total Prometheus metrics that will be scraped across all targets. This value of 1000 is the maximum per-Agent, and is a separate limit from other Custom Metrics (e.g. <a class="link" href="33836-3118-integrate-statsd-metrics.html" title="Integrate StatsD Metrics">statsd</a>, <a class="link" href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html" title="Integrate JMX Metrics from Java Virtual Machines">JMX</a>, and other <a class="link" href="33836-3120-integrate-applications--default-app-checks-.html" title="Integrate Applications (Default App Checks)">Application Checks</a>).</p></td></tr><tr><td class="td"><p> <code class="code">max_metrics_per_process</code> </p></td><td class="td"><p> <code class="code">1000</code> </p></td><td class="td"><p>The maximum number of Prometheus metrics that the Agent will save from a single scraped target.</p><p>(Default changed from 100 to 1000 in agent version 0.90.3.)</p></td></tr><tr><td class="td"><p> <code class="code">max_tags_per_metric</code> </p></td><td class="td"><p> <code class="code">20</code> </p></td><td class="td"><p>The maximum number of tags per Prometheus metric that the Agent will save from a scraped target</p></td></tr><tr><td class="td"><p> <code class="code">histograms</code> </p></td><td class="td"><p> <code class="code">false</code> </p></td><td class="td"><p>Whether the Agent should scrape and report histogram metrics. See <a class="link" href="">the section below on histograms</a> for details.</p></td></tr><tr><td class="td"><p> <code class="code">process_filter</code> </p></td><td class="td"><p>See below</p></td><td class="td"><p>Specifies which processes may be eligible for scraping. See the <a class="link" href="">Process Filter</a> section below.</p></td></tr><tr><td class="td"><p> <code class="code">timeout</code> </p></td><td class="td"><p>1</p></td><td class="td"><p>Used to configure the amount of time the agent will wait while scraping a Prometheus endpoint before timing out. The default value is 1 second.</p></td></tr></tbody></table></div></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-processfilterProcessFilter"><div class="titlepage"><div><div class="title"><h6 class="title">Process Filter</h6></div></div></div><p>The <span class="bold bold"><strong> <code class="code">process_filter</code> </strong></span> section specifies which of the processes known by an Agent may be eligible for scraping.</p><p>Note that once you specify a <span class="bold bold"><strong> <code class="code">process_filter</code> </strong></span> in your <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span>, this replaces the entire Prometheus <span class="bold bold"><strong> <code class="code">process_filter</code> </strong></span> section (i.e. all rules) shown in the <span class="bold bold"><strong> <code class="code">dragent.default.yaml</code> </strong></span>.</p><p>The Process Filter is specified in a series of <span class="bold bold"><strong> <code class="code">include</code> </strong></span> and <span class="bold bold"><strong> <code class="code">exclude</code> </strong></span> rules that are evaluated top-to-bottom for each process known by an Agent. If a process matches an <span class="bold bold"><strong> <code class="code">include</code> </strong></span> rule, scraping will be attempted via a <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span> endpoint on each listening TCP port for the process, unless a <span class="bold bold"><strong> <code class="code">conf</code> </strong></span> section also appears within the rule to further restrict how the process will be scraped (see <a class="link" href="">the "conf" section</a> below).</p><p>Multiple patterns can be specified in a single rule, in which case all patterns must match for the rule to be a match (AND logic).</p><p>Within a pattern value, simple "glob" wildcarding may be used, where <span class="bold bold"><strong> <code class="code">*</code> </strong></span> matches any number of characters (including none) and <span class="bold bold"><strong> <code class="code">?</code> </strong></span> matches any single character. Note that due to YAML syntax, when using wildcards, be sure to enclose the value in quotes (<span class="bold bold"><strong> <code class="code">"*"</code> </strong></span>).</p><p>The table below describes the supported patterns in Process Filter rules. To provide realistic examples, we'll use a simple <a class="link" href="https://hub.docker.com/r/luca3m/prometheus-java-app/" target="_blank">sample Prometheus exporter</a> (source code <a class="link" href="https://github.com/luca3m/app-examples/tree/master/prometheus-java" target="_blank">here</a>) which can be deployed as a container using the Docker command line below. To help illustrate some of the configuration options, this sample exporter presents Prometheus metrics on <span class="bold bold"><strong> <code class="code">/promtheus</code> </strong></span> instead of the more common <code class="code">/metrics</code> endpoint, which will be shown in the example configurations further below.</p><pre class="programlisting"># docker run -d -p 8080:8080 \
    --label class="exporter" \
    --name my-java-app \
    luca3m/prometheus-java-app
 
# ps auxww | grep app.jar
root     11502 95.9  9.2 3745724 753632 ?      Ssl  15:52   1:42 java -jar /app.jar --management.security.enabled=false
 
# curl http://localhost:8080/prometheus
...
random_bucket{le="0.005",} 6.0
random_bucket{le="0.01",} 17.0
random_bucket{le="0.025",} 51.0
...</pre><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Pattern name</p></th><th class="th"><p>Description</p></th><th class="th"><p>Example</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">container.image</code> </p></td><td class="td"><p>Matches if the process is running inside a container running the specified image</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.image: luca3m/prometheus-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code"> <a class="link" href="http://container.name" target="_blank">container.name</a> </code> </p></td><td class="td"><p>Matches if the process is running inside a container with the specified name</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> <a class="link" href="http://container.name" target="_blank">container.name</a>: my-java-app</code> </p></td></tr><tr><td class="td"><p> <code class="code">container.label.*</code> </p></td><td class="td"><p>Matches if the process is running in a container that has a Label matching the given value</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> container.label.class: exporter</code> </p></td></tr><tr><td class="td"><p> <code class="code">kubernetes.&lt;object&gt;.annotation.* kubernetes.&lt;object&gt;.label.*</code> </p></td><td class="td"><p>Matches if the process is attached to a Kubernetes object (Pod, Namespace, etc.) that is marked with the Annotation/Label matching the given value.</p><p>Note: This pattern does not apply to the Docker-only command-line shown above, but would instead apply if the exporter were installed as a Kubernetes Deployment using <a class="link" href="https://raw.githubusercontent.com/luca3m/app-examples/master/prometheus-java/prometheus-java-app.yaml" target="_blank">this example YAML</a>.</p><p>Note: See the section below on <a class="link" href="">Integrate Prometheus Metrics into Sysdig Monitor UI#Kubernetes Objects</a> for information on the full set of supported Annotations and Labels.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> <a class="link" href="http://kubernetes.pod.annotation.prometheus.io/scrape" target="_blank">kubernetes.pod.annotation.prometheus.io/scrape</a>: true</code> </p></td></tr><tr><td class="td"><p> <code class="code"> <a class="link" href="http://process.name" target="_blank">process.name</a> </code> </p></td><td class="td"><p>Matches the name of the running process</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> <a class="link" href="http://process.name" target="_blank">process.name</a>: java</code> </p></td></tr><tr><td class="td"><p> <code class="code">process.cmdline</code> </p></td><td class="td"><p>Matches a command line argument</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> process.cmdline: "*app.jar*"</code> </p></td></tr><tr><td class="td"><p> <code class="code">port</code> </p></td><td class="td"><p>Matches if the process is listening on one or more TCP ports.</p><p>The pattern for a single rule can specify a single port as shown in this example, or a single range (e.g.<code class="code">8079-8081</code>), but does not support comma-separated lists of ports/ranges.</p><p>Note: This parameter is <span class="italic italic">only</span> used to confirm if a process is eligible for scraping based on the ports on which it is listening. For example, if a process is listening on one port for application traffic and has a second port open for exporting Prometheus metrics, it would be possible to specify the application port here (but not the exporting port), and the exporting port in the <a class="link" href=""> <span class="bold bold"><strong> <code class="code">conf</code> </strong></span> section</a> (but not the application port), and the process would be matched as eligible and the exporting port would be scraped.</p></td><td class="td"><p> <code class="code">- include:</code> </p><p> <code class="code"> port: 8080</code> </p></td></tr><tr><td class="td"><p> <code class="code">appcheck.match</code> </p></td><td class="td"><p>Matches if an <a class="link" href="33836-3120-integrate-applications--default-app-checks-.html" title="Integrate Applications (Default App Checks)">Application Check</a> with the specific name or pattern is scheduled to run for the process.</p></td><td class="td"><p> <code class="code">- exclude:</code> </p><p> <code class="code"> appcheck.match: "*"</code> </p></td></tr></tbody></table></div><p>Instead of the <span class="bold bold"><strong> <code class="code">include</code> </strong></span> examples shown above that would have each matched our process, due to the previously-described ability to combine multiple patterns in a single rule, the following very strict configuration would also have matched:</p><pre class="programlisting">- include:
    container.image: luca3m/prometheus-java-app
    container.name: my-java-app
    container.label.class: exporter
    process.name: java
    process.cmdline: "*app.jar*"
    port: 8080</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-confconf"><div class="titlepage"><div><div class="title"><h6 class="title">conf</h6></div></div></div><p>Each <span class="bold bold"><strong> <code class="code">include</code> </strong></span> rule in the <span class="bold bold"><strong> <code class="code">port_filter</code> </strong></span> may include a <span class="bold bold"><strong> <code class="code">conf</code> </strong></span> portion that further describes how scraping will be attempted on the eligible process. If a <span class="bold bold"><strong> <code class="code">conf</code> </strong></span> portion is not included, scraping will be attempted at a <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span> endpoint on all listening ports of the matching process. The possible settings:</p><div class="informaltable table-responsive"><table class="informaltable frame-void rules-rows"><colgroup><col></col><col></col><col></col></colgroup><thead><tr><th class="th"><p>Parameter name</p></th><th class="th"><p>Description</p></th><th class="th"><p>Example</p></th></tr></thead><tbody><tr><td class="td"><p> <code class="code">port</code> </p></td><td class="td"><p>Either a static number for a single TCP port to be scraped, or a container/Kubernetes Label name or Kubernetes Annotation specified in curly braces. If the process is running in a container that is marked with this Label or is attached to a Kubernetes object (Pod, Namespace, etc.) that is marked with this Annotation/Label, scraping will be attempted only on the port specified as the value of the Label/Annotation.</p><p>Note: The Label/Annotation to match against will not include the text shown in <span class="bold bold"><strong>red</strong></span>.</p><p>Note: See <a class="link" href="">the section below on Kubernetes Objects</a> for information on the full set of supported Annotations and Labels.</p><p>Note: If running the exporter inside a container, this should specify the port number that the exporter process in the container is listening on, not the port that the container exposes to the host.</p></td><td class="td"><p> <code class="code">port: 8080</code> </p><p>- or -</p><p> <code class="code">port: "{container.label.io.prometheus.port}" </code> </p><p>- or -</p><p> <code class="code">port: "{kubernetes.pod.annotation.<a class="link" href="http://prometheus.io/port" target="_blank">prometheus.io/port</a>}" </code> </p></td></tr><tr><td class="td"><p> <code class="code">port_filter</code> </p></td><td class="td"><p>A set of include and exclude rules that define the ultimate set of listening TCP ports for an eligible process on which scraping may be attempted. Note that the syntax is different from the <span class="bold bold"><strong> <code class="code">port</code> </strong></span> pattern option from within the higher-level include rule in the <span class="bold bold"><strong> <code class="code">process_filter</code> </strong></span>. Here a given rule can include single ports, comma-separated lists of ports (enclosed in square brackets), or contiguous port ranges (without brackets).</p></td><td class="td"><p> <code class="code">port_filter:</code> </p><p> <code class="code"> - include: 8080 </code> <code class="code"> - exclude: [9092,9200,9300] - include: 9090-9100</code> </p></td></tr><tr><td class="td"><p> <code class="code">path</code> </p></td><td class="td"><p>Either the static specification of an endpoint to be scraped, or a container/Kubernetes Label name or Kubernetes Annotation specified in curly braces. If the process is running in a container that is marked with this Label or is attached to a Kubernetes object (Pod, Namespace, etc.) that is marked with this Annotation/Label, scraping will be attempted via the endpoint specified as the value of the Label/Annotation.</p><p>If <span class="bold bold"><strong> <code class="code">path</code> </strong></span> is not specified, or specified but the Agent does not find the Label/Annotation attached to the process, the common Prometheus exporter default of <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span> will be used.</p><p>Note: A Label/Annotation to match against will not include the text shown in <span class="bold bold"><strong>red</strong></span>.</p><p>Note: See <a class="link" href="">the section below on Kubernetes Objects</a> for information on the full set of supported Annotations and Labels.</p></td><td class="td"><p> <code class="code">path: "/prometheus"</code> </p><p>- or -</p><p> <code class="code">path: "{container.label.io.prometheus.path}" </code> </p><p>- or -</p><p> <code class="code">path: "{kubernetes.pod.annotation.<a class="link" href="http://prometheus.io/path" target="_blank">prometheus.io/path</a>}" </code> </p></td></tr><tr><td class="td"><p>host</p><pre class="programlisting"></pre></td><td class="td"><p>A hostname or IP address. The default is localhost.</p></td><td class="td"><pre class="programlisting">host: 192.168.1.101
- or -
host: subdomain.example.com
- or -
host: localhost</pre></td></tr><tr><td class="td"><p> <code class="code">use_https</code> </p></td><td class="td"><p>When set to <span class="bold bold"><strong> <code class="code">true</code> </strong></span>, connectivity to the exporter will only be attempted through HTTPS instead of HTTP. It is <span class="bold bold"><strong> <code class="code">false</code> </strong></span> by default.</p><p>(Available in Agent version 0.79.0 and newer)</p></td><td class="td"><p> <code class="code">use_https: true</code> </p></td></tr><tr><td class="td"><p> <code class="code">ssl_verify</code> </p></td><td class="td"><p>When set to <span class="bold bold"><strong> <code class="code">true</code> </strong></span>, verification will be performed for the server certificates for an HTTPS connection. It is <span class="bold bold"><strong> <code class="code">false</code> </strong></span> by default. Verification was enabled by default before 0.79.0.</p><p>(Available in Agent version 0.79.0 and newer)</p></td><td class="td"><p> <code class="code">ssl_verify: true</code> </p></td></tr></tbody></table></div><h6 id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-AuthenticationIntegration" class="bridgehead">Authentication Integration</h6><p>As of agent version 0.89, Sysdig can collect Prometheus metrics from endpoints requiring authentication. Use the parameters below to enable this function.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For username/password authentication:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <code class="code">username</code> </p></li><li class="listitem"><p> <code class="code">password</code> </p></li></ul></div></li><li class="listitem"><p>For authentication using a token:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <code class="code">auth_token_path </code> </p></li></ul></div></li><li class="listitem"><p>For certificate authentication with a certificate key:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p> <code class="code">auth_cert_path</code> </p></li><li class="listitem"><p> <code class="code">auth_key_path</code> </p></li></ul></div></li></ul></div><div dir="ltr" class="note note"><h3 class="title">Note</h3><p>Token substitution is also supported for all the authorization parameters. For instance a username can be taken from a Kubernetes annotation by specifying</p><p> <code class="code">username: "{<a class="link" href="http://kubernetes.service.annotation.prometheus.openshift.io/username" target="_blank">kubernetes.service.annotation.prometheus.openshift.io/username</a>}"</code> </p></div><h6 id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-confAuthenticationExample" class="bridgehead">conf Authentication Example</h6><p>Below is an example of the <code class="code">dragent.yaml</code> section showing all the Prometheus authentication configuration options, on OpenShift, Kubernetes, and etcd.</p><p>In this example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="code">username/password</code> are taken from a default annotation used by OpenShift.</p></li><li class="listitem"><p>The <code class="code">auth token</code> path is commonly available in Kubernetes deployments.</p></li><li class="listitem"><p>The <code class="code">certificate</code> and <code class="code">key</code> used here for etcd may normally not be as easily accessible to the agent. In this case they were extracted from the host namespace, constructed into Kubernetes secrets, and then mounted into the agent container.</p></li></ul></div><pre class="programlisting">prometheus: 
  enabled: true
  process_filter: 
    - include: 
        port: 1936
        conf: 
            username: "{kubernetes.service.annotation.prometheus.openshift.io/username}"
            password: "{kubernetes.service.annotation.prometheus.openshift.io/password}"
    - include: 
        process.name: kubelet
        conf: 
            port: 10250
            use_https: true
            auth_token_path: "/run/secrets/kubernetes.io/serviceaccount/token"
    - include: 
        process.name: etcd
        conf: 
            port: 2379
            use_https: true
            auth_cert_path: "/run/secrets/etcd/client-cert"
            auth_key_path: "/run/secrets/etcd/client-key"</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-objectsKubernetesObjects"><div class="titlepage"><div><div class="title"><h6 class="title">Kubernetes Objects</h6></div></div></div><p>As described above, there are multiple configuration options that can be set based on auto-discovered values for Kubernetes Labels and/or Annotations. The format in each case begins with <code class="code">"kubernetes.OBJECT.annotation." </code>or <code class="code">"kubernetes.OBJECT.label."</code> where <code class="code">OBJECT</code> can be any of the following supported Kubernetes object types:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code class="code">daemonSet</code> </p></li><li class="listitem"><p> <code class="code">deployment</code> </p></li><li class="listitem"><p> <code class="code">namespace</code> </p></li><li class="listitem"><p> <code class="code">node</code> </p></li><li class="listitem"><p> <code class="code">pod</code> </p></li><li class="listitem"><p> <code class="code">replicaSet</code> </p></li><li class="listitem"><p> <code class="code">replicationController</code> </p></li><li class="listitem"><p> <code class="code">service</code> </p></li><li class="listitem"><p> <code class="code">statefulset</code> </p></li></ul></div><p>The configuration text you add after the final dot becomes the name of the Kubernetes Label/Annotation that the Agent will look for. If the Label/Annotation is discovered attached to the process, the value of that Label/Annotation will be used for the configuration option.</p><p>Note that there are multiple ways for a Kubernetes Label/Annotation to be attached to a particular process. One of the simplest examples of this is the Pod-based approach shown above in the <a class="link" href="">Quick Start For Kubernetes Environments</a>. However, as an example alternative to marking at the Pod level, you could attach Labels/Annotations at the Namespace level, in which case auto-discovered configuration options would apply to all processes running in that Namespace regardless of whether they're in a Deployment, DaemonSet, ReplicaSet, etc.</p></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-55bf7152-4556-4daf-6791-570519bf3992" data-publication-date="" id="UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f"><div class="titlepage"><div><div class="title"><h5 class="title">Example Configuration</h5></div></div></div><p>As an example that pulls together many of the configuration elements shown above, consider the default Agent configuration that's inherited from the <span class="bold bold"><strong> <code class="code">dragent.default.yaml</code> </strong></span>.</p><pre class="programlisting">prometheus:
  enabled: false
  interval: 10
  log_errors: true
  max_metrics: 1000
  max_metrics_per_process: 100
  max_tags_per_metric: 20
 
  # Filtering processes to scan. Processes not matching a rule will not
  # be scanned
  # If an include rule doesn't contain a port or port_filter in the conf
  # section, we will scan all the ports that a matching process is listening to.
  process_filter:
    - exclude:
        process.name: docker-proxy
    - exclude:
        container.image: sysdig/agent
    # special rule to exclude processes matching configured prometheus appcheck
    - exclude:
        appcheck.match: prometheus
    - include:
        container.label.io.prometheus.scrape: "true"
        conf:
            # Custom path definition
            # If the Label doesn't exist we'll still use "/metrics"
            path: "{container.label.io.prometheus.path}"
 
            # Port definition
            # - If the Label exists, only scan the given port.
            # - If it doesn't, use port_filter instead.
            # - If there is no port_filter defined, skip this process
            port: "{container.label.io.prometheus.port}"
            port_filter:
                - exclude: [9092,9200,9300]
                - include: 9090-9500
                - include: [9913,9984,24231,42004]
    - exclude:
        container.label.io.prometheus.scrape: "false"
    - include:
        kubernetes.pod.annotation.prometheus.io/scrape: true
        conf:
            path: "{kubernetes.pod.annotation.prometheus.io/path}"
            port: "{kubernetes.pod.annotation.prometheus.io/port}"
    - exclude:
        kubernetes.pod.annotation.prometheus.io/scrape: false</pre><p>Things to note about this default configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Once enabled, this default configuration is ideal for the use case described above in the <a class="link" href="">Quick Start For Kubernetes Environments</a>.</p></li><li class="listitem"><p>All Prometheus scraping is disabled by default to allow for a smooth transition for users of the legacy Prometheus Application Check (see <a class="link" href="">the note below</a>). To enable the entire config shown here, you would only need to add the following to your <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span>:</p><pre class="programlisting">prometheus:
  enabled: true</pre></li><li class="listitem"><p>A Process Filter rule excludes processes that are likely to exist in most environments but are known to never export Prometheus metrics, such as the Docker Proxy and the Agent itself.</p></li><li class="listitem"><p>Another Process Filter rule ensures that any processes configured to be scraped by the legacy Prometheus Application Check will not be scraped. See <a class="link" href="">the section below on the Legacy Prometheus Application Check</a> for details.</p></li><li class="listitem"><p>Another Process Filter rule is tailored to use of container Labels. Processes marked with the container Label <span class="bold bold"><strong> <code class="code">io.prometheus.scrape</code> </strong></span> will become eligible for scraping, and if further marked with container Labels <span class="bold bold"><strong> <code class="code">io.prometheus.port</code> </strong></span> and/or <span class="bold bold"><strong> <code class="code">io.prometheus.path</code> </strong></span>, scraping will be attempted only on this port and/or endpoint. If the container is not marked with the specified path Label, scraping the <span class="bold bold"><strong> <code class="code">/metrics</code> </strong></span> endpoint will be attempted. If the container is not marked with the specified port Label, any listening ports in the <span class="bold bold"><strong> <code class="code">port_filter</code> </strong></span> will be attempted for scraping (this <span class="bold bold"><strong> <code class="code">port_filter</code> </strong></span> in the default is set for the <a class="link" href="https://github.com/prometheus/prometheus/wiki/Default-port-allocations" target="_blank">range of ports for common Prometheus exporters</a>, with exclusions for ports in the range that are known to be used by other applications that are not exporters).</p></li><li class="listitem"><p>The final Process Filter include rule is tailored to the use case described above in <a class="link" href="">Quick Start For Kubernetes Environments</a>.</p></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-ContainerEnvironment"><div class="titlepage"><div><div class="title"><h6 class="title">Container Environment</h6></div></div></div><p>With this default configuration enabled, a containerized install of our example exporter shown below would be automatically scraped via the Agent.</p><pre class="programlisting"># docker run -d -p 8080:8080 \
    --label io.prometheus.scrape="true" \
    --label io.prometheus.port="8080" \
    --label io.prometheus.path="/prometheus" \
    luca3m/prometheus-java-app</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-KubernetesEnvironment"><div class="titlepage"><div><div class="title"><h6 class="title">Kubernetes Environment</h6></div></div></div><p>In a Kubernetes-based environment, a Deployment with the Annotations as shown in using <a class="link" href="https://raw.githubusercontent.com/luca3m/app-examples/master/prometheus-java/prometheus-java-app.yaml" target="_blank">this example YAML</a> would also be scraped by enabling the default configuration.</p><pre class="programlisting">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: prometheus-java-app
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: prometheus-java-app
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/path: "/prometheus"
        prometheus.io/port: "8080"
    spec:
      containers:
        - name: prometheus-java-app
          image: luca3m/prometheus-java-app
          imagePullPolicy: Always

</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-Non-ContainerizedEnvironment"><div class="titlepage"><div><div class="title"><h6 class="title">Non-Containerized Environment</h6></div></div></div><p>This is an example of a non-containerized environment or a containerized environment that doesn't use Labels or Annotations. The following <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span> would override the default and do per-second scrapes of our sample exporter and also a second exporter on port 5005, each at their respective non-standard endpoints. This can be thought of as a conservative "whitelist" type of configuration since it restricts scraping to only exporters that are known to exist in the environment and the ports on which they're known to export Prometheus metrics.</p><pre class="programlisting">prometheus:
  enabled: true
  interval: 1
  process_filter:
    - include:
        process.cmdline: "*app.jar*"
        conf:
          port: 8080
          path: "/prometheus"
    - include:
        port: 5005
        conf:
          port: 5005
          path: "/wacko"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-ContainerEnvironment" title="Container Environment">Container Environment</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-KubernetesEnvironment" title="Kubernetes Environment">Kubernetes Environment </a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-Non-ContainerizedEnvironment" title="Non-Containerized Environment">Non-Containerized Environment</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-34422b16-7fcd-3a85-26d3-bb4d94d1288a" data-publication-date="" id="UUID-da55674a-f9da-039c-8601-bb8dc6d16dfe"><div class="titlepage"><div><div class="title"><h5 class="title">Enabling Histogram Metrics</h5></div></div></div><p>By default, the Agent does not scrape details for the histogram metrics reported by exporters. To enable this, include the additional <span class="bold bold"><strong><code class="code">histograms</code></strong></span> option:</p><pre class="programlisting">prometheus:
  enabled: true
  histograms: true</pre><p>Note that the way Prometheus histograms are typically reported by exporters, they are <a class="link" href="https://www.robustperception.io/why-are-prometheus-histograms-cumulative/" target="_blank">cumulative across buckets</a> and also report accumulations within each bucket range since the exporter started. To make this data easier to visualize, the Sysdig Monitor application presents histogram data as a delta over the selected time range. For instance, below we've had our <a class="link" href="https://hub.docker.com/r/luca3m/prometheus-java-app/" target="_blank">sample Prometheus exporter</a> running for over an hour, accumulating data in a histogram metric called random:</p><pre class="programlisting"># curl http://127.0.0.1:8080/prometheus
...
# HELP random Random sleep
# TYPE random histogram
random_bucket{le="0.005",} 33.0
random_bucket{le="0.01",} 74.0
random_bucket{le="0.025",} 180.0
random_bucket{le="0.05",} 404.0
random_bucket{le="0.075",} 639.0
random_bucket{le="0.1",} 848.0
random_bucket{le="0.25",} 2145.0
random_bucket{le="0.5",} 4307.0
random_bucket{le="0.75",} 6371.0
random_bucket{le="1.0",} 8592.0
random_bucket{le="2.5",} 8619.0
random_bucket{le="5.0",} 8619.0
random_bucket{le="7.5",} 8619.0
random_bucket{le="10.0",} 8619.0
random_bucket{le="+Inf",} 8619.0
...</pre><p>However in the Sysdig Monitor interface, if we select the metric and a time range such as 10 minutes, we'll see the per-bucket distribution for only that time range. Hover your mouse over a particular bar to see the bucket range. If this histogram metric is being reported from multiple sources, you will see the contribution to the total from each source based on your choice of <span class="bold bold"><strong>Segment by</strong></span>. In this case we are segmenting by hostname and only have one contributing source, called "ubuntu16".</p><div class="mediaobject"><table border="0" class="image-viewport" style="cellpadding: 0; cellspacing: 0;" width="1024px"><tr style="height: 667px"><td><img src="image/15d5af4f87f4e9.png" style="max-width: 1024px; max-height: 667px; " alt="373621863.png"></img></td></tr></table></div></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-23ab4e27-6d6d-9ad9-b6c9-90eaea6d9c41" data-publication-date="" id="UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140"><div class="titlepage"><div><div class="title"><h5 class="title">Logging and Troubleshooting</h5></div></div></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140_id_LoggingandTroubleshooting-Logging"><div class="titlepage"><div><div class="title"><h6 class="title">Logging</h6></div></div></div><p>After the Agent begins scraping Prometheus metrics, there may be a delay of up to a few minutes before the metrics become visible in Sysdig Monitor. To help quickly confirm your configuration is correct, starting with Agent version 0.80.0, the following log line will appear in the Agent log the first time since starting that it has found and is successfully scraping at least one Prometheus exporter:</p><pre class="programlisting">2018-05-04 21:42:10.048, 8820, Information, 05-04 21:42:10.048324 Starting export of Prometheus metrics</pre><p>As this is an INFO level log message, it will appear in Agents using the default logging settings. To reveal even more detail, <a class="xref" href="33836-17701-sysdig-agent.html#UUID-eeef951d-d042-19ed-3be1-4ac4cec9f193" title="Optional: Change the Agent Log Level"><span class="xreftitle">Optional: Change the Agent Log Level</span></a> , which produces a message like the following that reveals the name of a specific metric first detected. You can then look for this metric to be visible in Sysdig Monitor shortly after.</p><pre class="programlisting">2018-05-04 21:50:46.068, 11212, Debug, 05-04 21:50:46.068141 First prometheus metrics since agent start: pid 9583: 5 metrics including: randomSummary.95percentile</pre></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140_id_LoggingandTroubleshooting-Troubleshooting"><div class="titlepage"><div><div class="title"><h6 class="title">Troubleshooting</h6></div></div></div><p>See the previous section for information on expected log messages during successful scraping. If you have enabled Prometheus and are not seeing the <span class="bold bold"><strong><code class="code">Starting export</code></strong></span> message shown there, revisit your configuration.</p><p>It is also suggested to leave the configuration option in its default setting of <span class="bold bold"><strong><code class="code">log_errors: true</code></strong></span>, which will reveal any issues scraping eligible processes in the Agent log.</p><p>For example, here is an error message for a failed scrape of a TCP port that was listening but not accepting HTTP requests:</p><pre class="programlisting">2017-10-13 22:00:12.076, 4984, Error, sdchecks[4987] Exception on running check prometheus.5000: Exception('Timeout when hitting http://localhost:5000/metrics',)
2017-10-13 22:00:12.076, 4984, Error, sdchecks, Traceback (most recent call last):
2017-10-13 22:00:12.076, 4984, Error, sdchecks, File "/opt/draios/lib/python/sdchecks.py", line 246, in run
2017-10-13 22:00:12.076, 4984, Error, sdchecks, self.check_instance.check(self.instance_conf)
2017-10-13 22:00:12.076, 4984, Error, sdchecks, File "/opt/draios/lib/python/checks.d/prometheus.py", line 44, in check
2017-10-13 22:00:12.076, 4984, Error, sdchecks, metrics = self.get_prometheus_metrics(query_url, timeout, "prometheus")
2017-10-13 22:00:12.076, 4984, Error, sdchecks, File "/opt/draios/lib/python/checks.d/prometheus.py", line 105, in get_prometheus_metrics
2017-10-13 22:00:12.077, 4984, Error, sdchecks, raise Exception("Timeout when hitting %s" % url)
2017-10-13 22:00:12.077, 4984, Error, sdchecks, Exception: Timeout when hitting http://localhost:5000/metrics</pre><p>Here is an example error message for a failed scrape of a port that was responding to HTTP requests on the <span class="bold bold"><strong><code class="code">/metrics</code></strong></span> endpoint but not responding with valid Prometheus-format data. The invalid endpoint is responding as follows:</p><pre class="programlisting"># curl http://localhost:5002/metrics
This ain't no Prometheus metrics!</pre><p>And the corresponding error message in the Agent log, indicating no further scraping will be attempted after the initial failure:</p><pre class="programlisting">2017-10-13 22:03:05.081, 5216, Information, sdchecks[5219] Skip retries for Prometheus error: could not convert string to float: ain't
2017-10-13 22:03:05.082, 5216, Error, sdchecks[5219] Exception on running check prometheus.5002: could not convert string to float: ain't</pre></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-342fa844-e78f-96bf-6c74-8b614468fe9e" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195"><div class="titlepage"><div><div class="title"><h5 class="title">Collecting Prometheus Metrics from Remote Hosts</h5></div></div></div><p>Sysdig Monitor can collect Prometheus metrics from remote endpoints with minimum configuration. Remote endpoints (remote hosts) refer to hosts where Sysdig Agent cannot be deployed. For example, a Kubernetes master node on managed Kubernetes services such as GKE and EKS where user workload cannot be deployed, which in turn implies no Agents involved. Enabling remote scraping on such hosts is as simple as identifying an Agent to perform the scraping and declaring the endpoint configurations with a remote services section in the Agent configuration file.</p><p>The collected Prometheus metrics are reported under and associated with the Agent that performed the scraping as opposed to associating them with a process.</p><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingtheConfigurationFile"><div class="titlepage"><div><div class="title"><h6 class="title">Preparing the Configuration File</h6></div></div></div><p>Multiple Agents can share the same configuration. Therefore, determine which one of those Agents scrape the remote endpoints with the <span class="bold bold"><strong> <code class="code">dragent.yaml</code> </strong></span> file. This is applicable to both</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create a separate configuration section for remote services in the Agent configuration file under the <code class="code">prometheus</code> configuration.</p></li><li class="listitem"><p>Include a configuration section for each remote endpoint, and add either a URL or host/port (and an optional path) parameter to each section to identify the endpoint to scrape. The optional path identifies the resource at the endpoint. An empty path parameter defaults to the <code class="code">"/metrics"</code> endpoint for scraping.</p></li><li class="listitem"><p>Optionally, add custom tags for each endpoint configuration for remote services. In the absence of tags, metric reporting might not work as expected when multiple endpoints are involved. Agents cannot distinguish similar metrics scraped from multiple endpoints unless those metrics are uniquely identified by tags.</p></li></ul></div><p>To help you get started, an example configuration for Kubernetes is given below:</p><pre class="programlisting">prometheus:
  remote_services:
        - prom_1:
            kubernetes.node.annotation.sysdig.com/region: europe
            kubernetes.node.annotation.sysdig.com/scraper: true
            conf:
                url: "https://xx.xxx.xxx.xy:5005/metrics"
                tags:
                    host: xx.xxx.xxx.xy
                    service: prom_1
                    scraping_node: "{kubernetes.node.name}"
        - prom_2:
            kubernetes.node.annotation.sysdig.com/region: india
            kubernetes.node.annotation.sysdig.com/scraper: true
            conf:
                host: xx.xxx.xxx.yx
                port: 5005
                use_https: true
                tags:
                    host: xx.xxx.xxx.yx
                    service: prom_2
                    scraping_node: "{kubernetes.node.name}"
        - prom_3:
            kubernetes.pod.annotation.sysdig.com/prom_3_scraper: true
            conf:
                url: "{kubernetes.pod.annotation.sysdig.com/prom_3_url}"
                tags:
                    service: prom_3
                    scraping_node: "{kubernetes.node.name}"
        - haproxy:
            kubernetes.node.annotation.yourhost.com/haproxy_scraper: true
            conf:
                host: "mymasternode"
                port: 1936
                path: "/metrics"
                username: "{kubernetes.node.annotation.yourhost.com/haproxy_username}"
                password: "{kubernetes.node.annotation.yourhost.com/haproxy_password}"
                tags:
                    service: router</pre><p>In the above example, scraping is triggered by node and pod annotations. You can add annotations to nodes and pods by using the <code class="code">kubectl annotate</code> command as follows:</p><pre class="programlisting">kubectl annotate node mynode --overwrite sysdig.com/region=india sysdig.com/scraper=true haproxy_scraper=true yourhost.com/haproxy_username=admin yourhost.com/haproxy_password=admin</pre><p>In this example, you set annotation on a node to trigger scraping of the <code class="code">prom2</code> and <code class="code">haproxy</code> services as defined in the above configuration.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingContainerEnvironments"><div class="titlepage"><div><div class="title"><h6 class="title">Preparing Container Environments</h6></div></div></div><p>An example configuration for Docker environment is given below:</p><pre class="programlisting">prometheus:
  remote_services:
        - prom_container:
            container.label.com.sysdig.scrape_xyz: true
            conf:
                url: "https://xyz:5005/metrics"
                tags:
                    host: xyz
                    service: xyz</pre><p>In order for remote scraping to work in a Docker-based container environment, set the <code class="code">com.sysdig.scrape_xyz=true</code> label to the Agent container. For example:</p><pre class="programlisting">docker run -d --name sysdig-agent --restart always --privileged --net host --pid host -e ACCESS_KEY=&lt;KEY&gt; -e COLLECTOR=&lt;COLLECTOR&gt; -e SECURE=true -e TAGS=example_tag:example_value -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro --shm-size=512m sysdig/agent</pre><p>Substitute &lt;<code class="code">KEY</code>&gt;, &lt;<code class="code">COLLECTOR</code>&gt;, <code class="code">TAGS</code> with your account key, collector, and tags respectively.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-SyntaxoftheRules"><div class="titlepage"><div><div class="title"><h6 class="title">Syntax of the Rules</h6></div></div></div><p>The syntax of the rules for the<code class="code">remote_services</code>is almost identical to those of<code class="code">process_filter</code>with an exception to the include/exclude rule. The<code class="code">remote_services</code>section does not use include/exclude rules. The<code class="code">process_filter</code>uses include and exclude rules of which only the first match against a process is applied, whereas, in the<code class="code">remote_services</code>section, each rule has a corresponding service name and all the matching rules are applied.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-RuleConditions"><div class="titlepage"><div><div class="title"><h6 class="title">Rule Conditions</h6></div></div></div><p>The rule conditions work the same way as those for the <code class="code">process_filter</code>. The only caveat is that the rules will be matched against the Agent process and container because the remote process/context is unknown. Therefore, matches for container labels and annotations work as before but they must be applicable to the Agent container as well. For instance, node annotations will apply because the Agent container runs on a node.</p><p>For annotations, multiple patterns can be specified in a single rule, in which case all patterns must match for the rule to be a match (AND operator). In the following example, the endpoint will not be considered unless both the annotations match:</p><pre class="programlisting">kubernetes.node.annotation.sysdig.com/region_scraper: europe
kubernetes.node.annotation.sysdig.com/scraper: true</pre><p>That is, Kubernetes nodes belonging to only the Europe region are considered for scraping.</p></section><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-AuthenticatingSysdigAgent"><div class="titlepage"><div><div class="title"><h6 class="title">Authenticating Sysdig Agent</h6></div></div></div><p>Sysdig Agent requires necessary permissions on the remote host to scrape for metrics. The <a class="link" href="">authentication methods</a> for local scraping works for authenticating Agents on remote hosts as well, but the authorization parameters work only in the Agent context.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Authentication based on certificate-key pair requires it to be constructed into Kubernetes secret and mounted to the agent.</p></li><li class="listitem"><p>In token-based authentication, make sure the agent token has access rights on the remote endpoint to do the scraping.</p></li><li class="listitem"><p>Use annotation to retrieve username/password instead of passing them in plaintext. Any annotation enclosed in curly braces will be replaced by the value of the annotation. If the annotation doesn't exist the value will be an empty string. Token substitution is supported for all the authorization parameters. Because authorization works only in the Agent context, credentials cannot be automatically retrieved from the target pod. Therefore, use an annotation in the Agent pod to pass them. To do so, set the password into an annotation for the selected Kubernetes object.</p></li></ul></div><p>In the following example, an haproxy account is authenticated with the password supplied in the <code class="code"> <a class="link" href="http://yourhost.com/haproxy_password" target="_blank">yourhost.com/haproxy_password</a> </code> annotation on the Agent node.</p><pre class="programlisting">- haproxy:
            kubernetes.node.annotation.yourhost.com/haproxy_scraper: true
            conf:
                host: "mymasternode"
                port: 1936
                path: "/metrics"
                username: "{kubernetes.node.annotation.yourhost.com/haproxy_username}"
                password: "{kubernetes.node.annotation.yourhost.com/haproxy_password}"
                tags:
                    service: router</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingtheConfigurationFile" title="Preparing the Configuration File">Preparing the Configuration File</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingContainerEnvironments" title="Preparing Container Environments">Preparing Container Environments</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-SyntaxoftheRules" title="Syntax of the Rules">Syntax of the Rules</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-RuleConditions" title="Rule Conditions">Rule Conditions</a> </p></li><li class="listitem"><p> <a class="link" href="33836-3105-integrate-prometheus-metrics.html#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-AuthenticatingSysdigAgent" title="Authenticating Sysdig Agent">Authenticating Sysdig Agent</a> </p></li></ul></div></section></section><section xml:lang="en" dir="ltr" class="section original-topic lang-en original-topic" data-origin-id="UUID-533d714c-4898-196c-9fc3-0f65ec54908f" data-publication-date="" id="UUID-11a81234-9117-3163-f6e4-2c374afbc53e"><div class="titlepage"><div><div class="title"><h5 class="title">Legacy Prometheus Application Check</h5></div></div></div><p>Special care should be taken if you're already using the <span class="bold bold"><strong>legacy Prometheus Application Check</strong></span> (explained below) to scrape any Prometheus metrics. You will be able to scrape for the same metrics using the new approach and they will appear in Sysdig Monitor under the same metric name. However, any historical data from when it was collected via the legacy Prometheus App Check will no longer be visible. As a result, the new approach is disabled by default, and you should carefully plan your transition to using the new approach for each set of metrics when you feel you can endure the break with historical data.</p><p>The <span class="bold bold"><strong>legacy Prometheus application check</strong></span> is able to collect metrics from a static external HTTP endpoint exposing metrics in Prometheus format and import them as StatsD metrics in Sysdig.</p><p>To configure the legacy Prometheus application check, Add these lines to the agent's configuration file:</p><pre class="programlisting">app_checks:
  - name: prometheus
    pattern:
      comm: python
      arg: /opt/draios/bin/sdchecks
    conf:
      url: http://{YOUR_PROMETHEUS_ENDPOINT_IP}:8080/metrics</pre></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-0b1882da-ba8f-f931-69ea-3aa0745dce46">Integrate Prometheus Metrics</a></li><li><a href="#UUID-abe1f333-29ec-3a81-16d7-7abd7403ee67">Working with Prometheus Metrics</a></li><li><a href="#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4">Setting up the Environment</a><ul class="nav"><li><a href="#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-quickstartQuickStartForKubernetesEnvironments">Quick Start For Kubernetes Environments</a></li><li><a href="#UUID-6d12a7fd-2616-e21b-7bb3-128ffdeb36e4_id_SettinguptheEnvironment-QuickStartforContainerEnvironments">Quick Start for Container Environments</a></li></ul></li><li><a href="#UUID-f447e6fa-032a-15a6-b276-9391b8c89815">Configuring Sysdig Agent</a><ul class="nav"><li><a href="#UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-MainConfigParameters">Main Config Parameters</a></li><li><a href="#UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-processfilterProcessFilter">Process Filter</a></li><li><a href="#UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-confconf">conf</a></li><li><a href="#UUID-f447e6fa-032a-15a6-b276-9391b8c89815_id_ConfiguringSysdigAgent-objectsKubernetesObjects">Kubernetes Objects</a></li></ul></li><li><a href="#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f">Example Configuration</a><ul class="nav"><li><a href="#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-ContainerEnvironment">Container Environment</a></li><li><a href="#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-KubernetesEnvironment">Kubernetes Environment</a></li><li><a href="#UUID-e29d43d9-ab40-fbb6-47dc-bcb9c42c0f2f_id_ExampleConfiguration-Non-ContainerizedEnvironment">Non-Containerized Environment</a></li></ul></li><li><a href="#UUID-da55674a-f9da-039c-8601-bb8dc6d16dfe">Enabling Histogram Metrics</a></li><li><a href="#UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140">Logging and Troubleshooting</a><ul class="nav"><li><a href="#UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140_id_LoggingandTroubleshooting-Logging">Logging</a></li><li><a href="#UUID-a8d96023-0f73-2b3e-ce5a-815c4f75b140_id_LoggingandTroubleshooting-Troubleshooting">Troubleshooting</a></li></ul></li><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195">Collecting Prometheus Metrics from Remote Hosts</a><ul class="nav"><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingtheConfigurationFile">Preparing the Configuration File</a></li><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-PreparingContainerEnvironments">Preparing Container Environments</a></li><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-SyntaxoftheRules">Syntax of the Rules</a></li><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-RuleConditions">Rule Conditions</a></li><li><a href="#UUID-3c9c55c7-639c-12f9-3a33-685cb69a8195_id_CollectingPrometheusMetricsfromRemoteHosts-AuthenticatingSysdigAgent">Authenticating Sysdig Agent</a></li></ul></li><li><a href="#UUID-11a81234-9117-3163-f6e4-2c374afbc53e">Legacy Prometheus Application Check</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div class="voting-title">Was this helpful?</div><div class="btn-group btn-group-toggle" data-toggle="buttons"><button id="feedback-yes-btn" class="btn toggle-yes">Yes</button><button id="feedback-no-btn" class="btn">No</button></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="33836-3104-sysdig-integrations.html#UUID-9c0339a4-b266-fe6b-c308-daa15519cea2_id_SysdigIntegrations-KeyIntegrations">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="33836-3117-integrate-jmx-metrics-from-java-virtual-machines.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> Â© 2019 Sysdig </div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
